<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Case Study: Introducing Pants to Oxbotica | Pantsbuild</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://www.pantsbuild.org/img/social-card.png /><meta data-rh=true name=twitter:image content=https://www.pantsbuild.org/img/social-card.png /><meta data-rh=true property=og:url content=https://www.pantsbuild.org/blog/2022/11/04/introducing-pants-to-oxbotica /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docusaurus_tag content=default /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docsearch:docusaurus_tag content=default /><meta data-rh=true property=og:title content="Case Study: Introducing Pants to Oxbotica | Pantsbuild"/><meta data-rh=true name=description content="Photo by [Jake"/><meta data-rh=true property=og:description content="Photo by [Jake"/><meta data-rh=true property=og:type content=article /><meta data-rh=true property=article:published_time content=2022-11-04T00:00:00.000Z /><meta data-rh=true property=article:author content=https://github.com/AlexTereshenkov /><meta data-rh=true property=article:tag content=ci,python,case-studies /><link data-rh=true rel=icon href=/img/favicon.ico /><link data-rh=true rel=canonical href=https://www.pantsbuild.org/blog/2022/11/04/introducing-pants-to-oxbotica /><link data-rh=true rel=alternate href=https://www.pantsbuild.org/blog/2022/11/04/introducing-pants-to-oxbotica hreflang=en /><link data-rh=true rel=alternate href=https://www.pantsbuild.org/blog/2022/11/04/introducing-pants-to-oxbotica hreflang=x-default /><link data-rh=true rel=preconnect href=https://QD9KY1TRVK-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://www.pantsbuild.org/blog/2022/11/04/introducing-pants-to-oxbotica","@type":"BlogPosting","author":{"@type":"Person","description":"Pants Maintainer","image":"https://github.com/AlexTereshenkov.png","name":"Alexey Tereshenkov","url":"https://github.com/AlexTereshenkov"},"datePublished":"2022-11-04T00:00:00.000Z","description":"Photo by [Jake","headline":"Case Study: Introducing Pants to Oxbotica","isPartOf":{"@id":"https://www.pantsbuild.org/blog","@type":"Blog","name":"Blog"},"keywords":[],"mainEntityOfPage":"https://www.pantsbuild.org/blog/2022/11/04/introducing-pants-to-oxbotica","name":"Case Study: Introducing Pants to Oxbotica","url":"https://www.pantsbuild.org/blog/2022/11/04/introducing-pants-to-oxbotica"}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Pantsbuild RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Pantsbuild Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-SEHBXJRF42"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SEHBXJRF42",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=Pantsbuild href=/opensearch.xml><link rel=stylesheet href=/assets/css/styles.b71b45ed.css /><script src=/assets/js/runtime~main.43acf77f.js defer></script><script src=/assets/js/main.636c7439.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_lucK href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo.svg alt="My Site Logo" class="themedComponent_x_jL themedComponent--light_WGb9"/><img src=/img/logo.svg alt="My Site Logo" class="themedComponent_x_jL themedComponent--dark_oBxQ"/></div><b class="navbar__title text--truncate">Pantsbuild</b></a><a class="navbar__item navbar__link" href=/stable/docs/introduction/welcome-to-pants>Docs</a><a class="navbar__item navbar__link" href=/stable/reference/global-options>Reference</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/blog>Blog</a><a class="navbar__item navbar__link" href=/sponsors>Sponsors</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/stable/docs/introduction/welcome-to-pants>2.30</a><ul class=dropdown__menu><li><a class=dropdown__link href=/prerelease/docs/introduction/welcome-to-pants>2.31 (prerelease)</a><li><a class=dropdown__link href=/stable/docs/introduction/welcome-to-pants>2.30</a><li><a class=dropdown__link href=/2.29/docs/introduction/welcome-to-pants>2.29</a><li><a class=dropdown__link href=/2.28/docs/introduction/welcome-to-pants>2.28 (deprecated)</a><li class=""><hr class=dropdown-separator><li><a class=dropdown__link href=/versions>All Versions</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Slack</a><ul class=dropdown__menu><li><a href=https://pantsbuild.slack.com target=_blank rel="noopener noreferrer" class=dropdown__link>Workspace<svg width=12 height=12 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><li><a href="https://docs.google.com/forms/d/e/1FAIpQLSf9zgf-MXRnVDJbrVEST3urqneq7LCcy0zw8qU-GH4hPMn52A/viewform?usp=sf_link" target=_blank rel="noopener noreferrer" class=dropdown__link>Workspace Invite<svg width=12 height=12 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><li><a href=https://chat.pantsbuild.org target=_blank rel="noopener noreferrer" class=dropdown__link>Linen Mirror<svg width=12 height=12 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a></ul></div><a href=https://github.com/pantsbuild/pants target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><div class=navbarSearchContainer_Mydu><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div><div class="toggle_AwgP colorModeToggle_rXRM"><button class="clean-btn toggleButton_kTC9 toggleButtonDisabled_N4X8" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_X8HE lightToggleIcon_cay9"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_X8HE darkToggleIcon_B6hH"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_X8HE systemToggleIcon_k4zv"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_GzA5"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_cLTH thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_C3sy margin-bottom--md">All posts</div><div role=group><h3 class=yearGroupHeading_Wib2>2025</h3><ul class="sidebarItemList_iEWr clean-list"><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2025/12/11/lockfile-metadata-files>Writing Python lockfile metadata to separate files</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2025/12/10/pants-2-30>Pants 2.30.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2025/10/06/winding-down-macos-intel-support>When to Wind Down MacOS Intel Support</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2025/10/03/pants-2-29>Pants 2.29.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2025/09/08/pants-2-28>Pants 2.28.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2025/06/30/pants-2-27>Pants 2.27.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2025/06/29/introducing-the-sandboxer>Introducing the Sandboxer!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2025/05/05/pants-2-26>Pants 2.26.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2025/03/01/pants-2-25>Pants 2.25.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2025/01/28/pants-2-24>Pants 2.24.0 is released!</a></ul></div><div role=group><h3 class=yearGroupHeading_Wib2>2024</h3><ul class="sidebarItemList_iEWr clean-list"><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/12/04/workspace-environments>In-Workspace Execution in Pants v2.23.x</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/11/20/pants-2-23>Pants 2.23.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/10/08/user-survey-2024>2024 Pantsbuild User Survey</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/09/10/pants-2-22>Pants 2.22.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/08/24/venerable-pythons>Venerable Pythons, Pants, Pip, and Ecosystems</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/07/01/building-linux-on-osx-silicon>Building Linux/x64 containers on OS X on Apple Silicon with Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/06/13/announcing-klaviyo-sponsorship>Announcing Klaviyo's Sponsorship</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/05/29/pants-2-21>Pants 2.21.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/04/27/simple-versioning-with-git-tags>Simple versioning with git tags</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/03/27/pants-2-20>Pants 2.20.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/01/25/inspecting-dependency-inference-results>Inspecting dependency inference results</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2024/01/24/pants-2-19>Pants 2.19.0 is released!</a></ul></div><div role=group><h3 class=yearGroupHeading_Wib2>2023</h3><ul class="sidebarItemList_iEWr clean-list"><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/11/14/pants-2.18.0-is-released>Pants 2.18.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/08/30/pants-2-17-0-is-released>Pants 2.17.0 is released!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/07/03/sharing-pants-plugins>Sharing Pants plugins</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/06/16/pants-2-16-0>Pants 2.16.0 is here!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/04/25/visibility-feature-in-pants-2-16>Visibility features coming in Pants 2.16</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/04/01/new-chat-archive>Tada, it's our new chat archive!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/03/31/two-hermetic-pythons>Two hermetic Pythons</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/03/28/environments-simpler-multi-platform-workflows>Environments: simpler multi-platform workflows</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/03/02/what-we-mean-by-contributing-to-pants>What we mean by "contributing" to Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/03/02/write-or-speak-about-pants-communitys-favorite-topics>Write (or speak) about any of Pants community's favorite topics!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/02/28/linting-python-at-warp-speed>Linting Python at warp speed with Pants+Ruff</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/02/24/choosing-a-python-packaging-format>Challenges in choosing a Python packaging format</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/02/24/pants-2-15>Pants 2.15: Easier multi-platform workflows, Docker build support, automatic code cleanup, and more!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/02/24/pantsbuild-community-survey-2023>Pantsbuild Community Survey 2023</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/02/23/the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants>The pants launcher binary - a much simpler way to install and run Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/02/14/my-experience-as-a-pantsbuild-maintainer>My experience as a Pantsbuild maintainer</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2023/01/03/tweag-case-study>Tweag case study: From adopting Pants, to generalizing our CI to multiple Python versions</a></ul></div><div role=group><h3 class=yearGroupHeading_Wib2>2022</h3><ul class="sidebarItemList_iEWr clean-list"><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/11/21/quick-feedback-on-new-features-via-experimental-backends>How we get quick feedback on new features via "experimental" backends</a><li class=sidebarItem_O5rf><a aria-current=page class="sidebarItemLink_BBtq sidebarItemLinkActive_kBWW" href=/blog/2022/11/04/introducing-pants-to-oxbotica>Case Study: Introducing Pants to Oxbotica</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/10/27/celebrating-two-years-of-pants-2>Celebrating two years of Pants 2</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/10/27/why-dependency-inference>Dependency inference: Pants's special sauce</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/10/26/pants-2-14>Pants 2.14: Less boilerplate, more Rust, better support for Go monorepos, interactive debugging support, and more!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/10/10/skipping-github-actions-jobs-without-breaking-branch-protection>Skipping GitHub Actions jobs while keeping branch protection rules that require them</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/09/02/meet-our-newest-maintainer-a-alonso-dominguez>Meet our newest Maintainer: A. Alonso Dominguez</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/09/01/introducing-pants-2-13>Pants 2.13: Easier at the command line, easier parallel execution in CI, Kotlin support, and better Python and JVM support!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/08/12/astranis-case-study-wrangling-python-in-a-monorepo>Astranis Case Study: Wrangling Python In a Monorepo</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/08/05/monorepository-linting-via-pants-project-introspection>Monorepository linting via Pants's project introspection</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/08/02/optimizing-python-docker-deploys-using-pants>Optimizing Python + Docker deploys using Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/07/28/better-ci-cd-caching-with-pants>Better CI/CD caching with Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/06/29/pants-2-12>Pants 2.12: Improved performance for common cases, IDE support for Java and Scala</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/06/17/m1-support-self-hosted>How we streamlined Apple M1 Support with self-hosted Github Actions runners</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/05/25/multiple-lockfiles-python>Multiple lockfiles in Python repos</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/05/02/introducing-pants-2-11>Pants 2.11 adds Go Protobuf codegen, Pex lockfiles for Python, and parametrization</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/05/01/pycon-us-2022-talk>Talk Notes: PyCon US 2022 - Hermetic Environments in Pantsbuild</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/03/23/introducing-pants-2-10>Pants 2.10 adds multiple Python lockfile support, PyOxidizer, Thrift codegen, and better linter parallelization</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/03/21/the-2022-annual-community-survey-is-a-wrap-and-the-results-are-in>The 2022 annual community survey is a wrap, and the results are in!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/03/15/effective-monorepos-with-pants>Effective monorepos with Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/03/09/the-monorepo-approach-to-code-management>The monorepo approach to code management</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/03/07/thrift-python>Pants 2.10 adds Apache Thrift support for Python</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/02/28/meet-our-newest-maintainer-alexey-tereshenkov>Meet our newest Maintainer: Alexey Tereshenkov</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/02/18/packaging-python-with-the-pyoxidizer-pants-plugin>Packaging Python with the PyOxidizer Pants Plugin</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/02/15/choosing-a-python-interpreter-for-a-pants-project>Choosing a Python interpreter for a Pants project</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/02/15/new-maintainer-joshua-cannon>Meet our newest Maintainer: Joshua Cannon</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/01/12/pants-2-9>Pants 2.9: Alpha support for Java and Scala, improvements for Docker and Go, and more</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/01/12/you-can-call-us-pantsbuild-or-pants-whichever-you-prefer>You can call us Pantsbuild (or Pants, whichever you prefer)</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/01/06/updating-pants-build-files-programmatically>Updating Pants BUILD files programmatically</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2022/01/05/happy-new-year-2022>Happy new year!</a></ul></div><div role=group><h3 class=yearGroupHeading_Wib2>2021</h3><ul class="sidebarItemList_iEWr clean-list"><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/12/16/docs-improvements>Docs improvements</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/11/22/automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference>Automatically unlocking concurrent builds and fine-grained caching on the JVM with dependency inference</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/11/18/pants-vs-bazel>pants-vs-bazel</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/11/17/introducing-pants-2-8>Pants 2.8 adds Autoflake & Pyupgrade, Docker publishing, Golang, and Google Cloud Functions</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/11/10/golang-support-pants-28>Pants 2.8 adds experimental Golang support</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/10/27/pants-supports-pep-517>Pants supports PEP 517</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/10/21/podcasting-pants>Podcasting Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/10/13/pants-pex-and-docker>Streamline your Docker builds with Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/09/28/docker-support>Docker support in Pants 2.7</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/09/27/contributing-yapf-support>My experience contributing YAPF formatter support to Pants 2.7</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/09/27/introducing-pants-2-7>Introducing Pants 2.7: Python tool lockfiles, Yapf, Docker, and ./pants peek</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/09/14/meet-our-newest-maintainer-andreas-stenius>Meet our newest Maintainer: Andreas Stenius</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/08/02/introducing-pants-2-6>Introducing Pants 2.6: Poetry support, third-party type stubs, and linter reports</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/07/29/poetry-support-for-pants-2-6>Poetry support for Pants 2.6</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/06/28/pydev-of-the-week>PyDev of the Week</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/06/21/how-we-added-apple-silicon-support-to-pants>How we added Apple Silicon support to Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/05/20/introducing-pants-2-5>Introducing Pants 2.5: Shell support, config autodiscovery, and incremental tool adoption</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/05/12/pycon_us_2021>It's PyCon US Time!</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/04/30/introducing-pants-build-2-4-0>Introducing Pants Build 2.4.0</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/04/21/monorepos-and-performance>Monorepos and performance: Pants Build maintainer Benjy Weinberger's conversation with SemaphoreCI</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/03/22/introducing-pants-2-3-0>Introducing Pants Build 2.3.0</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/03/19/tailoring-pants-to-your-codebase>Tailoring Pants to your codebase</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/02/22/pants-2-2-adds-dependency-inference-for-protobuf>Pants 2.2 adds dependency inference for Protobuf</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2021/02/01/fast-incremental-builds-speculation-cancellation>fast-incremental-builds-speculation-cancellation</a></ul></div><div role=group><h3 class=yearGroupHeading_Wib2>2020</h3><ul class="sidebarItemList_iEWr clean-list"><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2020/11/25/talking-pants>Talking Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2020/11/17/python-3-migrations>Unlocking incremental Python 3 migrations with Pants</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2020/10/29/dependency-inference>Dependency inference: Precise caching and concurrency, without the boilerplate</a><li class=sidebarItem_O5rf><a class=sidebarItemLink_BBtq href=/blog/2020/10/27/introducing-pants-v2>Introducing Pants v2</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_XRK8>Case Study: Introducing Pants to Oxbotica</h1><div class="container_d4VT margin-vert--md"><time datetime=2022-11-04T00:00:00.000Z>November 4, 2022</time> · <!-- -->24 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_tvhT"><div class="avatar margin-bottom--sm"><a href=https://github.com/AlexTereshenkov target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_en77" src=https://github.com/AlexTereshenkov.png alt="Alexey Tereshenkov"/></a><div class="avatar__intro authorDetails_DHFq"><div class=avatar__name><a href=https://github.com/AlexTereshenkov target=_blank rel="noopener noreferrer"><span class=authorName_irTy translate=no>Alexey Tereshenkov</span></a></div><small class=authorTitle_4FLl title="Pants Maintainer">Pants Maintainer</small><div class=authorSocials_uJie></div></div></div></div></div></header><div id=__blog-post-container class=markdown><div><img decoding=async loading=lazy src=/assets/images/splash-9153ac052d566fc57af5eec83b97e117.jpg class=img_axWV /><figcaption><p>Photo by <a href="https://unsplash.com/@jakeblucker?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit" target=_blank rel="noopener noreferrer" class="">Jake
Blucker</a>
/
<a href="https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit" target=_blank rel="noopener noreferrer" class="">Unsplash</a></figcaption></div>
<p>A year in, builds take only a few minutes (~150K LOC, ~1500 tests), PRs have become smaller as devs no longer try to squeeze as much as code as possible into a single change, code reviews get completed much faster (and are more likely to provide useful feedback), development velocity has increased…</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=background>Background<a href=#background class=hash-link aria-label="Direct link to Background" title="Direct link to Background" translate=no>​</a></h2>
<p>At <a href=https://www.oxbotica.com/ target=_blank rel="noopener noreferrer" class="">Oxbotica</a>, we are on a mission to make the Earth move. The company is a global leader in autonomous vehicle software for businesses. This year an Oxbotica vehicles set the Europe-first precedent for zero-occupancy autonomous vehicle journey on publicly-accessible roads. Founded in 2014 and headquartered in Oxfordshire, England, we are a fast-growth company focused on artificial intelligence engineering, machine learning and modular software design.</p>
<p>Our Python code repository represents a unified codebase containing code for multiple projects that share underlying dependencies, functionality, tooling, and processes. There are multiple teams within Oxbotica working on separate parts of the repository, but they very often overlap, particularly on these shared dependencies. However, as the organization and the codebase grew, the repository and its build complexity grew with it. Our company has used Pants in the Python monorepository for over a year now, and in this post I'll share our experience and the motivation to introduce Pants as a new build system for the our Python codebase.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=challenges>Challenges<a href=#challenges class=hash-link aria-label="Direct link to Challenges" title="Direct link to Challenges" translate=no>​</a></h2>
<p>As our company got bigger, more and more engineers started contributing to the Python repository. Each project was a <code>conda</code> package that has its 3rd party dependencies as well as peer dependencies (i.e. other projects in the same repo) declared in the <code>conda</code> build files. Local development workflow was fairly streamlined as developers spent most of their time within a single project and could run project tests. However, ensuring cross-project compatibility wasn't easy because <code>conda</code> had to resolve dependencies of each project independently. In addition, each package was versioned independently which meant that developers couldn't easily run the tests that span multiple projects since that would require spending too much time resolving dependencies and preparing the <code>conda</code> environments. This approach was quite inefficient as it's often unnecessary to rebuild and retest a project if its code and code of its dependencies haven't changed.</p>
<p>This way, even though all the code was stored in a single Git repository, technically, it was just a common storage of interdependent projects. It wasn't possible any longer to complete the local and CI builds in feasible time and after doing some research, we have decided that its time to move to a monorepository approach. This would ideally require bringing a special build system. That's how we discovered Pants.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=why-a-build-system>Why a build system?<a href=#why-a-build-system class=hash-link aria-label="Direct link to Why a build system?" title="Direct link to Why a build system?" translate=no>​</a></h2>
<p>Despite Python being an interpreted language that doesn't require compiling in a sense of compiled languages such as C++ or Java, the build process refers to build in a general sense. This refers to all the steps that one takes to go from writing the source code all the way through to having a deployable artifact that can be installed in an arbitrary Python environment. The build steps are likely to include:</p>
<ul>
<li class="">resolving and downloading external dependencies (from a global and/or a self-hosted private PyPI)</li>
<li class="">generating code if a code generator such as <a href=https://developers.google.com/protocol-buffers target=_blank rel="noopener noreferrer" class="">Protobuf</a> is used</li>
<li class="">type checking and static code analysis</li>
<li class="">running linters and formatters</li>
<li class="">running tests</li>
<li class="">packaging artifacts</li>
</ul>
<p>Standard Python ecosystem tools were not designed for monorepos, and they may do a lot of repeated work that may be unnecessary. However, the tooling already provides all the necessary functionality (e.g. <code>pip</code> for dependency resolution, <code>pytest</code> for running tests, <code>flake8</code> for linting), so we really only needed an orchestration system. As more advanced Python engineering practices will be enforced across all projects of the monorepo, as a Python developer, one will need to do a lot more than just to run the tests to validate that the code is correct and can be checked in. All the tools mentioned above need to be invoked with the right arguments, at the right time during the workflow, and in a way that the entire team will be able to reproduce.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=build-system-requirements>Build system requirements<a href=#build-system-requirements class=hash-link aria-label="Direct link to Build system requirements" title="Direct link to Build system requirements" translate=no>​</a></h2>
<p>We strongly believe that a good build system should coordinate all of those tools to provide a much smaller command-line interface to the team of software engineers. While one could write bespoke per-repo scripts (e.g. Shell or Makefile) to assist the developers ("use this command for this and these sequence of commands for that"), we really hoped to have a build system that could become a higher-level solution. Another benefit of using a build system we hoped to take advantage of was to invoke the tools in a way would allow using caching and incrementalism mechanisms (to minimize the amount of work that is re-done on the subsequent run). As testing within our codebase is often data driven and may involve reading large files and be quite time consuming, being able to cut the time spent running tests was critical to us.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=change-management>Change management<a href=#change-management class=hash-link aria-label="Direct link to Change management" title="Direct link to Change management" translate=no>​</a></h3>
<p>In his talk <a href="https://www.youtube.com/watch?v=N6ENyH4_r8U" target=_blank rel="noopener noreferrer" class="">Python monorepos: what, why and how</a>, Benjy Weinberger put well that the hardest problem of the monorepo is managing changes, managing dependencies and, most importantly, the overlap between those. Managing changes is hard per se, however, managing changes in the presence of dependencies is much harder, and vice versa.</p>
<p>After making changes to one of the projects within the monorepo, the necessary workflow would be:</p>
<ol>
<li class="">Find all the consumers of this project.</li>
<li class="">Ensure that they still work with the changes you made (by running their tests).</li>
<li class="">Make changes as needed until their tests pass.</li>
<li class="">Repeat recursively for all the projects you changed.</li>
</ol>
<p>At that time, it was done by building all projects using <a href=https://docs.conda.io/projects/conda-build/en/latest/index.html target=_blank rel="noopener noreferrer" class="">conda-build</a> recipes and then re-creating environments for each individual project pulling their updated dependencies and running the tests. Since all the clients of all the code are in the same repository, the breakages are immediately visible since one can run tests of all the relevant projects. However, this approach slows down a developer significantly, because running tests becomes very expensive since one has to run tests not only in the project they make changes in, but also across all other projects unless they know what the dependees of the project they work on are.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=why-pantsbuild>Why Pantsbuild?<a href=#why-pantsbuild class=hash-link aria-label="Direct link to Why Pantsbuild?" title="Direct link to Why Pantsbuild?" translate=no>​</a></h2>
<p><a href=https://www.pantsbuild.org/docs/python target=_blank rel="noopener noreferrer" class="">Pants v2</a> was specifically designed for the Python use case in contrast to other popular choices such as <a href=https://bazel.build/ target=_blank rel="noopener noreferrer" class="">Bazel</a>, <a href=https://buck.build/ target=_blank rel="noopener noreferrer" class="">Buck</a>, or <a href=https://please.build/ target=_blank rel="noopener noreferrer" class="">Please</a>. It is a ground-up redesign of based on lessons from 10 years of Pants v1 development.</p>
<p>We came to the conclusion that Pants v2 is a much better choice for Python monorepo because our only language of interest is Python and v2 removes friction present in v1 that caused some companies to migrate their multi-language monorepos to Bazel. As Pants v2 develops, support for additional languages continue to be added, which should provide us with the necessary tooling straight out-of-the-box should we start writing tools in, for example, Go.</p>
<p><a href=https://github.com/pantsbuild/pants/ target=_blank rel="noopener noreferrer" class="">Pants project</a> is actively developed, and the contributors are friendly and helpful. In 2018, <a href=https://toolchain.com/ target=_blank rel="noopener noreferrer" class="">Toolchain Labs</a> was founded by Pants' originators, John Sirois and Benjy Weinberger. The company leads development of Pants, and is staffed by other longtime Pants core team members. The open source project is foundational for these people. We reasoned that this should provide some guarantees on the long-term commitment to the open-source project and make it a safe investment.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=enabling-pants-in-the-repository>Enabling Pants in the repository<a href=#enabling-pants-in-the-repository class=hash-link aria-label="Direct link to Enabling Pants in the repository" title="Direct link to Enabling Pants in the repository" translate=no>​</a></h2>
<p>Pants documentation is a great place to learn <a href=https://www.pantsbuild.org/docs/existing-repositories target=_blank rel="noopener noreferrer" class="">how to incrementally add Pants to an existing repository</a>. Setting up Pants in the monorepo was done in multiple steps as we wanted to merge changes in small bulks and with no disruption to the current users.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=project-directory-layout>Project directory layout<a href=#project-directory-layout class=hash-link aria-label="Direct link to Project directory layout" title="Direct link to Project directory layout" translate=no>​</a></h3>
<p>Pants makes it easy to adopt for existing codebases, because it doesn't require all Python projects within the monorepo to have the same <a href=https://www.pantsbuild.org/docs/source-roots#examples target=_blank rel="noopener noreferrer" class="">directory layout</a>. We didn't want to make any structural changes to the code layout and in fact it wasn't necessary thanks to sensible defaults set in the <code>BUILD</code> metadata files. For example, some projects stored test modules along with the source modules while others had a dedicated <code>tests</code> directory. We noticed that source modules may have been stored in the root directory of a project or in a layout of the <code>src</code>/<code>tests</code> directory structure.</p>
<p>However, if you have to follow a standard project structure (perhaps because you rely on tooling that makes certain assumptions), you may want to split sources and tests and move some code around. While in some programming languages using a build project such as Apache Maven there are some standards to the <a href=https://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html target=_blank rel="noopener noreferrer" class="">directory layout</a>, Python ecosystem is much more flexible in terms of conventions. <a href=https://docs.pytest.org/en/6.2.x/goodpractices.html#choosing-a-test-layout-import-rules target=_blank rel="noopener noreferrer" class="">Pytest documentation</a> currently supports two common project layouts. There are a few helpful resources (<a href=https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure target=_blank rel="noopener noreferrer" class="">here</a> and <a href=https://docs.python-guide.org/writing/structure/ target=_blank rel="noopener noreferrer" class="">here</a>) where you can find out more. If you need some inspiration, it may be worth taking a look at how other large Python projects such as <a href=https://github.com/pytest-dev/pytest target=_blank rel="noopener noreferrer" class="">pytest</a>, <a href=https://github.com/pallets/click target=_blank rel="noopener noreferrer" class="">click</a>, <a href=https://github.com/PyCQA/flake8 target=_blank rel="noopener noreferrer" class="">flake8</a>, and <a href=https://github.com/psf/black target=_blank rel="noopener noreferrer" class="">black</a> structure their projects.</p>
<p>We have <a href=https://www.pantsbuild.org/docs/source-roots#multiple-top-level-projects target=_blank rel="noopener noreferrer" class="">Multiple top-level projects</a> layout and have enabled Pants for the projects one by one over the course of a few months. This meant we had more time to fix issues and learn more about Pants features and best practices before we rolled Pants across all the projects.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=3rd-party-dependencies>3rd party dependencies<a href=#3rd-party-dependencies class=hash-link aria-label="Direct link to 3rd party dependencies" title="Direct link to 3rd party dependencies" translate=no>​</a></h3>
<p>We have decided to use a single list of the 3rd party dependencies for the entire monorepo, with the requirement that the package versions need to be conflict-free, so that all code in the monorepo can be reused. This makes it possible to create a single virtual environment containing all the requirements which we'll discuss later in the post.</p>
<p>Pants will set up a virtual environment for every build, so any dependency conflicts are detected right away. However, thanks to the <a class="" href=/blog/2022/10/27/why-dependency-inference>dependency inference</a>, each build (e.g. when running a test or packaging an artifact) will pull only those dependencies that are truly required.</p>
<p>Since there is only one place in the monorepo for defining any external dependencies, this simplifies the dependency management. You don't have to deal with the situations that can occur if you try to import a Python module that depends on a different version of a 3rd party dependency than your current project. For example, it is not possible to have project A to depend on a 3rd party package X of version 1 and project B to depend on the 3rd party package X of version 2. If a certain project needs a newer version of a package than the one defined in the monorepo root requirements, one would need to upgrade this package, and make sure all other clients of this package remain functional.</p>
<p>However, we do allow defining individual requirements that may be specific to a particular project. This is common when a project owners would like to bring an experimental dependency and take advantage of the Pants build system, but are not yet ready to make it accessible to everyone via the root requirements. Another time we had to use this approach was when there was a project with experimental code with a dependency on a PyPI package with native code that didn't have a wheel for devices on certain hardware architecture.</p>
<p>Since we have a variety of platforms and architecture to support (macOS on Intel and Apple silicon chips and Linux on Intel and ARM chips), it was necessary to make sure that all 3rd party dependencies that have native code are available as Python wheels so that they are readily available for Pants builds. We have managed to build those packages without rolling out a new CI pipeline that would automate this process as most of the projects finally caught up and started publishing Python wheels for missing platforms. If you would like to use open-source Python projects on Linux with ARM processors, you may have no choice, but automate the build process as it's still very rare for them to have a CI plan with ARM agents. For macOS builds, <a href=https://github.com/cirruslabs/tart target=_blank rel="noopener noreferrer" class="">tart</a> driven workflow worked really well and for Linux Docker builds, you can take a look at <a href=https://github.com/pypa/manylinux target=_blank rel="noopener noreferrer" class="">pypa/manylinux</a>.</p>
<p>A single place for pinned dependencies allows us upgrading a certain package for all the projects in the monorepo at once. This greatly simplifies doing security audits and package version upgrades. In addition to downloading the necessary public PyPI packages, Pants also support accessing a private package index via <a href=https://www.pantsbuild.org/docs/reference-python-repos target=_blank rel="noopener noreferrer" class="">PyPI servers</a> or a binary repository manager which is where we host wheels internally.</p>
<p>Pants does support having multiple versions for 3rd party requirements for individual projects as long as they are not dependent on each other in either way. If they are, however, it won't be possible to resolve the requirements for the virtual environment where the tests will be run. Despite Pants having excellent support for <a href=https://www.pantsbuild.org/docs/python-third-party-dependencies#multiple-lockfiles target=_blank rel="noopener noreferrer" class="">multiple lockfiles</a>, we have decided to have a single consistently resolvable universe of requirements.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=adding-build-metadata>Adding build metadata<a href=#adding-build-metadata class=hash-link aria-label="Direct link to Adding build metadata" title="Direct link to Adding build metadata" translate=no>​</a></h3>
<p>The metadata files were generated in semi-automated manner using <code>./pants tailor</code> goal after <a href=https://www.pantsbuild.org/docs/python-backend target=_blank rel="noopener noreferrer" class="">enabling Python support</a>. Each project directory has <code>BUILD</code> files with minimal information about the internal and external dependencies.</p>
<p>We have decided to <a href=https://www.pantsbuild.org/docs/python-linters-and-formatters target=_blank rel="noopener noreferrer" class="">enable linters and formatters</a> incrementally, per project basis. Because there were multiple legacy projects that were written without any linters and formatters in mind, we didn't want to make massive changes across them at once. This meant that project owners could decide themselves when they are ready to commit to format and lint their code. We felt that it would be better to empower engineers by giving them all the tooling they may need and let them use it when appropriate.</p>
<p>We have written scripts to automate making changes to the <code>BUILD</code> metadata files. You can learn more about it the blog post <a class="" href=/blog/2022/01/06/updating-pants-build-files-programmatically>Updating Pants BUILD files programmatically</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=adding-a-ci-pipeline>Adding a CI pipeline<a href=#adding-a-ci-pipeline class=hash-link aria-label="Direct link to Adding a CI pipeline" title="Direct link to Adding a CI pipeline" translate=no>​</a></h3>
<p>Once we had our first project to trial in Pants adoption, we were ready to start CI builds of the monorepo using Pants. Pants docs share lots of useful advice on <a href=https://www.pantsbuild.org/docs/using-pants-in-ci target=_blank rel="noopener noreferrer" class="">Using Pants in CI</a>. Enabling caching was trivial as the repo checkouts are built inside Docker containers and the cache can be shared between them. Pants guarantees safe interactions between processes that make simultaneous writes to the cache which is what will happen as builds take place in parallel, so you don't need to worry about resource contention.</p>
<p>We were not comfortable at that point to set up a cache that could be shared between the build nodes and we kept keeping one Pants cache directory per machine used as a CI node. Because a build can be started on an arbitrary node, the caches have filled fairly quickly and we have started seeing excellent cache hit rates. We may explore setting up a dedicated file server to be used as a single Pants cache, but given the build size, at the moment this feels like overkill, as a typical build currently takes only a few minutes (~150K LOC, ~1500 tests).</p>
<p>As a side effect, since the build time got down significantly, we noticed that the pull requests became smaller as developers are no longer trying to squeeze as much as code as possible in a single change. Code reviews get completed much faster (and are more likely to provide useful feedback) and development velocity increases.</p>
<p>Pants is source control aware and can figure out which tests need to be <a href=https://www.pantsbuild.org/docs/using-pants-in-ci#approach-1-only-run-over-changed-files target=_blank rel="noopener noreferrer" class="">run based on changed files</a>. However, if your repository is not that big and takes advantage of caching, you may just run over everything (while still benefiting from having the cache set up). It may also be helpful to re-run all the tests in each build to observe the performance improvements when comparing with your current build approach (in case you have been running all the tests for every build earlier).</p>
<p>We have also invested heavily in the monorepository linting which takes place in CI builds from the very start, to ensure consistency and best practices across the codebase. For example, we identify fragile dependencies between projects, forbid certain options in the targets metadata, warn about files not owned by any target, and many more. Please see <a class="" href=/blog/2022/08/05/monorepository-linting-via-pants-project-introspection>Monorepository linting via Pants's project introspection</a> to learn more.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=packaging-artifacts>Packaging artifacts<a href=#packaging-artifacts class=hash-link aria-label="Direct link to Packaging artifacts" title="Direct link to Packaging artifacts" translate=no>​</a></h3>
<p>Before Pants, each project was distributed as a <code>conda</code> package. With Pants and the monorepo approach, this is no longer necessary as projects interact between each other directly via the source files. We have studied what projects are dependencies for engineers and systems outside of the monorepo (as we have multiple Git repositories) and started providing packages in a suitable format.</p>
<p>To avoid creating too many distributions, we have decided that any new Python code that needs to be written should be brought into the monorepo and packaged here. The core Python libraries used in other repositories are shipped as wheels (known as a <a href=https://www.pantsbuild.org/docs/python-distributions target=_blank rel="noopener noreferrer" class="">distribution</a> in the Pants land). We produce Docker images used in data processing pipelines with each image containing Shell scripts and <a href=https://pex.readthedocs.io/en/v2.1.104/index.html target=_blank rel="noopener noreferrer" class="">PEX</a> files. We also produce Debian packages (currently with the standard Debian tooling) with each package containing one or more PEX files; please see <a href=https://github.com/pantsbuild/pants/issues/12421 target=_blank rel="noopener noreferrer" class="">Packaging PEX files as Debian packages</a> to learn more about the motivation.</p>
<p>When designing the packaging strategy, we have tried to be very thoughtful with regards to the versioning approach. If you distribute Python wheels of different libraries that may have shared code, you may run into the issues if they share some code, so you have to be very careful making sure these projects don't have overlapping scope. Since the version 2.13, Pants supports <a href=https://www.pantsbuild.org/docs/generating-version-tags target=_blank rel="noopener noreferrer" class="">generating version tags from Git</a> which may help you in case you already rely on Git driven versioning.</p>
<p>Packaging Python code into PEX files became such a popular option so that it is currently used outside of Python monorepo where Pants is not used. A typical use case is to package command line tools into a single executable files to avoid copying or creating virtual environments from scratch.</p>
<p>PEX has also been used for ad hoc packaging to produce executable files for a foreign hardware architecture which has been for a while a preferred way to get some arbitrary Python code running in Linux environment on ARM (before we could run Pants on ARM natively).</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=developer-tooling>Developer tooling<a href=#developer-tooling class=hash-link aria-label="Direct link to Developer tooling" title="Direct link to Developer tooling" translate=no>​</a></h3>
<p>To provide optimal developer experience, we wanted to provide instructions on how to set up two most popular IDEs for Python development in the organization - PyCharm and VSCode - to work with the monorepo. We found the Pants documentation section <a href=https://www.pantsbuild.org/docs/setting-up-an-ide target=_blank rel="noopener noreferrer" class="">Setting up an IDE</a> to be very helpful. It can also be helpful to take advantage of any existing automation systems developers are used to. For instance, we use <code>Makefile</code> to bring a simpler interface to the Pants command (e.g. <code>make fmt</code> to format both the sources and the build metadata files and <code>make deps project=name</code> to list 3rd party dependencies of a project).</p>
<p>We also try not to enforce any particular tooling on a developer and instead only share available options in case they don't have a strong opinion. For example, we let users decide on how they want to ensure their code is formatted. A CI build will fail if the code is unformatted, so how the code gets formatted locally doesn't really matter. We leave it up to a developer to decide whether they want to use Git or pre-commit hooks, run the commands manually, using a <code>make</code> command or a Bash alias, or have the code formatted by their IDE.</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=build-files><code>BUILD</code> files<a href=#build-files class=hash-link aria-label="Direct link to build-files" title="Direct link to build-files" translate=no>​</a></h4>
<p>We have also spent some time looking for support of <code>BUILD</code> files as many IDEs and text editors already support syntax highlighting out of the box. There is some limited support for code navigation and interaction as well such as reporting syntax errors, ability to comment/uncomment blocks of code, and collapse/expand code sections.</p>
<p>For PyCharm users, we suggested installing the <a href=https://plugins.jetbrains.com/plugin/8609-bazel target=_blank rel="noopener noreferrer" class="">Bazel plugin</a> and adding the <code>BUILD</code> file name pattern to the <code>Bazel BUILD language</code> in the <code>Recognized File Types</code> section. See <a href=https://www.jetbrains.com/help/pycharm/creating-and-registering-file-types.html#change-extension target=_blank rel="noopener noreferrer" class="">Change filename patterns associated with file type</a> to learn more. For VSCode users, we suggested installing the <a href="https://marketplace.visualstudio.com/items?itemName=BazelBuild.vscode-bazel" target=_blank rel="noopener noreferrer" class="">Bazel plugin</a> with any additional configuration being optional.</p>
<p>There is some research in progress to bring proper support of Pants build metadata files in popular IDEs using Language Server and Build Server protocols (<a href=https://microsoft.github.io/language-server-protocol/ target=_blank rel="noopener noreferrer" class="">LSP</a> and <a href=https://build-server-protocol.github.io/ target=_blank rel="noopener noreferrer" class="">BSP</a>).</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=virtual-environments>Virtual environments<a href=#virtual-environments class=hash-link aria-label="Direct link to Virtual environments" title="Direct link to Virtual environments" translate=no>​</a></h4>
<p>Because we have a single list of requirements for the whole monorepository, we were able to resolve them into a <a href=https://pip.pypa.io/en/stable/user_guide/#constraints-files target=_blank rel="noopener noreferrer" class="">constraints</a> file using the <a href=https://github.com/jazzband/pip-tools target=_blank rel="noopener noreferrer" class="">pip-tools</a>. Developers can use <code>pip</code> to create virtual environment from the <code>requirements.txt</code> file (applying the <code>constraints.txt</code> generated with the <code>pip-compile</code>). Pants provide mechanisms for generating a virtual environment via the <a href=https://www.pantsbuild.org/docs/reference-export target=_blank rel="noopener noreferrer" class=""><code>export</code></a>, however, we wanted to keep things simple. The request to be able to run tests for a given project or run an arbitrary Python module without using Pants was quite common. Many developers felt it was easier/faster to run a <code>pytest</code> command when they are iterating writing code and they switch to the Pants tooling once they are done with a chunk of work and wanted to run the tests across the repository before starting a CI build.</p>
<p>We also have to support hardware engineers, researchers, and other users who do not normally "live" in the repo and may be interacting with the repo only occasionally and therefore missing the build system context. For instance, users often want to create a virtual environment with only the 3rd party dependencies (identifiable with the help of <a href=https://www.pantsbuild.org/docs/reference-dependencies target=_blank rel="noopener noreferrer" class=""><code>dependencies</code></a> goal) of a particular project for rapid prototyping. This is why we have documented how to use standard Python tooling for quick experiments, so that they never really needed to get to know Pants build system.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=python-runtime-environment>Python runtime environment<a href=#python-runtime-environment class=hash-link aria-label="Direct link to Python runtime environment" title="Direct link to Python runtime environment" translate=no>​</a></h3>
<p>Finding the right strategy to decide on Python interpreter constraints to be used in the Pants monorepository required some careful thinking. Because we had enough users who are not Python programmers or are not familiar with the Python ecosystem and tooling, we needed to make sure there is a simple way to get a Python interpreter installed. Because our development infrastructure team is rather small, we couldn't have the privilege to be open to any CPython 3.8 interpreter users may have installed. This is to avoid dealing with support requests from developers who experience issues running the code or tests as their Python interpreter may have come from a <code>pyenv</code> interpreter, system Python, <code>conda</code> environment, <code>brew</code> formula, or anything else discovered on the system <code>$PATH</code>.</p>
<p>As we had a well established macOS setup, we've decided to stick to the <a href=https://developer.apple.com/xcode/ target=_blank rel="noopener noreferrer" class="">Xcode</a> Python which we can automate installing using <a href=https://www.jamf.com/ target=_blank rel="noopener noreferrer" class="">jamf</a>. As the expectation is that the users will already have Xcode installed, we declare <code>search_path = ["/usr/bin"]</code> in the <code>pants.toml</code> file. This way, we ensure that once a user's machine is bootstrapped, the repository checkout can immediately be used with Pants and it just works. However, we also allow engineers to override this or, in fact, any setting using the <a href=https://www.pantsbuild.org/docs/options#pantsrc-file target=_blank rel="noopener noreferrer" class="">.pants.rc</a> file, so that we remain flexible and allow devs to use any compatible Python interpreter they may prefer. See <a class="" href=/blog/2022/02/15/choosing-a-python-interpreter-for-a-pants-project>Choosing a Python interpreter for a Pants project</a> so that you can find a strategy that works for you.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=documentation>Documentation<a href=#documentation class=hash-link aria-label="Direct link to Documentation" title="Direct link to Documentation" translate=no>​</a></h3>
<p>Pants documentation is extremely sophisticated and exhaustive, however, it may also feel a bit overwhelming for a newcomer. In fact, we don't think our developers need to know anything about Pants unless they really want to. This is the opposite of what is expected from our developers working in the C++ repository - they need to be fairly proficient in <a href=https://cmake.org/ target=_blank rel="noopener noreferrer" class="">CMake</a> to be able to write and maintain build metadata files. We maintain our own documentation on how to operate in Oxbotica's monorepository, covering standard internal workflows, and have extended it over the past year as we observed common questions and points of confusion.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate=no>​</a></h2>
<p><strong>After using Pants over a year now, we can say with confidence it was worth every effort.</strong></p>
<p>The repository build workflows can now accommodate a much larger number of contributors thanks to Pants caching mechanisms used in tests and very smart dependency inference thanks to which the builds do only what's truly required. It has also removed the cognitive burden from the developers who can focus on the domain code instead of dealing with the build system nuances. The engineers are happy to make occasional changes to the <code>BUILD</code> files (e.g. adding new <code>resource</code> and <code>pex_binary</code> targets) and find the API very intuitive. We strive to hide the Pants internal details from the user to keep things simple, however, they found error messages given by Pants extremely helpful — not only because they are short and full of context, but also because they tell you how to fix the error (e.g. run another goal or fix a typo in a target's name).</p>
<p>It's great to see the project being actively developed, bringing support for new frameworks and tools. For instance, we are exploring using <a href=https://www.pantsbuild.org/docs/pyoxidizer target=_blank rel="noopener noreferrer" class="">PyOxidizer</a> to produce a package with the Python interpreter baked in to facilitate sharing applications with non-developers. We are also very pleased to see the Pants community growing attracting more users and providing a space to improve developer productivity across multiple organizations. It's said that with Python, <a href=https://xkcd.com/353/ target=_blank rel="noopener noreferrer" class="">programming is fun again</a>. With Pants, building Python is fun again!</p>
<div class="theme-admonition theme-admonition-info admonition_LZeC alert alert--info"><div class=admonitionHeading_SJYM><span class=admonitionIcon_iulS><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>About the author</div><div class=admonitionContent_NJOy><p>Alexey Tereshenkov led Oxbotica's 2021 migration to Pants, and in the process became a committed contributor to the open source project. Since becoming involved with Pants through Oxbotica, Alexey has made many contributions to the project, notably including Yapf formatter support for Python, writing blog posts, docs improvements, and adding a long-requested <code>python_distribution</code> improvement. He also drives Debian packaging support in Pants. <a class="" href=/blog/2022/02/28/meet-our-newest-maintainer-alexey-tereshenkov>In 2022 he joined the project's core team of maintainers.</a></div></div></div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>Tags:</b><ul class="tags_zmUf padding--none margin-left--sm"><li class=tag_b6K5><a rel=tag class="tag_onkF tagRegular_ZD5p" href=/blog/tags/ci>ci</a><li class=tag_b6K5><a rel=tag class="tag_onkF tagRegular_ZD5p" href=/blog/tags/python>python</a><li class=tag_b6K5><a rel=tag class="tag_onkF tagRegular_ZD5p" href=/blog/tags/case-studies>case-studies</a></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col noPrint_eWnd"><a href=https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-11-04-introducing-pants-to-oxbotica/index.mdx target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_HmrO aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_F4iS"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/blog/2022/11/21/quick-feedback-on-new-features-via-experimental-backends><div class=pagination-nav__sublabel>Newer post</div><div class=pagination-nav__label>How we get quick feedback on new features via "experimental" backends</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/blog/2022/10/27/celebrating-two-years-of-pants-2><div class=pagination-nav__sublabel>Older post</div><div class=pagination-nav__label>Celebrating two years of Pants 2</div></a></nav></main><div class="col col--2"><div class="tableOfContents_ZBPU thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#background class="table-of-contents__link toc-highlight">Background</a><li><a href=#challenges class="table-of-contents__link toc-highlight">Challenges</a><li><a href=#why-a-build-system class="table-of-contents__link toc-highlight">Why a build system?</a><li><a href=#build-system-requirements class="table-of-contents__link toc-highlight">Build system requirements</a><ul><li><a href=#change-management class="table-of-contents__link toc-highlight">Change management</a></ul><li><a href=#why-pantsbuild class="table-of-contents__link toc-highlight">Why Pantsbuild?</a><li><a href=#enabling-pants-in-the-repository class="table-of-contents__link toc-highlight">Enabling Pants in the repository</a><ul><li><a href=#project-directory-layout class="table-of-contents__link toc-highlight">Project directory layout</a><li><a href=#3rd-party-dependencies class="table-of-contents__link toc-highlight">3rd party dependencies</a><li><a href=#adding-build-metadata class="table-of-contents__link toc-highlight">Adding build metadata</a><li><a href=#adding-a-ci-pipeline class="table-of-contents__link toc-highlight">Adding a CI pipeline</a><li><a href=#packaging-artifacts class="table-of-contents__link toc-highlight">Packaging artifacts</a><li><a href=#developer-tooling class="table-of-contents__link toc-highlight">Developer tooling</a><li><a href=#python-runtime-environment class="table-of-contents__link toc-highlight">Python runtime environment</a><li><a href=#documentation class="table-of-contents__link toc-highlight">Documentation</a></ul><li><a href=#conclusion class="table-of-contents__link toc-highlight">Conclusion</a></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Spotlight</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/spotlight/users>Users</a><li class=footer__item><a class=footer__link-item href=/spotlight/testimonials>Testimonials</a><li class=footer__item><a class=footer__link-item href=/spotlight/media>Media</a><li class=footer__item><a class=footer__link-item href=/spotlight/service-providers>Service Providers</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Connect</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://github.com/pantsbuild/pants target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://twitter.com/pantsbuild target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://www.youtube.com/@pantsbuild target=_blank rel="noopener noreferrer" class=footer__link-item>YouTube<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://groups.google.com/forum/#!forum/pants-devel target=_blank rel="noopener noreferrer" class=footer__link-item>Mailing List<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/blog>Blog</a><li class=footer__item><a class=footer__link-item href=/sponsors>Sponsors</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/community/getting-help>Getting Help</a><li class=footer__item><a class=footer__link-item href=/community/members>Members</a><li class=footer__item><a class=footer__link-item href=/community/code-of-conduct>Code of Conduct</a><li class=footer__item><a class=footer__link-item href=/community/meet-the-team>Meet the Team</a><li class=footer__item><a class=footer__link-item href=/community/maintainers>Maintainers</a><li class=footer__item><a class=footer__link-item href=/community/contentious-decisions>Contentious Decisions</a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © Pants project contributors. <a href=https://github.com/pantsbuild/pantsbuild.org>Website source</a> @ <a href=https://github.com/pantsbuild/pantsbuild.org/commit/a274212dfdcfe1657dd5eae4836420db8cdf9099>a27421</a>.</div></div></div></footer></div></body>