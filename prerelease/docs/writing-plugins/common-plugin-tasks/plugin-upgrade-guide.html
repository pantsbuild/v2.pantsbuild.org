<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-2.31 docs-doc-page docs-doc-id-docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Plugin upgrade guide | Pantsbuild</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://www.pantsbuild.org/img/social-card.png /><meta data-rh=true name=twitter:image content=https://www.pantsbuild.org/img/social-card.png /><meta data-rh=true property=og:url content=https://www.pantsbuild.org/prerelease/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=2.31 /><meta data-rh=true name=docusaurus_tag content=docs-default-2.31 /><meta data-rh=true name=docsearch:version content=2.31 /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-2.31 /><meta data-rh=true property=og:title content="Plugin upgrade guide | Pantsbuild"/><meta data-rh=true name=description content="How to adjust for changes made to the Plugin API."/><meta data-rh=true property=og:description content="How to adjust for changes made to the Plugin API."/><link data-rh=true rel=icon href=/img/favicon.ico /><link data-rh=true rel=canonical href=https://www.pantsbuild.org/prerelease/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide /><link data-rh=true rel=alternate href=https://www.pantsbuild.org/prerelease/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide hreflang=en /><link data-rh=true rel=alternate href=https://www.pantsbuild.org/prerelease/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide hreflang=x-default /><link data-rh=true rel=preconnect href=https://QD9KY1TRVK-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://www.pantsbuild.org/prerelease/docs/writing-plugins/common-plugin-tasks/","name":"Common plugin tasks","position":1},{"@type":"ListItem","item":"https://www.pantsbuild.org/prerelease/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide","name":"Plugin upgrade guide","position":2}]}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Pantsbuild RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Pantsbuild Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-SEHBXJRF42"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SEHBXJRF42",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=Pantsbuild href=/opensearch.xml><link rel=stylesheet href=/assets/css/styles.b71b45ed.css /><script src=/assets/js/runtime~main.43acf77f.js defer></script><script src=/assets/js/main.636c7439.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_lucK href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo.svg alt="My Site Logo" class="themedComponent_x_jL themedComponent--light_WGb9"/><img src=/img/logo.svg alt="My Site Logo" class="themedComponent_x_jL themedComponent--dark_oBxQ"/></div><b class="navbar__title text--truncate">Pantsbuild</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/prerelease/docs/introduction/welcome-to-pants>Docs</a><a class="navbar__item navbar__link" href=/prerelease/reference/global-options>Reference</a><a class="navbar__item navbar__link" href=/blog>Blog</a><a class="navbar__item navbar__link" href=/sponsors>Sponsors</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/prerelease/docs/introduction/welcome-to-pants>2.31 (prerelease)</a><ul class=dropdown__menu><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/prerelease/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide>2.31 (prerelease)</a><li><a class=dropdown__link href=/stable/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide>2.30</a><li><a class=dropdown__link href=/2.29/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide>2.29</a><li><a class=dropdown__link href=/2.28/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide>2.28 (deprecated)</a><li class=""><hr class=dropdown-separator><li><a class=dropdown__link href=/versions>All Versions</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Slack</a><ul class=dropdown__menu><li><a href=https://pantsbuild.slack.com target=_blank rel="noopener noreferrer" class=dropdown__link>Workspace<svg width=12 height=12 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><li><a href="https://docs.google.com/forms/d/e/1FAIpQLSf9zgf-MXRnVDJbrVEST3urqneq7LCcy0zw8qU-GH4hPMn52A/viewform?usp=sf_link" target=_blank rel="noopener noreferrer" class=dropdown__link>Workspace Invite<svg width=12 height=12 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><li><a href=https://chat.pantsbuild.org target=_blank rel="noopener noreferrer" class=dropdown__link>Linen Mirror<svg width=12 height=12 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a></ul></div><a href=https://github.com/pantsbuild/pants target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><div class=navbarSearchContainer_Mydu><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div><div class="toggle_AwgP colorModeToggle_rXRM"><button class="clean-btn toggleButton_kTC9 toggleButtonDisabled_N4X8" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_X8HE lightToggleIcon_cay9"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_X8HE darkToggleIcon_B6hH"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_X8HE systemToggleIcon_k4zv"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_GzA5"><div class=docsWrapper_LbKj><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_bDNn" type=button></button><div class=docRoot_PpgM><aside class="theme-doc-sidebar-container docSidebarContainer_aj0D"><div class=sidebarViewport_pg77><div class=sidebar_Us5f><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_FPuF"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/prerelease/docs/introduction/welcome-to-pants><span title=Introduction class=categoryLinkLabel_JmoG>Introduction</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist" href=/prerelease/docs/getting-started><span title="Getting Started" class=categoryLinkLabel_JmoG>Getting Started</span></a><button aria-label="Expand sidebar category 'Getting Started'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/prerelease/docs/using-pants/command-line-help><span title="Using Pants" class=categoryLinkLabel_JmoG>Using Pants</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/prerelease/docs/python/overview><span title=Python class=categoryLinkLabel_JmoG>Python</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist" href=/prerelease/docs/go><span title=Go class=categoryLinkLabel_JmoG>Go</span></a><button aria-label="Expand sidebar category 'Go'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/prerelease/docs/jvm/java-and-scala><span title=JVM class=categoryLinkLabel_JmoG>JVM</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist" href=/prerelease/docs/shell><span title=Shell class=categoryLinkLabel_JmoG>Shell</span></a><button aria-label="Expand sidebar category 'Shell'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist" href=/prerelease/docs/docker><span title=Docker class=categoryLinkLabel_JmoG>Docker</span></a><button aria-label="Expand sidebar category 'Docker'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/prerelease/docs/kubernetes><span title=Kubernetes class=linkLabel_BwCR>Kubernetes</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist" href=/prerelease/docs/helm><span title=Helm class=categoryLinkLabel_JmoG>Helm</span></a><button aria-label="Expand sidebar category 'Helm'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/prerelease/docs/terraform><span title=Terraform class=linkLabel_BwCR>Terraform</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/prerelease/docs/sql><span title=SQL class=linkLabel_BwCR>SQL</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/prerelease/docs/ad-hoc-tools/integrating-new-tools-without-plugins><span title="Ad-Hoc Tools" class=categoryLinkLabel_JmoG>Ad-Hoc Tools</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/prerelease/docs/javascript/overview><span title=Javascript class=categoryLinkLabel_JmoG>Javascript</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true href=/prerelease/docs/writing-plugins/overview><span title="Writing Plugins" class=categoryLinkLabel_JmoG>Writing Plugins</span></a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/overview><span title="Plugins overview" class=linkLabel_BwCR>Plugins overview</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/macros><span title=Macros class=linkLabel_BwCR>Macros</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist" tabindex=0 href=/prerelease/docs/writing-plugins/the-target-api><span title="The Target API" class=categoryLinkLabel_JmoG>The Target API</span></a><button aria-label="Expand sidebar category 'The Target API'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist" tabindex=0 href=/prerelease/docs/writing-plugins/the-rules-api><span title="The Rules API" class=categoryLinkLabel_JmoG>The Rules API</span></a><button aria-label="Expand sidebar category 'The Rules API'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist menu__link--active" tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks><span title="Common plugin tasks" class=categoryLinkLabel_JmoG>Common plugin tasks</span></a><button aria-label="Collapse sidebar category 'Common plugin tasks'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks/add-a-linter><span title="Add a linter" class=linkLabel_BwCR>Add a linter</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks/add-a-formatter><span title="Add a formatter" class=linkLabel_BwCR>Add a formatter</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks/add-a-typechecker><span title="Add a typechecker" class=linkLabel_BwCR>Add a typechecker</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks/add-codegen><span title="Add codegen" class=linkLabel_BwCR>Add codegen</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks/add-a-repl><span title="Add a REPL" class=linkLabel_BwCR>Add a REPL</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks/run-tests><span title="Run tests" class=linkLabel_BwCR>Run tests</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks/plugin-lockfiles><span title="Add lockfiles" class=linkLabel_BwCR>Add lockfiles</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks/custom-python-artifact-kwargs><span title="Custom `python_artifact()` kwargs" class=linkLabel_BwCR>Custom `python_artifact()` kwargs</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide><span title="Plugin upgrade guide" class=linkLabel_BwCR>Plugin upgrade guide</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/common-plugin-tasks/allowing-tool-export><span title="Making a tool exportable" class=linkLabel_BwCR>Making a tool exportable</span></a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/prerelease/docs/writing-plugins/common-subsystem-tasks><span title="Common subsystem tasks" class=linkLabel_BwCR>Common subsystem tasks</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/prerelease/docs/releases/deprecation-policy><span title=Releases class=categoryLinkLabel_JmoG>Releases</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist" href=/prerelease/docs/contributions><span title=Contributions class=categoryLinkLabel_JmoG>Contributions</span></a><button aria-label="Expand sidebar category 'Contributions'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_cnt8 menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/prerelease/docs/tutorials/create-a-new-goal><span title=Tutorials class=categoryLinkLabel_JmoG>Tutorials</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 margin-vert--none"><hr/><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/prerelease/reference/global-options><span title=Reference class=linkLabel_BwCR>Reference</span></a></ul></nav></div></div></aside><main class=docMainContainer_oWFJ><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_b2qu"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role=alert><div>This is unreleased documentation for <!-- -->Pantsbuild<!-- --> <b>2.31 (prerelease)</b> version.</div><div class=margin-top--md>For up-to-date documentation, see the <b><a href=/stable/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide>latest version</a></b> (<!-- -->2.30<!-- -->).</div></div><div class=docItemContainer_TkYX><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_nJ9e" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_WW1h><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><span class=breadcrumbs__link>Writing Plugins</span><li class=breadcrumbs__item><a class=breadcrumbs__link href=/prerelease/docs/writing-plugins/common-plugin-tasks><span>Common plugin tasks</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Plugin upgrade guide</span></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 2.31 (prerelease)</span><div class="tocCollapsible_hk9T theme-doc-toc-mobile tocMobile_cNpz"><button type=button class="clean-btn tocCollapsibleButton_ljii">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Plugin upgrade guide</h1></header><p>How to adjust for changes made to the Plugin API.</p>
<hr/>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=230>2.30<a href=#230 class=hash-link aria-label="Direct link to 2.30" title="Direct link to 2.30" translate=no>​</a></h2>
<p><code>Get</code> and <code>MultiGet</code> have been deprecated in favor of calling rules by name. See the <a class="" href=/prerelease/docs/writing-plugins/the-rules-api/migrating-gets>migration guide</a> for how to update your plugins to use this idiom.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=223>2.23<a href=#223 class=hash-link aria-label="Direct link to 2.23" title="Direct link to 2.23" translate=no>​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=deprecated-generatetoollockfilesentinel>Deprecated GenerateToolLockfileSentinel<a href=#deprecated-generatetoollockfilesentinel class=hash-link aria-label="Direct link to Deprecated GenerateToolLockfileSentinel" title="Direct link to Deprecated GenerateToolLockfileSentinel" translate=no>​</a></h3>
<p><code>GenerateToolLockfileSentinel</code> was used to generate lockfiles. It is deprecated in favour of <code>ExportableTool</code>.</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">JarJar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">JvmToolBase</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">JarJarGeneratorLockfileSentinel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">GenerateToolLockfileSentinel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    resolve_name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> JarJar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">options_scope</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@rule</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>async</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">generate_jarjar_lockfile_request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> JarJarGeneratorLockfileSentinel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> jarjar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> JarJar</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">></span><span class="token plain"> GenerateJvmLockfileFromTool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>return</span><span class="token plain"> GenerateJvmLockfileFromTool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">jarjar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> UnionRule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">GenerateToolLockfileSentinel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> JarJarGeneratorLockfileSentinel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br/></span></code></pre></div></div>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">JarJar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">JvmToolBase</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> UnionRule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ExportableTool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> JarJar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=jvm-deprecated-getgeneratejvmlockfilefromtool-generatetoollockfilesentinel-for-lockfiles>JVM: Deprecated Get(GenerateJvmLockfileFromTool, GenerateToolLockfileSentinel) for lockfiles<a href=#jvm-deprecated-getgeneratejvmlockfilefromtool-generatetoollockfilesentinel-for-lockfiles class=hash-link aria-label="Direct link to JVM: Deprecated Get(GenerateJvmLockfileFromTool, GenerateToolLockfileSentinel) for lockfiles" title="Direct link to JVM: Deprecated Get(GenerateJvmLockfileFromTool, GenerateToolLockfileSentinel) for lockfiles" translate=no>​</a></h4>
<p>As part of the deprecation, <code>GenerateJvmLockfileFromTool</code> can be invoked directly on your tool, without a Get. You may need to request your <code>JvmToolBase</code></p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@rule</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>async</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">shade_jar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ShadeJarRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> jdk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> InternalJdk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> jarjar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> JarJar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">></span><span class="token plain"> ShadedJar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    lockfile_request </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>await</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">GenerateJvmLockfileFromTool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> JarJarGeneratorLockfileSentinel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    tool_classpath </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>await</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ToolClasspath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ToolClasspathRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lockfile</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">lockfile_request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@rule</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>async</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">shade_jar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ShadeJarRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> jdk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> InternalJdk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> jarjar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> JarJar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">></span><span class="token plain"> ShadedJar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>await</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">            ToolClasspath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ToolClasspathRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lockfile</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">GenerateJvmLockfileFromTool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">jarjar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=jvm-migrating-from-generatejvmlockfilefromtool-to-jvmtoolbase>JVM: Migrating from GenerateJvmLockfileFromTool to JvmToolBase<a href=#jvm-migrating-from-generatejvmlockfilefromtool-to-jvmtoolbase class=hash-link aria-label="Direct link to JVM: Migrating from GenerateJvmLockfileFromTool to JvmToolBase" title="Direct link to JVM: Migrating from GenerateJvmLockfileFromTool to JvmToolBase" translate=no>​</a></h3>
<p><code>JvmToolBase</code> is the preferred way to define JVM-based tools.</p>
<ol>
<li class="">set the <code>options_scope</code>, usually to the <code>resolve_name</code></li>
<li class="">set the <code>help</code></li>
<li class=""><code>default_artifacts</code> is the <code>artifact_inputs</code> converted to a tuple. A version can be replaced by <code>{version}</code> and moved to the <code>default_version</code> field</li>
<li class=""><code>default_lockfile_resource</code> is the same</li>
</ol>
<p>A <code>GenerateJvmLockfileFromTool</code> is created from a <code>JvmToolBase</code> with <code>GenerateJvmLockfileFromTool.create</code></p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=217>2.17<a href=#217 class=hash-link aria-label="Direct link to 2.17" title="Direct link to 2.17" translate=no>​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=deprecated-some-request-types-in-favor-of-get-with-only-one-arg>Deprecated some <code>Request</code> types in favor of <code>Get</code> with only one arg<a href=#deprecated-some-request-types-in-favor-of-get-with-only-one-arg class=hash-link aria-label="Direct link to deprecated-some-request-types-in-favor-of-get-with-only-one-arg" title="Direct link to deprecated-some-request-types-in-favor-of-get-with-only-one-arg" translate=no>​</a></h3>
<p>For several APIs like <code>pants.core.util_rules.system_binaries</code>, we had an eager and lazy version of the same API. You could do either of these two:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>from</span><span class="token plain"> pants</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">util_rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">system_binaries </span><span class="token keyword" style=font-style:italic>import</span><span class="token plain"> ZipBinary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ZipBinaryRequest</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>from</span><span class="token plain"> pants</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rules </span><span class="token keyword" style=font-style:italic>import</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rule</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyOutput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>pass</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@rule</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>async</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">my_rule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">zip_binary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ZipBinary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">></span><span class="token plain"> MyOutput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>return</span><span class="token plain"> MyOutput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@rule</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>async</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">my_rule_lazy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">></span><span class="token plain"> MyOutput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    zip_binary </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>await</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ZipBinary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ZipBinaryRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>return</span><span class="token plain"> MyOutput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>The lazy API is useful, for example, when you only want to <code>Get</code> that output type inside an <code>if</code> branch.</p>
<p>We added syntax in 2.17 to now use <code>Get(OutputType)</code>, whereas before you had to do <code>Get(OutputType, OutputTypeRequest)</code> or (as of 2.15) <code>Get(OutputType, {})</code>. So, these <code>OutputTypeRequest</code> types are now redundant and deprecated in favor of simply using <code>Get(OutputType)</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=environmentbehaviorunmigrated-is-no-longer-available><code>EnvironmentBehavior.UNMIGRATED</code> is no longer available<a href=#environmentbehaviorunmigrated-is-no-longer-available class=hash-link aria-label="Direct link to environmentbehaviorunmigrated-is-no-longer-available" title="Direct link to environmentbehaviorunmigrated-is-no-longer-available" translate=no>​</a></h3>
<p>Following the deprecation cycle in 2.15, all <code>Goal</code>s need to set <code>EnvironmentBehavior.LOCAL_ONLY</code> or <code>EnvironmentBehavior.USES_ENVIRONMENTS</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=216>2.16<a href=#216 class=hash-link aria-label="Direct link to 2.16" title="Direct link to 2.16" translate=no>​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=runfieldset-and-testrequest-now-have-a-rules-method><code>RunFieldSet</code> and <code>TestRequest</code> now have a <code>.rules()</code> method<a href=#runfieldset-and-testrequest-now-have-a-rules-method class=hash-link aria-label="Direct link to runfieldset-and-testrequest-now-have-a-rules-method" title="Direct link to runfieldset-and-testrequest-now-have-a-rules-method" translate=no>​</a></h3>
<p>These methods should be used to register your run/test plugins:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">MyRunFieldSetSubclass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">MyTestRequestSubclass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br/></span></code></pre></div></div>
<p>Additionally, these types now by-default register the implementations for the rules used for <code>--debug</code>/<code>--debug-adapter</code>. If your plugin doesn't support these flags, simply remove the rules you've declared and let the default ones handle erroring. If your plugin does support these, set the class property(s) <code>supports_debug = True</code>/<code>supports_debug_adapter = True</code>, respectively.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=runfieldset-can-be-used-to-run-targets-in-the-sandbox-as-part-of-a-build-rule><code>RunFieldSet</code> can be used to run targets in the sandbox as part of a build rule<a href=#runfieldset-can-be-used-to-run-targets-in-the-sandbox-as-part-of-a-build-rule class=hash-link aria-label="Direct link to runfieldset-can-be-used-to-run-targets-in-the-sandbox-as-part-of-a-build-rule" title="Direct link to runfieldset-can-be-used-to-run-targets-in-the-sandbox-as-part-of-a-build-rule" translate=no>​</a></h3>
<p>With the new <code>experimental_run_in_sandbox</code> target type, targets that implement <code>RunFieldSet</code> can be run as a build rule for their side effects.</p>
<p>Many rules that create <code>RunRequest</code>s can be used verbatim, but others may make assumptions that they will not be run hermetically. You will need set <code>run_in_sandbox_behavior</code> to one of the following values to generate a rule that allows your targets to be run in the sandbox:</p>
<ul>
<li class=""><code>RunInSandboxBehavior.RUN_REQUEST_HERMETIC</code>: Use the existing <code>RunRequest</code>-generating rule, and enable cacheing. Use this if you are confident the behaviour of the rule relies only on state that is captured by pants (e.g. binary paths are found using <code>EnvironmentVarsRequest</code>), and that the rule only refers to files in the sandbox.</li>
<li class=""><code>RunInSandboxBehavior.RUN_REQUEST_NOT_HERMETIC</code>: Use the existing <code>RunRequest</code>-generating rule, and do not enable cacheing. Use this if your existing rule is mostly suitable for use in the sandbox, but you cannot guarantee reproducible behavior.</li>
<li class=""><code>RunInSandboxBehavior.CUSTOM</code>: Opt to write your own rule that returns <code>RunInSandboxRequest</code>.</li>
<li class=""><code>RunInSandboxBehavior.NOT_SUPPORTED</code>: Opt out of being usable in <code>experimental_run_in_sandbox</code>. Attempting to use such a target will result in a runtime exception.</li>
</ul>
<p>We expect to deprecate <code>RUN_REQUEST_NOT_HERMETIC</code> and <code>NOT_SUPPORTED</code> in a few versions time: these options are provided to give you some time to make your existing rules match the semantics of <code>RUN_REQUEST_HERMETIC</code>, or to add a <code>CUSTOM</code> rule.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=binaryshimsrequest-no-longer-accepts-output_directory><code>BinaryShimsRequest</code> no longer accepts <code>output_directory</code><a href=#binaryshimsrequest-no-longer-accepts-output_directory class=hash-link aria-label="Direct link to binaryshimsrequest-no-longer-accepts-output_directory" title="Direct link to binaryshimsrequest-no-longer-accepts-output_directory" translate=no>​</a></h3>
<p><code>BinaryShims</code> now produces all of its shim scripts in the root of its <code>digest</code>, and provides helper methods for use with <code>immutable_input_digests</code> and the <code>PATH</code> environment variable. It also produces a unique directory name so that multiple rules can be called to populate <code>PATH</code>.</p>
<p>Consider using these helper methods in favor of the old behavior:</p>
<div class="language-text codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-text codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain">process = Process(</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    immutable_input_digests=binary_shims.immutable_input_digests,</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    env={"PATH": binary_shims.path_component},</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">)</span><br/></span></code></pre></div></div>
<p>You can replicate the previous behavior using <code>AddDigest</code>:</p>
<div class="language-text codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-text codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain">new_digest = await Get(Digest, AddDigest(binary_shims.digest, output_directory))</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=215>2.15<a href=#215 class=hash-link aria-label="Direct link to 2.15" title="Direct link to 2.15" translate=no>​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=lint-and-fmt-schema-changes><code>lint</code> and <code>fmt</code> schema changes<a href=#lint-and-fmt-schema-changes class=hash-link aria-label="Direct link to lint-and-fmt-schema-changes" title="Direct link to lint-and-fmt-schema-changes" translate=no>​</a></h3>
<p>In order to accomplish several goals (namely targetless formatters and unifying the implementation of <code>lint</code>) <code>lint</code> and <code>fmt</code> have undergone a drastic change of their plugin API.</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=1-linttargetsfilesrequest-and-fmttargetsrequest-now-require-a-tool_subsystem-class-attribute>1. <code>Lint&lt;Targets|Files>Request</code> and <code>FmtTargetsRequest</code> now require a <code>tool_subsystem</code> class attribute.<a href=#1-linttargetsfilesrequest-and-fmttargetsrequest-now-require-a-tool_subsystem-class-attribute class=hash-link aria-label="Direct link to 1-linttargetsfilesrequest-and-fmttargetsrequest-now-require-a-tool_subsystem-class-attribute" title="Direct link to 1-linttargetsfilesrequest-and-fmttargetsrequest-now-require-a-tool_subsystem-class-attribute" translate=no>​</a></h4>
<p>Instead of the <code>name</code> class attribute, <code>Lint&lt;Targets|Files>Request</code> and <code>FmtTargetsRequest</code> require subclasses to provide a <code>tool_subsystem</code> class attribute with a value of your tool's <code>Subsystem</code> subclass.</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=2-your-tool-subsystem-should-have-a-skip-option>2. Your tool subsystem should have a <code>skip</code> option.<a href=#2-your-tool-subsystem-should-have-a-skip-option class=hash-link aria-label="Direct link to 2-your-tool-subsystem-should-have-a-skip-option" title="Direct link to 2-your-tool-subsystem-should-have-a-skip-option" translate=no>​</a></h4>
<p>Although not explicitly not required by the engine to function correctly, <code>mypy</code> will complain if the subsystem type provided to <code>tool_subsystem</code> doesn't have a <code>skip: SkipOption</code> option registered.</p>
<p>Otherwise, you can <code># type: ignore[assignment]</code> on your <code>tool_subsystem</code> declaration.</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=3-the-core-goals-now-use-a-2-rule-approach>3. The core goals now use a 2-rule approach<a href=#3-the-core-goals-now-use-a-2-rule-approach class=hash-link aria-label="Direct link to 3. The core goals now use a 2-rule approach" title="Direct link to 3. The core goals now use a 2-rule approach" translate=no>​</a></h4>
<p>Fmt:</p>
<p>In order to support targetless formatters, <code>fmt</code> needs to know which <em>files</em> you'll be operating on. Therefore the plugin API for <code>fmt</code> has forked into 2 rules:</p>
<ol>
<li class="">A rule taking <code>&lt;RequestType>.PartitionRequest</code> and returning a <code>Partitions</code> object. This is sometimes referred to as the "partitioner" rule.</li>
<li class="">A rule taking <code>&lt;RequestType>.Batch</code> and returning a <code>FmtResult</code>. This is sometimes referred to as the "runner" rule.</li>
</ol>
<p>This way <code>fmt</code> can serialize tool runs that operate on the same file(s) while parallelizing tool runs that don't overlap.</p>
<p>(Why are targetless formatters something we want to support? This allows us to have <code>BUILD</code> file formatters, formatters like <code>Prettier</code> running on your codebase <em>without</em> boilerplate targets, as well as Pants doing interesting deprecation fixers on its own files)</p>
<p>The partitioner rule gives you all the matching files (or <code>FieldSet</code>s depending on which class you subclassed) and you'll return a mapping from <code>&lt;key></code> to files (called a Partition). The <code>&lt;key></code> can be anything passable at the rule boundary and is given back to you in your runner rule. The partitioner rule gives you an opportunity to perform expensive <code>Get</code>s once for the entire run, to partition the inputs based on metadata to simplify your runner, and to have a place for easily skipping your tool if requested.</p>
<p>The runner rule will mostly remain unchanged, aside from the request type (<code>&lt;RequestType>.Batch</code>), which now has a <code>.files</code> property.</p>
<p>If you don't require any <code>Get</code>s or metadata for your tool in your partitioner rule, Pants has a way to provide a "default" implementation. In your <code>FmtRequest</code> subclass, set the <code>partitioner_type</code> class variable to <code>PartitionerType.DEFAULT_SINGLE_PARTITION</code> and only provide a runner rule.</p>
<hr/>
<p>Lint:</p>
<p>Lint plugins are almost identical to format plugins, except in 2 ways:</p>
<ol>
<li class="">Your partitioner rule still returns a <code>Partitions</code> object, but the element type can be anything.</li>
<li class=""><code>&lt;RequestType>.Batch</code> has a <code>.elements</code> field instead of <code>.files</code>.</li>
</ol>
<hr/>
<p>As always, taking a look at Pants' own plugins can also be very enlightening.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=test-schema-changes><code>test</code> schema changes<a href=#test-schema-changes class=hash-link aria-label="Direct link to test-schema-changes" title="Direct link to test-schema-changes" translate=no>​</a></h3>
<p>To enable running tests in batches, the plugin API for <code>test</code> has significantly changed. The new API largely resembles the <code>lint</code>/<code>fmt</code> API described above.</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=1-test-plugins-must-now-define-a-skip-able-subsystem>1. Test plugins must now define a <code>skip</code>-able <code>Subsystem</code>.<a href=#1-test-plugins-must-now-define-a-skip-able-subsystem class=hash-link aria-label="Direct link to 1-test-plugins-must-now-define-a-skip-able-subsystem" title="Direct link to 1-test-plugins-must-now-define-a-skip-able-subsystem" translate=no>​</a></h4>
<p>To hook into the new API, a test runner must declare a subclass of <code>Subsystem</code> with a <code>skip: SkipOption</code> option. Add <code>skip = SkipOption("test")</code> to your existing (or new) subsystems.</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=2-test-plugins-must-define-a-subclass-of-testrequest>2. Test plugins must define a subclass of <code>TestRequest</code>.<a href=#2-test-plugins-must-define-a-subclass-of-testrequest class=hash-link aria-label="Direct link to 2-test-plugins-must-define-a-subclass-of-testrequest" title="Direct link to 2-test-plugins-must-define-a-subclass-of-testrequest" translate=no>​</a></h4>
<p>To define the rules expected by the new <code>test</code> API, you will need to define a <code>TestRequest</code> subclass. This new type will point at your plugin-specific <code>TestFieldSet</code> and <code>Subsystem</code> subclasses:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CustomTestRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TestRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    field_set_type </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> CustomTestFieldSet</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    tool_subsystem </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> CustomSubsystem</span><br/></span></code></pre></div></div>
<p>After declaring your new type, register its rules:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Add to what you already have:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">CustomTestRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=3-test-execution-now-uses-a-2-rule-approach>3. Test execution now uses a 2-rule approach<a href=#3-test-execution-now-uses-a-2-rule-approach class=hash-link aria-label="Direct link to 3. Test execution now uses a 2-rule approach" title="Direct link to 3. Test execution now uses a 2-rule approach" translate=no>​</a></h4>
<p>The plugin API for <code>test</code> has forked into 2 rules:</p>
<ol>
<li class="">A rule taking <code>&lt;TestRequestSubclass>.PartitionRequest</code> and returning a <code>Partitions</code> object. This is sometimes referred to as the "partitioner" rule.</li>
<li class="">A rule taking <code>&lt;TestRequestSubclass>.Batch</code> and returning a <code>TestResult</code>. This is sometimes referred to as the "runner" rule.</li>
</ol>
<p>The "partitioner" rule was introduced to allow plugins to group tests into "compatible" batches, to be executed as a batch within the "runner" rule. The "runner" rule is a replacement for the previous API which took <code>TestFieldSet</code> instances as input.</p>
<p>By default, registering <code>&lt;TestRequestSubclass>.rules()</code> will register a "partitioner" rule that creates a single-element partition per input <code>TestFieldSet</code>, replicating the behavior from before Pants 2.15. You can then upgrade your existing "runner" rule to take the new input type.</p>
<p>Before:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@rule</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>async</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">field_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> CustomTestFieldSet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">></span><span class="token plain"> TestResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><br/></span></code></pre></div></div>
<p>After:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@rule</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>async</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run_tests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">batch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> CustomTestRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Batch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">></span><span class="token plain"> TestResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    field_set </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> batch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">single_element</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><br/></span></code></pre></div></div>
<p>If you would like to make use of the new support for batched testing, override the <code>partitioner_type</code> field in your <code>TestRequest</code> subclass:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CustomTestRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TestRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    field_set_type </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> CustomTestFieldSet</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    tool_subsystem </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> CustomSubsystem</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    partitioner_type </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> PartitionerType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CUSTOM</span><br/></span></code></pre></div></div>
<p>This will prevent registration of the default "partitioner" rule, allowing you to implement any partitioning logic you'd like. You'll then need to update your "runner" rule to handle a multi-element <code>batch</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=environmentname-is-now-required-to-run-processes-get-environment-variables-etc><code>EnvironmentName</code> is now required to run processes, get environment variables, etc<a href=#environmentname-is-now-required-to-run-processes-get-environment-variables-etc class=hash-link aria-label="Direct link to environmentname-is-now-required-to-run-processes-get-environment-variables-etc" title="Direct link to environmentname-is-now-required-to-run-processes-get-environment-variables-etc" translate=no>​</a></h3>
<p>Pants 2.15 introduces the concept of <a class="" href=/prerelease/docs/using-pants/environments>"Target Environments"</a>, which allow Pants to execute processes in remote or local containerized environments (using Docker), and to specify configuration values for those environments.</p>
<p>In order to support the new environments feature, an <code>EnvironmentName</code> parameter is now required in order to:</p>
<ul>
<li class="">Run a <code>Process</code></li>
<li class="">Get environment variables</li>
<li class="">Inspect the current <code>Platform</code></li>
</ul>
<p>This parameter is often provided automatically from a transitive value provided earlier in the call graph. The choice of whether to use a local or alternative environment must be made at a <code>@goal_rule</code> level.</p>
<p>In many cases, the local execution environment is sufficient. If so, your rules will not require significant work to migrate, and execution will behave similarly to pre-2.15 versions of Pants.</p>
<p>In cases where the environment needs to be factored into to rule execution, you'll need to do some work.</p>
<p>2.15 adds a deprecation warning for all goals that have not considered whether they need to use the execution environment.</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=goalenvironment_behavior><code>Goal.environment_behavior</code><a href=#goalenvironment_behavior class=hash-link aria-label="Direct link to goalenvironment_behavior" title="Direct link to goalenvironment_behavior" translate=no>​</a></h4>
<p>2.15 adds the <code>environment_behavior</code> property to the <code>Goal</code> class, which controls whether an <code>EnvironmentName</code> is automatically injected when a <code>@goal_rule</code> runs.</p>
<p>When <code>environment_behavior=Goal.EnvironmentBehavior.UNMIGRATED</code> (the default), the <code>QueryRule</code> that is installed for a <code>@goal_rule</code> will include an <code>EnvironmentName</code> and will raise a deprecation warning.</p>
<p>If your Goal only ever needs to use the local target environment, use <code>environment_behavior=Goal.EnvironmentBehavior.LOCAL_ONLY</code>. The <code>QueryRule</code> installed for the <code>@goal_rule</code> will include an <code>EnvironmentName</code> that refers to a local environment, and will silence the deprecation warning. No further migration work needs to be done for your Goal.</p>
<h5 class="anchor anchorTargetStickyNavbar_UrHV" id=for-goals-that-need-to-respect-environmentfields>For goals that need to respect <code>EnvironmentField</code>s<a href=#for-goals-that-need-to-respect-environmentfields class=hash-link aria-label="Direct link to for-goals-that-need-to-respect-environmentfields" title="Direct link to for-goals-that-need-to-respect-environmentfields" translate=no>​</a></h5>
<p>If your goal needs to select the target's specified environment when running underlying rules, set <code>environment_behavior=Goal.EnvironmentBehavior.USES_ENVIRONMENTS</code>, which will silence the deprecation. Unlike for the <code>LOCAL_ONLY</code> behavior, any rules that require an <code>EnvironmentName</code> will need to specify that name directly.</p>
<p>In general, <code>Goal</code>s should use <code>EnvironmentNameRequest</code> to get <code>EnvironmentName</code>s for the targets that they will be operating on.</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    EnvironmentName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    EnvironmentNameRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    EnvironmentNameRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">from_field_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">field_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>Then, the <code>EnvironmentName</code> should be used at <code>Get</code> callsites which require an environment:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TestResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">field_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> TestFieldSet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> environment_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> EnvironmentName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>The multi-parameter <code>Get</code> syntax provides the value transitively, and so will need to be used in many <code>Get</code> callsites in <code>@goal_rule</code>s which transitively run processes, consume the platform, etc. One exception is that (most of) the APIs provided by <code>pants.engine.target</code> are pinned to running in the <code>__local__</code> environment, and so do not require an <code>EnvironmentName</code> to use.</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=rulerunnerinherent_environment><code>RuleRunner.inherent_environment</code><a href=#rulerunnerinherent_environment class=hash-link aria-label="Direct link to rulerunnerinherent_environment" title="Direct link to rulerunnerinherent_environment" translate=no>​</a></h4>
<p>To reduce the number of changes necessary in tests, the <code>RuleRunner.inherent_environment</code> argument defaults to injecting an <code>EnvironmentName</code> when running <code>@rule</code>s in tests.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=platform-kwarg-for-process-deprecated><code>platform</code> kwarg for <code>Process</code> deprecated<a href=#platform-kwarg-for-process-deprecated class=hash-link aria-label="Direct link to platform-kwarg-for-process-deprecated" title="Direct link to platform-kwarg-for-process-deprecated" translate=no>​</a></h3>
<p>Previously, we assumed processes were platform-agnostic, i.e. they had identical output on all platforms (OS x CPU architecture). You had to opt into platform awareness by setting the kwarg<code>platform</code> on the <code>Process</code>; otherwise, remote caching could incorrectly use results from a different platform.</p>
<p>This was not a safe default, and this behavior also breaks the new Docker support. So, now all processes automatically are marked as platform-specific.</p>
<p><a href=https://github.com/pantsbuild/pants/issues/16873 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/issues/16873</a> proposes how you will eventually be able to mark a <code>Process</code> as platform-agnostic.</p>
<p>To fix this deprecation, simply delete the <code>platform</code> kwarg.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=environment-environmentrequest-and-completeenvironment-renamed-and-moved><code>Environment</code>, <code>EnvironmentRequest</code>, and <code>CompleteEnvironment</code> renamed and moved<a href=#environment-environmentrequest-and-completeenvironment-renamed-and-moved class=hash-link aria-label="Direct link to environment-environmentrequest-and-completeenvironment-renamed-and-moved" title="Direct link to environment-environmentrequest-and-completeenvironment-renamed-and-moved" translate=no>​</a></h3>
<p>The types were moved from <code>pants.engine.environment</code> to <code>pants.engine.env_vars</code>, and now have <code>Vars</code> in their names:</p>
<p>Before: <code>pants.engine.environment.{Environment,EnvironmentRequest,CompleteEnvironment}</code>
After: <code>pants.engine.env_vars.{EnvironmentVars,EnvironmentVarsRequest,CompleteEnvironmentVars}</code></p>
<p>The old names still exist until Pants 2.16 as deprecated aliases.</p>
<p>This rename was to avoid ambiguity with the new "environments" mechanism, which lets users specify different options for environments like Linux vs. macOS and running in Docker images.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=mockget-expects-input_types-kwarg-not-input_type><code>MockGet</code> expects <code>input_types</code> kwarg, not <code>input_type</code><a href=#mockget-expects-input_types-kwarg-not-input_type class=hash-link aria-label="Direct link to mockget-expects-input_types-kwarg-not-input_type" title="Direct link to mockget-expects-input_types-kwarg-not-input_type" translate=no>​</a></h3>
<p>It's now possible in Pants 2.15 to use zero arguments or multiple arguments in a <code>Get</code>. To support this change, <code>MockGet</code> from <code>run_rule_with_mocks()</code> now expects the kwarg <code>input_types: tuple[type, ...]</code> rather than <code>input_type: type</code>.</p>
<p>Before:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain">MockGet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    output_type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">LintResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    input_type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">LintTargetsRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    mock</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token keyword" style=font-style:italic>lambda</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> LintResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>After:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain">MockGet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    output_type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">LintResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    input_types</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">LintTargetsRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    mock</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token keyword" style=font-style:italic>lambda</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> LintResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=deprecated-platformcurrent>Deprecated <code>Platform.current</code><a href=#deprecated-platformcurrent class=hash-link aria-label="Direct link to deprecated-platformcurrent" title="Direct link to deprecated-platformcurrent" translate=no>​</a></h3>
<p>The <code>Platform</code> to use will soon become dependent on a <code>@rule</code>'s position in the <code>@rule</code> graph. To get the correct <code>Platform</code>, a <code>@rule</code> should request a <code>Platform</code> as a positional argument.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=deprecated-convert_dir_literal_to_address_literal-kwarg>Deprecated <code>convert_dir_literal_to_address_literal</code> kwarg<a href=#deprecated-convert_dir_literal_to_address_literal-kwarg class=hash-link aria-label="Direct link to deprecated-convert_dir_literal_to_address_literal-kwarg" title="Direct link to deprecated-convert_dir_literal_to_address_literal-kwarg" translate=no>​</a></h3>
<p>The <code>convert_dir_literal_to_address_literal</code> keyword argument for <code>RawSpecs.create()</code> and <code>SpecsParser.parse_specs()</code> no longer does anything. It should be deleted.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=214>2.14<a href=#214 class=hash-link aria-label="Direct link to 2.14" title="Direct link to 2.14" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.14.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.14.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=removed-second-type-parameter-from-get>Removed second type parameter from <code>Get</code><a href=#removed-second-type-parameter-from-get class=hash-link aria-label="Direct link to removed-second-type-parameter-from-get" title="Direct link to removed-second-type-parameter-from-get" translate=no>​</a></h3>
<p><code>Get</code> now takes only a single type parameter for the output type: <code>Get[_Output]</code>. The input type parameter was unused.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=fmtrequest---fmttargetsrequest><code>FmtRequest</code> -> <code>FmtTargetsRequest</code><a href=#fmtrequest---fmttargetsrequest class=hash-link aria-label="Direct link to fmtrequest---fmttargetsrequest" title="Direct link to fmtrequest---fmttargetsrequest" translate=no>​</a></h3>
<p>In order to support non-target formatting (like <code>BUILD</code> files) we'll be introducing additional <code>fmt</code> request types. Therefore <code>FmtRequest</code> has been renamed to <code>FmtTargetsRequest</code> to reflect the behavior.</p>
<p>This change also matches <code>lint</code>, which uses <code>LintTargetsRequest</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=optional-option-flag-name>Optional Option flag name<a href=#optional-option-flag-name class=hash-link aria-label="Direct link to Optional Option flag name" title="Direct link to Optional Option flag name" translate=no>​</a></h3>
<p>Pants 2.14 adds support for deducing the flag name from the attribute name when declaring <code>XOption</code>s. You can still provide the flag name in case the generated one shouldn't match the attribute name.</p>
<p>Before:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain">my_version </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> StrOption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">"--my-version"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">_run </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BoolOption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">"--run"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>Now:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain">my_version </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> StrOption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Still uses --my-version</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">_run </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BoolOption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Still uses --run</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=injectdependencies---inferdependencies-with-inferdependencies-using-a-fieldset><code>InjectDependencies</code> -> <code>InferDependencies</code>, with <code>InferDependencies</code> using a <code>FieldSet</code><a href=#injectdependencies---inferdependencies-with-inferdependencies-using-a-fieldset class=hash-link aria-label="Direct link to injectdependencies---inferdependencies-with-inferdependencies-using-a-fieldset" title="Direct link to injectdependencies---inferdependencies-with-inferdependencies-using-a-fieldset" translate=no>​</a></h3>
<p><code>InjectDependenciesRequest</code> has been folded into <code>InferDependenciesRequest</code>, which has also been changed to receive a <code>FieldSet</code>.</p>
<p>If you have an <code>InjectDependenciesRequest</code> type/rule, those should be renamed to <code>Infer...</code>.</p>
<p>Then for each <code>InferDependenciesRequest</code>, the <code>infer_from</code> class variable should now point to a relevant <code>FieldSet</code> subclass type. If you had an <code>Inject...</code> request, the <code>required_fields</code> will likely include the relevant <code>Dependencies</code> subclass. Likewise for pre-2.14 <code>Infer...</code> request, the<code>required_fields</code> will include the relevant <code>SourcesField</code> subclass.</p>
<p>Note that in most cases, you no longer need to request the target in your rule code, and should rely on <code>FieldSet</code>'s mechanisms for matching targets and getting field values.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=generatetoollockfilesentinel-encouraged-to-use-language-specific-subclasses><code>GenerateToolLockfileSentinel</code> encouraged to use language-specific subclasses<a href=#generatetoollockfilesentinel-encouraged-to-use-language-specific-subclasses class=hash-link aria-label="Direct link to generatetoollockfilesentinel-encouraged-to-use-language-specific-subclasses" title="Direct link to generatetoollockfilesentinel-encouraged-to-use-language-specific-subclasses" translate=no>​</a></h3>
<p>Rather than directly subclassing <code>GenerateToolLockfileSentinel</code>, we encourage you to subclass <code>GeneratePythonToolLockfileSentinel</code> and <code>GenerateJvmToolLockfileSentinel</code>. This is so that we can distinguish what language a tool belongs to, which is used for options like <code>[python].resolves_to_constraints_file</code> to validate which resolve names are recognized.</p>
<p>Things will still work if you do not make this change, other than the new options not recognizing your tool.</p>
<p>However, keep the <code>UnionRule</code> the same, i.e. with the first argument still <code>GenerateToolLockfileSentinel</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=matches_filespec-replaced-by-filespecmatcher><code>matches_filespec()</code> replaced by <code>FilespecMatcher</code><a href=#matches_filespec-replaced-by-filespecmatcher class=hash-link aria-label="Direct link to matches_filespec-replaced-by-filespecmatcher" title="Direct link to matches_filespec-replaced-by-filespecmatcher" translate=no>​</a></h3>
<p>Instead, use <code>FilespecMatcher(includes=[], excludes=[]).matches(paths: Sequence[str])</code> from <code>pants.source.filespec</code>.</p>
<p>The functionality is the same, but can have better performance because we don't need to parse the same globs each time <code>.matches()</code> is called. When possible, reuse the same <code>FilespecMatcher</code> object to get these performance benefits.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=213>2.13<a href=#213 class=hash-link aria-label="Direct link to 2.13" title="Direct link to 2.13" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.13.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.13.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=addressinput-and-unparsedaddressinputs-require-description_of_origin><code>AddressInput</code> and <code>UnparsedAddressInputs</code> require <code>description_of_origin</code><a href=#addressinput-and-unparsedaddressinputs-require-description_of_origin class=hash-link aria-label="Direct link to addressinput-and-unparsedaddressinputs-require-description_of_origin" title="Direct link to addressinput-and-unparsedaddressinputs-require-description_of_origin" translate=no>​</a></h3>
<p>Both types now require the keyword argument <code>description_of_origin: str</code>, which is used to make better error messages when the address cannot be found.</p>
<p>If the address is hardcoded in your rules, then use a description like <code>"the rule find_my_binary"</code>. If the address comes from user inputs, it is helpful to mention where the user defines the value, for example <code>f"the dependencies field from the target {my_tgt.address}"</code>.</p>
<p>You can now also set <code>UnparsedAddressInputs(skip_invalid_addresses=True, ...)</code>, which will not error when addresses are invalid.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=wrappedtarget-requires-wrappedtargetrequest><code>WrappedTarget</code> requires <code>WrappedTargetRequest</code><a href=#wrappedtarget-requires-wrappedtargetrequest class=hash-link aria-label="Direct link to wrappedtarget-requires-wrappedtargetrequest" title="Direct link to wrappedtarget-requires-wrappedtargetrequest" translate=no>​</a></h3>
<p>Before:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>from</span><span class="token plain"> pants</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addresses </span><span class="token keyword" style=font-style:italic>import</span><span class="token plain"> Address</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>from</span><span class="token plain"> pants</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">target </span><span class="token keyword" style=font-style:italic>import</span><span class="token plain"> WrappedTarget</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>await</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">WrappedTarget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> my_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>After:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>from</span><span class="token plain"> pants</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">target </span><span class="token keyword" style=font-style:italic>import</span><span class="token plain"> WrappedTarget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> WrappedTargetRequest</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>await</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">WrappedTarget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> WrappedTargetRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">my_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> description_of_origin</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">"my rule"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=redesign-of-specs>Redesign of <code>Specs</code><a href=#redesign-of-specs class=hash-link aria-label="Direct link to redesign-of-specs" title="Direct link to redesign-of-specs" translate=no>​</a></h3>
<p>Specs, aka command line arguments, were redesigned in Pants 2.13:</p>
<ul>
<li class="">The globs <code>::</code> and <code>:</code> now match all files, even if there are no owning targets.</li>
<li class="">Directory args like <code>my_dir/</code> can be set to match everything in the current directory, rather than the default target <code>my_dir:my_dir</code>.</li>
<li class="">Ignore globs were added with a <code>-</code> prefix, like <code>:: -ignore_me::</code></li>
</ul>
<p>To support these changes, we redesigned the class <code>Specs</code> and its sibling classes like <code>AddressSpecs</code>.</p>
<p>Renames for <code>Spec</code> subclass:</p>
<ul>
<li class=""><code>SiblingAddresses</code> -> <code>DirGlobSpec</code> (vs. <code>DirLiteralSpec</code>)</li>
<li class=""><code>DescendantAddresses</code> -> <code>RecursiveGlobSpec</code></li>
<li class=""><code>AscendantAddresses</code> -> <code>AncestorGlobSpec</code></li>
</ul>
<p>Those classes now have a keyword arg <code>error_if_no_target_matches</code>, rather than having a distinct class like <code>MaybeDescendantAddresses</code>.</p>
<p><code>AddressSpecs</code> was renamed to <code>SpecsWithoutFileOwners</code>, and <code>FilesystemSpecs</code> to <code>SpecsWithOnlyFileOwners</code>. But almost always, you should instead use the new <code>RawSpecs</code> class because it is simpler. See <a class="" href=/prerelease/docs/writing-plugins/the-rules-api/rules-and-the-target-api#how-to-resolve-targets>Rules API and Target API</a> for how to use <code>Get(Targets, RawSpecs)</code>, including its keyword arguments.</p>
<p>If you were directly creating <code>Specs</code> objects before, you likely want to change to <code>RawSpecs</code>. <code>Specs</code> allows us to handle "ignore specs" like <code>-ignore_me/</code>, which is usually not necessary in rules. See the above paragraph for how to use <code>RawSpecs</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=specssnapshot-is-now-specspaths><code>SpecsSnapshot</code> is now <code>SpecsPaths</code><a href=#specssnapshot-is-now-specspaths class=hash-link aria-label="Direct link to specssnapshot-is-now-specspaths" title="Direct link to specssnapshot-is-now-specspaths" translate=no>​</a></h3>
<p><code>SpecsSnapshot</code> was replaced with the more performant <code>SpecsPaths</code> from <code>pants.engine.fs</code>, which avoids digesting any files into the LMDB store.</p>
<p>Instead of <code>specs_snapshot.snapshot.files</code>, use <code>specs_paths.files</code> to get a list of all matching files.</p>
<p>If you still need the <code>Digest</code> (<code>specs_snapshot.snapshot.digest</code>), use <code>await Get(Digest, PathGlobs(globs=specs_paths.files))</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=removed-putativetargetssearchpaths-for-tailor-plugins>Removed <code>PutativeTargetsSearchPaths</code> for <code>tailor</code> plugins<a href=#removed-putativetargetssearchpaths-for-tailor-plugins class=hash-link aria-label="Direct link to removed-putativetargetssearchpaths-for-tailor-plugins" title="Direct link to removed-putativetargetssearchpaths-for-tailor-plugins" translate=no>​</a></h3>
<p>Before:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain">all_proto_files </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>await</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Paths</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> PathGlobs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">search_paths</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path_globs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">"*.proto"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>After:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token plain">all_proto_files </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>await</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Paths</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> PathGlobs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path_globs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">"*.proto"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>You can also now specify multiple globs, e.g. <code>req.path_globs("*.py", "*.pyi")</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=banned-short-option-names-like--x>Banned short option names like <code>-x</code><a href=#banned-short-option-names-like--x class=hash-link aria-label="Direct link to banned-short-option-names-like--x" title="Direct link to banned-short-option-names-like--x" translate=no>​</a></h3>
<p>You must now use a long option name when <a class="" href=/prerelease/docs/writing-plugins/the-rules-api/options-and-subsystems>defining options</a>. You can also now only specify a single option name per option.</p>
<p>(These changes allowed us to introduce ignore specs, like <code>pants list :: -ignore_me::</code>.)</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=212>2.12<a href=#212 class=hash-link aria-label="Direct link to 2.12" title="Direct link to 2.12" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.12.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.12.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=unified-formatters>Unified formatters<a href=#unified-formatters class=hash-link aria-label="Direct link to Unified formatters" title="Direct link to Unified formatters" translate=no>​</a></h3>
<p>Formatters no longer need to be installed in both the <code>FmtRequest</code> and <code>LintTargetsRequest</code> <code>@unions</code>: instead, installing in the <code>FmtRequest</code> union is sufficient to act as both a linter and formatter.</p>
<p>See <a class="" href=/prerelease/docs/writing-plugins/common-plugin-tasks/add-a-formatter>Add a formatter</a> for more information.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=211>2.11<a href=#211 class=hash-link aria-label="Direct link to 2.11" title="Direct link to 2.11" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.11.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.11.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=deprecated-subsystemregister_options>Deprecated <code>Subsystem.register_options()</code><a href=#deprecated-subsystemregister_options class=hash-link aria-label="Direct link to deprecated-subsystemregister_options" title="Direct link to deprecated-subsystemregister_options" translate=no>​</a></h3>
<p>Pants 2.11 added "concrete" option types which when used as class attributes of your subsystem. These are more declarative, simplify accessing options, and work with MyPy!</p>
<p>Before:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MySubsystem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Subsystem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    options_scope </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"example"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">help</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"..."</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@classmethod</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">register_options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">register_options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">"--my-opt"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">            </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">            default</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">            </span><span class="token builtin" style="color:rgb(130, 170, 255)">help</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">"..."</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>Now:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MySubsystem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Subsystem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    options_scope </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"example"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">help</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"..."</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    my_opt </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BoolOption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">"--my-opt"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        default</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">help</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">"..."</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>To access an option in rules, simply use <code>my_subsystem.my_opt</code> rather than <code>my_subsystem.options.my_opt</code>.</p>
<p>See <a class="" href=/prerelease/docs/writing-plugins/the-rules-api/options-and-subsystems>Options and subsystems</a> for more information, including the available types.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=moved-binarypathrequest-to-pantscoreutil_rulessystem_binaries>Moved <code>BinaryPathRequest</code> to <code>pants.core.util_rules.system_binaries</code><a href=#moved-binarypathrequest-to-pantscoreutil_rulessystem_binaries class=hash-link aria-label="Direct link to moved-binarypathrequest-to-pantscoreutil_rulessystem_binaries" title="Direct link to moved-binarypathrequest-to-pantscoreutil_rulessystem_binaries" translate=no>​</a></h3>
<p>The new module <code>pants.core.util_rules.system_binaries</code> centralizes all discovery of existing binaries on a user's machines.</p>
<p>The functionality is the same, you only need to change your imports for types like <code>BinaryPathRequest</code> to <code>pants.core.util_rules.system_binaries</code> rather than <code>pants.engine.process</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=deprecated-not-implementing-targetgenerator-in-generatetargetsrequest-implementors>Deprecated not implementing <code>TargetGenerator</code> in <code>GenerateTargetsRequest</code> implementors<a href=#deprecated-not-implementing-targetgenerator-in-generatetargetsrequest-implementors class=hash-link aria-label="Direct link to deprecated-not-implementing-targetgenerator-in-generatetargetsrequest-implementors" title="Direct link to deprecated-not-implementing-targetgenerator-in-generatetargetsrequest-implementors" translate=no>​</a></h3>
<p>See <a href=https://github.com/pantsbuild/pants/pull/14962 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/14962</a> for an explanation and some examples of how to fix.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=replaced-goalsubsystemrequired_union_implementations-with-goalsubsystemactivated>Replaced <code>GoalSubsystem.required_union_implementations</code> with <code>GoalSubsystem.activated()</code><a href=#replaced-goalsubsystemrequired_union_implementations-with-goalsubsystemactivated class=hash-link aria-label="Direct link to replaced-goalsubsystemrequired_union_implementations-with-goalsubsystemactivated" title="Direct link to replaced-goalsubsystemrequired_union_implementations-with-goalsubsystemactivated" translate=no>​</a></h3>
<p>See <a href=https://github.com/pantsbuild/pants/pull/14313 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/14313</a> for an explanation and some examples of how to fix.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=210>2.10<a href=#210 class=hash-link aria-label="Direct link to 2.10" title="Direct link to 2.10" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.10.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.10.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=rename-lintrequest-to-linttargetsrequest>Rename <code>LintRequest</code> to <code>LintTargetsRequest</code><a href=#rename-lintrequest-to-linttargetsrequest class=hash-link aria-label="Direct link to rename-lintrequest-to-linttargetsrequest" title="Direct link to rename-lintrequest-to-linttargetsrequest" translate=no>​</a></h3>
<p>Pants 2.10 added a new <code>LintFilesRequest</code>, which allows you to run linters on code without any owning targets! <a href=https://github.com/pantsbuild/pants/pull/14102 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/14102</a></p>
<p>To improve clarity, we renamed <code>LintRequest</code> to <code>LintTargetsRequest</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=fmtrequest-checkrequest-and-linttargetsrequest-must-set-name><code>FmtRequest</code>, <code>CheckRequest</code>, and <code>LintTargetsRequest</code> must set <code>name</code><a href=#fmtrequest-checkrequest-and-linttargetsrequest-must-set-name class=hash-link aria-label="Direct link to fmtrequest-checkrequest-and-linttargetsrequest-must-set-name" title="Direct link to fmtrequest-checkrequest-and-linttargetsrequest-must-set-name" translate=no>​</a></h3>
<p>You must set the class property <code>name</code> on these three types.</p>
<p>Before:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyPyRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">CheckRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    field_set_type </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> MyPyFieldSet</span><br/></span></code></pre></div></div>
<p>After:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyPyRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">CheckRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    field_set_type </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> MyPyFieldSet</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"mypy"</span><br/></span></code></pre></div></div>
<p>This change is what allowed us to add the <code>lint --only=flake8</code> feature.</p>
<p>For DRY, it is a good idea to change the <code>formatter_name</code>, <code>linter_name</code>, and <code>checker_name</code> in <code>FmtResult</code>, <code>LintResults</code>, and <code>CheckResults</code>, respectively, to use <code>request.name</code> rather than hardcoding the string again. See <a href=https://github.com/pantsbuild/pants/pull/14304 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/14304</a> for examples.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=removed-languagefmttargets-for-fmt>Removed <code>LanguageFmtTargets</code> for <code>fmt</code><a href=#removed-languagefmttargets-for-fmt class=hash-link aria-label="Direct link to removed-languagefmttargets-for-fmt" title="Direct link to removed-languagefmttargets-for-fmt" translate=no>​</a></h3>
<p>When setting up a new language to be formatted, you used to have to copy and paste a lot of boilerplate like <code>ShellFmtTargets</code>. That's been fixed, thanks to <a href=https://github.com/pantsbuild/pants/pull/14166 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/14166</a>.</p>
<p>To fix your code:</p>
<ol>
<li class="">If you defined any new languages to be formatted, delete the copy-and-pasted <code>LanguageFmtTargets</code> code.</li>
<li class="">For every formatter, change the <code>UnionRule</code> to be <code>UnionRule(FmtRequest, BlackRequest)</code>, rather than <code>UnionRule(PythonFmtRequest, BlackRequest)</code>, for example.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=replimplementation-now-passes-root-targets-not-transitive-closure><code>ReplImplementation</code> now passes root targets, not transitive closure<a href=#replimplementation-now-passes-root-targets-not-transitive-closure class=hash-link aria-label="Direct link to replimplementation-now-passes-root-targets-not-transitive-closure" title="Direct link to replimplementation-now-passes-root-targets-not-transitive-closure" translate=no>​</a></h3>
<p>We realized that it's useful to let REPL rules know what was specified vs. what is a transitive dependency: <a href=https://github.com/pantsbuild/pants/pull/14323 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/14323</a>.</p>
<p>To adapt to this, you will want to use <code>transitive_targets = await Get(TransitiveTargets, TransitiveTargetsRequest(request.addresses)</code>, then operate on <code>transitive_targets.closure</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=removed-pexfromtargetsrequestadditional_requirements>Removed <code>PexFromTargetsRequest.additional_requirements</code><a href=#removed-pexfromtargetsrequestadditional_requirements class=hash-link aria-label="Direct link to removed-pexfromtargetsrequestadditional_requirements" title="Direct link to removed-pexfromtargetsrequestadditional_requirements" translate=no>​</a></h3>
<p>Let us know if you were using this, and we can figure out how to add it back: <a href=https://github.com/pantsbuild/pants/pull/14350 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/14350</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=removed-pexfromtargetsrequestdirect_deps_only-bool>Removed <code>PexFromTargetsRequest(direct_deps_only: bool)</code><a href=#removed-pexfromtargetsrequestdirect_deps_only-bool class=hash-link aria-label="Direct link to removed-pexfromtargetsrequestdirect_deps_only-bool" title="Direct link to removed-pexfromtargetsrequestdirect_deps_only-bool" translate=no>​</a></h3>
<p>Let us know if you were using this, and we can figure out how to add it back: <a href=https://github.com/pantsbuild/pants/pull/14291 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/14291</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=renamed-generatetoollockfilesentineloptions_scope-to-resolve_name>Renamed <code>GenerateToolLockfileSentinel.options_scope</code> to <code>resolve_name</code><a href=#renamed-generatetoollockfilesentineloptions_scope-to-resolve_name class=hash-link aria-label="Direct link to renamed-generatetoollockfilesentineloptions_scope-to-resolve_name" title="Direct link to renamed-generatetoollockfilesentineloptions_scope-to-resolve_name" translate=no>​</a></h3>
<p>See <a href=https://github.com/pantsbuild/pants/pull/14231 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/14231</a> for more info.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=renamed-pythonmodule-to-pythonmoduleownersrequest>Renamed <code>PythonModule</code> to <code>PythonModuleOwnersRequest</code><a href=#renamed-pythonmodule-to-pythonmoduleownersrequest class=hash-link aria-label="Direct link to renamed-pythonmodule-to-pythonmoduleownersrequest" title="Direct link to renamed-pythonmodule-to-pythonmoduleownersrequest" translate=no>​</a></h3>
<p>This type was used to determine the owners of a Python module. The new name makes that more clear. See <a href=https://github.com/pantsbuild/pants/pull/14276 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/14276</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=29>2.9<a href=#29 class=hash-link aria-label="Direct link to 2.9" title="Direct link to 2.9" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.9.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.9.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=deprecated-rulerunnercreate_files-create_file-and-add_to_build_file>Deprecated <code>RuleRunner.create_files()</code>, <code>.create_file()</code> and <code>.add_to_build_file()</code><a href=#deprecated-rulerunnercreate_files-create_file-and-add_to_build_file class=hash-link aria-label="Direct link to deprecated-rulerunnercreate_files-create_file-and-add_to_build_file" title="Direct link to deprecated-rulerunnercreate_files-create_file-and-add_to_build_file" translate=no>​</a></h3>
<p>Instead, for your <code>RuleRunner</code> tests, use <code>.write_files()</code>. See <a href=https://github.com/pantsbuild/pants/pull/13817 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/13817</a> for some examples.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=28>2.8<a href=#28 class=hash-link aria-label="Direct link to 2.8" title="Direct link to 2.8" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.8.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.8.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=target-modeling-changes>Target modeling changes<a href=#target-modeling-changes class=hash-link aria-label="Direct link to Target modeling changes" title="Direct link to Target modeling changes" translate=no>​</a></h3>
<p>Pants 2.8 cleaned up the modeling of targets. Now, there are targets that describe the atom of each language, like <code>python_test</code> and <code>python_source</code> which correspond to a single file. There are also target generators which exist solely for less boilerplate, like <code>python_tests</code> and <code>python_sources</code>.</p>
<p>We recommend re-reading <a class="" href=/prerelease/docs/using-pants/key-concepts/targets-and-build-files>Targets and BUILD files</a>.</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=sourcesfield><code>SourcesField</code><a href=#sourcesfield class=hash-link aria-label="Direct link to sourcesfield" title="Direct link to sourcesfield" translate=no>​</a></h4>
<p>The <code>Sources</code> class was replaced with <code>SourcesField</code>, <code>SingleSourceField</code>, and <code>MultipleSourcesField</code>.</p>
<p>When defining new target types with the Target API, you should choose between subclassing <code>SingleSourceField</code> and <code>MultipleSourcesField</code>, depending on if you want the field to be <code>source: str</code> or <code>sources: list[str]</code>.</p>
<p>Wherever you were using <code>Sources</code> in your <code>@rule</code>s, simply replace with <code>SourcesField</code>.</p>
<h4 class="anchor anchorTargetStickyNavbar_UrHV" id=renames-of-some-sources-subclasses>Renames of some <code>Sources</code> subclasses<a href=#renames-of-some-sources-subclasses class=hash-link aria-label="Direct link to renames-of-some-sources-subclasses" title="Direct link to renames-of-some-sources-subclasses" translate=no>​</a></h4>
<p>You should update all references to these classes in your <code>@rule</code>s.</p>
<ul>
<li class=""><code>FilesSources</code> -> <code>FileSourceField</code></li>
<li class=""><code>ResourcesSources</code> -> <code>ResourceSourceField</code></li>
<li class=""><code>PythonSources</code> -> <code>PythonSourceField</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=outputpathfieldvalue_or_default><code>OutputPathField.value_or_default()</code><a href=#outputpathfieldvalue_or_default class=hash-link aria-label="Direct link to outputpathfieldvalue_or_default" title="Direct link to outputpathfieldvalue_or_default" translate=no>​</a></h3>
<p>The method <code>OutputPathField.value_or_default()</code> no longer takes <code>Address</code> as an argument.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=27>2.7<a href=#27 class=hash-link aria-label="Direct link to 2.7" title="Direct link to 2.7" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.7.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.7.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=type-hints-work-properly>Type hints work properly<a href=#type-hints-work-properly class=hash-link aria-label="Direct link to Type hints work properly" title="Direct link to Type hints work properly" translate=no>​</a></h3>
<p>Pants was not using PEP 561 properly, which means that MyPy would not enforce type hints when using Pants APIs. Oops! This is now fixed.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=options-scopes-should-not-have-_>Options scopes should not have <code>_</code><a href=#options-scopes-should-not-have-_ class=hash-link aria-label="Direct link to options-scopes-should-not-have-_" title="Direct link to options-scopes-should-not-have-_" translate=no>​</a></h3>
<p>For example, use <code>my-subsystem</code> instead of <code>my_subsystem</code>. This is to avoid ambiguity with target types.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=26>2.6<a href=#26 class=hash-link aria-label="Direct link to 2.6" title="Direct link to 2.6" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.6.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.6.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=processcachescope><code>ProcessCacheScope</code><a href=#processcachescope class=hash-link aria-label="Direct link to processcachescope" title="Direct link to processcachescope" translate=no>​</a></h3>
<p><code>ProcessCacheScope.NEVER</code> was renamed to <code>ProcessCacheScope.PER_SESSION</code> to better reflect that a rule never runs more than once in a session (i.e. a single Pants run) given the same inputs.</p>
<p><code>ProcessCacheScope.PER_RESTART</code> was replaced with <code>ProcessCacheScope.PER_RESTART_ALWAYS</code> and <code>ProcessCacheScope.PER_RESTART_SUCCESSFUL</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=pexinterpreterconstraints><code>PexInterpreterConstraints</code><a href=#pexinterpreterconstraints class=hash-link aria-label="Direct link to pexinterpreterconstraints" title="Direct link to pexinterpreterconstraints" translate=no>​</a></h3>
<p>Now called <code>InterpreterConstraints</code> and defined in <code>pants.backend.python.util_rules.interpreter_constraints</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=25>2.5<a href=#25 class=hash-link aria-label="Direct link to 2.5" title="Direct link to 2.5" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.5.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.5.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=triboolfield><code>TriBoolField</code><a href=#triboolfield class=hash-link aria-label="Direct link to triboolfield" title="Direct link to triboolfield" translate=no>​</a></h3>
<p><code>BoolField.value</code> is no longer <code>bool | None</code>, but simply <code>bool</code>. This means that you must either set <code>required = True</code> or set the <code>default</code>.</p>
<p>Use <code>TriBoolField</code> if you still want to be able to represent a trinary state: <code>False</code>, <code>True</code>, and <code>None</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=added-rulerunnerwrite_files>Added <code>RuleRunner.write_files()</code><a href=#added-rulerunnerwrite_files class=hash-link aria-label="Direct link to added-rulerunnerwrite_files" title="Direct link to added-rulerunnerwrite_files" translate=no>​</a></h3>
<p>This is a more declarative way to set up files than the older API of <code>RuleRunner.create_file()</code>, <code>.create_files()</code>, and <code>.add_to_build_files()</code>. See <a class="" href=/prerelease/docs/writing-plugins/the-rules-api/testing-plugins>Testing plugins</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=24>2.4<a href=#24 class=hash-link aria-label="Direct link to 2.4" title="Direct link to 2.4" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.4.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.4.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=pexrequest-changes-how-entry-point-is-set><code>PexRequest</code> changes how entry point is set<a href=#pexrequest-changes-how-entry-point-is-set class=hash-link aria-label="Direct link to pexrequest-changes-how-entry-point-is-set" title="Direct link to pexrequest-changes-how-entry-point-is-set" translate=no>​</a></h3>
<p>See <a href=https://github.com/pantsbuild/pants/pull/11620 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/11620</a>. Instead of setting <code>entry_point="pytest"</code> in the <code>PexRequest</code> constructor, now you set <code>main=ConsoleScript("black")</code> or <code>main=EntryPoint("pytest")</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=must-use-environmentrequest-for-accessing-environment-variables>Must use <code>EnvironmentRequest</code> for accessing environment variables<a href=#must-use-environmentrequest-for-accessing-environment-variables class=hash-link aria-label="Direct link to must-use-environmentrequest-for-accessing-environment-variables" title="Direct link to must-use-environmentrequest-for-accessing-environment-variables" translate=no>​</a></h3>
<p>See <a href=https://github.com/pantsbuild/pants/pull/11641 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/pull/11641</a>. Pants now eagerly purges environment variables from the run, so using <code>os.environ</code> in plugins won't work anymore.</p>
<p>Instead, use <code>await Get(Environment, EnvironmentRequest(["MY_ENV_VAR"])</code>.</p>
<p>For <code>RuleRunner</code> tests, you must now either set <code>env</code> or the new <code>env_inherit</code> arguments for environment variables to be set. Tests are now hermetic.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=23>2.3<a href=#23 class=hash-link aria-label="Direct link to 2.3" title="Direct link to 2.3" translate=no>​</a></h2>
<p>There were no substantial changes to the Plugin API in 2.3. See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.3.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.3.x.md</a> for the changelog.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=22>2.2<a href=#22 class=hash-link aria-label="Direct link to 2.2" title="Direct link to 2.2" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.2.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.2.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=primitivefield-and-asyncfield-are-removed-220dev0><code>PrimitiveField</code> and <code>AsyncField</code> are removed (2.2.0.dev0)<a href=#primitivefield-and-asyncfield-are-removed-220dev0 class=hash-link aria-label="Direct link to primitivefield-and-asyncfield-are-removed-220dev0" title="Direct link to primitivefield-and-asyncfield-are-removed-220dev0" translate=no>​</a></h3>
<p>Rather than subclassing <code>PrimitiveField</code>, subclass <code>Field</code> directly. <code>Field</code> now behaves like <code>PrimitiveField</code> used to, and <code>PrimitiveField</code> was removed for simplicity.</p>
<p>Rather than subclassing <code>AsyncField</code> or <code>AsyncStringSequenceField</code>, subclass <code>Field</code> or a template like <code>StringField</code> and also subclass <code>AsyncFieldMixin</code>:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>from</span><span class="token plain"> pants</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">target </span><span class="token keyword" style=font-style:italic>import</span><span class="token plain"> AsyncFieldMixin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> StringField</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyField</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">StringField</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> AsyncFieldMixin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    alias </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"my_field"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">help</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"Description."</span><br/></span></code></pre></div></div>
<p>Async fields now access the raw value with the property <code>.value</code>, rather than <code>.sanitized_raw_value</code>. To override the eager validation, override <code>compute_value()</code>, rather than <code>sanitize_raw_value()</code>. Both these changes bring async fields into alignment with non-async fields.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=set-the-property-help-with-subsystems-targets-and-fields-220dev3>Set the property <code>help</code> with Subsystems, Targets, and Fields (2.2.0.dev3)<a href=#set-the-property-help-with-subsystems-targets-and-fields-220dev3 class=hash-link aria-label="Direct link to set-the-property-help-with-subsystems-targets-and-fields-220dev3" title="Direct link to set-the-property-help-with-subsystems-targets-and-fields-220dev3" translate=no>​</a></h3>
<p>Previously, you were supposed to set the class's docstring for the <code>pants help</code> message. Instead, now set a class property <code>help</code>, like this:</p>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyField</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">StringField</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    alias </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"my_field"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">help</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"A summary.\n\nOptional extra information."</span><br/></span></code></pre></div></div>
<p>Pants will now properly wrap strings and preserve newlines. You may want to run <code>pants help ${target/subsystem}</code> to verify things render properly.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=21>2.1<a href=#21 class=hash-link aria-label="Direct link to 2.1" title="Direct link to 2.1" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.1.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.1.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=sourcessnapshot-is-now-specssnapshot-210rc0><code>SourcesSnapshot</code> is now <code>SpecsSnapshot</code> (2.1.0rc0)<a href=#sourcessnapshot-is-now-specssnapshot-210rc0 class=hash-link aria-label="Direct link to sourcessnapshot-is-now-specssnapshot-210rc0" title="Direct link to sourcessnapshot-is-now-specssnapshot-210rc0" translate=no>​</a></h3>
<p>The type was renamed for clarity. Still import it from <code>pants.engine.fs</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_UrHV" id=20>2.0<a href=#20 class=hash-link aria-label="Direct link to 2.0" title="Direct link to 2.0" translate=no>​</a></h2>
<p>See <a href=https://github.com/pantsbuild/pants/blob/main/docs/notes/2.0.x.md target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/blob/main/docs/notes/2.0.x.md</a> for the changelog.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=use-transitivetargetsrequest-as-input-for-resolving-transitivetargets-200rc0>Use <code>TransitiveTargetsRequest</code> as input for resolving <code>TransitiveTargets</code> (2.0.0rc0)<a href=#use-transitivetargetsrequest-as-input-for-resolving-transitivetargets-200rc0 class=hash-link aria-label="Direct link to use-transitivetargetsrequest-as-input-for-resolving-transitivetargets-200rc0" title="Direct link to use-transitivetargetsrequest-as-input-for-resolving-transitivetargets-200rc0" translate=no>​</a></h3>
<p>Rather than <code>await Get(TransitiveTargets, Addresses([addr1]))</code>, use <code>await Get(TransitiveTargets, TransitiveTargetsRequest([addr1]))</code>, from <code>pants.engine.target</code>.</p>
<p>It's no longer possible to include <code>TransitiveTargets</code> in your <code>@rule</code> signature in order to get the transitive closure of what the user specified on the command. Instead, put <code>Addresses</code> in your rule's signature, and use <code>await Get(TransitiveTargets, TransitiveTargetsRequest(addresses))</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=codegen-implementations-use-dependenciesrequestlite-and-transitivetargetslite-200rc0>Codegen implementations: use <code>DependenciesRequestLite</code> and <code>TransitiveTargetsLite</code> (2.0.0rc0)<a href=#codegen-implementations-use-dependenciesrequestlite-and-transitivetargetslite-200rc0 class=hash-link aria-label="Direct link to codegen-implementations-use-dependenciesrequestlite-and-transitivetargetslite-200rc0" title="Direct link to codegen-implementations-use-dependenciesrequestlite-and-transitivetargetslite-200rc0" translate=no>​</a></h3>
<p>Due to a new cycle in the rule graph, for any codegen implementations, you must use <code>DependenciesRequestLite</code> instead of <code>DependenciesRequest</code>, and <code>TransitiveTargetsLite</code> instead of <code>TransitiveTargetsRequest</code>. Both imports are still from <code>pants.engine.target</code>.</p>
<p>These behave identically, except that they do not include dependency inference in the results. Unless you are generating for <code>input = PythonSources</code>, this should be fine, as dependency inference is currently only used with Python.</p>
<p>This is tracked by <a href=https://github.com/pantsbuild/pants/issues/10917 target=_blank rel="noopener noreferrer" class="">https://github.com/pantsbuild/pants/issues/10917</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=dependencies-like-fields-have-more-robust-support-200rc0>Dependencies-like fields have more robust support (2.0.0rc0)<a href=#dependencies-like-fields-have-more-robust-support-200rc0 class=hash-link aria-label="Direct link to Dependencies-like fields have more robust support (2.0.0rc0)" title="Direct link to Dependencies-like fields have more robust support (2.0.0rc0)" translate=no>​</a></h3>
<p>If you have any custom fields that act like the dependencies field, but do not subclass <code>Dependencies</code>, there are two new mechanisms for better support.</p>
<ol>
<li class="">Instead of subclassing <code>StringSequenceField</code>, subclass <code>SpecialCasedDependencies</code> from <code>pants.engine.target</code>. This will ensure that the dependencies show up with <code>pants dependencies</code> and <code>pants dependents</code>.</li>
<li class="">You can use <code>UnparsedAddressInputs</code> from <code>pants.engine.addresses</code> to resolve the addresses:</li>
</ol>
<div class="language-python codeBlockContainer_LrZr theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QpNL><pre tabindex=0 class="prism-code language-python codeBlock_z5Jo thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_YVRJ><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>from</span><span class="token plain"> pants</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addresses </span><span class="token keyword" style=font-style:italic>import</span><span class="token plain"> Address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Addresses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> UnparsedAddressedInputs</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>from</span><span class="token plain"> pants</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">target </span><span class="token keyword" style=font-style:italic>import</span><span class="token plain"> Targets</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">addresses </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>await</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Addresses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> UnparsedAddressedInputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">"//:addr1"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"project/addr2"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> owning_address</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Or, use this.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">targets </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>await</span><span class="token plain"> Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    Targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    UnparsedAddressedInputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">"//:addr1"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"project/addr2"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> owning_address</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">Address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">"project"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> target_name</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">"original"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>If you defined a subclass of <code>SpecialCasedDependencies</code>, you can use <code>await Get(Addresses | Targets, UnparsedAddressInputs, my_tgt[MyField].to_unparsed_address_inputs())</code>.</p>
<p>(Why would you ever do this? If you have dependencies that you don't treat like normal—e.g. that you will call the equivalent of <code>pants package</code> on those deps—it's often helpful to call out this magic through a dedicated field. For example, Pants's <a href=https://github.com/pantsbuild/pants/blob/969c8dcba6eda0c939918b3bc5157ca45099b4d1/src/python/pants/core/target_types.py#L231-L257 target=_blank rel="noopener noreferrer" class="">archive</a> target type has the fields <code>files</code> and <code>packages</code>, rather than <code>dependencies</code>.)</p>
<h3 class="anchor anchorTargetStickyNavbar_UrHV" id=package-implementations-may-want-to-add-the-field-output_path-200rc0><code>package</code> implementations may want to add the field <code>output_path</code> (2.0.0rc0)<a href=#package-implementations-may-want-to-add-the-field-output_path-200rc0 class=hash-link aria-label="Direct link to package-implementations-may-want-to-add-the-field-output_path-200rc0" title="Direct link to package-implementations-may-want-to-add-the-field-output_path-200rc0" translate=no>​</a></h3>
<p>All of Pants's target types that can be built via <code>pants package</code> now have an <code>output_path</code> field, which allows the user to override the path used for the created asset.</p>
<p>You optionally may want to add this <code>output_path</code> field to your custom target type for consistency:</p>
<ol>
<li class="">Include <code>OutputPathField</code> from <code>pants.core.goals.package</code> in your target's <code>core_fields</code> class property.</li>
<li class="">In your <code>PackageFieldSet</code> subclass, include <code>output_path: OutputPathField</code>.</li>
<li class="">When computing the filename in your rule, use <code>my_package_field_set.output_path.value_or_default(field_set.address, file_ending="my_ext")</code>.</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_eWnd"><a href=https://github.com/pantsbuild/pants/edit/main/docs/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide.mdx target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_HmrO aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_F4iS"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/prerelease/docs/writing-plugins/common-plugin-tasks/custom-python-artifact-kwargs><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Custom `python_artifact()` kwargs</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/prerelease/docs/writing-plugins/common-plugin-tasks/allowing-tool-export><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Making a tool exportable</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_ZBPU thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#230 class="table-of-contents__link toc-highlight">2.30</a><li><a href=#223 class="table-of-contents__link toc-highlight">2.23</a><ul><li><a href=#deprecated-generatetoollockfilesentinel class="table-of-contents__link toc-highlight">Deprecated GenerateToolLockfileSentinel</a><li><a href=#jvm-migrating-from-generatejvmlockfilefromtool-to-jvmtoolbase class="table-of-contents__link toc-highlight">JVM: Migrating from GenerateJvmLockfileFromTool to JvmToolBase</a></ul><li><a href=#217 class="table-of-contents__link toc-highlight">2.17</a><ul><li><a href=#deprecated-some-request-types-in-favor-of-get-with-only-one-arg class="table-of-contents__link toc-highlight">Deprecated some <code>Request</code> types in favor of <code>Get</code> with only one arg</a><li><a href=#environmentbehaviorunmigrated-is-no-longer-available class="table-of-contents__link toc-highlight"><code>EnvironmentBehavior.UNMIGRATED</code> is no longer available</a></ul><li><a href=#216 class="table-of-contents__link toc-highlight">2.16</a><ul><li><a href=#runfieldset-and-testrequest-now-have-a-rules-method class="table-of-contents__link toc-highlight"><code>RunFieldSet</code> and <code>TestRequest</code> now have a <code>.rules()</code> method</a><li><a href=#runfieldset-can-be-used-to-run-targets-in-the-sandbox-as-part-of-a-build-rule class="table-of-contents__link toc-highlight"><code>RunFieldSet</code> can be used to run targets in the sandbox as part of a build rule</a><li><a href=#binaryshimsrequest-no-longer-accepts-output_directory class="table-of-contents__link toc-highlight"><code>BinaryShimsRequest</code> no longer accepts <code>output_directory</code></a></ul><li><a href=#215 class="table-of-contents__link toc-highlight">2.15</a><ul><li><a href=#lint-and-fmt-schema-changes class="table-of-contents__link toc-highlight"><code>lint</code> and <code>fmt</code> schema changes</a><li><a href=#test-schema-changes class="table-of-contents__link toc-highlight"><code>test</code> schema changes</a><li><a href=#environmentname-is-now-required-to-run-processes-get-environment-variables-etc class="table-of-contents__link toc-highlight"><code>EnvironmentName</code> is now required to run processes, get environment variables, etc</a><li><a href=#platform-kwarg-for-process-deprecated class="table-of-contents__link toc-highlight"><code>platform</code> kwarg for <code>Process</code> deprecated</a><li><a href=#environment-environmentrequest-and-completeenvironment-renamed-and-moved class="table-of-contents__link toc-highlight"><code>Environment</code>, <code>EnvironmentRequest</code>, and <code>CompleteEnvironment</code> renamed and moved</a><li><a href=#mockget-expects-input_types-kwarg-not-input_type class="table-of-contents__link toc-highlight"><code>MockGet</code> expects <code>input_types</code> kwarg, not <code>input_type</code></a><li><a href=#deprecated-platformcurrent class="table-of-contents__link toc-highlight">Deprecated <code>Platform.current</code></a><li><a href=#deprecated-convert_dir_literal_to_address_literal-kwarg class="table-of-contents__link toc-highlight">Deprecated <code>convert_dir_literal_to_address_literal</code> kwarg</a></ul><li><a href=#214 class="table-of-contents__link toc-highlight">2.14</a><ul><li><a href=#removed-second-type-parameter-from-get class="table-of-contents__link toc-highlight">Removed second type parameter from <code>Get</code></a><li><a href=#fmtrequest---fmttargetsrequest class="table-of-contents__link toc-highlight"><code>FmtRequest</code> -> <code>FmtTargetsRequest</code></a><li><a href=#optional-option-flag-name class="table-of-contents__link toc-highlight">Optional Option flag name</a><li><a href=#injectdependencies---inferdependencies-with-inferdependencies-using-a-fieldset class="table-of-contents__link toc-highlight"><code>InjectDependencies</code> -> <code>InferDependencies</code>, with <code>InferDependencies</code> using a <code>FieldSet</code></a><li><a href=#generatetoollockfilesentinel-encouraged-to-use-language-specific-subclasses class="table-of-contents__link toc-highlight"><code>GenerateToolLockfileSentinel</code> encouraged to use language-specific subclasses</a><li><a href=#matches_filespec-replaced-by-filespecmatcher class="table-of-contents__link toc-highlight"><code>matches_filespec()</code> replaced by <code>FilespecMatcher</code></a></ul><li><a href=#213 class="table-of-contents__link toc-highlight">2.13</a><ul><li><a href=#addressinput-and-unparsedaddressinputs-require-description_of_origin class="table-of-contents__link toc-highlight"><code>AddressInput</code> and <code>UnparsedAddressInputs</code> require <code>description_of_origin</code></a><li><a href=#wrappedtarget-requires-wrappedtargetrequest class="table-of-contents__link toc-highlight"><code>WrappedTarget</code> requires <code>WrappedTargetRequest</code></a><li><a href=#redesign-of-specs class="table-of-contents__link toc-highlight">Redesign of <code>Specs</code></a><li><a href=#specssnapshot-is-now-specspaths class="table-of-contents__link toc-highlight"><code>SpecsSnapshot</code> is now <code>SpecsPaths</code></a><li><a href=#removed-putativetargetssearchpaths-for-tailor-plugins class="table-of-contents__link toc-highlight">Removed <code>PutativeTargetsSearchPaths</code> for <code>tailor</code> plugins</a><li><a href=#banned-short-option-names-like--x class="table-of-contents__link toc-highlight">Banned short option names like <code>-x</code></a></ul><li><a href=#212 class="table-of-contents__link toc-highlight">2.12</a><ul><li><a href=#unified-formatters class="table-of-contents__link toc-highlight">Unified formatters</a></ul><li><a href=#211 class="table-of-contents__link toc-highlight">2.11</a><ul><li><a href=#deprecated-subsystemregister_options class="table-of-contents__link toc-highlight">Deprecated <code>Subsystem.register_options()</code></a><li><a href=#moved-binarypathrequest-to-pantscoreutil_rulessystem_binaries class="table-of-contents__link toc-highlight">Moved <code>BinaryPathRequest</code> to <code>pants.core.util_rules.system_binaries</code></a><li><a href=#deprecated-not-implementing-targetgenerator-in-generatetargetsrequest-implementors class="table-of-contents__link toc-highlight">Deprecated not implementing <code>TargetGenerator</code> in <code>GenerateTargetsRequest</code> implementors</a><li><a href=#replaced-goalsubsystemrequired_union_implementations-with-goalsubsystemactivated class="table-of-contents__link toc-highlight">Replaced <code>GoalSubsystem.required_union_implementations</code> with <code>GoalSubsystem.activated()</code></a></ul><li><a href=#210 class="table-of-contents__link toc-highlight">2.10</a><ul><li><a href=#rename-lintrequest-to-linttargetsrequest class="table-of-contents__link toc-highlight">Rename <code>LintRequest</code> to <code>LintTargetsRequest</code></a><li><a href=#fmtrequest-checkrequest-and-linttargetsrequest-must-set-name class="table-of-contents__link toc-highlight"><code>FmtRequest</code>, <code>CheckRequest</code>, and <code>LintTargetsRequest</code> must set <code>name</code></a><li><a href=#removed-languagefmttargets-for-fmt class="table-of-contents__link toc-highlight">Removed <code>LanguageFmtTargets</code> for <code>fmt</code></a><li><a href=#replimplementation-now-passes-root-targets-not-transitive-closure class="table-of-contents__link toc-highlight"><code>ReplImplementation</code> now passes root targets, not transitive closure</a><li><a href=#removed-pexfromtargetsrequestadditional_requirements class="table-of-contents__link toc-highlight">Removed <code>PexFromTargetsRequest.additional_requirements</code></a><li><a href=#removed-pexfromtargetsrequestdirect_deps_only-bool class="table-of-contents__link toc-highlight">Removed <code>PexFromTargetsRequest(direct_deps_only: bool)</code></a><li><a href=#renamed-generatetoollockfilesentineloptions_scope-to-resolve_name class="table-of-contents__link toc-highlight">Renamed <code>GenerateToolLockfileSentinel.options_scope</code> to <code>resolve_name</code></a><li><a href=#renamed-pythonmodule-to-pythonmoduleownersrequest class="table-of-contents__link toc-highlight">Renamed <code>PythonModule</code> to <code>PythonModuleOwnersRequest</code></a></ul><li><a href=#29 class="table-of-contents__link toc-highlight">2.9</a><ul><li><a href=#deprecated-rulerunnercreate_files-create_file-and-add_to_build_file class="table-of-contents__link toc-highlight">Deprecated <code>RuleRunner.create_files()</code>, <code>.create_file()</code> and <code>.add_to_build_file()</code></a></ul><li><a href=#28 class="table-of-contents__link toc-highlight">2.8</a><ul><li><a href=#target-modeling-changes class="table-of-contents__link toc-highlight">Target modeling changes</a><li><a href=#outputpathfieldvalue_or_default class="table-of-contents__link toc-highlight"><code>OutputPathField.value_or_default()</code></a></ul><li><a href=#27 class="table-of-contents__link toc-highlight">2.7</a><ul><li><a href=#type-hints-work-properly class="table-of-contents__link toc-highlight">Type hints work properly</a><li><a href=#options-scopes-should-not-have-_ class="table-of-contents__link toc-highlight">Options scopes should not have <code>_</code></a></ul><li><a href=#26 class="table-of-contents__link toc-highlight">2.6</a><ul><li><a href=#processcachescope class="table-of-contents__link toc-highlight"><code>ProcessCacheScope</code></a><li><a href=#pexinterpreterconstraints class="table-of-contents__link toc-highlight"><code>PexInterpreterConstraints</code></a></ul><li><a href=#25 class="table-of-contents__link toc-highlight">2.5</a><ul><li><a href=#triboolfield class="table-of-contents__link toc-highlight"><code>TriBoolField</code></a><li><a href=#added-rulerunnerwrite_files class="table-of-contents__link toc-highlight">Added <code>RuleRunner.write_files()</code></a></ul><li><a href=#24 class="table-of-contents__link toc-highlight">2.4</a><ul><li><a href=#pexrequest-changes-how-entry-point-is-set class="table-of-contents__link toc-highlight"><code>PexRequest</code> changes how entry point is set</a><li><a href=#must-use-environmentrequest-for-accessing-environment-variables class="table-of-contents__link toc-highlight">Must use <code>EnvironmentRequest</code> for accessing environment variables</a></ul><li><a href=#23 class="table-of-contents__link toc-highlight">2.3</a><li><a href=#22 class="table-of-contents__link toc-highlight">2.2</a><ul><li><a href=#primitivefield-and-asyncfield-are-removed-220dev0 class="table-of-contents__link toc-highlight"><code>PrimitiveField</code> and <code>AsyncField</code> are removed (2.2.0.dev0)</a><li><a href=#set-the-property-help-with-subsystems-targets-and-fields-220dev3 class="table-of-contents__link toc-highlight">Set the property <code>help</code> with Subsystems, Targets, and Fields (2.2.0.dev3)</a></ul><li><a href=#21 class="table-of-contents__link toc-highlight">2.1</a><ul><li><a href=#sourcessnapshot-is-now-specssnapshot-210rc0 class="table-of-contents__link toc-highlight"><code>SourcesSnapshot</code> is now <code>SpecsSnapshot</code> (2.1.0rc0)</a></ul><li><a href=#20 class="table-of-contents__link toc-highlight">2.0</a><ul><li><a href=#use-transitivetargetsrequest-as-input-for-resolving-transitivetargets-200rc0 class="table-of-contents__link toc-highlight">Use <code>TransitiveTargetsRequest</code> as input for resolving <code>TransitiveTargets</code> (2.0.0rc0)</a><li><a href=#codegen-implementations-use-dependenciesrequestlite-and-transitivetargetslite-200rc0 class="table-of-contents__link toc-highlight">Codegen implementations: use <code>DependenciesRequestLite</code> and <code>TransitiveTargetsLite</code> (2.0.0rc0)</a><li><a href=#dependencies-like-fields-have-more-robust-support-200rc0 class="table-of-contents__link toc-highlight">Dependencies-like fields have more robust support (2.0.0rc0)</a><li><a href=#package-implementations-may-want-to-add-the-field-output_path-200rc0 class="table-of-contents__link toc-highlight"><code>package</code> implementations may want to add the field <code>output_path</code> (2.0.0rc0)</a></ul></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Spotlight</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/spotlight/users>Users</a><li class=footer__item><a class=footer__link-item href=/spotlight/testimonials>Testimonials</a><li class=footer__item><a class=footer__link-item href=/spotlight/media>Media</a><li class=footer__item><a class=footer__link-item href=/spotlight/service-providers>Service Providers</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Connect</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://github.com/pantsbuild/pants target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://twitter.com/pantsbuild target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://www.youtube.com/@pantsbuild target=_blank rel="noopener noreferrer" class=footer__link-item>YouTube<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://groups.google.com/forum/#!forum/pants-devel target=_blank rel="noopener noreferrer" class=footer__link-item>Mailing List<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_QvT7><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/blog>Blog</a><li class=footer__item><a class=footer__link-item href=/sponsors>Sponsors</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/community/getting-help>Getting Help</a><li class=footer__item><a class=footer__link-item href=/community/members>Members</a><li class=footer__item><a class=footer__link-item href=/community/code-of-conduct>Code of Conduct</a><li class=footer__item><a class=footer__link-item href=/community/meet-the-team>Meet the Team</a><li class=footer__item><a class=footer__link-item href=/community/maintainers>Maintainers</a><li class=footer__item><a class=footer__link-item href=/community/contentious-decisions>Contentious Decisions</a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © Pants project contributors. <a href=https://github.com/pantsbuild/pantsbuild.org>Website source</a> @ <a href=https://github.com/pantsbuild/pantsbuild.org/commit/a274212dfdcfe1657dd5eae4836420db8cdf9099>a27421</a>.</div></div></div></footer></div></body>