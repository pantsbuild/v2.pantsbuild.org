"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["16988"],{95660(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var s=t(24807),o=t(886070),i=t(848193);let l={authors:["eric"],tags:["announcement"]},r="Introducing Pants 2.5: Shell support, config autodiscovery, and incremental tool adoption",a={authorsImageUrls:[void 0]},c=[{value:"Shell support",id:"shell-support",level:2},{value:"Config autodiscovery",id:"config-autodiscovery",level:2},{value:"Incremental tool adoption",id:"incremental-tool-adoption",level:2},{value:"Fine-grained resolves without a performance hit",id:"fine-grained-resolves-without-a-performance-hit",level:2},{value:"Other changes",id:"other-changes",level:2},{value:"Upcoming in Pants 2.6",id:"upcoming-in-pants-26",level:2}];function d(e){let n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{CaptionedImg:s}=n;return s||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CaptionedImg",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s,{src:t(963482).A,children:(0,o.jsxs)(n.p,{children:["Photo by ",(0,o.jsx)(n.a,{href:"https://unsplash.com/@giuliamay?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Giulia\nMay"}),"\n/\n",(0,o.jsx)(n.a,{href:"https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Unsplash"})]})}),"\n","\n",(0,o.jsx)(n.p,{children:"We're pleased to announce Pants 2.5.0, the latest release of Pants, the scalable and ergonomic build system."}),"\n",(0,o.jsxs)(n.p,{children:["To update, set ",(0,o.jsx)(n.code,{children:'pants_version = "2.5.0"'})," in your ",(0,o.jsx)(n.code,{children:"pants.toml"}),". See ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/upgrade-tips",children:"upgrade tips"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"shell-support",children:"Shell support"}),"\n",(0,o.jsx)(n.p,{children:"Pants now supports Shell (e.g. Bash), in addition to Python!"}),"\n",(0,o.jsx)(n.p,{children:"Our goal is to empower you to follow best practices with your Shell scripts:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://www.shellcheck.net/",children:"Shellcheck"}),": lint for common Shell mistakes."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/mvdan/sh",children:"shfmt"}),": autoformat Shell code so that you can instead focus on the logic."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/kward/shunit2/",children:"shUnit2"}),": write light-weight unit tests for your Shell code."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Pants installs these tools for you deterministically, and integrates them into the workflows you already use with Pants: ",(0,o.jsx)(n.code,{children:"./pants lint"}),", ",(0,o.jsx)(n.code,{children:"./pants fmt"}),", and ",(0,o.jsx)(n.code,{children:"./pants test"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Pants will run these tools concurrently with your Python builds. For example, you can lint your Shell scripts at the same time as linting your Python code (Flake8, Black, etc.), all with a single consistent interface: ",(0,o.jsx)(n.code,{children:"./pants lint ::"}),"."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(873991).A+"",width:"1000",height:"692"})}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/shell",children:"https://www.pantsbuild.org/docs/shell"})," for how to get started with Shell."]}),"\n",(0,o.jsx)(n.h2,{id:"config-autodiscovery",children:"Config autodiscovery"}),"\n",(0,o.jsx)(n.p,{children:"Pants will now autodiscover config files for the tools you run\u2014like Black, isort, and Pytest\u2014using the same semantics that the tools themselves use."}),"\n",(0,o.jsxs)(n.p,{children:["If your config file is in a non-standard location, you can still set options like ",(0,o.jsx)(n.code,{children:"[black].config"})," and ",(0,o.jsx)(n.code,{children:"[flake8].config"})," for Pants to tell the tools to load the config."]}),"\n",(0,o.jsx)(n.h2,{id:"incremental-tool-adoption",children:"Incremental tool adoption"}),"\n",(0,o.jsxs)(n.p,{children:["You can now tell Pants to skip running a particular tool on specific files by updating the corresponding ",(0,o.jsx)(n.code,{children:"BUILD"})," file."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",metastring:'title="helloworld/BUILD"',children:'# Skip Black and Flake8 for all the non-test files in this folder.\npython_library(skip_black=True, skip_flake8=True)\n\n# Skip isort for all the test files in this folder.\npython_tests(name="tests", skip_isort=True)\n'})}),"\n",(0,o.jsx)(n.p,{children:"Pants will still run that tool on everything else, and will still run all your other tools on the skipped file."}),"\n",(0,o.jsx)(n.p,{children:"This feature gives you a consistent mechanism to adopt tools like MyPy and Flake8 incrementally, regardless of how large your repository becomes."}),"\n",(0,o.jsx)("iframe",{width:"100%",height:"500",src:"https://www.youtube.com/embed/BOhcdRsmv0s?si=Dl2IDI8QqJnGvQ9H",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0}),"\n",(0,o.jsx)(n.h2,{id:"fine-grained-resolves-without-a-performance-hit",children:"Fine-grained resolves without a performance hit"}),"\n",(0,o.jsxs)(n.p,{children:["Unlike most Python workflows (e.g. Poetry, Pipenv, ",(0,o.jsx)(n.code,{children:"virtualenv"}),") that use a single virtual environment for the entire project, Pants understands your file's transitive dependencies and only uses what is actually needed for that file to run."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell-session",children:"$ ./pants dependencies --transitive --type=3rdparty project/tests.py\nansicolors==1.1.8\ntyping-extensions==3.7.4.3\n"})}),"\n",(0,o.jsx)("figcaption",{children:(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"./pants dependencies"})," goal shows what exactly each file depends on. See\n",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/project-introspection",children:"https://www.pantsbuild.org/docs/project-introspection"}),"."]})}),"\n",(0,o.jsxs)(n.p,{children:["Fine-grained resolves give you fine-grained caching, meaning that when you change your ",(0,o.jsx)(n.code,{children:"requirements.txt"}),", for example, you only need to rerun tests whose requirements have changed, rather than needing to rerun your whole test suite. Fine-grained resolves also mean that Pants can ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/python-package-goal",children:"build artifacts like PEX files and wheels"})," and use only that code's true dependencies, rather than the whole virtual environment."]}),"\n",(0,o.jsx)(n.p,{children:"However, these fine-grained resolves previously introduced a performance issue: resolving from PyPI and building wheels is extremely slow, and it's painful to do this for every permutation of your requirements used in the project. So, Pants had an option to use a single virtual environment, but you would lose the benefits of fine-grained resolves."}),"\n",(0,o.jsxs)(n.p,{children:["Now, Pants knows how to get the best of both worlds by resolving your dependencies only once, and then subsetting that resolve to extract only the requirements you actually need. If you use a global constraints file with ",(0,o.jsx)(n.code,{children:"[python-setup].requirement_constraints"}),", Pants will first resolve all those dependencies once, downloading them and building their wheels. Then, Pants uses a new feature from PEX to extract the relevant subsets of that single resolve."]}),"\n",(0,o.jsxs)(n.p,{children:["This change means that when you update your ",(0,o.jsx)(n.code,{children:"requirements.txt"})," or ",(0,o.jsx)(n.code,{children:"constraints.txt"}),", only the tests that actually use those requirements will be invalidated with Pants's cache\u2014without needing to redownload and build wheels multiple times."]}),"\n",(0,o.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Pants can now run with Python 3.9, in addition to 3.7 and 3.8. (Your own code can use a different Python version)."}),"\n",(0,o.jsxs)(n.li,{children:["Setting ",(0,o.jsx)(n.code,{children:"[isort].config"})," will now tell isort to load the config file (when safe to do so), meaning that custom config file locations now work without needing to set ",(0,o.jsx)(n.code,{children:"[isort].args"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"[coverage-py]"})," config files now work with ",(0,o.jsx)(n.code,{children:"pyproject.toml"}),", ",(0,o.jsx)(n.code,{children:"setup.cfg"}),", and ",(0,o.jsx)(n.code,{children:"tox.ini"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"python_tests"})," targets have a new field ",(0,o.jsx)(n.code,{children:"extra_env_vars"})," to augment the option ",(0,o.jsx)(n.code,{children:"[test].extra_env_vars"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Added ",(0,o.jsx)(n.code,{children:"RuleRunner.write_files()"})," for more declarative tests of Pants plugins."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["See the full ",(0,o.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/blob/release_2.5.0/src/python/pants/notes/2.5.x.md",children:"changelog"})," for more changes."]}),"\n",(0,o.jsx)(n.h2,{id:"upcoming-in-pants-26",children:"Upcoming in Pants 2.6"}),"\n",(0,o.jsx)(n.p,{children:"We're re-envisioning Pants's support for Python third-party dependencies to be more ergonomic, flexible, and safe, including:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Autogenerating lockfiles."}),"\n",(0,o.jsx)(n.li,{children:"Adding dedicated lockfiles for each tool you run, e.g. Black and Flake8."}),"\n",(0,o.jsx)(n.li,{children:"Supporting multiple lockfiles for your repository."}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},963482(e,n,t){t.d(n,{A:()=>s});let s=t.p+"assets/images/splash-396865e6e0d4e5acf453c51cb94ee656.jpg"},873991(e,n,t){t.d(n,{A:()=>s});let s=t.p+"assets/images/shell-support-309bf739996bcdac08e2831040b4a6b5.png"},848193(e,n,t){t.d(n,{R:()=>l,x:()=>r});var s=t(830758);let o={},i=s.createContext(o);function l(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(i.Provider,{value:n},e.children)}},24807(e){e.exports=JSON.parse('{"permalink":"/blog/2021/05/20/introducing-pants-2-5","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-05-20-introducing-pants-2-5/index.mdx","source":"@site/blog/2021-05-20-introducing-pants-2-5/index.mdx","title":"Introducing Pants 2.5: Shell support, config autodiscovery, and incremental tool adoption","description":"Photo by [Giulia","date":"2021-05-20T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":4.31,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["announcement"]},"unlisted":false,"prevItem":{"title":"How we added Apple Silicon support to Pants","permalink":"/blog/2021/06/21/how-we-added-apple-silicon-support-to-pants"},"nextItem":{"title":"It\'s PyCon US Time!","permalink":"/blog/2021/05/12/pycon_us_2021"}}')}}]);