"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["840361"],{865275(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var s=t(460573),i=t(886070),o=t(848193);let r={title:"Setting up Pants",sidebar_position:0},l,a={},d=[{value:"Step 1: Fork and clone <code>pantsbuild/pants</code>",id:"step-1-fork-and-clone-pantsbuildpants",level:2},{value:"Step 2: Bootstrap the Rust engine",id:"step-2-bootstrap-the-rust-engine",level:2},{value:"Step 3: Set up a pre-push Git Hook",id:"step-3-set-up-a-pre-push-git-hook",level:2},{value:"Configure your IDE (optional)",id:"configure-your-ide-optional",level:2},{value:"Hooking up the Python virtual environment",id:"hooking-up-the-python-virtual-environment",level:3},{value:"PyCharm guide",id:"pycharm-guide",level:3},{value:"VSCode guide",id:"vscode-guide",level:3},{value:"Alternative with the Dev Container",id:"alternative-with-the-dev-container",level:2},{value:"Features",id:"features",level:3},{value:"Getting started",id:"getting-started",level:3},{value:"Using the Dev Container",id:"using-the-dev-container",level:3}];function c(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"How to set up Pants for local development."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"step-1-fork-and-clone-pantsbuildpants",children:["Step 1: Fork and clone ",(0,i.jsx)(n.code,{children:"pantsbuild/pants"})]}),"\n",(0,i.jsxs)(n.p,{children:["We use the popular forking workflow typically used by open source projects. See ",(0,i.jsx)(n.a,{href:"https://guides.github.com/activities/forking/",children:"https://guides.github.com/activities/forking/"})," for a guide on how to fork ",(0,i.jsx)(n.a,{href:"https://github.com/pantsbuild/pants",children:"pantsbuild/pants"}),", then clone it to your local machine."]}),"\n",(0,i.jsxs)(n.admonition,{type:"caution",children:[(0,i.jsxs)(n.mdxAdmonitionTitle,{children:["macOS users: install a newer ",(0,i.jsx)(n.code,{children:"openssl"})]}),(0,i.jsxs)(n.p,{children:["Pants requires a more modern OpenSSL version than the one that comes with macOS. To get all dependencies to resolve correctly, run the below commands. If you are using Zsh, use ",(0,i.jsx)(n.code,{children:".zshrc"})," rather than ",(0,i.jsx)(n.code,{children:".bashrc"}),"."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ brew install openssl\n$ echo 'export PATH=\"$(brew --prefix)/opt/openssl/bin:$PATH\"' >> ~/.bashrc\n$ echo 'export LDFLAGS=\"-L$(brew --prefix)/opt/openssl/lib\"' >> ~/.bashrc\n$ echo 'export CPPFLAGS=\"-I$(brew --prefix)/opt/openssl/include\"' >> ~/.bashrc\n"})}),(0,i.jsxs)(n.p,{children:["(If you don't have ",(0,i.jsx)(n.code,{children:"brew"})," installed, see ",(0,i.jsx)(n.a,{href:"https://brew.sh",children:"https://brew.sh"}),")"]})]}),"\n",(0,i.jsx)(n.h2,{id:"step-2-bootstrap-the-rust-engine",children:"Step 2: Bootstrap the Rust engine"}),"\n",(0,i.jsxs)(n.p,{children:["Pants requires several dependencies to be installed: a Python 3.11 interpreter, Rust, the protobuf compiler, clang and others. There is experimental support for the Nix package manager that makes it easy to set up a dev environment. Follow the instructions on the ",(0,i.jsx)(n.a,{href:"https://nixos.org/download.html",children:"Nix website"})," to install Nix. Then ",(0,i.jsx)(n.code,{children:"cd"})," into the directory where you cloned the Pants repo and type ",(0,i.jsx)(n.code,{children:"nix-shell"}),". This will download all the necessary dependencies and start a shell with a suitably configured PATH variable to make them available for use."]}),"\n",(0,i.jsx)(n.p,{children:"Alternatively, you can install the dependencies manually as follows:"}),"\n",(0,i.jsxs)(n.p,{children:["Pants uses Rustup to install Rust. Run the command from ",(0,i.jsx)(n.a,{href:"https://rustup.rs",children:"https://rustup.rs"})," to install Rustup; ensure that ",(0,i.jsx)(n.code,{children:"rustup"})," is on your ",(0,i.jsx)(n.code,{children:"$PATH"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"If your system Python is not the version Pants expects (currently Python 3.11), you'll need to provide one. Python interpreters from Linux or Mac distributions sometimes have quirks that can cause headaches with bootstrapping the dev venv. Some examples of Pythons that work well with Pants are those provided by:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://packages.fedoraproject.org/pkgs/python3.11/python3.11/",children:"Fedora"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/asdf-community/asdf-python",children:"ASDF"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/pyenv/pyenv",children:"PyEnv"}),"\nProviders that sometimes cause issues include:"]}),"\n",(0,i.jsxs)(n.li,{children:["Ubuntu Deadsnakes\nYou also need to have the protobuf compiler and LLVM clang installed. On Debian derivatives, these can be installed using ",(0,i.jsx)(n.code,{children:"apt install clang protobuf-compiler"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Then, run ",(0,i.jsx)(n.code,{children:"pants"})," to set up the Python virtual environment and compile the engine."]}),"\n",(0,i.jsx)(n.admonition,{title:"This will take several minutes",type:"caution",children:(0,i.jsx)(n.p,{children:"Rust compilation is really slow. Fortunately, this step gets cached, so you will only need to wait the first time."})}),"\n",(0,i.jsxs)(n.admonition,{title:"Want a faster compile?",type:"note",children:[(0,i.jsxs)(n.p,{children:["We default to compiling with Rust's ",(0,i.jsx)(n.code,{children:"release"})," mode, instead of its ",(0,i.jsx)(n.code,{children:"debug"})," mode, because this makes Pants substantially faster. However, this results in the compile taking 5-10x longer."]}),(0,i.jsxs)(n.p,{children:["If you are okay with Pants running much slower when iterating, set the environment variable ",(0,i.jsx)(n.code,{children:"MODE=debug"})," and rerun ",(0,i.jsx)(n.code,{children:"pants"})," to compile in debug mode."]})]}),"\n",(0,i.jsxs)(n.admonition,{title:"Rust compilation can use lots of storage",type:"caution",children:[(0,i.jsx)(n.p,{children:"Compiling the engine typically results in several gigabytes of storage over time. We have not yet implemented automated garbage collection for building the engine because contributors are the only ones to need to compile Rust, not every-day users."}),(0,i.jsxs)(n.p,{children:["To free up space, run ",(0,i.jsx)(n.code,{children:"rm -rf src/rust/engine/target"}),"."]}),(0,i.jsx)(n.p,{children:"Warning: this will cause Rust to recompile everything."})]}),"\n",(0,i.jsx)(n.h2,{id:"step-3-set-up-a-pre-push-git-hook",children:"Step 3: Set up a pre-push Git Hook"}),"\n",(0,i.jsxs)(n.p,{children:["We have a ",(0,i.jsx)(n.a,{href:"https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks",children:"Git Hook"})," that runs some useful checks and lints when you ",(0,i.jsx)(n.code,{children:"git push"}),". Running this locally can prevent easily avoidable CI failures such as whitespace or linting issues."]}),"\n",(0,i.jsx)(n.p,{children:"To install this, run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ build-support/bin/setup.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can manually run the pre-push check with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ build-support/githooks/pre-push\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"/2.26/docs/contributions/development/developing-rust",children:"Rust-compilation"})," affecting ",(0,i.jsx)(n.code,{children:"MODE"}),' flag is passed through to the hooks, so to run the githooks in "debug" mode, you can do something like:']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ MODE=debug git push ...\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"How to temporarily skip the pre-push checks",type:"note",children:(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"git push --no-verify"})," or ",(0,i.jsx)(n.code,{children:"git push -n"})," to skip the checks."]})}),"\n",(0,i.jsx)(n.h2,{id:"configure-your-ide-optional",children:"Configure your IDE (optional)"}),"\n",(0,i.jsx)(n.h3,{id:"hooking-up-the-python-virtual-environment",children:"Hooking up the Python virtual environment"}),"\n",(0,i.jsxs)(n.p,{children:["Most IDEs allow you to configure a Python ",(0,i.jsx)(n.a,{href:"https://docs.python.org/3/tutorial/venv.html",children:"virtual environment"})," so that the editor understands your Python import statements."]}),"\n",(0,i.jsxs)(n.p,{children:["Pants sets up its development virtualenv at ",(0,i.jsx)(n.code,{children:"~/.cache/pants/pants_dev_deps/<arch>.<version>.venv/"}),". Point your editor to the ",(0,i.jsx)(n.code,{children:"bin/python"})," file in this folder, e.g. ",(0,i.jsx)(n.code,{children:"~/.cache/pants/pants_dev_deps/Darwin.py37.venv/bin/python"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"pycharm-guide",children:"PyCharm guide"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:'Use "New project" and click the option "Existing interpreter". Point the interpreter to the virtual environment location described above.'}),"\n",(0,i.jsxs)(n.li,{children:["In your project tree (the list of folders and files), secondary-click the folder ",(0,i.jsx)(n.code,{children:"src/python"}),'. Click "Mark directory as" and choose "Sources".']}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"vscode-guide",children:"VSCode guide"}),"\n",(0,i.jsxs)(n.p,{children:["Add this to your ",(0,i.jsx)(n.code,{children:"settings.json"})," file inside the build root's ",(0,i.jsx)(n.code,{children:".vscode"})," folder:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",metastring:'title="settings.json"',children:'{\n  "python.analysis.extraPaths": ["src/python"],\n  "python.formatting.provider": "black",\n  "python.linting.enabled": true,\n  "python.linting.flake8Enabled": true,\n  "python.linting.flake8Args": ["--config=build-support/flake8/.flake8"],\n  "rust-analyzer.linkedProjects": ["src/rust/engine/Cargo.toml"]\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"python.analysis.extraPaths"})," lets VSCode know where to find Pants's source root. The other config enables ",(0,i.jsx)(n.code,{children:"black"})," and ",(0,i.jsx)(n.code,{children:"flake8"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"alternative-with-the-dev-container",children:"Alternative with the Dev Container"}),"\n",(0,i.jsx)(n.admonition,{title:"We would love your feedback",type:"note",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.em,{children:"Development Container"})," for Pants is still in its early stages. Please let us know if you encounter any issues or have suggestions for improvement."]})}),"\n",(0,i.jsxs)(n.p,{children:["This project provides a ",(0,i.jsx)(n.em,{children:"Development Container"})," (or ",(0,i.jsx)(n.a,{href:"https://containers.dev/",children:"Dev Container"})," for short) with a full-featured development environment containing all the tools, libraries, and runtimes needed to work with the ",(0,i.jsx)(n.a,{href:"https://github.com/pantsbuild/pants",children:"Pants"})," codebase. Here are some advantages of using dev containers:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Faster setup"}),": Dev containers can be pre-built with all the necessary tools, libraries and runtimes, making setting up a new development environment faster. This is especially useful for new team members joining a project who can quickly get started without spending time setting up their development environment."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Portability"}),": Dev containers provide portability between different platforms and clouds, allowing developers to write once and run anywhere. This ensures that developers can use the same development environment across different machines and platforms without compatibility issues."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consistency"}),": Dev containers provide a consistent development environment for all developers working on a project. This ensures that everyone is using the same tools, libraries and runtimes, reducing the chances of compatibility issues and making it easier to collaborate and reproduce bugs."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Isolation"}),": Dev containers run in isolation from the host system, which improves security and reduces the chances of conflicts with other software installed on the host system."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reproducibility"}),": Dev containers can be version-controlled, making it easy to reproduce the development environment at any point in time. It also allows developers to roll back to an earlier environment version if necessary."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"features",children:"Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://www.rust-lang.org/",children:"Rust"})," engine and common Rust utilities"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://www.python.org/",children:"Python"})," 3.11"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/devcontainers/features/tree/main/src/docker-in-docker",children:"Docker-in-Docker"})," (DinD)"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/stuartleeks/dev-container-features/tree/main/src/shell-history",children:"Shell History"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.pantsbuild.org/stable/docs/contributions/development/setting-up-pants#step-3-set-up-a-pre-push-git-hook",children:"Local Git hooks"})}),"\n",(0,i.jsxs)(n.li,{children:["Useful VS Code extensions like ",(0,i.jsx)(n.code,{children:"Python"}),", ",(0,i.jsx)(n.code,{children:"Pylance"}),", ",(0,i.jsx)(n.code,{children:"Black Formatter"}),", ",(0,i.jsx)(n.code,{children:"rust-analyser"}),", ",(0,i.jsx)(n.code,{children:"Even Better TOML"}),", etc."]}),"\n",(0,i.jsxs)(n.li,{children:["Volumes for Pants ",(0,i.jsx)(n.a,{href:"https://www.pantsbuild.org/stable/docs/using-pants/using-pants-in-ci#directories-to-cache",children:"cache directories"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hyperfine"}),", ",(0,i.jsx)(n.code,{children:"py-sy"}),", ",(0,i.jsx)(n.code,{children:"memray"})," and ",(0,i.jsx)(n.code,{children:"dbg"})," for ",(0,i.jsx)(n.a,{href:"https://www.pantsbuild.org/stable/docs/contributions/development/debugging-and-benchmarking",children:"debugging and benchmarking"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"getting-started",children:"Getting started"}),"\n",(0,i.jsx)(n.p,{children:"You need three (3) things to get started with development containers:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://code.visualstudio.com/",children:"VS Code"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.docker.com/",children:"Docker"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers",children:"Dev Containers"})," extension for VS Code"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["More on getting started can be found ",(0,i.jsx)(n.a,{href:"https://code.visualstudio.com/docs/devcontainers/containers#_getting-started",children:"here"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"using-the-dev-container",children:"Using the Dev Container"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["After forking and cloning ",(0,i.jsx)(n.code,{children:"pantsbuild/pants"}),", start VS Code and run the ",(0,i.jsx)(n.code,{children:"Dev Containers: Open Folder in Container..."})," command from the ",(0,i.jsx)(n.em,{children:"Command Palette..."})," (",(0,i.jsx)(n.code,{children:"F1"}),") and select the Pants project folder."]}),"\n",(0,i.jsx)(n.li,{children:"The VS Code window (instance) will reload and start building the dev container. A progress notification provides status updates."}),"\n",(0,i.jsx)(n.li,{children:"After the build completes, VS Code will automatically connect to the container. You can now work with the repository source code in this independent environment."}),"\n",(0,i.jsxs)(n.li,{children:["Pants sets up its development virtualenv at ",(0,i.jsx)(n.code,{children:"~/.cache/pants/pants_dev_deps/<venv_fingerprint>.venv/"}),". Point VS Code to the ",(0,i.jsx)(n.code,{children:"bin/python"})," file in this folder by running the ",(0,i.jsx)(n.code,{children:"Python: Select Interpreter"})," command from the ",(0,i.jsx)(n.em,{children:"Command Palette..."})," (",(0,i.jsx)(n.code,{children:"F1"}),"), and then ",(0,i.jsx)(n.code,{children:"Enter interpreter path..."}),". You may need to restart your ",(0,i.jsx)(n.em,{children:"terminal"}),". See ",(0,i.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/contributor-setup#configure-your-ide-optional",children:"Configure your IDE (optional)"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["More on starting a dev container can be found ",(0,i.jsx)(n.a,{href:"https://code.visualstudio.com/docs/devcontainers/containers#_picking-your-quick-start",children:"here"}),"."]})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},848193(e,n,t){t.d(n,{R:()=>r,x:()=>l});var s=t(830758);let i={},o=s.createContext(i);function r(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}},460573(e){e.exports=JSON.parse('{"id":"docs/contributions/development/setting-up-pants","title":"Setting up Pants","description":"How to set up Pants for local development.","source":"@site/versioned_docs/version-2.26/docs/contributions/development/setting-up-pants.mdx","sourceDirName":"docs/contributions/development","slug":"/docs/contributions/development/setting-up-pants","permalink":"/2.26/docs/contributions/development/setting-up-pants","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/contributions/development/setting-up-pants.mdx","tags":[],"version":"2.26","sidebarPosition":0,"frontMatter":{"title":"Setting up Pants","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Development","permalink":"/2.26/docs/contributions/development/"},"next":{"title":"Style guide","permalink":"/2.26/docs/contributions/development/style-guide"}}')}}]);