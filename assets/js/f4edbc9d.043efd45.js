"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["637905"],{128814(e,t,i){i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>d});var n=i(506227),s=i(886070),r=i(848193);let a={title:"Concepts",sidebar_position:0},o,l={},d=[{value:"Targets and Fields - the core building blocks",id:"targets-and-fields---the-core-building-blocks",level:2},{value:"Definition of <em>target</em>",id:"definition-of-target",level:3},{value:"Definition of <em>field</em>",id:"definition-of-field",level:3},{value:"Precise definition of <em>target</em>: a combination of fields",id:"precise-definition-of-target-a-combination-of-fields",level:3},{value:"Fields may be reused",id:"fields-may-be-reused",level:3},{value:"A Field-Driven API",id:"a-field-driven-api",level:2},{value:"Customizing fields through subclassing",id:"customizing-fields-through-subclassing",level:2}];function c(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"The core concepts of Targets and Fields."}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.p,{children:["The Target API defines how you interact with targets in your plugin. For example, you would use the Target API to read the ",(0,s.jsx)(t.code,{children:"sources"})," field of a target to know which files to run on."]}),"\n",(0,s.jsx)(t.p,{children:"The Target API can also be used to add new target types\u2014such as adding support for a new language. Additionally, the Target API can be used to extend pre-existing target types."}),"\n",(0,s.jsxs)(t.admonition,{title:"v1 plugin author upgrading to the Target API?",type:"note",children:[(0,s.jsx)(t.p,{children:"These docs are written from the perspective of writing a brand new plugin using the Target API and v2 engine, rather than the perspective of already having a v1 plugin and writing bindings for your plugin. However, these docs are still relevant."}),(0,s.jsx)(t.p,{children:"We recommend reading the docs in this order:"}),(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:['Skim this "Concepts" page. The main difference from V1 targets is that fields are the most important part of the Target API. Rather than defining your fields in the ',(0,s.jsx)(t.code,{children:"__init__()"})," of your target, you create a new class for each field."]}),"\n",(0,s.jsx)(t.li,{children:'Read "Creating new fields". The majority of your bindings will be creating fields for each custom target you have.'}),"\n",(0,s.jsxs)(t.li,{children:['Read "Creating new targets". This shows how to hook up the fields you created in the previous step and how to register your target in ',(0,s.jsx)(t.code,{children:"register.py"}),"."]}),"\n"]}),(0,s.jsxs)(t.p,{children:["While writing your binding, run ",(0,s.jsx)(t.code,{children:"./pants help my_custom_target"})," to check that everything looks right."]}),(0,s.jsxs)(t.p,{children:["See ",(0,s.jsx)(t.a,{href:"https://gist.github.com/Eric-Arellano/f83dcb8cfb891afe6af50f4b15707894",children:"here"})," for an example of writing a binding."]}),(0,s.jsxs)(t.p,{children:["Please message us on ",(0,s.jsx)(t.a,{href:"/community/members",children:"Slack"})," if you have any questions or you would like help writing bindings! We are eager to help."]})]}),"\n",(0,s.jsx)(t.h2,{id:"targets-and-fields---the-core-building-blocks",children:"Targets and Fields - the core building blocks"}),"\n",(0,s.jsxs)(t.h3,{id:"definition-of-target",children:["Definition of ",(0,s.jsx)(t.em,{children:"target"})]}),"\n",(0,s.jsxs)(t.p,{children:["As described in ",(0,s.jsx)(t.a,{href:"/2.2/docs/using-pants/concepts/targets-and-build-files",children:"Targets and BUILD files"}),", a ",(0,s.jsx)(t.em,{children:"target"})," is a set of metadata describing some of your code."]}),"\n",(0,s.jsxs)(t.p,{children:["For example, this BUILD file defines a ",(0,s.jsx)(t.code,{children:"python_tests"})," target."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="BUILD"',children:"python_tests(\n    sources=['app_test.py'],\n    compatibility='==3.7.*'\n    timeout=120,\n)\n"})}),"\n",(0,s.jsxs)(t.h3,{id:"definition-of-field",children:["Definition of ",(0,s.jsx)(t.em,{children:"field"})]}),"\n",(0,s.jsxs)(t.p,{children:["A ",(0,s.jsx)(t.em,{children:"field"})," is a single value of metadata belonging to a target."]}),"\n",(0,s.jsxs)(t.p,{children:["In the above example, ",(0,s.jsx)(t.code,{children:"sources"}),", ",(0,s.jsx)(t.code,{children:"compatibility"}),", and ",(0,s.jsx)(t.code,{children:"timeout"})," are all fields."]}),"\n",(0,s.jsx)(t.p,{children:"Each field has a Python class that defines its BUILD file alias, data type, and optional settings like default values. For example:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="example_fields.py"',children:'from pants.engine.target import IntField, StringField\n\nclass PythonInterpreterCompatibility(StringField):\n    alias = "compatibility"\n\nclass PythonTestsTimeout(IntField):\n    alias = "timeout"\n    default = 60\n\n'})}),"\n",(0,s.jsxs)(t.h3,{id:"precise-definition-of-target-a-combination-of-fields",children:["Precise definition of ",(0,s.jsx)(t.em,{children:"target"}),": a combination of fields"]}),"\n",(0,s.jsx)(t.p,{children:"Precisely, a target is a combination of fields, along with a BUILD file alias."}),"\n",(0,s.jsxs)(t.p,{children:["These fields should make sense together. For example, it does not make sense for a ",(0,s.jsx)(t.code,{children:"python_library"})," target to have a ",(0,s.jsx)(t.code,{children:"haskell_version"})," field."]}),"\n",(0,s.jsxs)(t.p,{children:["In fact, it only takes 3 lines of code to ",(0,s.jsx)(t.a,{href:"/2.2/docs/writing-plugins/the-target-api/creating-new-targets",children:"create a new target"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="plugin_target_type.py"',children:'from pants.engine.target import Dependencies, Sources, Target, Tags\n\nclass CustomTarget(Target):\n    alias = "custom_target"\n    core_fields = (Sources, Dependencies, Tags)\n'})}),"\n",(0,s.jsx)(t.p,{children:"Any unrecognized fields will cause an exception when used in a BUILD file."}),"\n",(0,s.jsx)(t.h3,{id:"fields-may-be-reused",children:"Fields may be reused"}),"\n",(0,s.jsx)(t.p,{children:"Because fields are stand-alone Python classes, the same field definition may be reused across multiple different target types."}),"\n",(0,s.jsxs)(t.p,{children:["For example, most target types have the ",(0,s.jsx)(t.code,{children:"sources"})," field."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="BUILD"',children:'resources(\n    name="files_tgt",\n    sources=["demo.txt"],\n)\n\npython_library(\n    name="python_tgt",\n    sources=["demo.py"],\n)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["This gives you reuse of code (",(0,s.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Don't_repeat_yourself",children:"DRY"}),") and is important for your plugin to work with multiple different target types, as explained below."]}),"\n",(0,s.jsx)(t.h2,{id:"a-field-driven-api",children:"A Field-Driven API"}),"\n",(0,s.jsx)(t.p,{children:"Pants plugins do not care about specific target types; they only care that the target type has the right combination of field types that the plugin needs to operate."}),"\n",(0,s.jsxs)(t.p,{children:["For example, the Python autoformatter Black does not actually care whether you have a ",(0,s.jsx)(t.code,{children:"python_library"}),", ",(0,s.jsx)(t.code,{children:"python_tests"}),", or ",(0,s.jsx)(t.code,{children:"custom_target"})," target; all that it cares about is that your target type has the field ",(0,s.jsx)(t.code,{children:"PythonSources"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Targets are only used to get access to the underlying fields through the methods ",(0,s.jsx)(t.code,{children:".has_field()"})," and ",(0,s.jsx)(t.code,{children:".get()"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'if target.has_field(PythonSources):\n    print("My plugin can work on this target.")\n\ntimeout_field = target.get(PythonTestsTimeout)\nprint(timeout_field.value)\n'})}),"\n",(0,s.jsx)(t.p,{children:"This means when creating new target types, the fields you choose for your target will determine the functionality it has."}),"\n",(0,s.jsx)(t.h2,{id:"customizing-fields-through-subclassing",children:"Customizing fields through subclassing"}),"\n",(0,s.jsxs)(t.p,{children:["Often, you may like how a field behaves, but want to make some tweaks. For example, you may want to give a default value to the ",(0,s.jsx)(t.code,{children:"Sources"})," field."]}),"\n",(0,s.jsx)(t.p,{children:"To modify a pre-existing field, simply subclass it."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'from pants.engine.target import Sources\n\nclass JsonSources(Sources):\n    default = ("*.json",)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"Target"})," methods ",(0,s.jsx)(t.code,{children:".has_field()"})," and ",(0,s.jsx)(t.code,{children:".get()"})," understand this subclass relationship, as follows:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:">>> json_target.has_field(JsonSources)\nTrue\n>>> json_target.has_field(Sources)\nTrue\n>>> python_target.has_field(JsonSources)\nFalse\n>>> python_target.has_field(Sources)\nTrue\n"})}),"\n",(0,s.jsx)(t.p,{children:"This subclass mechanism is key to how the Target API behaves:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["You can use subclasses of fields\u2014along with ",(0,s.jsx)(t.code,{children:"Target.has_field()"}),"\u2014 to filter out irrelevant targets. For example, the Black autoformatter doesn't work with any plain ",(0,s.jsx)(t.code,{children:"Sources"})," field; it needs ",(0,s.jsx)(t.code,{children:"PythonSources"}),". The Python test runner is even more specific: it needs ",(0,s.jsx)(t.code,{children:"PythonTestsSources"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["You can create custom fields and custom target types that still work with pre-existing functionality. For example, you can subclass ",(0,s.jsx)(t.code,{children:"PythonSources"})," to create ",(0,s.jsx)(t.code,{children:"DjangoSources"}),", and the Black autoformatter will still be able to operate on your target."]}),"\n"]})]})}function h(e={}){let{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},848193(e,t,i){i.d(t,{R:()=>a,x:()=>o});var n=i(830758);let s={},r=n.createContext(s);function a(e){let t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),n.createElement(r.Provider,{value:t},e.children)}},506227(e){e.exports=JSON.parse('{"id":"docs/writing-plugins/the-target-api/concepts","title":"Concepts","description":"The core concepts of Targets and Fields.","source":"@site/versioned_docs/version-2.2/docs/writing-plugins/the-target-api/concepts.mdx","sourceDirName":"docs/writing-plugins/the-target-api","slug":"/docs/writing-plugins/the-target-api/concepts","permalink":"/2.2/docs/writing-plugins/the-target-api/concepts","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/writing-plugins/the-target-api/concepts.mdx","tags":[],"version":"2.2","sidebarPosition":0,"frontMatter":{"title":"Concepts","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"The Target API","permalink":"/2.2/docs/writing-plugins/the-target-api/"},"next":{"title":"Creating new fields","permalink":"/2.2/docs/writing-plugins/the-target-api/creating-new-fields"}}')}}]);