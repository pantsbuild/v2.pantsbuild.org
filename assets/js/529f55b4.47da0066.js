"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["633372"],{898718(e,n,i){i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var l=i(990542),s=i(886070),t=i(848193);let a={title:"Deprecation policy",sidebar_position:0},o,r={},d=[{value:"Prohibited changes",id:"prohibited-changes",level:2},{value:"Allowed changes",id:"allowed-changes",level:2},{value:"Plugin API deprecation policy",id:"plugin-api-deprecation-policy",level:2},{value:"What is public?",id:"what-is-public",level:3},{value:"Prohibited API changes",id:"prohibited-api-changes",level:3},{value:"Allowed API changes",id:"allowed-api-changes",level:3}];function c(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"How we try to provide you a stable experience."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"Deprecations must live at least one stable release, meaning that if something is deprecated in 2.1.x, for example, it cannot be removed until 2.2.x."}),"\n",(0,s.jsxs)(n.p,{children:["Every deprecation message will include a description of how to respond to the change, such as renaming a value in your ",(0,s.jsx)(n.code,{children:"pants.toml"})," config file."]}),"\n",(0,s.jsx)(n.h2,{id:"prohibited-changes",children:"Prohibited changes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Removing options without a deprecation.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Deprecated options must behave the same as before."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Changing default option values without a deprecation."}),"\n",(0,s.jsx)(n.li,{children:"Removing features without a deprecation."}),"\n",(0,s.jsxs)(n.li,{children:["Substantial performance regressions (slowdown of >= 10%).","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If a new feature results in this slowdown, it should be put behind a flag that is disabled by default."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"allowed-changes",children:"Allowed changes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Adding new options."}),"\n",(0,s.jsx)(n.li,{children:"Adding new functionality."}),"\n",(0,s.jsx)(n.li,{children:"Fixing bugs."}),"\n",(0,s.jsx)(n.li,{children:"Changes that are required by law."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"plugin-api-deprecation-policy",children:"Plugin API deprecation policy"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.a,{href:"/2.3/docs/writing-plugins/overview",children:"writing plugins"}),", Pants is used as a ",(0,s.jsx)(n.em,{children:"library"}),", rather than a ",(0,s.jsx)(n.em,{children:"binary"}),". That is, you import Pants code to write plugins. We try to make this API stable for your plugins."]}),"\n",(0,s.jsx)(n.h3,{id:"what-is-public",children:"What is public?"}),"\n",(0,s.jsx)(n.p,{children:"A module, variable, method, function, or class is part of the public API if at least one of the following is true:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Its definition's docstring is marked with ",(0,s.jsx)(n.code,{children:":API: public"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Its enclosing scope is marked with ",(0,s.jsx)(n.code,{children:":API: public"})," and the name does not start with an underscore."]}),"\n",(0,s.jsxs)(n.li,{children:["It is abstract and any inheriting class published by Pants is marked ",(0,s.jsx)(n.code,{children:":API: public"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"All other code defaults to being a private API and does not need to follow this deprecation policy."}),"\n",(0,s.jsx)(n.p,{children:"Examples:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:'title="deprecation_example.py"',children:'"""An example public module.\n\nThis means that everything in this module is public, except for\nvalues prefixed with `_`.\n\n:API: public\n"""\n\ndef demo_function(x: int) -> None:\n    """An example public top-level function.\n\n    :API: public\n    """\n    print(x)\n\n\nclass Demo:\n    """An example public class.\n\n    All methods and class properties are public, except for values\n    prefixed with `_`.\n\n    :API: public\n    """\n\n    def demo_method(self, x: int) -> None:\n        """An example public method.\n\n        :API: public\n        """\n        print(x)\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"prohibited-api-changes",children:"Prohibited API changes"}),"\n",(0,s.jsx)(n.p,{children:"These changes all require a deprecation."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Removing a public API."}),"\n",(0,s.jsx)(n.li,{children:"Moving a public API to a new module."}),"\n",(0,s.jsx)(n.li,{children:"Removing the parameters of a public function."}),"\n",(0,s.jsx)(n.li,{children:"Changing the default values of a public function."}),"\n",(0,s.jsxs)(n.li,{children:["Changing a public function to require keyword arguments through the ",(0,s.jsx)(n.code,{children:"*"})," operator."]}),"\n",(0,s.jsxs)(n.li,{children:["Moving the order of the parameters of a public function.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["This is only allowed if we are already enforcing keyword arguments with the ",(0,s.jsx)(n.code,{children:"*"})," operator."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Changing the behavior of a public API.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Instead, the API would need a new parameter that toggles the change in behavior."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"allowed-api-changes",children:"Allowed API changes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Adding a new module."}),"\n",(0,s.jsx)(n.li,{children:"Adding new functionality to a module, e.g. new classes or functions."}),"\n",(0,s.jsxs)(n.li,{children:["Adding new parameters to a function ",(0,s.jsx)(n.em,{children:"if and only if"})," they have a default value."]}),"\n",(0,s.jsx)(n.li,{children:"Adding type hints."}),"\n",(0,s.jsx)(n.li,{children:"Fixing bugs."}),"\n",(0,s.jsx)(n.li,{children:"Upgrading Pants to use new versions of third-party libraries."}),"\n",(0,s.jsx)(n.li,{children:"Changes that are required by law."}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{title:"The Rules and Target APIs are still experimental",type:"caution",children:[(0,s.jsx)(n.p,{children:"These two APIs do not yet follow this deprecation policy because we are actively shaping the API."}),(0,s.jsx)(n.p,{children:"We do try, however, to limit changes and may choose to respect the deprecation policy on a case-by-case basis."})]})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},848193(e,n,i){i.d(n,{R:()=>a,x:()=>o});var l=i(830758);let s={},t=l.createContext(s);function a(e){let n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),l.createElement(t.Provider,{value:n},e.children)}},990542(e){e.exports=JSON.parse('{"id":"docs/release-notes/deprecation-policy","title":"Deprecation policy","description":"How we try to provide you a stable experience.","source":"@site/versioned_docs/version-2.3/docs/release-notes/deprecation-policy.mdx","sourceDirName":"docs/release-notes","slug":"/docs/release-notes/deprecation-policy","permalink":"/2.3/docs/release-notes/deprecation-policy","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/release-notes/deprecation-policy.mdx","tags":[],"version":"2.3","sidebarPosition":0,"frontMatter":{"title":"Deprecation policy","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Plugin upgrade guide","permalink":"/2.3/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide"},"next":{"title":"Upgrade tips","permalink":"/2.3/docs/release-notes/upgrade-tips"}}')}}]);