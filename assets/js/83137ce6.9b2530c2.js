"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["841980"],{103897(e,r,s){s.r(r),s.d(r,{assets:()=>a,contentTitle:()=>n,default:()=>_,frontMatter:()=>c,metadata:()=>i,toc:()=>h});var i=s(477365),d=s(886070),o=s(848193),t=s(554707),l=s(375002);let c={title:"docker",description:"Options for interacting with Docker.\n"},n,a={},h=[{value:"Basic options",id:"basic-options",level:2},{value:"<code>build_args</code>",id:"build_args",level:3},{value:"<code>build_hosts</code>",id:"build_hosts",level:3},{value:"<code>build_no_cache</code>",id:"build_no_cache",level:3},{value:"<code>build_target_stage</code>",id:"build_target_stage",level:3},{value:"<code>build_verbose</code>",id:"build_verbose",level:3},{value:"<code>default_context_root</code>",id:"default_context_root",level:3},{value:"<code>default_repository</code>",id:"default_repository",level:3},{value:"<code>registries</code>",id:"registries",level:3},{value:"<code>run_args</code>",id:"run_args",level:3},{value:"<code>use_buildx</code>",id:"use_buildx",level:3},{value:"Advanced options",id:"advanced-options",level:2},{value:"<code>env_vars</code>",id:"env_vars",level:3},{value:"<code>executable_search_paths</code>",id:"executable_search_paths",level:3},{value:"<code>tailor</code>",id:"tailor",level:3},{value:"<code>tools</code>",id:"tools",level:3},{value:"Deprecated options",id:"deprecated-options",level:2},{value:"Related subsystems",id:"related-subsystems",level:2}];function p(e){let r={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.hr,{}),"\n",(0,d.jsx)(r.p,{children:"Options for interacting with Docker."}),"\n",(0,d.jsxs)(r.p,{children:["Backend: ",(0,d.jsx)("span",{className:"color--primary",children:(0,d.jsx)(r.code,{children:"pants.backend.docker"})})]}),"\n",(0,d.jsxs)(r.p,{children:["Config section: ",(0,d.jsx)("span",{className:"color--primary",children:(0,d.jsx)(r.code,{children:"[docker]"})})]}),"\n",(0,d.jsxs)("span",{className:l.A.options,children:[(0,d.jsx)(r.h2,{id:"basic-options",children:"Basic options"}),(0,d.jsx)(r.h3,{id:"build_args",children:(0,d.jsx)(r.code,{children:"build_args"})}),(0,d.jsxs)(t.A,{cli_repr:'--docker-build-args="[<shell_str>, <shell_str>, ...]"',env_repr:"PANTS_DOCKER_BUILD_ARGS",toml_repr:`[docker]
build_args = [
  <shell_str>,
  <shell_str>,
  ...,
]`,default_repr:"[]",children:[(0,d.jsxs)(r.p,{children:["Global build arguments (for Docker ",(0,d.jsx)(r.code,{children:"--build-arg"})," options) to use for all ",(0,d.jsx)(r.code,{children:"docker build"})," invocations."]}),(0,d.jsxs)(r.p,{children:["Entries are either strings in the form ",(0,d.jsx)(r.code,{children:"ARG_NAME=value"})," to set an explicit value; or just ",(0,d.jsx)(r.code,{children:"ARG_NAME"})," to copy the value from Pants's own environment."]}),(0,d.jsx)(r.p,{children:"Example:"}),(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:'[docker]\nbuild_args = ["VAR1=value", "VAR2"]\n'})}),(0,d.jsxs)(r.p,{children:["Use the ",(0,d.jsx)(r.code,{children:"extra_build_args"})," field on a ",(0,d.jsx)(r.code,{children:"docker_image"})," target for additional image specific build arguments."]})]}),(0,d.jsx)(r.h3,{id:"build_hosts",children:(0,d.jsx)(r.code,{children:"build_hosts"})}),(0,d.jsxs)(t.A,{cli_repr:"--docker-build-hosts=\"{'key1': val1, 'key2': val2, ...}\"",env_repr:"PANTS_DOCKER_BUILD_HOSTS",toml_repr:`[docker.build_hosts]
key1 = val1
key2 = val2
...`,default_repr:"{}",children:[(0,d.jsxs)(r.p,{children:["Hosts entries to be added to the ",(0,d.jsx)(r.code,{children:"/etc/hosts"})," file in all built images."]}),(0,d.jsx)(r.p,{children:"Example:"}),(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:'[docker]\nbuild_hosts = {"docker": "10.180.0.1", "docker2": "10.180.0.2"}\n'})}),(0,d.jsxs)(r.p,{children:["Use the ",(0,d.jsx)(r.code,{children:"extra_build_hosts"})," field on a ",(0,d.jsx)(r.code,{children:"docker_image"})," target for additional image specific host entries."]})]}),(0,d.jsx)(r.h3,{id:"build_no_cache",children:(0,d.jsx)(r.code,{children:"build_no_cache"})}),(0,d.jsx)(t.A,{cli_repr:"--[no-]docker-build-no-cache",env_repr:"PANTS_DOCKER_BUILD_NO_CACHE",toml_repr:`[docker]
build_no_cache = <bool>`,default_repr:"False",children:(0,d.jsx)(r.p,{children:"Do not use the Docker cache when building images."})}),(0,d.jsx)(r.h3,{id:"build_target_stage",children:(0,d.jsx)(r.code,{children:"build_target_stage"})}),(0,d.jsxs)(t.A,{cli_repr:"--docker-build-target-stage=<str>",env_repr:"PANTS_DOCKER_BUILD_TARGET_STAGE",toml_repr:`[docker]
build_target_stage = <str>`,default_repr:"None",children:[(0,d.jsxs)(r.p,{children:["Global default value for ",(0,d.jsx)(r.code,{children:"target_stage"})," on ",(0,d.jsx)(r.code,{children:"docker_image"})," targets, overriding the field value on the targets, if there is a matching stage in the ",(0,d.jsx)(r.code,{children:"Dockerfile"}),"."]}),(0,d.jsx)(r.p,{children:"This is useful to provide from the command line, to specify the target stage to build for at execution time."})]}),(0,d.jsx)(r.h3,{id:"build_verbose",children:(0,d.jsx)(r.code,{children:"build_verbose"})}),(0,d.jsx)(t.A,{cli_repr:"--[no-]docker-build-verbose",env_repr:"PANTS_DOCKER_BUILD_VERBOSE",toml_repr:`[docker]
build_verbose = <bool>`,default_repr:"False",children:(0,d.jsx)(r.p,{children:"Whether to log the Docker output to the console. If false, only the image ID is logged."})}),(0,d.jsx)(r.h3,{id:"default_context_root",children:(0,d.jsx)(r.code,{children:"default_context_root"})}),(0,d.jsxs)(t.A,{cli_repr:"--docker-default-context-root=<workspace_path>",env_repr:"PANTS_DOCKER_DEFAULT_CONTEXT_ROOT",toml_repr:`[docker]
default_context_root = <workspace_path>`,default_repr:"",children:[(0,d.jsxs)(r.p,{children:["Provide a default Docker build context root path for ",(0,d.jsx)(r.code,{children:"docker_image"})," targets that does not specify their own ",(0,d.jsx)(r.code,{children:"context_root"})," field."]}),(0,d.jsxs)(r.p,{children:["The context root is relative to the build root by default, but may be prefixed with ",(0,d.jsx)(r.code,{children:"./"})," to be relative to the directory of the BUILD file of the ",(0,d.jsx)(r.code,{children:"docker_image"}),"."]}),(0,d.jsx)(r.p,{children:"Examples:"}),(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:"--default-context-root=src/docker\n--default-context-root=./relative_to_the_build_file\n"})})]}),(0,d.jsx)(r.h3,{id:"default_repository",children:(0,d.jsx)(r.code,{children:"default_repository"})}),(0,d.jsxs)(t.A,{cli_repr:"--docker-default-repository=<str>",env_repr:"PANTS_DOCKER_DEFAULT_REPOSITORY",toml_repr:`[docker]
default_repository = <str>`,default_repr:"{name}",children:[(0,d.jsx)(r.p,{children:"Configure the default repository name used in the Docker image tag."}),(0,d.jsx)(r.p,{children:"The value is formatted and may reference these variables (in addition to the normal placeheolders derived from the Dockerfile and build args etc):"}),(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsx)(r.li,{children:"name"}),"\n",(0,d.jsx)(r.li,{children:"directory"}),"\n",(0,d.jsx)(r.li,{children:"parent_directory"}),"\n",(0,d.jsx)(r.li,{children:"target_repository"}),"\n"]}),(0,d.jsxs)(r.p,{children:["Example: ",(0,d.jsx)(r.code,{children:'--default-repository="{directory}/{name}"'}),"."]}),(0,d.jsxs)(r.p,{children:["The ",(0,d.jsx)(r.code,{children:"name"})," variable is the ",(0,d.jsx)(r.code,{children:"docker_image"}),"'s target name, ",(0,d.jsx)(r.code,{children:"directory"})," and ",(0,d.jsx)(r.code,{children:"parent_directory"})," are the name of the directory in which the BUILD file is for the target, and its parent directory respectively."]}),(0,d.jsxs)(r.p,{children:["Use the ",(0,d.jsx)(r.code,{children:"repository"})," field to set this value directly on a ",(0,d.jsx)(r.code,{children:"docker_image"})," target."]}),(0,d.jsx)(r.p,{children:"Registries may override the repository value for a specific registry."}),(0,d.jsx)(r.p,{children:"Any registries or tags are added to the image name as required, and should not be part of the repository name."})]}),(0,d.jsx)(r.h3,{id:"registries",children:(0,d.jsx)(r.code,{children:"registries"})}),(0,d.jsxs)(t.A,{cli_repr:"--docker-registries=\"{'key1': val1, 'key2': val2, ...}\"",env_repr:"PANTS_DOCKER_REGISTRIES",toml_repr:`[docker.registries]
key1 = val1
key2 = val2
...`,default_repr:"{}",children:[(0,d.jsx)(r.p,{children:"Configure Docker registries. The schema for a registry entry is as follows:"}),(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:'{\n    "registry-alias": {\n        "address": "registry-domain:port",\n        "default": bool,\n        "extra_image_tags": [],\n        "skip_push": bool,\n        "repository": str,\n        "use_local_alias": bool,\n    },\n    ...\n}\n'})}),(0,d.jsxs)(r.p,{children:["If no registries are provided in a ",(0,d.jsx)(r.code,{children:"docker_image"})," target, then all default addresses will be used, if any."]}),(0,d.jsxs)(r.p,{children:["The ",(0,d.jsx)(r.code,{children:"docker_image.registries"})," may be provided with a list of registry addresses and registry aliases prefixed with ",(0,d.jsx)(r.code,{children:"@"})," to be used instead of the defaults."]}),(0,d.jsxs)(r.p,{children:["A configured registry is marked as default either by setting ",(0,d.jsx)(r.code,{children:"default = true"})," or with an alias of ",(0,d.jsx)(r.code,{children:'"default"'}),"."]}),(0,d.jsxs)(r.p,{children:["A ",(0,d.jsx)(r.code,{children:"docker_image"})," may be pushed to a subset of registries using the per registry ",(0,d.jsx)(r.code,{children:"skip_push"})," option rather then the all or nothing toggle of the field option ",(0,d.jsx)(r.code,{children:"skip_push"})," on the ",(0,d.jsx)(r.code,{children:"docker_image"})," target."]}),(0,d.jsxs)(r.p,{children:["Any image tags that should only be added for specific registries may be provided as the ",(0,d.jsx)(r.code,{children:"extra_image_tags"})," option. The tags may use value formatting the same as for the ",(0,d.jsx)(r.code,{children:"image_tags"})," field of the ",(0,d.jsx)(r.code,{children:"docker_image"})," target."]}),(0,d.jsxs)(r.p,{children:["When a registry provides a ",(0,d.jsx)(r.code,{children:"repository"})," value, it will be used instead of the ",(0,d.jsx)(r.code,{children:"docker_image.repository"})," or the default repository. Using the placeholders ",(0,d.jsx)(r.code,{children:"{target_repository}"})," or ",(0,d.jsx)(r.code,{children:"{default_repository}"})," those overridden values may be incorporated into the registry specific repository value."]}),(0,d.jsxs)(r.p,{children:["If ",(0,d.jsx)(r.code,{children:"use_local_alias"})," is true, a built image is additionally tagged locally using the registry alias as the value for repository (i.e. the additional image tag is not pushed) and will be used for any ",(0,d.jsx)(r.code,{children:"pants run"})," requests."]})]}),(0,d.jsx)(r.h3,{id:"run_args",children:(0,d.jsx)(r.code,{children:"run_args"})}),(0,d.jsxs)(t.A,{cli_repr:'--docker-run-args="[<shell_str>, <shell_str>, ...]"',env_repr:"PANTS_DOCKER_RUN_ARGS",toml_repr:`[docker]
run_args = [
  <shell_str>,
  <shell_str>,
  ...,
]`,default_repr:"[]",children:[(0,d.jsxs)(r.p,{children:["Additional arguments to use for ",(0,d.jsx)(r.code,{children:"docker run"})," invocations."]}),(0,d.jsx)(r.p,{children:"Example:"}),(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:'$ pants run --docker-run-args="-p 127.0.0.1:80:8080/tcp --name demo" src/example:image -- [image entrypoint args]\n'})}),(0,d.jsxs)(r.p,{children:["To provide the top-level options to the ",(0,d.jsx)(r.code,{children:"docker"})," client, use ",(0,d.jsx)(r.code,{children:"[docker].env_vars"})," to configure the ",(0,d.jsx)(r.a,{href:"https://docs.docker.com/engine/reference/commandline/cli/#environment-variables",children:"Environment variables"})," as appropriate."]}),(0,d.jsxs)(r.p,{children:["The arguments for the image entrypoint may be passed on the command line after a double dash (",(0,d.jsx)(r.code,{children:"--"}),"), or using the ",(0,d.jsx)(r.code,{children:"--run-args"})," option."]}),(0,d.jsxs)(r.p,{children:["Defaults to ",(0,d.jsx)(r.code,{children:"--interactive --tty"})," when stdout is connected to a terminal."]})]}),(0,d.jsx)(r.h3,{id:"use_buildx",children:(0,d.jsx)(r.code,{children:"use_buildx"})}),(0,d.jsx)(t.A,{cli_repr:"--[no-]docker-use-buildx",env_repr:"PANTS_DOCKER_USE_BUILDX",toml_repr:`[docker]
use_buildx = <bool>`,default_repr:"False",children:(0,d.jsxs)(r.p,{children:["Use ",(0,d.jsx)(r.a,{href:"https://github.com/docker/buildx#buildx",children:"buildx"})," (and BuildKit) for builds."]})}),(0,d.jsx)(r.h2,{id:"advanced-options",children:"Advanced options"}),(0,d.jsx)(r.h3,{id:"env_vars",children:(0,d.jsx)(r.code,{children:"env_vars"})}),(0,d.jsxs)(t.A,{cli_repr:'--docker-env-vars="[<shell_str>, <shell_str>, ...]"',env_repr:"PANTS_DOCKER_ENV_VARS",toml_repr:`[docker]
env_vars = [
  <shell_str>,
  <shell_str>,
  ...,
]`,default_repr:"[]",target_field_name:"docker_env_vars",children:[(0,d.jsxs)(r.p,{children:["Environment variables to set for ",(0,d.jsx)(r.code,{children:"docker"})," invocations."]}),(0,d.jsxs)(r.p,{children:["Entries are either strings in the form ",(0,d.jsx)(r.code,{children:"ENV_VAR=value"})," to set an explicit value; or just ",(0,d.jsx)(r.code,{children:"ENV_VAR"})," to copy the value from Pants's own environment."]})]}),(0,d.jsx)(r.h3,{id:"executable_search_paths",children:(0,d.jsx)(r.code,{children:"executable_search_paths"})}),(0,d.jsx)(t.A,{cli_repr:'--docker-executable-search-paths="[<binary-paths>, <binary-paths>, ...]"',env_repr:"PANTS_DOCKER_EXECUTABLE_SEARCH_PATHS",toml_repr:`[docker]
executable_search_paths = [
  <binary-paths>,
  <binary-paths>,
  ...,
]`,default_repr:`[
  "<PATH>"
]`,target_field_name:"docker_executable_search_paths",children:(0,d.jsxs)(r.p,{children:["The PATH value that will be used to find the Docker client and any tools required. The special string ",(0,d.jsx)(r.code,{children:'"<PATH>"'})," will expand to the contents of the PATH env var."]})}),(0,d.jsx)(r.h3,{id:"tailor",children:(0,d.jsx)(r.code,{children:"tailor"})}),(0,d.jsx)(t.A,{cli_repr:"--[no-]docker-tailor",env_repr:"PANTS_DOCKER_TAILOR",toml_repr:`[docker]
tailor = <bool>`,default_repr:"True",children:(0,d.jsxs)(r.p,{children:["If true, add ",(0,d.jsx)(r.code,{children:"docker_image"})," targets with the ",(0,d.jsx)(r.code,{children:"tailor"})," goal."]})}),(0,d.jsx)(r.h3,{id:"tools",children:(0,d.jsx)(r.code,{children:"tools"})}),(0,d.jsx)(t.A,{cli_repr:"--docker-tools=\"['<str>', '<str>', ...]\"",env_repr:"PANTS_DOCKER_TOOLS",toml_repr:`[docker]
tools = [
  '<str>',
  '<str>',
  ...,
]`,default_repr:"[]",children:(0,d.jsx)(r.p,{children:"List any additional executable tools required for Docker to work. The paths to these tools will be included in the PATH used in the execution sandbox, so that they may be used by the Docker client."})}),(0,d.jsx)(r.h2,{id:"deprecated-options",children:"Deprecated options"}),(0,d.jsx)(r.p,{children:"None"}),(0,d.jsx)(r.h2,{id:"related-subsystems",children:"Related subsystems"}),(0,d.jsx)(r.p,{children:"None"})]})]})}function _(e={}){let{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,d.jsx)(r,{...e,children:(0,d.jsx)(p,{...e})}):p(e)}},375002(e,r,s){s.d(r,{A:()=>i});let i={options:"options_nrbo"}},554707(e,r,s){s.d(r,{A:()=>t});var i=s(886070),d=s(384122),o=s(580830);function t({children:e,cli_repr:r,env_repr:s,toml_repr:t,one_of:l,default_repr:c,target_field_name:n,removal_version:a,removal_hint:h}){return(0,i.jsxs)("div",{className:"margin-bottom--lg",children:[(0,i.jsx)("code",{style:{color:"var(--pants-reference-option-repr)"},children:r}),(0,i.jsx)("br",{}),(0,i.jsx)("code",{style:{color:"var(--pants-reference-option-repr)"},children:s}),(0,i.jsx)("br",{}),(0,i.jsx)(d.A,{language:"toml",title:"pants.toml",children:t}),(0,i.jsxs)("div",{style:{paddingLeft:"2em"},children:[(0,i.jsxs)("span",{children:[l&&(0,i.jsxs)("span",{children:["one of:"," ",(0,i.jsx)("code",{style:{color:"var(--ifm-color-success)"},children:l}),(0,i.jsx)("br",{})]}),"default:"," ",(0,i.jsx)("span",{style:{color:"var(--ifm-color-success)"},children:(c||"").includes("\n")?(0,i.jsx)("pre",{className:"padding--sm",children:c}):(0,i.jsx)("code",{children:c})})]}),(0,i.jsx)("br",{}),a&&(0,i.jsxs)("span",{style:{color:"var(--ifm-color-danger-darkest)"},children:["Deprecated, will be removed in version: ",a,".",(0,i.jsx)("br",{}),h,(0,i.jsx)("br",{})]}),e,n&&(0,i.jsxs)("span",{children:["Can be overriden by field",(0,i.jsx)("code",{children:n})," on"," ",(0,i.jsx)(o.A,{to:"../targets/local_environment",children:(0,i.jsx)("code",{children:"local_environment"})}),","," ",(0,i.jsx)(o.A,{to:"../targets/docker_environment",children:(0,i.jsx)("code",{children:"docker_environment"})}),", or"," ",(0,i.jsx)(o.A,{to:"../targets/remote_environment",children:(0,i.jsx)("code",{children:"remote_environment"})}),"targets."]})]})]})}},477365(e){e.exports=JSON.parse('{"id":"reference/subsystems/docker","title":"docker","description":"Options for interacting with Docker.\\n","source":"@site/versioned_docs/version-2.19/reference/subsystems/docker.mdx","sourceDirName":"reference/subsystems","slug":"/reference/subsystems/docker","permalink":"/2.19/reference/subsystems/docker","draft":false,"unlisted":false,"tags":[],"version":"2.19","frontMatter":{"title":"docker","description":"Options for interacting with Docker.\\n"},"sidebar":"referenceSidebar","previous":{"title":"docformatter","permalink":"/2.19/reference/subsystems/docformatter"},"next":{"title":"dockerfile-parser","permalink":"/2.19/reference/subsystems/dockerfile-parser"}}')}}]);