"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["759784"],{706314(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var s=t(560005),i=t(886070),o=t(848193);let r={title:"Generating version tags from Git",sidebar_position:10},a,c={},d=[{value:"Enabling the Python backend",id:"enabling-the-python-backend",level:2},{value:"The <code>vcs_version</code> target",id:"the-vcs_version-target",level:2},{value:"Using the generated version",id:"using-the-generated-version",level:2},{value:"The generated version string",id:"the-generated-version-string",level:2}];function l(e){let n={a:"a",code:"code",h2:"h2",hr:"hr",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:"Pants can generate a version string based on Git state that you can use during builds."}),"\n",(0,i.jsx)(n.h2,{id:"enabling-the-python-backend",children:"Enabling the Python backend"}),"\n",(0,i.jsxs)(n.p,{children:["The implementation of this feature relies on a third-party ",(0,i.jsx)(n.a,{href:"https://github.com/pypa/setuptools_scm",children:"Python library"}),',\nso to use it you will need to activate the Python backend and its "experimental" extension, even if\nyou\'re not otherwise using Python in your repo:']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'backend_packages.add = [\n  ...\n  "pants.backend.python",\n  "pants.backend.experimental.python",\n  ...\n]\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"the-vcs_version-target",children:["The ",(0,i.jsx)(n.code,{children:"vcs_version"})," target"]}),"\n",(0,i.jsxs)(n.p,{children:["To utilize this functionality, you first create a ",(0,i.jsx)(n.code,{children:"vcs_version"})," target in some BUILD file, e.g.,:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="src/foo/BUILD"',children:'vcs_version(\n    name="version",\n    generate_to="src/foo/version.py",\n    template=\'version = "{version}"\',\n)\n'})}),"\n",(0,i.jsxs)(n.p,{children:["When you test, run or package any code that depends (directly or indirectly) on this target,\nPants will compute a version string based on the current Git state, and then generate content\nusing the specified ",(0,i.jsx)(n.code,{children:"template"})," (with ",(0,i.jsx)(n.code,{children:"{version}"})," serving as a placeholder for the version string)\nat the path specified by ",(0,i.jsx)(n.code,{children:"generate_to"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"This content will be available at test and run time, and be packaged along with your\ncode and its dependencies. Your code can use the generated content (e.g., by importing\nit or reading it) and thus have access to a dynamically-generated version."}),"\n",(0,i.jsxs)(n.p,{children:["Note that, similarly to how Pants handles other code generation tools (such as ",(0,i.jsx)(n.a,{href:"/2.29/docs/python/integrations/protobuf-and-grpc",children:"Protobuf"}),"),\nthis content is not written out as a file into your source tree. Instead, the content is materialized\non the fly, as needed. If you want to inspect the generated contents manually, you can use the\n",(0,i.jsx)(n.code,{children:"export-codegen"})," goal:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pants export-codegen src/foo:version\n"})}),"\n",(0,i.jsx)(n.h2,{id:"using-the-generated-version",children:"Using the generated version"}),"\n",(0,i.jsxs)(n.p,{children:["Code that depends on the ",(0,i.jsx)(n.code,{children:"vcs_version"})," target can import and use the generated file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="src/util.py"',children:"from version import version\n...\n"})}),"\n",(0,i.jsx)(n.p,{children:"In this example we generated a Python source file, but you can generate code in any language,\nor even generate a text file for some code to load at runtime."}),"\n",(0,i.jsxs)(n.p,{children:["In fact, in the Python case you don't even need an explicit dependency on the ",(0,i.jsx)(n.code,{children:"vcs_version"})," target, as\none will be inferred from the import. This does not work (yet) for other languages, so those will\nrequire an explicit dependency."]}),"\n",(0,i.jsx)(n.h2,{id:"the-generated-version-string",children:"The generated version string"}),"\n",(0,i.jsxs)(n.p,{children:["Pants delegates the version string computation to ",(0,i.jsx)(n.a,{href:"https://github.com/pypa/setuptools_scm",children:"setuptools_scm"}),".\nSee ",(0,i.jsx)(n.a,{href:"https://setuptools-scm.readthedocs.io/en/latest/usage/#default-versioning-scheme",children:"here"})," for how it computes the version string from the Git state."]}),"\n",(0,i.jsxs)(n.p,{children:["We don't yet support any of the configuration options that control how the string is computed. Please\n",(0,i.jsx)(n.a,{href:"/community/getting-help",children:"let us know"})," if you need such advanced functionality."]})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},848193(e,n,t){t.d(n,{R:()=>r,x:()=>a});var s=t(830758);let i={},o=s.createContext(i);function r(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}},560005(e){e.exports=JSON.parse('{"id":"docs/using-pants/generating-version-tags-from-git","title":"Generating version tags from Git","description":"---","source":"@site/versioned_docs/version-2.29/docs/using-pants/generating-version-tags-from-git.mdx","sourceDirName":"docs/using-pants","slug":"/docs/using-pants/generating-version-tags-from-git","permalink":"/2.29/docs/using-pants/generating-version-tags-from-git","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/using-pants/generating-version-tags-from-git.mdx","tags":[],"version":"2.29","sidebarPosition":10,"frontMatter":{"title":"Generating version tags from Git","sidebar_position":10},"sidebar":"docsSidebar","previous":{"title":"Remote execution","permalink":"/2.29/docs/using-pants/remote-caching-and-execution/remote-execution"},"next":{"title":"Anonymous telemetry","permalink":"/2.29/docs/using-pants/anonymous-telemetry"}}')}}]);