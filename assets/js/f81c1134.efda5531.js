"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["936607"],{677735(e){e.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"/2025/12/11/lockfile-metadata-files","metadata":{"permalink":"/blog/2025/12/11/lockfile-metadata-files","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2025-12-11-lockfile-metadata-files/index.mdx","source":"@site/blog/2025-12-11-lockfile-metadata-files/index.mdx","title":"Writing Python lockfile metadata to separate files","description":"Image generated by ChatGPT","date":"2025-12-11T00:00:00.000Z","tags":[{"inline":true,"label":"development","permalink":"/blog/tags/development"},{"inline":true,"label":"community","permalink":"/blog/tags/community"},{"inline":true,"label":"macos","permalink":"/blog/tags/macos"}],"readingTime":2.36,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["development","community","macos"],"date":"2025-12-11T00:00:00.000Z"},"unlisted":false,"nextItem":{"title":"Pants 2.30.0 is released!","permalink":"/blog/2025/12/10/pants-2-30"}},"content":"<CaptionedImg src={require(\\"./splash.png\\").default}>\\n  Image generated by [ChatGPT](https://chatgpt.com/)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nThe Pants Python backend uses [lockfiles](https://www.pantsbuild.org/2.30/docs/python/overview/lockfiles) extensively to support repeatable, secure builds.\\n\\nThese lockfiles are in a proprietary JSON format defined by the underlying [Pex tool](https://docs.pex-tool.org/). However, Pants associates some extra metadata with each such Pex-created lockfile.\\n\\nUntil recently, this metadata was tacked on to the lockfile as front matter. Pants would remove this metadata before passing the lockfile on to Pex. This was convenient in some ways, but had the very unfortunate effect of making those lockfiles invalid JSON, and unreadable by Pex when used outside of Pants. This was a regrettable design choice which we are now remedying.\\n\\nStarting in the just-released [Pants 2.30.0](/blog/2025/12/10/pants-2-30), this lockfile metadata can be written to a separate file. Specifically, if enabled, the metadata for `path/to/lockfile.json` will be stored in a sibling file `path/to/lockfile.json.metadata`.\\n\\n## What does this mean for me?\\n\\nWe recommend enabling this feature after you upgrade to Pants 2.30.0 or higher. To do so set the following option in your pants.toml:\\n\\n```\\n[python]\\nseparate_lockfile_metadata_file = true\\n```\\n\\nThis will become the default in Pants 2.31.0, and eventually the prepended header will be phased out entirely.\\n\\nNote that even with this option enabled, Pants will _read_ the prepended header if it finds one. This option only controls where Pants places this metadata when you generate a _new_ lockfile.\\n\\nNonetheless, you may want to get ready for the future (and enjoy the benefits of unbroken JSON) by converting your existing lockfiles now. You can do so by regenerating them, but of course that might pick up dependency changes you don\'t want to deal with at the moment.\\n\\nYour other option is to run the following script on your existing lockfiles. Simply copy this into a file, say `convert_lockfiles.py`:\\n\\n```\\nimport sys\\n\\nfor path in sys.argv[1:]:\\n    with open(path, \\"r\\") as fp:\\n        lines = fp.read().splitlines(keepends=False)\\n        metadata_lines = []\\n        in_metadata_block = False\\n        delim = lines[0].split()[0] + \\" \\"\\n        lines_iter = iter(lines)\\n        while True:\\n            line = next(lines_iter)\\n            if line == f\\"{delim}This lockfile was autogenerated by Pants. To regenerate, run:\\":\\n                next(lines_iter)\\n                cmd = next(lines_iter)[len(delim):].strip()\\n            if line == f\\"{delim}--- END PANTS LOCKFILE METADATA ---\\":\\n                remaining_lines = list(lines_iter)\\n                break\\n            elif in_metadata_block:\\n                metadata_lines.append(line[len(delim):])\\n            elif line == f\\"{delim}--- BEGIN PANTS LOCKFILE METADATA: DO NOT EDIT OR REMOVE ---\\":\\n                in_metadata_block = True\\n        metadata_lines.insert(1, f\'\\"description\\": \\"This lockfile was generated by Pants. To regenerate, run: {cmd}\\",\')\\n        metadata = \\"\\\\n\\".join(metadata_lines) + \\"\\\\n\\"\\n        with open(f\\"{path}.metadata\\", \\"w\\") as fp:\\n            fp.write(metadata)\\n        with open(path, \\"w\\") as fp:\\n+            fp.write(\\"\\\\n\\".join(remaining_lines).strip() + \\"\\\\n\\")\\n```\\n\\nthen run `python convert_lockfiles.py path/to/lockfile1 path/to/lockfile2 ...`\\n\\nand voila, your lockfiles will be nicely split up without incurring any other perturbations!"},{"id":"/2025/12/10/pants-2-30","metadata":{"permalink":"/blog/2025/12/10/pants-2-30","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2025-12-10-pants-2-30/index.mdx","source":"@site/blog/2025-12-10-pants-2-30/index.mdx","title":"Pants 2.30.0 is released!","description":"Photo by marcos mayer on","date":"2025-12-10T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":2.51,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["announcement"],"date":"2025-12-10T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Writing Python lockfile metadata to separate files","permalink":"/blog/2025/12/11/lockfile-metadata-files"},"nextItem":{"title":"When to Wind Down MacOS Intel Support","permalink":"/blog/2025/10/06/winding-down-macos-intel-support"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [marcos mayer](https://unsplash.com/@mmayyer) on\\n  [Unsplash](https://unsplash.com/photos/shallow-focus-photography-of-padlocks-in-steel-cable-8_NI1WTqCGY)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe are pleased to announce Pants [2.30.0](https://github.com/pantsbuild/pants/blob/2.30.x/docs/notes/2.30.x.md), the latest release of [Pantsbuild](https://www.pantsbuild.org/), the scalable and ergonomic build system. To update, set `pants_version = \\"2.30.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](/2.30/docs/getting-started).\\n\\nImportant note: Pants 2.30 is scheduled to be the last version to provide binaries for the [MacOS Intel platform](/blog/2025/10/06/winding-down-macos-intel-support). This flows from the [reduced support](https://github.com/actions/runner-images/issues/13046) from GitHub and continued movement in the macOS ecosystem. If you are interested in maintaining or supporting `x86_64` macOS binaries, please [reach out](https://github.com/pantsbuild/pants/discussions/22711).\\n\\n_Highlights in [2.30](https://github.com/pantsbuild/pants/blob/2.30.x/docs/notes/2.30.x.md) include_:\\n\\n- \u{1F512} **Python lockfile metadata can now be stored in a sibling file to the lockfile** - instead of as a prepended header in the lockfile itself.\\n- \u{1F4DB} **The plugin API\'s `Get()` construct has been deprecated in favor of call-by-name**. See [here](/2.30/docs/writing-plugins/the-rules-api/migrating-gets) for how to update your plugins.\\n- \u{1F41E} And a whole bunch of updates, bugfixes, and general improvements!\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/blob/2.30.x/docs/notes/2.30.x.md) for the accumulation of all those little improvements, and look forward to guidance for plugins to switch to call-by-name in 2.30.\\n\\nPants is an open-source project, and the changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a [contributor](/stable/docs/contributions).\\n\\nWe also offer [formal sponsorship tiers for companies](/sponsorship), as well as individual sponsorships via [GitHub](/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nSome Pants maintainers also offer [paid consulting](/spotlight/service-providers) for adopting and customizing Pants for your company\'s needs.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-django](https://github.com/pantsbuild/example-django)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-serverless](https://github.com/pantsbuild/example-serverless)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n- [example-workspace-execution](https://github.com/pantsbuild/example-workspace-execution)\\n\\nAnd let us know what you think in [Slack!](/community/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to `2.30.0`, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2025/10/06/winding-down-macos-intel-support","metadata":{"permalink":"/blog/2025/10/06/winding-down-macos-intel-support","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2025-10-06-winding-down-macos-intel-support/index.mdx","source":"@site/blog/2025-10-06-winding-down-macos-intel-support/index.mdx","title":"When to Wind Down MacOS Intel Support","description":"Image generated by ChatGPT","date":"2025-10-05T00:00:00.000Z","tags":[{"inline":true,"label":"development","permalink":"/blog/tags/development"},{"inline":true,"label":"community","permalink":"/blog/tags/community"},{"inline":true,"label":"macos","permalink":"/blog/tags/macos"}],"readingTime":0.95,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["development","community","macos"],"date":"2025-10-05T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Pants 2.30.0 is released!","permalink":"/blog/2025/12/10/pants-2-30"},"nextItem":{"title":"Pants 2.29.0 is released!","permalink":"/blog/2025/10/03/pants-2-29"}},"content":"<CaptionedImg src={require(\\"./splash.png\\").default}>\\n  Image generated by [ChatGPT](https://chatgpt.com/)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nIntel-based Macs are [on their way out](https://mbsdirect.com/mbs-blog/article-upgrade-soon-intel-based-macs-and-apps-are-on-their-way-out). The transition to Apple Silicon hardware has been ongoing for the past 5 years, and the recently released macOS Tahoe is the last macOS version to support the x86_64 platform.\\n\\nWe currently release Pants for macOS on x86_64, but it is becoming increasingly laborious and costly to do so. GitHub\'s macos-13 runner was deprecated recently and will be fully unsupported in a few weeks. So we would like to begin considering our timeline for dropping macOS Intel support. And you can help us!\\n\\nDo you use Pants on Intel Macs? Do you intend to do so indefinitely, or do you have a target date for your own migration off that platform? Regardless of your own usage, do you have opinions on this topic?\\n\\nPlease let us know by chiming in on [this GitHub discussion](https://github.com/pantsbuild/pants/discussions/22711)! We look forward to a spirited and courteous conversation. Thanks!"},{"id":"/2025/10/03/pants-2-29","metadata":{"permalink":"/blog/2025/10/03/pants-2-29","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2025-10-03-pants-2-29/index.mdx","source":"@site/blog/2025-10-03-pants-2-29/index.mdx","title":"Pants 2.29.0 is released!","description":"Photo by Klares Vincent on","date":"2025-10-04T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":2.28,"hasTruncateMarker":true,"authors":[{"name":"Chris Burroughs","title":"Pants Maintainer","url":"https://github.com/cburroughs","imageURL":"https://github.com/cburroughs.png","key":"cburroughs","page":null}],"frontMatter":{"authors":["cburroughs"],"tags":["announcement"],"date":"2025-10-04T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"When to Wind Down MacOS Intel Support","permalink":"/blog/2025/10/06/winding-down-macos-intel-support"},"nextItem":{"title":"Pants 2.28.0 is released!","permalink":"/blog/2025/09/08/pants-2-28"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Klares Vincent](https://unsplash.com/@byvincentk) on\\n  [Unsplash](https://unsplash.com/photos/ancient-stone-aqueduct-reflected-in-calm-water-Sbhx-SzSWBw)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe are pleased to announce Pants [2.29.0](https://github.com/pantsbuild/pants/blob/2.29.x/docs/notes/2.29.x.md), the latest release of [Pantsbuild](https://www.pantsbuild.org/), the scalable and ergonomic build system. To update, set `pants_version = \\"2.29.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/2.29/docs/getting-started).\\n\\nSo, this is usually the spot where these blog posts include some highlights. And there _are_ bugs fixed, tools updated, maintenance completed, lights kept on, and quality of life improvements refined. But the big theme of this release is the continued work on -- and near completion of! -- the [call-by-name](https://github.com/pantsbuild/pants/issues/21065) migration. This brings faster startup time, simplified Pants engine code, and an end to inscrutable rules graph errors for plugin authors. (If you have seen [one](https://gist.github.com/cburroughs/beb4054b73c377373f1195f20a6a477d), you know what I mean.)\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/blob/2.29.x/docs/notes/2.29.x.md) for the accumulation of all those little improvements, and look forward to guidance for plugins to switch to call-by-name in 2.30.\\n\\nPants is an open-source project, and the changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a [contributor](https://www.pantsbuild.org/stable/docs/contributions).\\n\\nWe also offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nSome Pants maintainers also offer [paid consulting](https://www.pantsbuild.org/spotlight/service-providers) for adopting and customizing Pants for your company\'s needs.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-django](https://github.com/pantsbuild/example-django)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-serverless](https://github.com/pantsbuild/example-serverless)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n- [example-workspace-execution](https://github.com/pantsbuild/example-workspace-execution)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/community/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to `2.29.0`, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2025/09/08/pants-2-28","metadata":{"permalink":"/blog/2025/09/08/pants-2-28","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2025-09-08-pants-2-28/index.mdx","source":"@site/blog/2025-09-08-pants-2-28/index.mdx","title":"Pants 2.28.0 is released!","description":"Photo by Adrien on","date":"2025-09-08T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":2.17,"hasTruncateMarker":true,"authors":[{"name":"Tom Dyas","title":"Pants Maintainer","url":"https://github.com/tdyas","key":"tdyas","page":null}],"frontMatter":{"authors":["tdyas"],"tags":["announcement"],"date":"2025-09-08T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Pants 2.29.0 is released!","permalink":"/blog/2025/10/03/pants-2-29"},"nextItem":{"title":"Pants 2.27.0 is released!","permalink":"/blog/2025/06/30/pants-2-27"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Adrien](https://unsplash.com/@add_rien_20) on\\n  [Unsplash](https://unsplash.com/photos/a-man-riding-a-bike-down-a-street-z2wYBRTck-g)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe are pleased to announce Pants [2.28.0](https://github.com/pantsbuild/pants/blob/2.28.x/docs/notes/2.28.x.md), the latest release of [Pantsbuild, the scalable and ergonomic build system](https://www.pantsbuild.org/). To update, set `pants_version = \\"2.28.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/2.28/docs/getting-started).\\n\\nThank you to [Klaviyo](https://www.klaviyo.com/) for their Platinum tier [sponsorship](https://www.pantsbuild.org/sponsors) throughout this release!\\n\\n_Highlights in [2.28](https://github.com/pantsbuild/pants/blob/2.28.x/docs/notes/2.28.x.md) include_:\\n\\n- \u{1F680} **Significantly faster daemon startup** - Some real-world codebases report startup time cut to 30-40% of what it was in v2.27.0 (2.5-3\xd7 faster!).\\n- \u{1F3AF} **TypeScript improvements** - TypeScript targets now work with JavaScript goals, plus better dependency inference with TSX grammar.\\n- \u{1F4E6} **Batched remote cache reads** - Experimental support for batch reads from the gRPC Remote Execution API significantly increases throughput.\\n- \u{1F40D} **Direct type stub generation for Protobuf/Python** - Protobuf can now generate Python type stubs directly via `protoc`.\\n- \u{1F41E} And a whole bunch of updates, bugfixes, and general improvements!\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/blob/2.28.x/docs/notes/2.28.x.md).\\n\\nPants is an open-source project, and changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a [contributor](https://www.pantsbuild.org/stable/docs/contributions).\\n\\nWe also offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nSome Pants maintainers also offer [paid consulting](https://www.pantsbuild.org/spotlight/service-providers) for adopting and customizing Pants for your company\'s needs.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/community/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to `2.28.0`, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2025/06/30/pants-2-27","metadata":{"permalink":"/blog/2025/06/30/pants-2-27","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2025-06-30-pants-2-27/index.mdx","source":"@site/blog/2025-06-30-pants-2-27/index.mdx","title":"Pants 2.27.0 is released!","description":"Photo by xiaokang Zhang on","date":"2025-06-30T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":2.04,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["announcement"],"date":"2025-06-30T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Pants 2.28.0 is released!","permalink":"/blog/2025/09/08/pants-2-28"},"nextItem":{"title":"Introducing the Sandboxer!","permalink":"/blog/2025/06/29/introducing-the-sandboxer"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [xiaokang Zhang](https://unsplash.com/@hellomm) on\\n  [Unsplash](https://unsplash.com/photos/close-up-photography-of-shell-beside-seashore-bNQKQOmbfL8)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe are pleased to announce Pants [2.27.0](https://github.com/pantsbuild/pants/blob/2.27.x/docs/notes/2.27.x.md), the latest release of [Pantsbuild](https://www.pantsbuild.org/), the scalable and ergonomic build system. To update, set `pants_version = \\"2.27.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/2.27/docs/getting-started).\\n\\nThank you to [Klaviyo](https://www.klaviyo.com/) for their Platinum tier [sponsorship](https://www.pantsbuild.org/sponsors) throughout this release!\\n\\n_Highlights in [2.27](https://github.com/pantsbuild/pants/blob/2.27.x/docs/notes/2.27.x.md) include_:\\n\\n- \u{1F3D6}\uFE0F The [Sandboxer feature](/blog/2025/06/29/introducing-the-sandboxer), to fix a pernicious ETXTBSY race condition.\\n- \u{1FAB5} Local and remote processes now log their action and command digests, for ease of debugging.\\n- \u2197\uFE0F Several built-in tools have had the default versions upgraded.\\n- \u{1F40B} Stats logging now includes histograms by default.\\n- \u{1F41E} And a whole bunch of updates, bugfixes, and general improvements.\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/blob/2.27.x/docs/notes/2.27.x.md). Pants is an open-source project, and the changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a [contributor](https://www.pantsbuild.org/stable/docs/contributions).\\n\\nWe also offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nSome Pants maintainers also offer [paid consulting](https://www.pantsbuild.org/spotlight/service-providers) for adopting and customizing Pants for your company\'s needs.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/community/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to `2.27.0`, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2025/06/29/introducing-the-sandboxer","metadata":{"permalink":"/blog/2025/06/29/introducing-the-sandboxer","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2025-06-29-introducing-the-sandboxer/index.mdx","source":"@site/blog/2025-06-29-introducing-the-sandboxer/index.mdx","title":"Introducing the Sandboxer!","description":"Photo by Markus Spiske on","date":"2025-06-29T00:00:00.000Z","tags":[{"inline":true,"label":"under-the-hood","permalink":"/blog/tags/under-the-hood"}],"readingTime":4.75,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["under-the-hood"],"date":"2025-06-29T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Pants 2.27.0 is released!","permalink":"/blog/2025/06/30/pants-2-27"},"nextItem":{"title":"Pants 2.26.0 is released!","permalink":"/blog/2025/05/05/pants-2-26"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Markus Spiske](https://unsplash.com/@markusspiske) on\\n  [Unsplash](https://unsplash.com/photos/green-and-black-tractor-toy-KU3lOAiP-tQ)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nThe latest Pants release, [2.27.0](/blog/2025/06/30/pants-2-27), includes a new feature known as the \\"sandboxer\\". This feature solves the \\"ETXTBSY race\\" - a longstanding issue on POSIX systems that is a particular nuisance to build systems.\\n\\n## The ETXTBSY race\\n\\nThis issue is due to an apparent design flaw in POSIX, causing bad interactions between multithreaded programs that write binaries to disk and then attempt to run them. The issue is as follows:\\n\\nFirst, note that POSIX will error with ETXTBSY if an attempt is made to exec a binary that has any file descriptors open for writing. This on its own is a good thing, as you can imagine. Trying to exec a binary that is currently being written to could be disastrous!\\n\\nHowever, now consider a multithreaded process that writes out a binary in a thread and tries to execute it (in that same thread or in some other thread). On POSIX, executing another binary in a subprocess involves [two steps](https://en.wikipedia.org/wiki/Fork%E2%80%93exec):\\n\\n- `fork`: creates a clone of the current process. The child process is identical to the parent process, and so inherits all the parent process\'s open file descriptors.\\n- `exec`: Just after the fork point, the child process detects that it is the child, and switches to running the new binary\'s executable. At that point all those inherited file descriptors will be closed.\\n\\nThe problem manifests as the following race condition:\\n\\n- Thread A starts writing out binary `path/bin`, via an open write file descriptor.\\n- Concurrently, thread B forks subprocess #1 in order to run some unrelated process. After subprocess #1 forks, but before it execs, it has a clone of the parent process\'s open write file descriptor to `path/bin`.\\n- Thread A finishes writing out the binary, closes the file descriptor, and forks subprocess #2 to exec it.\\n- If subprocess #2 proceeds to exec before subprocess #1 does, then the exec will fail due to the open write file handle still being held by subprocess #1.\\n\\nThis is a fundamental issue with the POSIX model, and there are no simple workarounds. You can read a good writeup about this problem [here](https://github.com/golang/go/issues/22315).\\n\\n## Materializing Sandboxes\\n\\nUnfortunately, writing processes out to disk and then executing them is pretty critical functionality for Pants, and for most build systems like it. For Pants, specifically, this happens when materializing sandboxes.\\n\\nAs a reminder, Pants executes each subprocess in a hermetic subdirectory known as a \\"sandbox\\". Executing a process typically involves writing all the process\'s inputs into the sandbox directory, and then executing the process with the sandbox as its working directory. This ensures that the process runs on exactly the inputs that the result is cached against.\\nThe contents of these input files are stored in a local or remote content-addressable store; Writing them out to the sandbox is referred to as \\"materializing\\" the files.\\n\\nIn many cases these input files include the binary to be executed. So Pants must write the binary out to disk, in the sandbox, and then execute it. And since Pants is a multithreaded process, this can trigger the ETXTBSY race.\\n\\nPreviously we attempted to mitigate the problem via retry loops and other hacks. These have made the issue less frequent, but they aren\'t robust solutions.\\n\\n## The Sandboxer Process\\n\\nSince the issue is due to a program writing out a binary and then executing it, the solution naturally needs to take one of those aspects out of the equation.\\nOne way to do that is to delegate writing the binary file out to disk to another process.\\n\\nBut there is a little extra complication: we can\'t always know which files in the sandbox are going to end up being executed. That is, we obviously know which binary Pants executes directly,\\nbut we don\'t know if that process will itself exec some other binary. So to be certain that we\'ve solved the problem comprehensively we need to delegate writing _all_ sandbox files to another process. And that is exactly what the Sandboxer process is for.\\n\\nThe Sandboxer is a sidecar process managed by the Pants daemon, `pantsd`. The Sandboxer is a very lightweight process, written in Rust. All it does is listen for gRPC requests on a local socket, and act on them. When `pantsd` needs to materialize files into a sandbox, it send a gRPC request to the Sandboxer with the details of the files that need materializing. The Sandboxer will read those files from the local store and materialize them to the relevant local sandbox directory.\\n\\nNote that with the Sandboxer, the `pantsd` process itself doesn\'t write out binaries, but does execute them, and the Sandboxer process does write out binaries but doesn\'t execute them. So the ETXTBSY race is avoided by both.\\n\\nThe Sandboxer process is stateless, and is cheap to restart, so it is quick to exit on errors or inactivity. `pantsd` will restart it as needed.\\n\\n## Using the Sandboxer\\n\\nThe Sandboxer functionality is new and so is currently turned off by default. If you encounter an ETXTBSY error, you can set the [global `sandboxer` option](https://www.pantsbuild.org/2.27/reference/global-options#sandboxer) to true to enable this feature.\\nIn the future we will likely enable this by default. We\'ll then be able to remove the previous mitigations, which will simplify the codebase.\\n\\nThe Sandboxer solves a longstanding, if infrequent, issue that has plagued Pants users. We hope it increases the robustness and reliability of the system for you and your team!"},{"id":"/2025/05/05/pants-2-26","metadata":{"permalink":"/blog/2025/05/05/pants-2-26","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2025-05-05-pants-2-26/index.mdx","source":"@site/blog/2025-05-05-pants-2-26/index.mdx","title":"Pants 2.26.0 is released!","description":"Photo by Kristin Snippe on","date":"2025-05-05T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":1.84,"hasTruncateMarker":true,"authors":[{"name":"Huon Wilson","title":"Pants Maintainer","url":"https://github.com/huonw","imageURL":"https://github.com/huonw.png","key":"huonw","page":null}],"frontMatter":{"authors":["huonw"],"tags":["announcement"],"date":"2025-05-05T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Introducing the Sandboxer!","permalink":"/blog/2025/06/29/introducing-the-sandboxer"},"nextItem":{"title":"Pants 2.25.0 is released!","permalink":"/blog/2025/03/01/pants-2-25"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Kristin Snippe](https://unsplash.com/@frausnippe) on\\n  [Unsplash](https://unsplash.com/photos/white-and-brown-crochet-textile-3-3X50TIm-M)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe are pleased to announce Pants [2.26.0](https://github.com/pantsbuild/pants/blob/2.26.x/docs/notes/2.26.x.md), the latest release of [Pantsbuild, the scalable and ergonomic build system](https://www.pantsbuild.org/). To update, set `pants_version = \\"2.26.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/2.26/docs/getting-started).\\n\\nThank you to [Klaviyo](https://www.klaviyo.com/) for their Platinum tier support throughout this release!\\n\\n_Highlights in [2.26](https://github.com/pantsbuild/pants/blob/2.26.x/docs/notes/2.26.x.md) include_:\\n\\n- \u{1F945} A new Kubernetes backend.\\n- \u2197\uFE0F Many built-in tools have had the default versions upgraded.\\n- \u{1F40B} Docker images can be published non-interactively and in parallel\\n- \u{1F3CE}\uFE0F Invocations of the Ruff tool are much faster on macOS\\n- \u{1F41E} And a whole bunch of updates, bugfixes, and general improvements.\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/blob/2.26.x/docs/notes/2.26.x.md). Pants is an open-source project, and the changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a [contributor](https://www.pantsbuild.org/stable/docs/contributions).\\n\\nWe also offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/community/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to `2.26.0`, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2025/03/01/pants-2-25","metadata":{"permalink":"/blog/2025/03/01/pants-2-25","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2025-03-01-pants-2-25/index.mdx","source":"@site/blog/2025-03-01-pants-2-25/index.mdx","title":"Pants 2.25.0 is released!","description":"Photo by Ag\xea Barros on","date":"2025-03-19T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":2.27,"hasTruncateMarker":true,"authors":[{"name":"Huon Wilson","title":"Pants Maintainer","url":"https://github.com/huonw","imageURL":"https://github.com/huonw.png","key":"huonw","page":null}],"frontMatter":{"authors":["huonw"],"tags":["announcement"],"date":"2025-03-19T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Pants 2.26.0 is released!","permalink":"/blog/2025/05/05/pants-2-26"},"nextItem":{"title":"Pants 2.24.0 is released!","permalink":"/blog/2025/01/28/pants-2-24"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}>\\n  Photo by [Ag\xea Barros](https://unsplash.com/@agebarros) on\\n  [Unsplash](https://unsplash.com/photos/a-close-up-of-a-silver-watch-face-rBPOfVqROzY)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe are pleased to announce Pants [2.25.0](https://github.com/pantsbuild/pants/blob/2.25.x/docs/notes/2.25.x.md), the latest release of [Pantsbuild, the scalable and ergonomic build system](https://www.pantsbuild.org/). To update, set `pants_version = \\"2.25.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/2.25/docs/getting-started).\\n\\nThank you to [Klaviyo](https://www.klaviyo.com/) and [Normal Computing](https://normalcomputing.ai/) for their Platinum tier support throughout this release!\\n\\nPants 2.25 requires version `0.12.2` or newer of the `pants` [launcher binary](https://github.com/pantsbuild/scie-pants/). [Follow the upgrade instructions](https://www.pantsbuild.org/2.25/docs/getting-started/installing-pants#upgrading-pants) to ensure you are using a compatible version of the launcher binary.\\n\\n_Highlights in [2.25](https://github.com/pantsbuild/pants/blob/2.25.x/docs/notes/2.25.x.md) include_:\\n\\n- \u{1F40D} Pants itself now runs using Python 3.11 (previously 3.9), meaning plugins can use newer language features. Pants still works with user code using other Python versions.\\n- \u{1F40B} A Rust-based new parser for Dockerfiles (for dependency inference) is being rolled out to replace the old one. This parser is faster and doesn\'t require installing extra dependencies.\\n- \u2615 Improved dependency inference for the JavaScript (and TypeScript) backends.\\n- \u{1F4EC} A new OpenAPI backend for Python.\\n- \u{1F41E} And a whole bunch of updates, bugfixes, and general improvements.\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/blob/2.25.x/docs/notes/2.25.x.md). Pants is an open-source project, and the changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a [contributor](https://www.pantsbuild.org/stable/docs/contributions).\\n\\nWe also offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/community/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to `2.25.0`, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2025/01/28/pants-2-24","metadata":{"permalink":"/blog/2025/01/28/pants-2-24","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2025-01-28-pants-2-24/index.mdx","source":"@site/blog/2025-01-28-pants-2-24/index.mdx","title":"Pants 2.24.0 is released!","description":"Photo by Jiawei Zhao  on","date":"2025-01-28T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":2.35,"hasTruncateMarker":true,"authors":[{"name":"Chris Burroughs","title":"Pants Maintainer","url":"https://github.com/cburroughs","imageURL":"https://github.com/cburroughs.png","key":"cburroughs","page":null}],"frontMatter":{"authors":["cburroughs"],"tags":["announcement"],"date":"2025-01-28T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Pants 2.25.0 is released!","permalink":"/blog/2025/03/01/pants-2-25"},"nextItem":{"title":"In-Workspace Execution in Pants v2.23.x","permalink":"/blog/2024/12/04/workspace-environments"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}>\\n  Photo by [Jiawei Zhao ](https://unsplash.com/@jiaweizhao) on\\n  [Unsplash](https://unsplash.com/photos/tuxedo-cat-in-brown-cardboard-box-W-ypTC6R7_k)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe are pleased to announce Pants [2.24.0](https://github.com/pantsbuild/pants/blob/2.24.x/docs/notes/2.24.x.md), the latest release of [Pantsbuild, the scalable and ergonomic build system](https://www.pantsbuild.org/). To update, set `pants_version = \\"2.24.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/2.24/docs/getting-started).\\n\\n_Highlights in [2.24](https://github.com/pantsbuild/pants/blob/2.24.x/docs/notes/2.24.x.md) include_:\\n\\n- \u{1F4E6} Out of the box support for Python 3.13.\\n- \u{1FA9B} `pants export --bin` allows exporting more tools for use outside Pants\\n- \u{1F40D} A new experimental Python Provider backend using [Python Build Standalone](https://gregoryszorc.com/docs/python-build-standalone/main/).\\n- \u{1F51C} A new option system that unlocks future changes.\\n- \u{1F41E} And a whole bunch of updates, bugfixes, and general improvements.\\n\\nAnd some heads up of coming changes:\\n\\n- Pants 2.24x will suggest you upgrade to the at least version `0.12.2` of the `pants` [launcher binary](https://github.com/pantsbuild/scie-pants/) [following the upgrade instructions](https://www.pantsbuild.org/2.24/docs/getting-started/installing-pants#upgrading-pants). This supports underlying improvements coming in Pants 2.25.\\n- As in the previous release, in `2.24.x` we continue to run both the new and the legacy options systems concurrently and compare the results, issuing warnings if there are any discrepancies. If you do encounter discrepancies that you can\'t resolve on your own, please [reach out to us!](https://www.pantsbuild.org/community/getting-help).\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/blob/2.24.x/docs/notes/2.24.x.md). Pants is an open-source project, and the changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a [contributor](https://www.pantsbuild.org/stable/docs/contributions).\\n\\nWe also offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/community/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to `2.24.0`, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2024/12/04/workspace-environments","metadata":{"permalink":"/blog/2024/12/04/workspace-environments","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-12-04-workspace-environments/index.mdx","source":"@site/blog/2024-12-04-workspace-environments/index.mdx","title":"In-Workspace Execution in Pants v2.23.x","description":"Photo by Getty Images on","date":"2024-12-04T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":5.93,"hasTruncateMarker":true,"authors":[{"name":"Tom Dyas","title":"Pants Maintainer","url":"https://github.com/tdyas","key":"tdyas","page":null}],"frontMatter":{"authors":["tdyas"],"tags":["announcement"],"date":"2024-12-04T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Pants 2.24.0 is released!","permalink":"/blog/2025/01/28/pants-2-24"},"nextItem":{"title":"Pants 2.23.0 is released!","permalink":"/blog/2024/11/20/pants-2-23"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}>\\n  Photo by [Getty Images](https://unsplash.com/@gettyimages) on\\n  [Unsplash](https://unsplash.com/photos/contemporary-loft-office-interior-3d-rendering-design-concept-nvzguGid2Kk)\\n</CaptionedImg>\\n\\nPants is just one of many build orchestration tools in the world. As of Pants v2.23.0, Pants better supports integrating seamlessly with other tools in your development workflow via the new [\\"workspace environments\\" feature](/stable/docs/using-pants/environments#in-workspace-execution-experimental_workspace_environment). With workspace environments, you can run processes in the repository itself (i.e., the workspace) instead of in the usual execution sandbox. This support is useful for better integrating Pants with third party tooling which assumes it runs from your repository.\\n\\nRead on for an example of how to use this support to integrate Bazel with Pants.\\n\\n\x3c!-- truncate --\x3e\\n\\n## Motivation\\n\\nWhy might you want to run processes in the workspace?\\n\\nOne reason is if your development workflow uses third party tools not already supported by Pants. Such third party tools may assume they are the only build tool in use and _expect_ that they will run from the workspace. Trying to run them from the Pants execution sandbox then ends up being harder than just running the tool directly because of the need to work around the tool\'s \\"run from workspace\\" assumption.\\n\\nWith workspace environments, Pants can now run those tools in the way that they expect, and let you avoid having to work around the tool\'s assumptions about how it should be invoked.\\n\\n## The Example: Running Bazel\\n\\nThe goal for this example is to let Pants invoke Bazel to build a JVM jar file and then make use of that jar within Pants build logic using the workspace environment feature. <a href=\\"#fn0\\">[0]</a> We will use [this GitHub repository](https://github.com/pantsbuild/example-workspace-execution) for the example.\\n\\nThis article assumes you have some familiarity with the [Pants environments system](/stable/docs/using-pants/environments). The in-workspace execution support is modeled as \\"just another environment\\" and so most of the concepts applicable to other environments such as `local_environment`, `docker_environment`, and `remote_environment` are applicable to `experimental_workspace_environment`. For example, you can override any environment-aware configuration option in the same manner for `experimental_workspace_environment` as you would have for any of the other environment target types.\\n\\nFirst make sure Pants, Bazel, and Docker are all installed.\\n\\nNext, simply clone the repository with `git clone https://github.com/pantsbuild/example-workspace-execution` and then run `pants run //:project-image`.\\n\\nPants will invoke Bazel, Bazel will build the jar, and then Pants will build a Docker image from that jar and run the resulting Docker image. It may take some time for Bazel to build the jar the first time, and Pants will not display any output from Bazel until Bazel completes. You should see `Hello!` as the final output.\\n\\nLet\'s walk through the code and configuration.\\n\\n### Repository layout\\n\\nThe [repository](https://github.com/pantsbuild/example-workspace-execution) is laid out as follows:\\n\\n<table>\\n  <thead>\\n    <th>Path</th>\\n    <th>Description</th>\\n  </thead>\\n  <tbody>\\n    <tr>\\n      <td>`BUILD.pants`</td>\\n      <td>\\n        The root BUILD file for Pants. We are calling it `BUILD.pants` so Bazel\\n        (and developers) cannot confuse it for a Bazel build file.\\n      </td>\\n    </tr>\\n    <tr>\\n      <td>`pants.toml`</td>\\n      <td>The Pants configuration file</td>\\n    </tr>\\n    <tr>\\n      <td>`bazel-jvm/**`</td>\\n      <td>A Bazel project which produces a jar file.</td>\\n    </tr>\\n    <tr>\\n      <td>`bazel-jvm/src/main/java/com/example/**/*.java`</td>\\n      <td>The Java files to be built into the jar by Bazel.</td>\\n    </tr>\\n  </tbody>\\n</table>\\n\\n### Pants configuration\\n\\n1. _Configuring the workspace environment_. The first thing to do is configure a workspace environment to enable in-workspace execution support. In this example, we added an [`experimental_workspace_environment` target](/stable/reference/targets/experimental_workspace_environment) to the repository in the root `BUILD.pants`. Then we added the address for this target (`//:workspace`) to `pants.toml` under the [`[environments-preview.names]` key](/stable/reference/subsystems/environments-preview#names) which gives the environment a name.\\n\\n2. _Setting up the integration target_. The example uses the [`shell_command`](/stable/reference/targets/shell_command) target at address `//:bazel-jvm-binary` to invoke Bazel.\\n\\n- That target is configured to use the workspace environment by virtue of setting its `environment` field to the special symbol `__local_workspace__` which selects whatever `experimental_workspace_environment` matches the current platform. (If there is only one such environment, then it will always match.) We could have also just used the name of the workspace directly.\\n\\n- The new [`path_env_modify`](/stable/reference/targets/shell_command#path_env_modify) field on [`shell_command`](/stable/reference/targets/shell_command) is set to `off` so that Pants does not modify the `PATH` environment variable. By default, Pants will inject a directory with symlinks to the `tools` set on a `shell_command` target and prepend that directory to the `PATH`. Bazel incorporates the `PATH` into its own cache key and so we need to disable Pants changing that value so that Bazel does not invalidate the jar every time it is invoked.\\n\\n- The output from Bazel is copied to the `{chroot}` directory. Ordinarily, when Pants invokes a process, `{chroot}` refers to the execution sandbox. With workspace execution, this is no longer the case because the working directory is now within the repository. Pants, however, will still create a (now separate) temporary directory to allow materializing dependencies and to allow capture of outputs. Restated, Pants will not capture outputs from the repository, only from the temporary directory created during execution; that is, the `{chroot}` directory.\\n\\n3. _Using the output from Bazel_. The [`docker_image`](/stable/reference/targets/docker_image) target at address `//:project_image` consumes the output from the `//:bazel-jvm-binary` `shell_command` target by listing it as a dependency in the `dependencies` field. The Docker image is setup to invoke the jar. It is that simple to consume Bazel\'s output in Pants!\\n\\n## Limitations & Caveats\\n\\nThere are some limitations with the in-workspace execution support:\\n\\n1. The main issue is that it has only been designed to work seamlessly with the [`shell_command`](/stable/reference/targets/shell_command) and [`adhoc_tool`](/stable/reference/targets/adhoc_tool) target types. Using this support with other target types (for example, `pex_binary` or `go_binary`) has not been tested and you may encounter odd behavior because workspace environments violate the core Pants assumption that all execution occurs in temporary sandboxes. We have not tested those other use cases in any meaningful way.\\n\\n2. Any non-deterministic behavior in the external build tool or in the integration target may impact the ability of Pants to maintain reproducibility of the build. This is not a problem with workspace execution per se, but workspace execution can exacerbate any existing non-determinisms because it removes the execution sandbox as a mitigation. You, as the developer, always have the responsibility to configure Pants to operate in a deterministic way.\\n\\n## Conclusion & Credits\\n\\nHopefully the user community will find this support useful. We look forward to what you all build with it!\\n\\nThis work was awesomely sponsored by [Proxima Fusion GmbH](https://www.proximafusion.com/).\\n\\n<hr />\\n\\n<span id=\\"fn0\\">[0]</span> Having Bazel build a jar is a contrived example since\\nPants does have JVM support. But using Bazel\u2019s JVM support for this example made\\nit more straightforward to demonstrate integration between Pants and Bazel."},{"id":"/2024/11/20/pants-2-23","metadata":{"permalink":"/blog/2024/11/20/pants-2-23","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-11-20-pants-2-23/index.mdx","source":"@site/blog/2024-11-20-pants-2-23/index.mdx","title":"Pants 2.23.0 is released!","description":"Photo by [Sarah","date":"2024-11-19T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":3.25,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["announcement"],"date":"2024-11-19T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"In-Workspace Execution in Pants v2.23.x","permalink":"/blog/2024/12/04/workspace-environments"},"nextItem":{"title":"2024 Pantsbuild User Survey","permalink":"/blog/2024/10/08/user-survey-2024"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}>\\n  Photo by [Sarah\\n  Kilian](https://unsplash.com/@rojekilian?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)\\n  on\\n  [Unsplash](https://unsplash.com/photos/two-grey-walking-elephants-E-szZQqUmH4?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe are pleased to announce Pants [2.23.0](https://github.com/pantsbuild/pants/blob/2.23.x/docs/notes/2.23.x.md), the latest release of [Pantsbuild, the scalable and ergonomic build system](https://www.pantsbuild.org/). To update, set `pants_version = \\"2.23.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/2.23/docs/getting-started).\\n\\nThe previous release, 2.22.0, suffered from delays in its release cycle. So this 2.23.0 release is a relatively fast follow, and does not introduce major upheavals.\\n\\nA couple of administrative reminders:\\n\\n- The annual [Pants user survey](https://www.pantsbuild.org/blog/2024/10/08/user-survey-2024) is open through the end of 2024. The results will be used to assist the Pants maintainers and contributors to better understand areas where Pants may need work, so your feedback is vital!\\n- We\'re very proud that Pants now has its first [sponsors](https://www.pantsbuild.org/sponsors)! We are very grateful to [Klayvio](https://www.klaviyo.com/) and [Normal Computing](https://normalcomputing.ai/) for their Platinum tier support, and to [Continua](https://www.continua.ai/) and Stormfish for their Silver tier support.\\n  Sponsoring is a way for companies that use Pants to support the project while engaging more closely with the community. Want to support Pants? Find out more about our [sponsorship opportunities](https://www.pantsbuild.org/sponsorship) and the associated benefits at each tier.\\n\\n_Highlights in [2.23](https://github.com/pantsbuild/pants/blob/2.23.x/docs/notes/2.23.x.md) include_:\\n\\n- \u{1F316} Due to deprecations by GitHub, the minimum supported glibc version for Pants wheels is now 2.28. Unless you are running Pants with in-repo plugins on a Linux distro from before 2018, this should have no effect.\\n- \u2728 A new backend for the [buildifier](https://github.com/bazelbuild/buildtools/blob/main/buildifier/README.md) BUILD file formatter.\\n- \u{1F50D} Two new experimental backends: [nFPM](https://github.com/goreleaser/nfpm) and [Trufflehog](https://github.com/trufflesecurity/trufflehog). Try them out and [let us know](https://www.pantsbuild.org/community/getting-help) how it goes!\\n- \u{1F500} Better dependency inference for Dockerfiles.\\n- \u{1F689} Improvements to platform handling in Python function-as-a-service targets.\\n- \u26F0\uFE0F Enhancements to Terraform lockfiles and caching.\\n- \u{1F4C8} And lots of smaller features, update, bugfixes, and general improvements.\\n\\nAs in the previous release, in 2.23.x we continue to run both the new and the legacy options systems concurrently and compare the results, issuing warnings if there are any discrepancies. If you do encounter discrepancies that you can\'t resolve on your own, please [reach out to us!](https://www.pantsbuild.org/community/getting-help).\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/blob/2.23.x/docs/notes/2.23.x.md). Pants is an open-source project, and the changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a contributor.\\n\\nAs mentioned above, we offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/community/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to 2.23.0, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2024/10/08/user-survey-2024","metadata":{"permalink":"/blog/2024/10/08/user-survey-2024","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-10-08-user-survey-2024/index.mdx","source":"@site/blog/2024-10-08-user-survey-2024/index.mdx","title":"2024 Pantsbuild User Survey","description":"No (software) project survives without listening to its community of users. And the Pants project is no different. What does this mean? It is time for the 2024 Pantsbuild User Survey!","date":"2024-10-08T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":0.67,"hasTruncateMarker":true,"authors":[{"name":"Tom Dyas","title":"Pants Maintainer","url":"https://github.com/tdyas","key":"tdyas","page":null}],"frontMatter":{"authors":["tdyas"],"tags":["announcement"],"date":"2024-10-08T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Pants 2.23.0 is released!","permalink":"/blog/2024/11/20/pants-2-23"},"nextItem":{"title":"Pants 2.22.0 is released!","permalink":"/blog/2024/09/10/pants-2-22"}},"content":"No (software) project survives without listening to its community of users. And the Pants project is no different. What does this mean? It is time for the 2024 Pantsbuild User Survey!\\n\\nWe want to hear from our community about how well (or not so well) the project is going and how it can be improved.\\n\\n[This Google Form contains a short five question survey.](https://forms.gle/eo7Y4DuxurjaMSZn6)\\n\\n\x3c!-- truncate --\x3e\\n\\nIt is anonymous, but you may optionally provide us your email in case you are amenable to a potential follow-up to your feedback.\\n\\nThe survey will remain open through the end of the year (although we will be looking at the responses before then). The results will be used to assist the Pants maintainers and contributors to better understand areas where Pants may need work."},{"id":"/2024/09/10/pants-2-22","metadata":{"permalink":"/blog/2024/09/10/pants-2-22","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-09-10-pants-2-22/index.mdx","source":"@site/blog/2024-09-10-pants-2-22/index.mdx","title":"Pants 2.22.0 is released!","description":"Photo by [Florian","date":"2024-09-10T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":2.97,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["announcement"],"date":"2024-09-10T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"2024 Pantsbuild User Survey","permalink":"/blog/2024/10/08/user-survey-2024"},"nextItem":{"title":"Venerable Pythons, Pants, Pip, and Ecosystems","permalink":"/blog/2024/08/24/venerable-pythons"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}>\\n  Photo by [Florian\\n  Rebmann](https://unsplash.com/@florianxrebmann?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)\\n  on\\n  [Unsplash](https://unsplash.com/photos/a-building-with-a-flag-on-top-cWAsvnD9A98?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe are pleased to announce Pants [2.22.0](https://github.com/pantsbuild/pants/tree/2.22.x/docs/notes/2.22.x.md), the latest release of [Pantsbuild, the scalable and ergonomic build system](https://www.pantsbuild.org/). To update, set `pants_version = \\"2.22.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/2.22/docs/getting-started).\\n\\n_Highlights in [2.22](https://github.com/pantsbuild/pants/tree/2.22.x/docs/notes/2.22.x.md) include_:\\n\\n- \u{1F39B} A major re-implementation of the Pants [options system](https://www.pantsbuild.org/2.22/docs/using-pants/key-concepts/options). See below for more!\\n- \u{1F3E0} Support for executing local processes within the repository itself (rather than in a sandbox) via the new [workspace environment](https://www.pantsbuild.org/stable/docs/using-pants/environments#in-workspace-execution-experimental_workspace_environment) feature.\\n- \u{1F40D} Initial support for Python 3.13.\\n- \u{1F6EB} Ability to export Python tools [from their default bundled lockfiles](https://www.pantsbuild.org/2.22/docs/using-pants/setting-up-an-ide#tool-virtualenvs).\\n- \u2601\uFE0F Improvements in FaaS support, such as the ability to create cloud functions as directories, instead of .zip files.\\n- \u{1F3F7}\uFE0F [`vcs_version`](https://www.pantsbuild.org/stable/reference/targets/vcs_version) always executes locally, so that it has the local git context, even when otherwise using docker environments.\\n- \u{1F4CA} A new experimental SQL backend, with [SQLFluff](https://sqlfluff.com/) linter support.\\n- \u{1F5C3}\uFE0F A new experimental [Makeself](https://makeself.io/) backend for creating self-extractable archives.\\n- \u{1FAD9} A [`deploy_jar_exclude_files`](https://www.pantsbuild.org/2.22/reference/subsystems/jvm#deploy_jar_exclude_files) option, to allow excluding irrelevant signature files from JAR files.\\n- \u{1F5FA}\uFE0F Better understanding of self-type annotations in Scala dependency inference.\\n- \u{1F392} The ability to bundle `openapi_document` and its `openapi_source` dependencies into a single file, for consumption by other targets.\\n- \u{1F4C8} And lots of smaller features, update, bugfixes, and general improvements\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/tree/2.22.x/docs/notes/2.22.x.md). Pants is an open-source project, and the changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a contributor.\\n\\nIn particular, please note the transition to the new options system. In 2.22.x we run both the new and the legacy systems concurrently and compare the results, issuing warnings if there are any discrepancies. If you do encounter discrepancies that you can\'t resolve on your own, please [reach out to us!](https://www.pantsbuild.org/community/getting-help).\\n\\nWe also offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/community/getting-help)\\n\\nPants 2.22.0 took longer than usual to stabilize, but we hope to get 2.23.0 out quite soon!\\n\\nPants wouldn\'t be possible without everyone who contributed to 2.22.0, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2024/08/24/venerable-pythons","metadata":{"permalink":"/blog/2024/08/24/venerable-pythons","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-08-24-venerable-pythons/index.mdx","source":"@site/blog/2024-08-24-venerable-pythons/index.mdx","title":"Venerable Pythons, Pants, Pip, and Ecosystems","description":"Photo by David Clode /","date":"2024-08-22T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":2.05,"hasTruncateMarker":true,"authors":[{"name":"Chris Burroughs","title":"Pants Maintainer","url":"https://github.com/cburroughs","imageURL":"https://github.com/cburroughs.png","key":"cburroughs","page":null}],"frontMatter":{"authors":["cburroughs"],"tags":["announcement"],"date":"2024-08-22T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Pants 2.22.0 is released!","permalink":"/blog/2024/09/10/pants-2-22"},"nextItem":{"title":"Building Linux/x64 containers on OS X on Apple Silicon with Pants","permalink":"/blog/2024/07/01/building-linux-on-osx-silicon"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}>\\n  Photo by [David Clode](https://unsplash.com/@davidclode) /\\n  [Unsplash](https://unsplash.com/photos/python-resting-its-head-on-body-yrcaXCWe0VY)\\n</CaptionedImg>\\n\\nThe Python development community concurrently supports multiple version of the Python programming language. These are in various states such as \\"prerelease\\", \\"bugfix\\", \\"security\\", or \\"end-of-life\\". For example version 3.12 is currently in \\"bugfix\\" while 3.8 is the oldest still receiving security updates. The cadence of future release is currently governed by [PEP 602 \u2013 Annual Release Cycle for Python](https://peps.python.org/pep-0602/)\\n\\n{/* truncate */}\\n\\nCirca 2024 the state of [all Python versions](https://devguide.python.org/versions/) look something like:\\n\\n![CPython Release Status](./cpython-release-status.png)\\n\\nThat covers Python the _language_. The various projects and libraries that make up the broader Python ecosystem may support versions on different timetables. For example the `pip` project stopped supporting Python 3.7 in [2024-05](https://pip.pypa.io/en/stable/news/#b1-2024-05-06) which was significantly after Python 3.7 itself reached end-of-life in 2023. Other projects may hue closer to the \\"bleeding edge\\".\\n\\nThere are a few different \\"versions of Python\\" that are relevant for Pants:\\n\\n- The versions of Python that Pants can test and build.\\n- The versions of Python that Pants supports \\"out of the box\\" with default tool lockfiles. This includes tools like `pip`, `black`, or `mypy`.\\n- The version of Python that Pants itself is written in. This is only relevant for plugin authors, the version that Pants itself uses is otherwise an [implementation detail](/blog/2023/02/23/the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants)\\n\\nStarting in Pants version ~~2.23~~ 2.24 [^1], the default tool lockfile bundled with Pants will no longer support Python 3.7. Pants will still build and test Python 3.7 code! But you will first need to create your own [tool lockfiles](https://www.pantsbuild.org/2.21/docs/python/overview/lockfiles#lockfiles-for-tools).\\n\\nThis will allow the bundled lockfiles to support [versions of pip that will generate lockfiles faster](https://pip.pypa.io/en/stable/news/#v24-2), the [Python 3.13 release](https://github.com/pantsbuild/pants/issues/21103), and [more secure](https://github.com/pantsbuild/pants/issues/21184) versions of `setuptools`.\\n\\nIn the future as support across the Python ecosystem ebbs and flows, Pants will continue to adjust to provide broad \\"out of the box\\" support for a variety of Python versions.\\n\\n---\\n\\n[^1]: This was originally intended to be 2.23, but moved to 2.24 to give more time for testing."},{"id":"/2024/07/01/building-linux-on-osx-silicon","metadata":{"permalink":"/blog/2024/07/01/building-linux-on-osx-silicon","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-07-01-building-linux-on-osx-silicon/index.mdx","source":"@site/blog/2024-07-01-building-linux-on-osx-silicon/index.mdx","title":"Building Linux/x64 containers on OS X on Apple Silicon with Pants","description":"Espresso AI started as a primarily Linux shop, but as we\'ve added more developers on OS X we\'ve needed a way to build docker containers on OS X that are compatible with our Linux production environment.","date":"2024-07-01T00:00:00.000Z","tags":[{"inline":true,"label":"recipe","permalink":"/blog/tags/recipe"}],"readingTime":2.89,"hasTruncateMarker":true,"authors":[{"name":"Alex Kouzemtchenko","title":"CTO & Founder at Espresso AI","url":"https://github.com/kuza55","imageURL":"https://github.com/kuza55.png","key":"kuza55","page":null}],"frontMatter":{"authors":["kuza55"],"tags":["recipe"],"date":"2024-07-01T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Venerable Pythons, Pants, Pip, and Ecosystems","permalink":"/blog/2024/08/24/venerable-pythons"},"nextItem":{"title":"Announcing Klaviyo\'s Sponsorship","permalink":"/blog/2024/06/13/announcing-klaviyo-sponsorship"}},"content":"[Espresso AI](https://espresso.ai/) started as a primarily Linux shop, but as we\'ve added more developers on OS X we\'ve needed a way to build docker containers on OS X that are compatible with our Linux production environment.\\n\\nPants has supported running portions of the build in docker containers for [a while](https://www.pantsbuild.org/blog/2023/02/24/pants-2-15), but the exact configuration is a little tricky, particularly if you want to build x86_64 containers on Apple ARM processors.\\n\\n{/* truncate */}\\n\\nThe recipe itself is very straight forward, adding these two sections to your root BUILD and pants.toml files will build your python binaries and docker containers for Linux/x64 on both Linux & OSX:\\n\\n```bash title=\\"BUILD\\"\\n__defaults__({\\n  pex_binary: dict(environment=\\"linux\\"),\\n  docker_image: dict(build_platform=[\\"linux/amd64\\"]),\\n})\\n\\nlocal_environment(\\n  name=\\"local_linux\\",\\n  compatible_platforms=[\\"linux_x86_64\\"],\\n  fallback_environment=\\"docker\\",\\n  docker_env_vars=[\\"AWS_PROFILE=profile\\"]\\n)\\n\\nlocal_environment(\\n  name=\\"local_osx\\",\\n  compatible_platforms=[\\"macos_arm64\\"],\\n)\\n\\ndocker_environment(\\n  name=\\"docker\\",\\n  platform=\\"linux_x86_64\\",\\n  image=\\"python:3.11-bookworm\\",\\n  docker_env_vars=[\\"AWS_PROFILE=profile\\"]\\n)\\n```\\n\\n```bash title=\\"pants.toml\\"\\n[environments-preview.names]\\nlocal = \\"//:local_linux\\"\\nlocal_osx = \\"//:local_osx\\"\\ndocker = \\"//:docker\\"\\n```\\n\\nWith these snippets, we have defined 3 environments:\\n\\n- A docker environment with associated image for running the linux builds\\n- A local linux environment that falls back to docker\\n- An OSX environment for running non-linux builds & other goals locally on osx\\n\\nWe\'ve setup a few defaults for our repo to avoid unnecessary configuration in our BUILD files:\\n\\n- All of our pex_binary targets are built using either the local or docker linux environments via the fallback mechanism\\n- All of our docker_image targets have the build_platform explicitly specified so that we do not inherit the platform defaults to build arm64 images.\\n\\nThe other targets, such as tests, get built/run/etc using one of the maching local_workspace targets.\\n\\nWe\'ve also worked around a non-obvious requirement to duplicate our [docker.env_vars] setting in the docker_env_vars field of the docker_environment target. If your publish of a docker container is failing, this is likely the cause.\\n\\n# Troubleshooting Tips\\n\\nIf you are tempted to apply the build_platform argument on your individual docker_image targets, or attempt to add this to your Dockerfile, note that you need to specify this on the entire chain of docker images you depend on if you have multi-stage builds.\\n\\nIf you have attempted your own version of this build_platform setup before using this recipe, you may run into some caching issues and may benefit from using the [--no-local-cache](https://www.pantsbuild.org/2.20/reference/global-options#local_cache) flag once to get builds working.\\n\\nIf you notice you cannot publish images with this setup, run the publish command with the PANTS_LEVEL=debug environment variable to see what environment variables are actually making it to the docker push command.\\n\\n# Understanding common errors\\n\\nIf you are receiving errors like this, it indicates you are attempting to run a linux/x64 binary on a linux/arm64 container image and need to adjust your docker image by updating the build platform as shown in the example above:\\n\\n```\\nFailed to find compatible interpreter on path /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin.\\n\\nExamined the following interpreters:\\n1.) /usr/bin/python3.10 CPython==3.10.12\\n2.) /usr/bin/python3.11 CPython==3.11.9\\n\\nNo interpreter compatible with the requested constraints was found:\\n\\n  A distribution for pendulum could not be resolved for /usr/bin/python3.11.\\n  Found 1 distribution for pendulum that do not apply:\\n  1.) The wheel tags for pendulum 2.1.2 are cp311-cp311-manylinux_2_35_x86_64 which do not match the supported tags of /usr/bin/python3.11:\\n  cp311-cp311-manylinux_2_35_aarch64\\n```"},{"id":"/2024/06/13/announcing-klaviyo-sponsorship","metadata":{"permalink":"/blog/2024/06/13/announcing-klaviyo-sponsorship","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-06-13-announcing-klaviyo-sponsorship/index.mdx","source":"@site/blog/2024-06-13-announcing-klaviyo-sponsorship/index.mdx","title":"Announcing Klaviyo\'s Sponsorship","description":"Today we are excited to announce that Klaviyo has become the first Platinum sponsor of the Pants project via the corporate sponsorship program! This is one of the first such sponsorships through our new Open Source Sponsorship program, through which we are trying to support the open source projects we depend on. While the core development and maintenance of Pants is volunteer driven, there are costs involved with maintaining and distributing such a large piece of software, costs which far too often are covered by individual volunteers. We benefit enormously from this project and want to help contribute to its ongoing success.","date":"2024-06-13T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":1.49,"hasTruncateMarker":true,"authors":[{"name":"Greg Niemann","title":"Lead Site Reliability Engineer at Klaviyo","url":"https://github.com/gniemann","imageURL":"https://github.com/gniemann.png","key":"gniemann","page":null}],"frontMatter":{"authors":["gniemann"],"tags":["announcement"],"date":"2024-06-13T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Building Linux/x64 containers on OS X on Apple Silicon with Pants","permalink":"/blog/2024/07/01/building-linux-on-osx-silicon"},"nextItem":{"title":"Pants 2.21.0 is released!","permalink":"/blog/2024/05/29/pants-2-21"}},"content":"Today we are excited to announce that [Klaviyo](https://www.klaviyo.com/) has become the first Platinum sponsor of the Pants project via the [corporate sponsorship program](https://www.pantsbuild.org/sponsorship#corporate-sponsorship)! This is one of the first such sponsorships through our new [Open Source Sponsorship program](https://klaviyo.tech/inaugurating-our-open-source-sponsorship-program-df0572cc9c18), through which we are trying to support the open source projects we depend on. While the core development and maintenance of Pants is volunteer driven, there are costs involved with maintaining and distributing such a large piece of software, costs which far too often are covered by individual volunteers. We benefit enormously from this project and want to help contribute to its ongoing success.\\n\\n{/* truncate */}\\n\\nKlaviyo chose Pants as the build system for our backend monorepo 18 months ago (read about how we chose Pants [here](https://klaviyo.tech/why-we-chose-pants-906891a98a6e)). Since then, we have been impressed not only by the power, flexibility and ease of use relative to other systems that Pants offers, but also by the amazing community that surrounds it. It is truly the Pants community that sets it apart, from active development efforts to the vibrant and welcoming Slack. This community is a prime reason we chose Pants, and is what we hope to foster with our sponsorship.\\n\\nLike all software of this size, we recognize there are costs associated with the development of Pants - from compute costs for CI, to hosting for the incredible documentation site. We are happy to help fund these costs so that the project and community can continue to grow. We hope that our initial sponsorship will prompt other commercial businesses using Pants to do the same, at any level of support, helping to support a growing Pants community for years to come."},{"id":"/2024/05/29/pants-2-21","metadata":{"permalink":"/blog/2024/05/29/pants-2-21","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-05-29-pants-2-21/index.mdx","source":"@site/blog/2024-05-29-pants-2-21/index.mdx","title":"Pants 2.21.0 is released!","description":"Photo by Joshua Kettle /","date":"2024-05-29T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":2.67,"hasTruncateMarker":true,"authors":[{"name":"Chris Burroughs","title":"Pants Maintainer","url":"https://github.com/cburroughs","imageURL":"https://github.com/cburroughs.png","key":"cburroughs","page":null}],"frontMatter":{"authors":["cburroughs"],"tags":["announcement"],"date":"2024-05-29T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Announcing Klaviyo\'s Sponsorship","permalink":"/blog/2024/06/13/announcing-klaviyo-sponsorship"},"nextItem":{"title":"Simple versioning with git tags","permalink":"/blog/2024/04/27/simple-versioning-with-git-tags"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}>\\n  Photo by [Joshua Kettle](https://unsplash.com/@joshuakettle) /\\n  [Unsplash](https://unsplash.com/photos/a-purple-and-purple-sky-with-trees-in-the-foreground-tr1nv_cLVP0)\\n</CaptionedImg>\\n\\nWe are pleased to announce Pants [2.21.0](<(https://github.com/pantsbuild/pants/tree/2.21.x/src/python/pants/notes/2.21.x.md)>), the latest release of [Pantsbuild, the scalable and ergonomic build system](https://www.pantsbuild.org/). To update, set `pants_version = \\"2.21.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/docs/getting-started).\\n\\n_Highlights in [2.21](<(https://github.com/pantsbuild/pants/tree/2.21.x/src/python/pants/notes/2.21.x.md)>) include_:\\n\\n- \u{1F9EA} All backends now support [`[test].attempts_default`](https://www.pantsbuild.org/2.21/reference/goals/test#attempts_default)\\n- \u26A1 Pants internal manipulation of Python dependencies by way of [Pex](https://docs.pex-tool.org/) is now [substantially faster](https://github.com/pantsbuild/pants/blob/2.21.x/src/python/pants/notes/2.21.x.md#python) in many cases.\\n- \u{1F4DC} The [`__defaults__`](https://www.pantsbuild.org/2.21/docs/using-pants/key-concepts/targets-and-build-files#field-default-values) symbol will now set default values for generated targets too. For instance, `__defaults__({python_source: dict(skip_black=True)})` will now apply to the `python_source` targets generated by a python_sources target, without having to write `__defaults__({(python_source, python_sources): ...})`\\n- \u267B When running in CI, Pants will output a command to [rerun only the failed tests](https://www.pantsbuild.org/2.21/reference/goals/test#show_rerun_command).\\n- \u{1F40D} All built in lockfiles are now Python 3.12 ready.\\n- \u{1F6A1} As part of regenerating lockfiles for Python 3.12, the default version of most builtin Python tools has been updated.\\n- \u{1F433} The [`cache_from` field](https://www.pantsbuild.org/2.21/reference/targets/docker_image#cache_from) on `docker_image` now supports multiple values.\\n- \u{1F3DC} The `experimental-deploy` goal now has built-in support for the [`--dry-run` option](https://www.pantsbuild.org/2.21/reference/goals/experimental-deploy#dry_run).\\n- \u{1FA9C} Scalafix can now be run by Pants using the [new `pants.backend.experimental.scala.lint.scalafix` backend](https://www.pantsbuild.org/2.21/docs/jvm/java-and-scala#fix-scala-code).\\n- \u{1F4C8} And lots of smaller features, update, bugfixes, and general improvements\\n\\n{/* truncate */}\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/tree/2.21.x/src/python/pants/notes/2.21.x.md). Pants is an open-source project, and the changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a contributor.\\n\\nWe also offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to 2.21.0, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2024/04/27/simple-versioning-with-git-tags","metadata":{"permalink":"/blog/2024/04/27/simple-versioning-with-git-tags","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-04-27-simple-versioning-with-git-tags/index.mdx","source":"@site/blog/2024-04-27-simple-versioning-with-git-tags/index.mdx","title":"Simple versioning with git tags","description":"A frequently asked question on Pants Slack is how to","date":"2024-04-27T00:00:00.000Z","tags":[],"readingTime":1.38,"hasTruncateMarker":true,"authors":[{"name":"Gregory Borodin","title":"Pants Contributor","url":"https://github.com/grihabor","imageURL":"https://github.com/grihabor.png","key":"grihabor","page":null}],"frontMatter":{"authors":["grihabor"],"tags":[]},"unlisted":false,"prevItem":{"title":"Pants 2.21.0 is released!","permalink":"/blog/2024/05/29/pants-2-21"},"nextItem":{"title":"Pants 2.20.0 is released!","permalink":"/blog/2024/03/27/pants-2-20"}},"content":"A frequently asked question on [Pants Slack](/community/getting-help) is how to\\nset a version - such as for a docker image, helm chart or Python distribution -\\nbased on git state.\\n\\n{/* truncate */}\\n\\nPants does have various solutions for this, but they tend to be too\\ncomplicated, or too limited:\\n\\n- [Generating version tags from Git](https://www.pantsbuild.org/2.20/docs/using-pants/generating-version-tags-from-git)\\n- [Custom `python_artifact()` kwargs](https://www.pantsbuild.org/2.20/docs/writing-plugins/common-plugin-tasks/custom-python-artifact-kwargs)\\n- [vcs_version](https://www.pantsbuild.org/2.20/reference/targets/vcs_version) target\\n- [Using env vars to include dynamic data in tags](https://www.pantsbuild.org/2.20/docs/docker/tagging-docker-images#using-env-vars-to-include-dynamic-data-in-tags)\\n\\nIt turns out there is a hack that elegantly solves this problem. To make it\\nwork we need one more pants feature [hidden in the\\ndocs](https://www.pantsbuild.org/2.20/docs/using-pants/key-concepts/options#pantsbootstrap-file)\\n\u2014 the `.pants.bootstrap` file. It makes it possible to automatically set the\\n`VERSION` env var right before pants starts:\\n\\n```bash title=\\".pants.bootstrap\\"\\n#!/bin/sh\\n\\nVERSION=\\"${VERSION:-$(git describe --tags --dirty --match \\"[0-9\\\\.]*\\" || echo 0.0.1)}\\"\\nexport VERSION\\n```\\n\\nNow we can use the env var everywhere!\\n\\nTo set [docker_image](https://www.pantsbuild.org/2.20/reference/targets/python_distribution) tag:\\n\\n```python file=\\"BUILD\\"\\ndocker_image(\\n    name=\\"image\\",\\n    image_tags=[env(\\"VERSION\\")],\\n)\\n```\\n\\nTo pass [docker_image](https://www.pantsbuild.org/2.20/reference/targets/python_distribution) build arg:\\n\\n```python file=\\"BUILD\\"\\ndocker_image(\\n    name=\\"image\\",\\n    extra_build_args=[\\"VERSION=\\" + env(\\"VERSION\\")],\\n)\\n```\\n\\nTo set [python_distribution](https://www.pantsbuild.org/2.20/reference/targets/python_distribution) version:\\n\\n```python file=\\"BUILD\\"\\npython_distribution(\\n    name=\\"mydist\\",\\n    provides=python_artifact(\\n        name=\\"mydist\\",\\n        version=env(\\"VERSION\\"),\\n    ),\\n)\\n```\\n\\nTo set [helm_chart](https://www.pantsbuild.org/2.20/reference/targets/helm_chart) version:\\n\\n```python file=\\"BUILD\\"\\nhelm_chart(\\n    version=env(\\"VERSION\\"),\\n)\\n```"},{"id":"/2024/03/27/pants-2-20","metadata":{"permalink":"/blog/2024/03/27/pants-2-20","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-03-27-pants-2-20/index.mdx","source":"@site/blog/2024-03-27-pants-2-20/index.mdx","title":"Pants 2.20.0 is released!","description":"Photo by Jongsun Leed /","date":"2024-04-16T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":2.29,"hasTruncateMarker":true,"authors":[{"name":"Chris Burroughs","title":"Pants Maintainer","url":"https://github.com/cburroughs","imageURL":"https://github.com/cburroughs.png","key":"cburroughs","page":null}],"frontMatter":{"authors":["cburroughs"],"tags":["announcement"],"date":"2024-04-16T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Simple versioning with git tags","permalink":"/blog/2024/04/27/simple-versioning-with-git-tags"},"nextItem":{"title":"Inspecting dependency inference results","permalink":"/blog/2024/01/25/inspecting-dependency-inference-results"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}>\\n  Photo by [Jongsun Leed](https://unsplash.com/@sarahleejs) /\\n  [Unsplash](https://unsplash.com/photos/moon-eclipse-F-pSZO_jeE8)\\n</CaptionedImg>\\n\\nWe are pleased to announce Pants 2.20.0, the latest release of [Pantsbuild, the scalable and ergonomic build system](https://www.pantsbuild.org/). To update, set `pants_version = \\"2.20.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/docs/getting-started).\\n\\n_Highlights in 2.20 include_:\\n\\n- \u26A1 Support for the Ruff formatter, for both `BUILD` files and normal Python files.\\n- \u{1F512} Built-in support for [Terraform lockfiles](https://www.pantsbuild.org/2.20/docs/terraform#lockfiles).\\n- \u{1F4C1} Support for [more remote-caching providers](https://www.pantsbuild.org/2.20/docs/using-pants/remote-caching-and-execution/remote-caching): file system and GitHub Actions Cache.\\n- \u{1FAA5} New helpers for [defining \\"adhoc\\" code-quality tools](https://www.pantsbuild.org/2.20/reference/targets/code_quality_tool), without requiring a full plugin.\\n- \u2615 JVM third-party artifacts [can now be read from `pom.xml` files](https://www.pantsbuild.org/2.20/reference/targets/jvm_artifacts), and other related improvements.\\n- \u{1F43F} Go 1.22 can now be used.\\n- \u{1F95A} Several features of the [Pex](https://docs.pex-tool.org/) tool are now exposed by Pants including [`sh_boot`](https://www.pantsbuild.org/2.20/reference/targets/pex_binary#sh_boot) [`executable`](https://www.pantsbuild.org/2.20/reference/targets/pex_binary#executable), and [`check`](https://www.pantsbuild.org/2.20/reference/targets/pex_binary#check).\\n- \u26A0 Pex\'s [`emit_warnings`](https://www.pantsbuild.org/2.20/reference/subsystems/pex#emit_warnings) now works as advertised and comes with a [global option](https://www.pantsbuild.org/2.20/reference/subsystems/pex#emit_warnings).\\n- \u{1F40B} Experimental support for [Podman](https://podman.io/) with `pants.backend.experimental.docker.podman`.\\n- \u{1F4C8} And lots of smaller features, bugfixes, and general improvements\\n\\n{/* truncate */}\\n\\nCheck out the [full release notes](https://github.com/pantsbuild/pants/tree/2.20.x/src/python/pants/notes/2.20.x.md). Pants is an open-source project, and the changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a contributor.\\n\\nWe also offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\nTo see Pants in action, explore our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to 2.20.0, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2024/01/25/inspecting-dependency-inference-results","metadata":{"permalink":"/blog/2024/01/25/inspecting-dependency-inference-results","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-01-25-inspecting-dependency-inference-results/index.mdx","source":"@site/blog/2024-01-25-inspecting-dependency-inference-results/index.mdx","title":"Inspecting dependency inference results","description":"Photo by [Agence","date":"2024-01-25T00:00:00.000Z","tags":[{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"}],"readingTime":5.78,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":["concepts"]},"unlisted":false,"prevItem":{"title":"Pants 2.20.0 is released!","permalink":"/blog/2024/03/27/pants-2-20"},"nextItem":{"title":"Pants 2.19.0 is released!","permalink":"/blog/2024/01/24/pants-2-19"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Agence\\n  Olloweb](https://unsplash.com/photos/magnifying-glass-near-gray-laptop-computer-d9ILr-dbEdg)\\n  /\\n  [Unsplash](https://unsplash.com/photos/magnifying-glass-near-gray-laptop-computer-d9ILr-dbEdg)\\n</CaptionedImg>\\n\\nAn important distinguishing feature of Pants v2 is its ability to automatically [infer your code\'s internal and external dependencies](https://www.pantsbuild.org/blog/2022/10/27/why-dependency-inference). The information about those inferences is available via the `dependencies` and `peek` goals, so that metadata about what modules import from other modules is always readily accessible to you.\\n\\n{/* truncate */}\\n\\nWhile managing a codebase in a [Pants-supported language](https://www.pantsbuild.org/2.18/docs/introduction/welcome-to-pants#which-languages-and-frameworks-does-pants-support) (e.g. Python, Java, Scala, etc...), it can sometimes be useful dig deeper and explore the inferred dependencies in order to compare them to your source code\'s import statements. This can be particularly useful for large modules with many imports, where it\'s very easy to miss an omitted dependency or an inferred dependency that should have been ignored.\\n\\nYou can start your exploration with one of the lesser known goals, [`python-dump-source-analysis`](https://www.pantsbuild.org/2.18/reference/goals/python-dump-source-analysis). This goal will dump the dependency analysis for the Python source code build targets.\\n\\nThis command may be used to compliment any static code analysis tooling you may already employ such as [semgrep](https://semgrep.dev/) or [flake8](https://flake8.pycqa.org/en/latest/), as they can only parse your modules semantically and often won\'t be able to link individual imports to build targets in your codebase.\\n\\nIn order to run this goal, you need to enable the `\\"pants.backend.experimental.python\\"` backend:\\n\\n```shell-session\\n$ pants \\\\\\n  --backend-packages=\\"pants.backend.experimental.python\\" \\\\\\n  python-dump-source-analysis \\\\\\n  --analysis-flavor=raw_dependency_inference \\\\\\n  cheeseshop/repository/repository.py \\\\\\n  | jq\\n```\\n\\nIn the command output you can see the list of all `import` statements, including the standard library imports (`json` and `typing.Optional`), first-party (`cheeseshop.repository.package.Package`), and third-party (`requests`) imports. This saves you from either relying on fragile `grep`-based tooling or complex AST parsers to identify and reason about the `import` statements.\\n\\n```\\n[\\n  {\\n  ...\\n    \\"identified\\": {\\n      \\"imports\\": {\\n        \\"json\\": {\\n          \\"lineno\\": 1,\\n          \\"weak\\": false\\n        },\\n        \\"typing.Optional\\": {\\n          \\"lineno\\": 3,\\n          \\"weak\\": false\\n        },\\n        \\"requests\\": {\\n          \\"lineno\\": 5,\\n          \\"weak\\": false\\n        },\\n        \\"cheeseshop.repository.package.Package\\": {\\n          \\"lineno\\": 9,\\n          \\"weak\\": false\\n        }\\n      }\\n  ...\\n```\\n\\nYou can also take a look at the resolve status for every `import` statement. For instance, unownable imports are those that cannot be owned by a build target; these are usually standard library imports. Unowned imports are those that Pants could not resolve; this could be due to an attempt to import a non-existing first party module or a third party package that was not listed in the project requirements and Pants isn\'t aware of it.\\n\\nKeep in mind that Pants would only infer dependencies when it is safe to - as it checks for ambiguity. For instance, if you have multiple package requirements declared in the same Python resolve, e.g. `requests==2.25.1` and `requests==2.22.0`, Pants won\'t infer a dependency and will instead provide a suggestion for how to disambiguate. Unambiguous imports are those that are owned by exactly one build target whereas ambiguous ones are those that cannot be linked to a specific build target. See a partial output of the command below:\\n\\n```\\n    ...\\n    \\"resolved\\": {\\n      \\"resolve_results\\": {\\n        \\"json\\": {\\n          \\"status\\": \\"ImportOwnerStatus.unownable\\",\\n          \\"address\\": []\\n        },\\n        \\"typing.Optional\\": {\\n          \\"status\\": \\"ImportOwnerStatus.unownable\\",\\n          \\"address\\": []\\n        },\\n        \\"requests\\": {\\n          \\"status\\": \\"ImportOwnerStatus.unambiguous\\",\\n          \\"address\\": [\\n            \\"requirements#requests\\"\\n          ]\\n        },\\n        \\"cheeseshop.repository.package.TypoInModule\\": {\\n          \\"status\\": \\"ImportOwnerStatus.unowned\\",\\n          \\"address\\": []\\n        },\\n        \\"cheeseshop.repository.parsing.exceptions.PackageNotFoundError\\": {\\n          \\"status\\": \\"ImportOwnerStatus.unambiguous\\",\\n          \\"address\\": [\\n            \\"cheeseshop/repository/parsing/exceptions.py\\"\\n          ]\\n        }\\n      },\\n    ...\\n```\\n\\nMoreover, Pants can infer a target\'s dependencies based on strings that look like dynamic dependencies, such as Django settings files expressing dependencies as strings or `pytest` plugins listed in the `pytest_plugins` variable in a test module or a `conftest.py` file. These dependencies are considered to be \\"weak\\" and are reported separately:\\n\\n```shell-session\\n$ pants python-dump-source-analysis \\\\\\n  --analysis-flavor=raw_dependency_inference \\\\\\n  cheeseshop/repository/repository.py > sources.json\\n\\n$ jq -r \'.[].identified.imports\' sources.json \\\\\\n    | jq \'map_values(select(.weak == true))\'\\n{\\n  \\"cheeseshop.repository.properties\\": {\\n    \\"lineno\\": 12,\\n    \\"weak\\": true\\n  }\\n}\\n```\\n\\nWith this goal, you can also check if a guarded import was ignored. For instance, the import in:\\n\\n```python\\ntry:\\n  import foo.bar\\nexcept ImportError:\\n  pass\\n```\\n\\nis also going to be flagged as \\"weak\\". If the imported modules do not exist (e.g. there\'s a typo in a module path) and therefore won\'t be found by Pants, they will be marked as \\"weak_ignore\\". This may help you identify any imports that are always ignored.\\n\\nSince you are able to report the string-based imports, it will be easier to identify and ignore certain imports that are picked up by accident. This can happen, for instance, when a string literal with a file path may be identical to a path of an existing module. Once you have identified the dependencies parsed from the string literals, you should check whether they have been ignored as their status will be \\"weak_ignore\\". When appropriate, you can make sure that Pants will ignore unwanted dependencies by using the `# pants: no-infer-dep` pragma.\\n\\nHaving all this information accessible to you, there are quite a few things you may do with it. For instance, you could estimate how many modules rely on a particular Python standard library module which you\'d like to deprecate (for instance, you may be evaluating migrating to `ujson` from `json`).\\n\\nYou could also evaluate how many code members are imported from the modules for code quality analytics. For instance, having to import lots of members from the same module may suggest a poor code structure. To illustrate, this is how the import line `from cheeseshop.repository.parsing.casts import from_dict, from_bool` is going to be parsed:\\n\\n```\\n    {\\n        \\"cheeseshop.repository.parsing.casts.from_dict\\": {\\n          \\"status\\": \\"ImportOwnerStatus.unambiguous\\",\\n          \\"address\\": [\\n            \\"cheeseshop/repository/parsing/casts.py\\"\\n          ]\\n        },\\n        \\"cheeseshop.repository.parsing.casts.from_bool\\": {\\n          \\"status\\": \\"ImportOwnerStatus.unambiguous\\",\\n          \\"address\\": [\\n            \\"cheeseshop/repository/parsing/casts.py\\"\\n          ]\\n    }\\n```\\n\\nKnowing the line numbers of the `import` statements, you can ban having lazy imports in your modules (as for Pants it doesn\'t matter whether an import statement is at the beginning of a file or inside a function definition in the last few lines of a file) if that\'s what your coding conventions suggest. And since the dependencies declared manually in the BUILD files metadata are reported separately from those that are inferred automatically by scanning the source code, it should be easier to audit them over time as it is possible that after code changes, a module may not any longer have another module or a third party requirement as a dependency.\\n\\nIf you have a large codebase, and it\'s important for you to make sure that dependency inference reports only truly relevant dependencies, it\'s definitely worth trying to run this command. The details of the dependency inference may make certain tooling you use to collect the imports obsolete, so that you could take advantage of the functionality that Pants provides out-of-the-box. This goal will also most certainly help you to figure out why a particular module is a dependency of another one as it may not be obvious: was it picked up due to a string literal, thanks to a manual dependency declared, or because of an import statement buried in the middle of the module?\\n\\nHappy analyzing!"},{"id":"/2024/01/24/pants-2-19","metadata":{"permalink":"/blog/2024/01/24/pants-2-19","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2024-01-24-pants-2-19/index.mdx","source":"@site/blog/2024-01-24-pants-2-19/index.mdx","title":"Pants 2.19.0 is released!","description":"Photo by [Erol","date":"2024-01-24T00:00:00.000Z","tags":[],"readingTime":4.71,"hasTruncateMarker":true,"authors":[{"name":"Tom Solberg","title":"Pants Maintainer (and plugin developer)","url":"https://github.com/tgolsson","imageURL":"https://github.com/tgolsson.png","key":"tomsolberg","page":null}],"frontMatter":{"authors":["tomsolberg"],"tags":[]},"unlisted":false,"prevItem":{"title":"Inspecting dependency inference results","permalink":"/blog/2024/01/25/inspecting-dependency-inference-results"},"nextItem":{"title":"Pants 2.18.0 is released!","permalink":"/blog/2023/11/14/pants-2.18.0-is-released"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}>\\n  Photo by [Erol\\n  Ahmed](https://unsplash.com/@erol?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)\\n  /\\n  [Unsplash](https://unsplash.com/photos/mountains-covered-with-snow-d3pTF3r_hwY?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)\\n</CaptionedImg>\\n\\nWe\'re pleased to announce Pants 2.19.0, the latest release of [Pantsbuild, the scalable and ergonomic build system](https://www.pantsbuild.org/). To update, set `pants_version = \\"2.19.0\\"` in your `pants.toml`. If you\'re not using Pants yet, [get started now](https://www.pantsbuild.org/docs/getting-started).\\n\\n_Highlights in 2.19 include_:\\n\\n- New backends: `semgrep` and `openapi-format`\\n- Test retries for flaky Python tests\\n- `buildx` support in the Docker backend\\n- Using `parametrize` to set multiple fields in tandem\\n- And lots of smaller features, bugfixes, and general improvements\\n\\n{/* truncate */}\\n\\nKeep reading to see more, or check the [full release notes](https://github.com/pantsbuild/pants/tree/2.19.x/src/python/pants/notes/2.19.x.md). Pants is an open-source project, and the below changes are all contributed by our community. If you want to see something more in the next changelog, join us on [GitHub](https://github.com/pantsbuild/pants) and become a contributor.\\n\\nWe also offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild). These help pay for the ongoing development and hosting costs, and are managed by the Pants Build non-profit organization.\\n\\n### New backends and subsystems\\n\\nIn this release, we welcome two new backends and one new subsystem.\\n\\n[The new `openapi_format` backend](https://www.pantsbuild.org/2.19/reference/subsystems/openapi-format) supports running [openapi-format](https://github.com/thim81/openapi-format) to format `openapi_...` targets. You can enable this by adding `pants.backend.experimental.openapi.lint.openapi_format` to the list of active backends.\\n\\n[The new `semgrep` backend](https://www.pantsbuild.org/2.19/reference/subsystems/semgrep) supports running [Semgrep](https://semgrep.dev) as a local linter on all files that Pants knows about (any target with a `source` or `sources` field). Configuration files are automatically discovered. You can enable this by adding `pants.backend.experimental.tools.semgrep` to the list of active backends.\\n\\n[The new `[system-binaries]` subsystem](https://www.pantsbuild.org/2.19/reference/subsystems/system-binaries) allows controlling where Pants searches for binaries like `bash`, `zip`, `tar` that are used as part of normal operation. To change these paths set [the `system_binaries_paths` option](https://www.pantsbuild.org/2.19/reference/subsystems/system-binaries#system_binary_paths) as appropriate, potentially using the `<PATH>` special value. This can also be changed for specific [environments](https://www.pantsbuild.org/2.19/docs/using-pants/environments) using the `system_binaries_system_binary_paths` field.\\n\\n### Built-in test retries (for Python)\\n\\nPython tests can now be [attempted multiple times](https://www.pantsbuild.org/2.19/docs/using-pants/using-pants-in-ci#tip-automatically-retry-failed-tests), if they fail. This can help with limiting the impact of flaky tests. For instance, to require tests to fail three times before the overall `pants test` goal fails, set [`[test].attempts_default = 3`](https://www.pantsbuild.org/2.19/reference/goals/test#attempts_default). In this case, a very flaky test might fail on the first and second runs but finally pass on the third run, and thus the overall Pants invocation would pass.\\n\\nThis functionality can be added to any other language with not much extra work. Do you want automatic retries for Scala, Go, or another language Pants supports? Check out the [tracking issue](https://github.com/pantsbuild/pants/issues/20378) and come chat with us in [#development on Slack](https://docs.google.com/forms/d/e/1FAIpQLSf9zgf-MXRnVDJbrVEST3urqneq7LCcy0zw8qU-GH4hPMn52A/viewform).\\n\\n### Docker improvements\\n\\nThe [docker backend](https://www.pantsbuild.org/2.19/docs/docker) now has explicit support for using [`buildx` (and thus BuildKit)](https://github.com/docker/buildx#buildx), via [the new `use_buildx` option](https://www.pantsbuild.org/2.19/reference/subsystems/docker#use_buildx). This also allows adding few additional fields for [`docker_image` targets](https://www.pantsbuild.org/2.19/reference/targets/docker_image), for `buildx`-specific functionality:\\n\\n- [`cache_from` and `cache_to`](https://www.pantsbuild.org/2.19/docs/docker#external-cache-storage-backends) for using external cache storage backends\\n- [`output`](https://www.pantsbuild.org/2.19/reference/targets/docker_image#output) to control how/where `buildx` outputs an image when running `pants package ::`\\n\\n### Improved `parametrize` for tied options\\n\\n[The `parametrize` helper](https://www.pantsbuild.org/2.19/docs/using-pants/key-concepts/targets-and-build-files#field-default-values#parametrizing-targets) now supports parametrizing multiple fields together, in lock step. For instance:\\n\\n```python\\n# Creates two targets:\\n#\\n# example:tests@parametrize=py2\\n# example:tests@parametrize=py3\\n\\npython_test(\\n    name=\\"tests\\",\\n    source=\\"tests.py\\",\\n    **parametrize(\\"py2\\", interpreter_constraints=[\\"==2.7.*\\"], resolve=\\"lock-a\\"),\\n    **parametrize(\\"py3\\", interpreter_constraints=[\\">=3.6,<3.7\\"], resolve=\\"lock-b\\"),\\n)\\n```\\n\\nIn addition, `parametrize` can now be used with a single value (`field=parametrize(\\"for-consistency\\")`), and now works on target generations in more cases (particularly those with \\"plugin\\" fields).\\n\\n### Other noteworthy changes\\n\\n- New versions of [the `get-pants.sh` script](https://www.pantsbuild.org/2.19/docs/getting-started/installing-pants) install to `~/.local/bin`, not `~/bin`. Remember to update your CI pipelines!\\n- Environment variables that aren\'t valid UTF-8 no longer cause Pants to crash (note, `PANTS_...` environment variables that Pants needs to read but aren\'t UTF-8 will be ignored).\\n- Reference documentation for subsystem options includes how to set them in `pants.toml`, in addition to the environment variable and CLI arguments.\\n- The `.pids/` internal directory is now under `.pants.d/` by default, rather that adjacent to it (this can be controlled via [the `[GLOBAL].pants_subprocessdir` option](https://www.pantsbuild.org/2.19/reference/global-options#pants_subprocessdir)).\\n\\n## Much more!\\n\\nPants 2.19 involved several months of work from dozens of contributors, along with testing and feedback from the whole community. You can read the [full notes](https://github.com/pantsbuild/pants/tree/2.19.x/src/python/pants/notes/2.19.x.md). To update, set pants_version = \\"2.19.0\\" in your pants.toml.\\n\\nIf you\'re not using Pants to build, format, test (and more) your codebase, [get started now](https://www.pantsbuild.org/2.19/docs/getting-started) - or take it to the next level [as a contributor](https://www.pantsbuild.org/2.19/docs/contributions)."},{"id":"/2023/11/14/pants-2.18.0-is-released","metadata":{"permalink":"/blog/2023/11/14/pants-2.18.0-is-released","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-11-14-pants-2.18.0-is-released/index.mdx","source":"@site/blog/2023-11-14-pants-2.18.0-is-released/index.mdx","title":"Pants 2.18.0 is released!","description":"Photo by [Joseph","date":"2023-11-14T00:00:00.000Z","tags":[],"readingTime":6.2,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":[]},"unlisted":false,"prevItem":{"title":"Pants 2.19.0 is released!","permalink":"/blog/2024/01/24/pants-2-19"},"nextItem":{"title":"Pants 2.17.0 is released!","permalink":"/blog/2023/08/30/pants-2-17-0-is-released"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}>\\n  Photo by [Joseph\\n  Barrientos](https://unsplash.com/@jbcreate_?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'re pleased to announce Pants 2.18.0, the latest release of [Pantsbuild, the scalable and ergonomic build system](https://www.pantsbuild.org/).\\nTo update, set `pants_version = \\"2.18.0\\"` in your `pants.toml`. If you\'re not using Pants to build, format, test (and more) your codebase, [get started now](https://www.pantsbuild.org/docs/getting-started).\\n\\nHighlights in 2.18.0 include:\\n\\n    Even more improvements to AWS Lambda and Google Cloud Function support, including simpler configuration and support for AWS Lambda Layers.\\n    Many more options can now be controlled when building Docker images.\\n    Significant feature work and bug fixes to \\"deploy\\" backends like Helm and Terraform.\\n\\nThere\'s [much more](https://github.com/pantsbuild/pants/blob/2.18.x/src/python/pants/notes/2.18.x.md), too: performance optimizations, new backends, bug fixes and features!\\n\\nStarting from the previous 2.17.0 release, you can now [support Pants financially](https://www.pantsbuild.org/docs/sponsorship).\\n\\nPants is an open-source project that is not owned nor controlled by any one company or organization, and does incur some expenses. These expenses are managed by Pants Build, a non-profit that was established for this purpose. This non-profit\'s only source of revenue is sponsorship by individuals and companies that support Pants.\\n\\nWe offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/docs/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild).\\n\\n## Experimental backends!\\n\\nDid you know that Pants has a lot of \\"experimental\\" backends? These include support for languages, tools and ecosystems that are still in preview. The [documentation of backends](https://www.pantsbuild.org/v2.18/docs/enabling-backends) now lists all these backends.\\nPlease go check it out, try backends relevant to you and let us know how they go for your use cases, [report bugs](https://www.pantsbuild.org/v2.18/docs/getting-help) and/or [submit fixes](https://www.pantsbuild.org/v2.18/docs/contributor-overview)! People like you trying them is how we can perfect the features and squash the bugs to stabilize them.\\n\\n## Functions-as-a-service improvements for Python\\n\\nPants includes support for building function-as-a-service artifacts for Python, via the [`pants.backend.awslambda.python`](https://www.pantsbuild.org/v2.18/docs/awslambda-python) and [`pants.backend.google_cloud_function.python`](https://www.pantsbuild.org/v2.18/docs/google-cloud-function-python) backends. These backends make it easy to generate zip artifacts appropriate for uploading to cloud services.\\n\\nThese backends had significant improvements to their start-up performance and size in 2.17, and the improvements have continued in 2.18:\\n\\n- The [new `python_aws_lambda_layer` target](https://www.pantsbuild.org/v2.18/docs/awslambda-python#building-a-lambda-layer) can be used to build Layers for AWS Lambda. For instance, this allows putting third-party requirements from PyPI into a layer, and only first party-sources from your repository into the function code, making for faster builds and uploads. (For consistency, the `python_awslambda` target has been renamed to `python_aws_lambda_function`.)\\n  The `runtime` field is no longer necessary when the interpreter constraints unambiguously refer to an entire single major version. For instance, with `[python].interpreter_constraints = [\\"==3.11.*\\"]` in `pants.toml`, one doesn\'t need to specify `runtime=\\"python3.11\\"` to `python_aws_lambda_function` or `runtime=\\"python311\\"` to `python_google_cloud_function`, as it will be inferred.\\n- For AWS Lambda targets, the `complete_platforms` argument now has default values provided by Pants, which gives more reliable builds, especially when building on a different platform than the AWS Lambda itself. This change also means that only one of the `complete_platforms` or `platforms` fields should be provided.\\n\\n## Simplification of Python tool lockfiles\\n\\nYou now install custom versions of Python-based tools (such as Pytest, MyPy and so on) by pointing the tool\'s `install_from_resolve` option at a regular Python [resolve](https://www.pantsbuild.org/docs/python-lockfiles).\\nYou create the lockfiles for these resolves just as you would for your own code\'s resolves. You can have one resolve per tool, or one resolve for multiple tools, and you can even install tools from the same resolve you use for your code.\\nThis is useful when you have tools that also provide runtime libraries, such as Pytest.\\nSee [the documentation](https://www.pantsbuild.org/docs/python-lockfiles#lockfiles-for-tools) for more details.\\n\\nNote that this means that you can no longer `export` the built-in, default lockfile for a tool, as that is not represented by a named resolve. If you need to export Python tool virtualenvs for consumption outside of Pants, e.g., by an IDE, you must first create a resolve for them.\\n\\n## Infrastructure-as-code iteration\\n\\nPants has nascent support for describing and deploying infrastructure via the [`pants.backend.experimental.helm`](https://www.pantsbuild.org/v2.18/docs/helm-overview) and `pants.backend.experimental.terraform` backends. These have seen several improvements in 2.18.0:\\n\\n- Improved testing with [`helm_unittest_tests`](https://www.pantsbuild.org/v2.18/docs/helm-overview#helm-unit-tests) target as it can now be automatically created by the `tailor` goal, and supports [snapshot testing](https://www.pantsbuild.org/v2.18/docs/helm-overview#snapshot-testing) via the new `generate-snapshots` goal\\n- Support for running Kubeconform on Helm targets via the [new `pants.backend.experimental.helm.check.kubeconform` backend](https://www.pantsbuild.org/v2.18/docs/helm-kubeconform)\\n- The [new `terraform_deployment` target](https://www.pantsbuild.org/v2.18/docs/reference-terraform_deployment) allows configuring a `terraform_module` to be deployed with [the `experimental-deploy` goal](https://www.pantsbuild.org/v2.18/docs/reference-experimental-deploy).\\n- A new `pants.backend.experimental.terraform.lint.tfsec` backend has been added to run the `tfsec` linter as part of the `lint` goal.\\n  In addition to those major improvements, many smaller bug fixes and features are included in 2.18.0.\\n\\n## Docker finesse\\n\\nThe `pants.backend.docker` backend now supports many more options to control how images are built:\\n\\n- on [the `[docker] subsystem`](https://www.pantsbuild.org/v2.18/docs/reference-docker): `build_hosts`, `build_no_cache`\\n- on [the `docker_image` target]: `build_network`, `build_platform`, `extra_build_hosts`\\n\\nThese new options allow, for instance, more easily building a x86_64 image while running on an arm64 host.\\n\\n## More visible visibility\\n\\n[The `pants.backend.experimental.visibility` backend](https://www.pantsbuild.org/v2.18/docs/validating-dependencies) now also runs as a linter, such as when running `pants lint ::`, to report all visibility violations at one time.\\n\\nThis backend allows applying rules and restrictions to which targets can depend on other targets, for example, a repository with two applications and some shared library code can use the visibility backend to enforce that code in one application cannot depend on code in the other application.\\n\\n## Finding paths between addresses that expand to multiple targets\\n\\nPants previously allowed finding all paths in the dependency graph between two individual targets, like a `python_source` and a `python_test`. You can now find all paths that exist between multiple targets, for instance, by passing a directory address.This will help you to answer various questions such as \\"How is this Python module connected to a Python package, if at all?\\" or \\"How tightly are two Java packages connected?\\".\\n\\nThis also enables sophisticated dependency graph analytics. By listing all the paths in the repo, for example, between sources and tests, one can find the source modules that have most paths leading to tests, identify very long paths, and many more.\\n\\nFor example, this command will count all paths between all source and all test targets in a repository:\\n\\n```shell-session\\n$ pants paths --from=project/tests:: --to=project/src:: | jq length\\n42\\n```\\n\\n## Much more!\\n\\nPants 2.18 involved several months of work from dozens of contributors, thank you everyone!\\nSee the [release notes](https://github.com/pantsbuild/pants/blob/2.18.x/src/python/pants/notes/2.18.x.md) for all of the new features and fixes.\\n\\nTo update, set `pants_version = \\"2.18.0\\"` in your pants.toml. If you\'re not using Pants to build, format, test (and more) your codebase, get started now."},{"id":"/2023/08/30/pants-2-17-0-is-released","metadata":{"permalink":"/blog/2023/08/30/pants-2-17-0-is-released","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-08-30-pants-2-17-0-is-released/index.mdx","source":"@site/blog/2023-08-30-pants-2-17-0-is-released/index.mdx","title":"Pants 2.17.0 is released!","description":"Photo by [Ankush","date":"2023-08-30T00:00:00.000Z","tags":[],"readingTime":3.94,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":[]},"unlisted":false,"prevItem":{"title":"Pants 2.18.0 is released!","permalink":"/blog/2023/11/14/pants-2.18.0-is-released"},"nextItem":{"title":"Sharing Pants plugins","permalink":"/blog/2023/07/03/sharing-pants-plugins"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Ankush\\n  Minda](https://unsplash.com/@an_ku_sh?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'re pleased to announce Pants 2.17.0, the latest release of Pants Build, the scalable and ergonomic build system. To update, set `pants_version = \\"2.17.0\\"` in your `pants.toml`. See upgrade tips for more information.\\n\\nVersion 2.17.0 comes quickly after 2.16.0, which was one of our biggest releases ever, but still contains many notable changes, along side bug fixes, documentation, and performance improvements:\\n\\n- You can now [support Pants financially](https://www.pantsbuild.org/docs/sponsorship).\\n  Pants is an open-source project that is not owned or controlled by any one company or organization, and does incur some expenses. These expenses are managed by Pants Build, a non-profit that was established for this purpose. This non-profit\'s only source of revenue is sponsorship by individuals and companies that use Pants.\\n  We offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/docs/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild).\\n- The [`pants` launcher binary](https://github.com/pantsbuild/scie-pants) is now the recommended way to run Pants and use of a `./pants` shell script in a repository is deprecated. See the [Pants installation instructions](https://www.pantsbuild.org/docs/installation) for additional information on how to migrate to this way or running Pants.\\n- The default version of Pip that is used for resolving requirements and generating lockfiles has been bumped to `v23.1.2` which performs faster in backtracking scenarios when there are package version conflicts.\\n- Support for [Taplo](https://github.com/tamasfe/taplo), a TOML toolkit written in Rust, has been added and can now be used to format TOML files. To use, add `\\"pants.backend.tools.taplo\\"` to the list of `[GLOBAL].backend_packages` in `pants.toml`. See an example usage below:\\n\\n```shell-session\\n$ pants fmt pants*.toml\\n10:24:29.91 [WARN] Completed: Format with taplo - taplo made changes.\\n  pants.ci.toml\\n  pants.toml\\n+ taplo made changes.\\n```\\n\\n- Pants 2.17 ships with a new Rust-based, multithreaded, in-process [dependency parser](https://www.pantsbuild.org/v2.17/docs/reference-python-infer#use_rust_parser) for Python. This greatly speeds up dependency parsing compared to the previous implementation. To try the new parser, set `use_rust_parser` in `[python-infer]` in `pants.toml`. You may want to run `pants peek :: > before.json` and then `pants --python-infer-use-rust-parser peek :: > after.json` and compare the two results before switching to the new parser.\\n- The serverless `python_awslambda` or `python_google_cloud_function` targets now support a new `\'zip\'` layout, as recommended by the cloud vendors. This layout gives smaller packages and faster cold starts than the existing Lambdex layout, and will become the default in 2.18. See the docs [for `python_awslambda`](https://www.pantsbuild.org/v2.17/docs/awslambda-python#migrating-from-pants-216-and-earlier) and [for `python_google_cloud_function`](https://www.pantsbuild.org/v2.17/docs/google-cloud-function-python#migrating-from-pants-216-and-earlier).\\n- You can now use the `pants` binary launcher \xa0from anywhere in your repository, not just the project root. This also means that Pants will respect the address specs passed on the command line relative to the current working directory rather than the build root. See this in action in our [example-python](https://github.com/pantsbuild/example-python) repository:\\n\\n```shell-session\\n$ pwd\\n/home/user.name/example-python/helloworld/translator\\n\\n# target addresses are resolved relative to the build root\\n$ pants --pants-version=2.16.0 list :\\n//:reqs\\n//:reqs#ansicolors\\n...\\n\\n# target addresses are resolved relative to the current working directory\\n$ pants --pants-version=2.17.0 list :\\nhelloworld/translator/__init__.py:lib\\nhelloworld/translator/translator.py:lib\\n```\\n\\n- More features have been added in the work-in-progress JavaScript backend: there\'s support for `yarn@v1` and `Node.js` subpath imports as well as the `pnpm` package manager. There\'s also a new [example-javascript](https://github.com/pantsbuild/example-javascript) repository that you can use to explore JavaScript support in Pants. The Pants maintainers would appreciate any feedback from the community to help guide our JavaScript related development efforts.\\n\\nSee the full [changelog](https://github.com/pantsbuild/pants/blob/release_2.17.0/src/python/pants/notes/2.17.x.md) for more changes, along with our [plugin upgrade guide](https://www.pantsbuild.org/docs/plugin-upgrade-guide).\\n\\n---\\n\\nTry out one of our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-javascript](https://github.com/pantsbuild/example-javascript)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)\\n\\nPants wouldn\'t be possible without everyone who contributed to 2.17.0, including everyone who shared feedback on changes and who tested release candidates! Thank you very much!"},{"id":"/2023/07/03/sharing-pants-plugins","metadata":{"permalink":"/blog/2023/07/03/sharing-pants-plugins","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-07-03-sharing-pants-plugins/index.mdx","source":"@site/blog/2023-07-03-sharing-pants-plugins/index.mdx","title":"Sharing Pants plugins","description":"Photo by [Elaine","date":"2023-07-03T00:00:00.000Z","tags":[{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"}],"readingTime":4.16,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":["concepts"]},"unlisted":false,"prevItem":{"title":"Pants 2.17.0 is released!","permalink":"/blog/2023/08/30/pants-2-17-0-is-released"},"nextItem":{"title":"Pants 2.16.0 is here!","permalink":"/blog/2023/06/16/pants-2-16-0"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Elaine\\n  Casap](https://unsplash.com/@ecasap?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nIf you need to make some functionality available to all engineers in your company, you can author and release a Pants plugin (either internally or via a public PyPI index) independently of the rest of the codebase...\\n\\n{/* truncate */}\\n\\n---\\n\\nPants v2 has been designed with extensibility in mind: the functionality of Pants that is available out of the box uses the very same building blocks that developers would use when writing their custom plugins using the standard Plugin API. For instance, you could add support for a new linter, a new target type, or even a new goal. You can submit your contributions to the Pants repository itself so that it becomes part of the core product if you think the functionality is generic enough so that other Pants users would be able to benefit from it. If the functionality is very specific to a particular organization, it may make little sense to distribute it as a core part of Pants so you will likely want to keep it internal to your company. In this blog post, we\'ll explore writing and publishing Pants plugins.\\n\\nWhen writing internal plugins, you will most likely store them in your main codebase with the rest of your company\'s code. We refer to such plugins as \\"in-repo plugins\\": the plugin functionality becomes available internally to the repository developers and conventionally lives in a directory called `pants-plugins`. Making your custom plugin functionality available in the repository is trivial; you only need to specify the path to your plugin\'s top-level folder using the `[GLOBAL].pythonpath` option in the `pants.toml` file:\\n\\n```toml title=\\"pants.toml\\"\\n[GLOBAL]\\npythonpath = [\\"%(buildroot)s/pants-plugins\\"]\\n```\\n\\nMaintaining an in-repo plugin works great when following a monorepository approach when all of the company\'s code is stored in a single codebase. It is possible, however, that a company\'s code is split across multiple codebases, each having Pants build system enabled. For instance, one codebase may contain all the shared libraries and applications that are part of the core business product, and another one is used specifically for machine learning (ML) related development. They may have conflicting Pants version requirements, Python interpreter constraints, or drastically different CI/CD pipelines that you may want to keep separate. In either case, when you have some plugin functionality that you would like to make available across multiple Pants projects, this can be done by publishing your plugin to the PyPI or an internal, private package repository (optionally, extracting your plugin into a separate Git repository).\\n\\nThis means that if you need to make some functionality available to all engineers in your company, you can author and release a Pants plugin (either internally or via a public PyPI index) independently of the rest of the codebase. This gives you a chance to get started immediately and iterate very quickly as you won\'t be tied to the Pants release cycle - bugs can be fixed promptly following a new release cut. Once the plugin is stable and is proven to provide the functionality you need, you may consider contributing it to the Pants project itself to be able to receive community contributions, if you\'d like.\\n\\nConsuming published plugins is easy: you only need to list them in the \xa0`[GLOBAL].plugins` option in the `pants.toml` file. To demonstrate using a published Pants plugin, let\'s enable a sample [community plugin](https://github.com/AlexTereshenkov/pants-dep-graph) that was published on the [PyPI](https://pypi.org/project/pants-plugin-dep-graph/). We\'ll enable this plugin in the [example-python](https://github.com/pantsbuild/example-python) GitHub repository checkout:\\n\\n```toml title=\\"pants.toml\\"\\n[GLOBAL]\\nplugins = [\\"pants-plugin-dep-graph==1.0.2\\"]\\n```\\n\\nThis plugin provides a new goal that lets you query the dependency graph of your repository. This command, for instance, would export the dependencies of all Python source modules:\\n\\n```shell-session\\n$ pants dep-graph --filter-target-type=python_source --sources-only --deps ::\\n{\\n    \\"helloworld/__init__.py\\": [],\\n    \\"helloworld/main.py\\": [\\n        \\"helloworld/greet/greeting.py\\"\\n    ],\\n    \\"helloworld/greet/__init__.py\\": [],\\n    \\"helloworld/greet/greeting.py\\": [\\n        \\"helloworld/translator/translator.py\\"\\n    ],\\n    \\"helloworld/translator/__init__.py\\": [],\\n    \\"helloworld/translator/translator.py\\": []\\n}\\n```\\n\\nWhen publishing a Pants plugin only for internal company use, you\'ll have control over the Pants version, available Python versions, and the build environment. However, making a Pants plugin accessible to all Pants users may require careful thought if you intend to be able to support multiple versions of Pants. Please review the documentation on [publishing a plugin](https://www.pantsbuild.org/docs/plugins-overview#publishing-a-plugin) to learn more.\\n\\nIf you are just getting started writing plugins, take a look at the [writing plugins tutorials](https://www.pantsbuild.org/docs/create-a-new-goal) and the [documentation on writing plugins](https://www.pantsbuild.org/docs/plugins-overview) to get an introduction to the Pants engine core concepts. As always, we welcome your questions, feedback, and ideas for continuing to make Pants more adaptable to your needs!"},{"id":"/2023/06/16/pants-2-16-0","metadata":{"permalink":"/blog/2023/06/16/pants-2-16-0","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-06-16-pants-2-16-0/index.mdx","source":"@site/blog/2023-06-16-pants-2-16-0/index.mdx","title":"Pants 2.16.0 is here!","description":"This bird is called a ... Ruff! Just so you know. Photo by","date":"2023-06-16T00:00:00.000Z","tags":[],"readingTime":7.49,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":[]},"unlisted":false,"prevItem":{"title":"Sharing Pants plugins","permalink":"/blog/2023/07/03/sharing-pants-plugins"},"nextItem":{"title":"Visibility features coming in Pants 2.16","permalink":"/blog/2023/04/25/visibility-feature-in-pants-2-16"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  This bird is called a ... Ruff! Just so you know. Photo by\\n  [peterichman](https://www.flickr.com/photos/145489125@N03/) used under [CC BY\\n  2.0](https://creativecommons.org/licenses/by/2.0/)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'re very happy to announce Pants 2.16.0, the latest release of Pants.\\n\\nTo upgrade, set `pants_version = \\"2.16.0\\"` in your `pants.toml` file. See [upgrade tips](https://www.pantsbuild.org/v2.16/docs/upgrade-tips) to learn more.\\n\\nAnd, if you haven\'t already, we highly recommend switching from the old `./pants` runner script to the new `pants` [launcher binary](https://www.pantsbuild.org/docs/installation).\\n\\nIn terms of new features, 2.16.0 is one of our biggest releases ever! Read on to find out what\'s in the box.\\n\\n## Target visibility\\n\\nPants 2.16\'s biggest new feature is [Target visibility](https://www.pantsbuild.org/v2.16/docs/validating-dependencies), unlocking support for controlling dependencies within the repository.\\n\\nThe visibility backend lets you write rules that define allowed and forbidden dependencies between different parts of your repo. These rules may be set at any granularity, from entire directory trees down to a single file, as required.\\n\\nVisibility rules were one of our most requested features! Previously, \\"bad\\" dependencies could sneak in under the radar, particularly when relying on automatic [dependency inference](https://www.pantsbuild.org/v2.16/docs/how-does-pants-work#dependency-inference). Now, you can ensure that only dependencies that make sense for your repo architecture can exist.\\n\\nThis is likely to have a profound effect on the structure of your repository, as it can enforce a clean interface between components and prevent unwanted cross-tier or cross-project dependencies. Given its significant scope, we published a blog post specifically about this feature. Please visit [Visibility features coming in Pants 2.16](../2023-04-25-visibility-feature-in-pants-2-16/index.mdx) to learn more.\\n\\nTo help you get started, there\'s a [GitHub repository](https://github.com/pantsbuild/example-visibility) with a simple Python project where you will find some basic rules so that you could try to tweak them and explore.\\n\\n## ruff Python linter support\\n\\nThe [`ruff`](https://github.com/astral-sh/ruff) linter is the new hotness in the Python world. Written in Rust, it performs thousands of times faster than equivalent tools written in pure Python. The Pants core is also written in Rust, and so we\'re big fans of the language and the powerful combo of Rust and Python. Therefore we\'re extra-happy to announce that Pants now supports ruff for linting and formatting Python code.\\n\\nIf you haven\'t seen this tool yet, take a close look! It may speed up your build workflow a lot, particularly if you rely heavily on static code checks. Enable the\\n`pants.backend.experimental.python.lint.ruff` backend to make ruff available in your repository.\\nRuff support was added by a [first time contributor](https://github.com/pantsbuild/pants/pull/17945)! We\'re very grateful and excited to have new people coming on board and making such substantial changes. And this could be you! If you have a feature you\'d like to add or a bug you need to fix, come talk to us [on Slack](https://www.pantsbuild.org/v2.16/docs/getting-help#community-chat). We\'d love to help guide you through the contribution process.\\n\\nYou can find more information about the linter addition process in a separate blog post. Please read [Linting Python at warp speed with Pants+Ruff](../2023-02-28-linting-python-at-warp-speed/index.mdx) to find out more.\\n\\n## yamllint linter support\\n\\nPants now supports the [yamllint](https://yamllint.readthedocs.io) linter for inspecting YAML files. Enable the `pants.backend.experimental.tools.yamllint` backend to make it available in your repository.\\n\\nIn fact, `yamllint` support, too, was added by a [first time contributor](https://github.com/pantsbuild/pants/pull/17821)! It\'s great to see the community growing with so many substantial contributions from newcomers.\\n\\n## pydocstyle linter support\\n\\n[`pydocstyle`](https://www.pydocstyle.org/) is now supported for linting Python docstrings. Enable the `pants.backend.python.lint.pydocstyle` backend to make it available in your repository.\\n\\n## Auto-installation of Python interpreters via pyenv\\n\\nPants can now use [`pyenv`](https://github.com/pyenv/pyenv) to install Python interpreters for you! No more messing around with manually placing the right interpreter versions for your code on the PATH! Now Pants can now provide a hermetic version of Python for each relevant interpreter required to run user code. Enable the `pants.backend.python.providers.experimental.pyenv` backend to make it available in your repository. See our [separate blog post](../2023-03-31-two-hermetic-pythons/index.mdx) for more on this feature.\\n\\n## Shell command improvements and running ad hoc tools\\n\\nThe Shell backend, along with the new `pants.backend.experimental.adhoc` backend, have received a number of major improvements. These allow Pants to invoke workflows that include tools for which Pants does not yet have a dedicated backend.\\n\\nIn recognition of this, the `pants.backend.shell` backend has now been stabilized: `shell_command` and `run_shell_command` no longer have the `experimental` prefix, and are recommended for use for tasks like code generation and reusable commands by running an arbitrary shell script. This stabilization includes [a number of deprecations and changes](https://github.com/pantsbuild/pants/blob/2.16.x/src/python/pants/notes/2.16.x.md#shell-command-improvements-and-support-for-ad-hoc-tools).\\n\\nFor example, the `adhoc` backend lets you run an arbitrary Go binary, Python or JavaScript script before running certain tests, or generate code artifacts such as bindings or schema files necessary for your build workflow. Make sure to review the [Integrating new tools without plugins](https://www.pantsbuild.org/v2.16/docs/adhoc-tool) documentation page and explore the [example-adhoc](https://github.com/pantsbuild/example-adhoc/tree/main) GitHub repository that features various use cases.\\n\\n## Using `env` function BUILD files\\n\\nWith the help of the new `env` function, you can now access environment variables in your BUILD files. This may be helpful when you need to be able to parametrize your build targets to be able to pass field values dynamically. For example, you could set the version of a Python distribution target (for example with the environment variable set to the result of a Git command execution) or skip running certain static checks when building on a particular operating system.\\n\\n## Preamble plugin\\n\\nThe new \\"preamble\\" plugin allows formatting/linting files to ensure they start with specific text, such as a copyright header. This backend can be used instead of (or in addition to) the [regex-lint](https://www.pantsbuild.org/v2.16/docs/reference-regex-lint) backend which could lint your code using regex patterns. Enable the `pants.backend.tools.preamble` backend to add this support.\\n\\n## CUE language support\\n\\nPants now have basic support for the [CUE language](https://cuelang.org/) for defining, generating, and validating configuration data. Enable the `pants.backend.experimental.cue` backend to make it available in your repository.\\n\\n## Go\\n\\nThe Go backend has received a large number of changes in order to be ready for Go v1.20\\nand to make continued progress on [stabilizing the Go backend](https://github.com/pantsbuild/pants/issues/17447).\\n\\nThe main change is that Pants will now compile Go SDK packages from scratch and no longer rely on the prebuilt package archives distributed with the Go SDK. Go v1.20 will no longer ship with those prebuilt package archives, and so this change was necessary for Pants to continue to work with Go v1.20 and later releases.\\n\\n## Other notable changes\\n\\n- A new `symbols` topic was added to the help goal: `pants help symbols` provides a list of available BUILD file symbols which will help when troubleshooting or learning about the BUILD files syntax\\n- the `tailor` goal was extended to produce resource targets for `py.typed` marker files that make it possible for `mypy` and other compatible type checkers to regard the Python package as typed\\n- the [`python-infer`](https://www.pantsbuild.org/v2.16/docs/reference-python-infer#ignored_unowned_imports) subsystem was extended to let users provide unowned imports that should be ignored during dependency discovery. This will make it easier to ignore multiple modules when adding many `# pants: no-infer-dep` pragmas would be impractical.\\n- the `generate-lockfiles` goal was extended with the [`--diff`](https://www.pantsbuild.org/v2.16/docs/reference-generate-lockfiles#diff) flag that reports a summary of changes to requirements made after generating the lockfile.\\n- the special Python \\"tool lockfile\\" functionality is deprecated. It is now possible to use regular \\"user lockfiles\\" to provide custom versions of tools.\\n\\nSee the full [changelog](https://github.com/pantsbuild/pants/blob/release_2.16.0/src/python/pants/notes/2.16.x.md) for more changes, along with our [plugin upgrade guide](https://www.pantsbuild.org/docs/plugin-upgrade-guide).\\n\\n---\\n\\nTry out one of our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n- [example-visibility](https://github.com/pantsbuild/example-visibility)\\n- [example-adhoc](https://github.com/pantsbuild/example-adhoc/)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)\\n\\nWe\'re grateful as always for the growth of the Pants community, the increase in users, contributors, PRs and features. 2.16.0 was a slog, but it\'s finally here, and we\'re so excited for you to try it!"},{"id":"/2023/04/25/visibility-feature-in-pants-2-16","metadata":{"permalink":"/blog/2023/04/25/visibility-feature-in-pants-2-16","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-04-25-visibility-feature-in-pants-2-16/index.mdx","source":"@site/blog/2023-04-25-visibility-feature-in-pants-2-16/index.mdx","title":"Visibility features coming in Pants 2.16","description":"Photo by [Ben","date":"2023-04-25T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"development","permalink":"/blog/tags/development"}],"readingTime":10.71,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":["python","development"]},"unlisted":false,"prevItem":{"title":"Pants 2.16.0 is here!","permalink":"/blog/2023/06/16/pants-2-16-0"},"nextItem":{"title":"Tada, it\'s our new chat archive!","permalink":"/blog/2023/04/01/new-chat-archive"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Ben\\n  Hershey](https://unsplash.com/@benhershey?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nPants 2.16 introduces visibility features. These can be vital for keeping a monorepo\'s repository structure under control as the codebase grows. You\'ll benefit from having cleaner architecture and a dependency graph that is easier to reason about.\\n\\n{/* truncate */}\\n\\n---\\n\\nContinuing our series previewing Pants 2.16\'s coming attractions, one of the larger features introduced in 2.16 is [visibility rules](https://github.com/pantsbuild/pants/blob/main/docs/markdown/Using%20Pants/validating-dependencies.md). These rules provide a mechanism to help you control the accessibility of individual targets (such as source files) in your codebase.\\n\\nIn codebases with languages that have visibility rules built into them such as Java or Scala, you are already using mechanisms that let you declare whether classes are visible outside of their packages. For other languages such as Python, you have to rely on conventions and agreements made within your engineering organization, optionally, writing some custom linting tools to help you spot prohibited imports to keep the dependency graph sane. In either case, Pants visibility feature lets you go beyond what is offered by any programming language as it can operate on build targets rather than individual code elements.\\n\\nHaving the visibility rules declared may be important in a large codebase, particularly if it has multiple, often independent, projects or components. By using the visibility feature, you can:\\n\\n- Hide implementation logic behind an interface via a stable API\\n- Enforce a clean interface between components and prevent cross-project dependencies\\n- Deprecate safely by first raising warnings on deprecated usages and then at some point forbidding the imports\\n- Refactor fearlessly knowing no one else directly depends on your implementation details\\n\\nHaving the boundaries established between your codebase components has a few other benefits:\\n\\n## Code reuse and code extraction\\n\\nIn a codebase model consisting of one or more shared libraries and multiple applications, an application may not be allowed to depend on code from a sibling application. That code would need to be extracted and, optionally, refactored to make it more generic and reusable by other applications.\\n\\n## Faster builds\\n\\nAfter having the dependency rule violations amended, changes in one component would no longer trigger tests in a sibling component. With fewer cache invalidations, you are likely to see improvements in build times; particularly if the modules used across multiple applications are large and are modified often.\\n\\n## Safer deployments\\n\\nIf your components are released and deployed independently, a component shouldn\'t accidentally depend (potentially transitively) on code that is not included in the final deployment artifact such as an executable or an image.\\n\\n## Usage\\n\\nThe visibility rules are declared in BUILD metadata files just like any other Pants metadata. This is an example of a ruleset declaration for a project that is not to be imported by anything else than itself and can only depend on its own code:\\n\\n```python title=\\"src/projectA/BUILD\\"\\n# Declare rules for targets that depend on projectA\\n__dependents_rules__(\\n      (\\n            {\\"type\\": \\"*\\"},  # applies to every potential target\\n            \\"//src/projectA/*\\",  # code within the project directory\\n            \\"//src/projectA/**\\",  # code within the project, recursively\\n            \\"//tests/**\\",  # tests can import the projectA files\\n            \\"!*\\",  # no one else may import projectA files\\n      )\\n)\\n\\n# Declare rules for targets in projectA\\n__dependencies_rules__(\\n      (\\n            {\\"type\\": \\"*\\"},  # applies to every target in projectA\\n            \\"/**\\",  # may depend on anything in this subtree\\n            \\"//3rdparty:upstream-requirements\\",  # may depend on 3rd-party packages\\n            \\"!*\\",  # may not depend on anything else\\n      )\\n)\\n```\\n\\n[Visibility documentation](https://www.pantsbuild.org/v2.16/docs/validating-dependencies) is going to be available soon. Feel free to ask on Slack if you need help!\\n\\nThe way an organization would use the visibility rules may vary greatly. For a small codebase, one may only need to manually extend a few BUILD files with the `dependents` and/or `dependencies` rules. As your codebase evolves, you will adjust the BUILD files rules, for instance, by allowing an additional dependency or adding an exception to the list of actors who may depend on a component.\\n\\nFor a more complex codebase, you may want to take a more structured approach to the declaration of the rules. It may be worthwhile to spend some time thinking about the dependency graph of your codebase and the relationships between its components. In a codebase with multiple independent applications, you would likely have identical (or almost identical) rules applied to them. For instance, you may want your application to depend only on certain shared libraries and prevent any code in the repository from depending on the application\'s code. To prevent code duplication, you may want to declare the rules using a [macro](https://www.pantsbuild.org/docs/macros). Coming back to our previous example of an isolated component, it could be wrapped into a macro that would let us declare exceptions for each component:\\n\\n```python\\ndef visibility_private_component(**kwargs):\\n    \\"\\"\\"Private package not expected to be imported by anything else than itself.\\"\\"\\"\\n    name = kwargs[\\"name\\"]\\n    allowed_dependencies = kwargs.get(\\"allowed_dependencies\\", [])\\n    allowed_dependents = kwargs.get(\\"allowed_dependents\\", [])\\n\\n    __dependents_rules__(\\n        (\\n            {\\"type\\": \\"*\\"}, # applies to every target in the project\\n            \\"//src/projectA/*\\",  # code within the project directory\\n            \\"//src/projectA/**\\",  # code within the project, recursively\\n            allowed_dependents,  # extra allowed dependents\\n            \\"//tests/**\\",  # tests can import the projectA files\\n            \\"!*\\",  # no one else may import projectA files\\n        )\\n    )\\n    __dependencies_rules__(\\n        (\\n            \\"*\\",  # applies to everything in this BUILD file\\n            \\"/**\\",  # may depend on anything in this subtree\\n            \\"//3rdparty:upstream-requirements\\",  # may depend on 3rd-party packages\\n            allowed_dependencies,  # extra allowed dependencies\\n            \\"!*\\",  # may not depend on anything else\\n        )\\n    )\\n```\\n\\nHaving this macro, you can keep your BUILD files concise:\\n\\n```python title=\\"src/libraryA/BUILD\\"\\npython_sources()\\npython_tests()\\nvisibility_private_component(\\n      name=\\"libraryA\\",\\n      allowed_dependencies=[\\"src/common/helpers\\"],\\n      allowed_dependents=[\\"//reporting/tools\\"],\\n)\\n```\\n\\n```python title=\\"src/libraryB/BUILD\\"\\npython_sources()\\npython_tests()\\nvisibility_private_component(\\n      name=\\"libraryB\\",\\n      allowed_dependencies=[\\"src/shared/images\\"],\\n      allowed_dependents=[\\"reporting/tools\\"],\\n)\\n```\\n\\nThere\'s [ongoing work](https://github.com/pantsbuild/pants/pull/17671) to extend the `lint` goal so that you could validate all project dependencies:\\n\\n```shell-session\\n$ ./pants lint --only=visibility --no-visibility-enforce ::\\n```\\n\\nBefore this is available, you can trigger analysis of all dependencies via the `pants dependencies ::` command that would cause evaluation of all visibility rules.\\n\\n## Building a proof of concept (PoC)\\n\\nIn the early stages, instead of starting to code the rules, it may make sense to first spend some time sketching out the rules that you would like to apply to the targets in the codebase. You may need to consult any design documents and generate some graphs to be able to reason about the components in your codebase and the relationships between them. We recommend to ask yourself the following questions:\\n\\n- For sources, should there be any restrictions on who can depend on the code in a directory or a package and what code in a directory or a package can depend on?\\n- For tests, if having multiple test suite types, should there be any restrictions on what code can be shared between those and where would you want to place any test support code?\\n- For non-code resources, should there be any restrictions on where these can be stored and used?\\n- How much effort would it be to refactor the codebase to fix violating imports and enforce the visibility ruleset?\\n\\nLater on, before rolling out the visibility rules across your organization, you may start with a pilot project which would give you a chance to analyze how the relationships between the targets in the codebase are laid out. You may start with a project that is easy to reason about and the dependencies of which are much easier to refactor once you\'ll start enforcing the visibility rules. During the trial, you should become comfortable with the concepts and how the rules work in practice and figure out what rules make sense to apply.\\n\\nAn alternative strategy would be to start with the most complex project to see whether the visibility rules would work for you at all. There is a chance that the initial ruleset declaration syntax as introduced in 2.16 may not be expressive enough yet for your organization\'s needs. In this case, you should reach out to us on Slack since we\'d be very interested in hearing about your use case! If you can\'t wait for the feature to be extended in future versions to cover your scenario, you could still proceed with coarse-grained rule declarations (e.g. sources in a certain directory may not depend on sources in another directory) and should still be able to see the improvements of the overall code design.\\n\\n## Enforcing the rules\\n\\nOnce you are done with the PoC, you\'ll be able to see the warnings produced when running the `lint` goal. You would have to decide whether the violation of the boundaries you have established between the repository components should fail your CI builds or not. There may be too many violations in the codebase which would often be the case for a legacy codebase that hasn\'t been written with the visibility of packages in mind. This is particularly true for large, monolithic codebases where there are only a couple of final artifacts often deployed along each other.\\n\\nFor a large Python project, you will likely get a few false positives if you have enabled the [python-infer.string_imports](https://www.pantsbuild.org/docs/reference-python-infer#string_imports) option to pick up string literals that look like dynamic dependencies. For instance, you may be generating a log or a report file that happens to coincide with the name of the module declared in the project that a particular module should not depend on. If it\'s not obvious why a module depends on another module, try running the `paths` goal to find out if it is due to a transitive dependency you\'ve overseen. The `peek` goal output would also include a variety of information about the visibility rules you have in your BUILD files which may help you troubleshoot when you cannot explain the reason for having a violation.\\n\\nComing up with a solid strategy on handling the violations is crucial at this point. You may want to fix all the violations before enforcing the rules. Alternatively, you can add the violating imports as exceptions in your visibility ruleset to enforce the ruleset immediately and fix the violations later. Keep in mind that if your build pipeline is slow and your codebase is very large, you may want to think carefully and run extensive experiments before merging your changes. This is because editing the BUILD files (which is what would happen after you adjust your macro declaration) would mark all the targets declared in those BUILD files as changed which would invalidate any cache you may have which would cause additional build stages or more computations to run.\\n\\nWhen declaring the visibility policy, you can either warn (using `?`) or error (using `!`) when finding a violation. Depending on the strategy chosen, you would need to pick one accordingly: if you enforce the ruleset immediately, it makes sense to only warn about the issues while you work on fixing them and if you have already addressed all the relevant violations, then you can start failing the builds in CI, if you\'d like to. Keep in mind that if it is strictly forbidden to depend on a particular target, whenever you run a Pants goal that would inspect that target\'s dependencies, an error would be shown and the process fails. This can make local exploratory development and testing harder in cases where developers would like to avoid having any restrictions while they experiment and iterate. If you think this could be a concern, you may want to go with the warnings only which you can accumulate and present to the users in a CI build console or in a pre-push error message.\\n\\n## Conclusion\\n\\nHaving dependency rules declared in a large monorepo is often essential since it helps hide implementation details, exposing only your shared library\'s public interfaces which are vital to keep the repository structure under control as your codebase grows. It is possible to author sophisticated, fine-grained rules to operate on individual files level, but you can also declare the rules very coarsely to cover only the most critical parts of your codebase. In either case, you\'ll benefit from having a cleaner code architecture and a dependency graph that is easier to reason about.\\n\\nTo help you get started, there\'s a [GitHub repository](https://github.com/pantsbuild/example-visibility) with a simple Python project where we have written some basic rules so that you could try to tweak them and explore. We do understand that despite having the visibility feature developed to be very generic to cover most use cases, it\'s possible that you would struggle to find a way to express your particular visibility ruleset that makes sense for your organization. Don\'t stay out in the dark - please reach out to us on Slack and we\'d love to take a look! As always, we welcome your questions, feedback, and ideas for continuing to make Pants more adaptable to your needs."},{"id":"/2023/04/01/new-chat-archive","metadata":{"permalink":"/blog/2023/04/01/new-chat-archive","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-04-01-new-chat-archive/index.mdx","source":"@site/blog/2023-04-01-new-chat-archive/index.mdx","title":"Tada, it\'s our new chat archive!","description":"Photo by [Nana","date":"2023-04-01T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":1.74,"hasTruncateMarker":true,"authors":[{"name":"Carina C. Zona","title":"Pants Maintainer","url":"https://github.com/cczona","imageURL":"https://github.com/cczona.png","key":"cczona","page":null}],"frontMatter":{"authors":["cczona"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"Visibility features coming in Pants 2.16","permalink":"/blog/2023/04/25/visibility-feature-in-pants-2-16"},"nextItem":{"title":"Two hermetic Pythons","permalink":"/blog/2023/03/31/two-hermetic-pythons"}},"content":"import Admonition from \\"@theme/Admonition\\";\\n\\n\\n<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Nana\\n  Smirnova](https://unsplash.com/@nananadolgo?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nWelcome to our new chat mirror, with all six of the current Slack public channels being mirrored to the web.\\n\\n{/* truncate */}\\n\\n---\\n\\nWe\'re very proud of the vibrant, welcoming, responsive community that underlies the Pantsbuild project. For a long time it\'s been a goal to make the community chat Slack archives visible to search engines so that others can benefit even faster from previous questions and answers just by Googling, and so that newcomers can instantly see for themselves that this community is one of the truly standout features of Pants.\\n\\nA few months ago a member of the community arranged for Slack HQ to gift us an upgrade to Pro, making available the full archives starting with 2015. That in itself was an exciting development, and helped set the stage for today\'s development.\\n\\nRecently a community member, [Rhuan Barreto](https://github.com/rhuanbarreto), suggested looking into the Slack mirroring app Linen. Upon testing it\'s proven to be a great fit for our needs, so today we are formally launching a chat mirror with all six of the current public channels being mirrored to the web (_note: archived channels, private channels, and DMs are not mirrored_). Here it is, the new [chat.pantsbuild.org](https://chat.pantsbuild.org)!\\n\\n<Admonition type=\\"note\\" icon=\\"\u{1F464}\\" title=\\"Note\\">\\n  We have enabled a Linen feature which assigns every user a different\\n  randomly-generated username. Slack profiles (e.g. name, email address,\\n  pronouns, etc.) are not published to the mirror.\\n</Admonition>\\n\\nWe\'re delighted to be able to finally be able to share this deep repository of knowledge, insight, and generosity with a larger audience, knowing that it will be easier than ever to get started with Pants. We\'d like to thank [Slack HQ](https://slack.com/) for underwriting the Pro subscription, [Rhuan](https://github.com/rhuanbarreto) for bringing Linen to our attention, and Pants\' lead sponsor [Toolchain](https://toolchain.com) for underwriting the Linen subscription. Teamwork, for the win!"},{"id":"/2023/03/31/two-hermetic-pythons","metadata":{"permalink":"/blog/2023/03/31/two-hermetic-pythons","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-03-31-two-hermetic-pythons/index.mdx","source":"@site/blog/2023-03-31-two-hermetic-pythons/index.mdx","title":"Two hermetic Pythons","description":"Photo by [Hamish","date":"2023-03-31T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":3.14,"hasTruncateMarker":true,"authors":[{"name":"Joshua Cannon","title":"Pants Maintainer","url":"https://github.com/thejcannon","imageURL":"https://github.com/thejcannon.png","key":"joshua","page":null}],"frontMatter":{"authors":["joshua"],"tags":["python"]},"unlisted":false,"prevItem":{"title":"Tada, it\'s our new chat archive!","permalink":"/blog/2023/04/01/new-chat-archive"},"nextItem":{"title":"Environments: simpler multi-platform workflows","permalink":"/blog/2023/03/28/environments-simpler-multi-platform-workflows"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Hamish\\n  Duncan](https://unsplash.com/@hambourine?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nMake builds more reliable and save time doing so. The upcoming Pants 2.16 introduces a couple of exciting changes to make Pants safer, faster, and more user-friendly. Here we preview a pair of changes which increase hermeticity.\\n\\n{/* truncate */}\\n\\n---\\n\\nRecently, [Pants got a new launcher binary](../2023-02-23-the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants/index.mdx) that has a Python interpreter embedded. This was an important step forward for decoupling running Pants from what\'s installed on the system. However, there was still work to do; internally Pants still scoured the running machine looking for Python binaries for 2 use-cases:\\n\\n1.  For Pants\' own ability to run Python scripts as part of the build. Python is an intuitive and cross-platform scripting language. As such it is very convenient to use it for complex scripts (like file locking, parsing complicated text, or ironically, determining a compatible Python interpreter given interpreter constraints).\\n2.  For running user Python code. If you enable `pants.backend.python` one or more Python interpreters need to be found/used to run your code, tools, and tests.\\n\\n## Case 1: A Pants-internal Python\\n\\nFor case 1 where Pants just need _some_ Python interpreter to run scripts, we take a two-pronged approach.\\n\\nFor [Docker builds](../2023-02-24-pants-2-15/index.mdx) we download and sandbox a [Python Build Standalone](https://gregoryszorc.com/docs/python-build-standalone/main/) (the same kind of Python interpreter the new Pants binary launcher uses). Pants no longer dictates that a supported (or any) version of Python is present in the docker image running your build. Additionally, Pants is able to choose which version, meaning we could upgrade to faster [CPython versions](https://github.com/markshannon/faster-cpython/blob/master/plan.mdx) as they are released.\\n\\nFor local builds, we just use `sys.executable` (the Python interpreter that\'s running Pants itself). Eventually, the Pants binary launcher will be the only way to run Pants, meaning a hermetic, version-pinned interpreter will be the one-and-only way Pants is run.\\n\\nCombining these, the result is Pants completely decoupled from the system to run internal scripts, better hermeticity, and faster runs (by not consulting the system and by using the latest Python version available).\\n\\n## Case 2: A Pants-provided Python\\n\\nA long-standing request of Pants is to have [Pants provide a Python interpreter](https://github.com/pantsbuild/pants/issues/10447) for running your code, tools, and tests, instead of consulting the system. Consulting the system can be time-consuming, error-prone, and results in builds with reduced hermeticity.\\n\\nPants 2.16 has added a mechanism for plugins to provide versions of Python compatible with your code, along with an [experimental](../2022-11-21-quick-feedback-on-new-features-via-experimental-backends/index.mdx) backend to use [pyenv](https://github.com/pyenv/pyenv) as a provider. When the backend is enabled, for each version of Python that needs to be used based on your interpreter constraints, Pants either uses a hermetic, cached version if one exists, or installs it on-the-fly (roughly takes ~2-3 minutes). This results in faster builds (no more scouring the system) as well as ensuring maximal hermeticity when running your code, your tools, and your tests.\\n\\n## How to preview the new hermetic Pythons\\n\\nInterested in trying out these features? Upgrade to Pants 2.16 to benefit from a hermetic internal Python. Additionally, for a hermetic Python for your code enable `pants.backend.python.providers.experimental.pyenv` to your `[GLOBAL].backend_packages` and start enjoying the benefits. As with any experimental backend, we encourage you to [share your feedback on Slack](https://www.pantsbuild.org/docs/getting-help)!"},{"id":"/2023/03/28/environments-simpler-multi-platform-workflows","metadata":{"permalink":"/blog/2023/03/28/environments-simpler-multi-platform-workflows","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-03-28-environments-simpler-multi-platform-workflows/index.mdx","source":"@site/blog/2023-03-28-environments-simpler-multi-platform-workflows/index.mdx","title":"Environments: simpler multi-platform workflows","description":"Photo by [Milada","date":"2023-03-28T00:00:00.000Z","tags":[{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"},{"inline":true,"label":"docker","permalink":"/blog/tags/docker"}],"readingTime":3.59,"hasTruncateMarker":true,"authors":[{"name":"Stu Hood","title":"Pants Maintainer","url":"https://github.com/stuhood","imageURL":"https://github.com/stuhood.png","key":"stu","page":null}],"frontMatter":{"authors":["stu"],"tags":["concepts","docker"]},"unlisted":false,"prevItem":{"title":"Two hermetic Pythons","permalink":"/blog/2023/03/31/two-hermetic-pythons"},"nextItem":{"title":"What we mean by \\"contributing\\" to Pants","permalink":"/blog/2023/03/02/what-we-mean-by-contributing-to-pants"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Milada\\n  Vigerova](https://unsplash.com/@milada_vigerova?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nNow you can cross-test or cross-build your code on multiple different platforms concurrently, using Environments. Pants uses its precise knowledge of your build\'s deps to run exactly the relevant processes inside reusable Docker containers (or evenly remotely on a cluster of workers)\u2026\\n\\n{/* truncate */}\\n\\n## tl;dr\\n\\nPants\' [Environments](https://www.pantsbuild.org/v2.15/docs/environments) (introduced in [2.15.0](../2023-02-24-pants-2-15/index.mdx)) allow you to quickly and transparently cross-test or cross-build your code on multiple different platforms concurrently (from Linux to macOS, but also vice-versa when remote workers are available), improving the experience of both local and CI workflows.\\n\\n## Environments\\n\\nUsing an [Environment](https://www.pantsbuild.org/v2.15/docs/environments) in your Pants build replaces the need to run Pants _in_ Docker: instead, Pants transparently uses its precise knowledge of your build\'s dependencies to run exactly the relevant processes inside of reusable Docker containers (or even remotely on a cluster of workers; more on that later).\\n\\nRather than wrapping your build in an additional layer of tooling and complexity, you can use a tightly integrated, fine-grained toggle to control the environments that portions of your build are running in.\\n\\n### In Local Builds\\n\\nPants already carefully isolates the host machine\'s settings in order to ensure hermeticity and reproducibility across machines. But in many cases you might like your test environment to precisely match production or CI.\\n\\nInstead of figuring out how to sync your repository in and out of a container and paying the cost of virtualization ([on macOS](https://www.cncf.io/blog/2023/02/02/docker-on-macos-is-slow-and-how-to-fix-it/)) and containerization for your entire build, Pants will sync and run exactly the necessary bits.\\n\\n### In CI Builds\\n\\nIf you have a multi-platform CI build, you\'d usually have to split your build up by platform into separate steps/tasks using your CI provider\'s configuration language. But Pants\' Environments allow a single run of Pants to control the execution of tests on multiple operating systems, architectures, or sets of runtime dependencies.\\n\\nBecause Pants natively supports building with multiple Environments concurrently, you can easily cross-build for multiple platforms at once. For example, running a test on macOS and Linux simultaneously:\\n\\n```shell-session\\n$ ./pants test src/python/pants/util/dirutil_test.py\\n...\\n\u2713 src/python/pants/util/dirutil_test.py@environment=local_macos succeeded in 2.45s.\\n\u2713 src/python/pants/util/dirutil_test.py@environment=remote_linux succeeded in 3.48s (ran remotely).\\n```\\n\\n## How it works\\n\\n### Efficiency and reuse\\n\\nThe Environment to use is passed down through Pants\' build graph, but only into subgraphs which actually need to do something environment specific (like running processes, inspecting environment variables, consuming platform specific options, etc).\\n\\nUnlike when running your entire build in a Docker container, only the portions of the build graph which are relevant to the Environment run there: if you are building for multiple Environments simultaneously (such as via multiple Docker images, a mix of local and remote, etc), then large portions of the build graph (including dependency calculations) can be reused across those Environments!\\n\\n### Docker vs Remote Execution\\n\\nAlthough Pants support for Docker Environments enables transparently building in a Linux that matches your host machine\'s platform, Pants\' [support for Remote Execution](https://www.pantsbuild.org/v2.15/docs/remote-execution) enables transparently building on any platform and operating system supported by the [Remote Execution API](https://github.com/bazelbuild/remote-apis) standard!\\n\\nIn 2.15, remote execution has been adapted to allow [different classes of remote execution workers to be used as distinct Environments](https://www.pantsbuild.org/v2.15/docs/remote-execution#environment-specific-settings). That means that you can use a remote execution and caching platform like [Toolchain](https://www.toolchain.com/) to allow your local or CI use cases to cross build on heterogeneous workers concurrently (expect a post from Toolchain on this topic!)\\n\\n## Try it out!\\n\\nEnvironments are [experimental](https://github.com/pantsbuild/pants/issues/17355) in 2.15, so you may encounter some rough edges. We\'d love your feedback on how they are working for you, and what new use cases they can enable.\\n\\nIf you have any questions, please [reach out](https://www.pantsbuild.org/docs/getting-help) -- the Pants community would be more than happy to help!"},{"id":"/2023/03/02/what-we-mean-by-contributing-to-pants","metadata":{"permalink":"/blog/2023/03/02/what-we-mean-by-contributing-to-pants","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-03-02-what-we-mean-by-contributing-to-pants/index.mdx","source":"@site/blog/2023-03-02-what-we-mean-by-contributing-to-pants/index.mdx","title":"What we mean by \\"contributing\\" to Pants","description":"Photo by [Simon","date":"2023-03-02T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":3.01,"hasTruncateMarker":true,"authors":[{"name":"Carina C. Zona","title":"Pants Maintainer","url":"https://github.com/cczona","imageURL":"https://github.com/cczona.png","key":"cczona","page":null}],"frontMatter":{"authors":["cczona"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"Environments: simpler multi-platform workflows","permalink":"/blog/2023/03/28/environments-simpler-multi-platform-workflows"},"nextItem":{"title":"Write (or speak) about any of Pants community\'s favorite topics!","permalink":"/blog/2023/03/02/write-or-speak-about-pants-communitys-favorite-topics"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Simon\\n  Maage](https://unsplash.com/@simonmaage?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nWe embrace that open source is not code alone. We truly value a wide spectrum of contributions to Pants project and to the thriving community that underlies it. Here are some of the many ways anyone can potentially contribute to the vitality of Pants...\\n\\n{/* truncate */}\\n\\n---\\n\\nOn many open source projects, a \\"contributor\\" is narrowly defined as someone who contributes code specifically. Other forms of contributions often are overlooked or underappreciated in those communities. It\'s a loss for everyone. At Pants project, we embrace that open source is not code alone. [We value a wide spectrum of contributions to the project and to the community that underlies it.](https://www.pantsbuild.org/docs/the-pants-community#how-is-the-community-structured) When you do something that helps more people benefit from Pants, that\'s a win for them and a win for Pants. Thank you!\\n\\nHere are some of the many ways anyone can contribute to the vitality of Pants:\\n\\n- Tell peers why you use Pants and who you think will benefit from Pants too. Spread the word! Whether that be in a casual chat, tweet, blog post, tutorial, presentation, or video.\\n- Contribute to the collaborative spirit of the community by helping a fellow user on Slack or GitHub.\\n- Star the project on GitHub [https://github.com/pantsbuild/pants](https://github.com/pantsbuild/pants). It\'s an easy action that helps build exposure and momentum.\\n- Contribute to the docs using the \\"Suggest Edits\\" button.\\n- Contribute to the codebase by suggesting an idea, making a feature request, giving feedback on an issue or dev release, opening an issue, or starting a pull request.\\n- List your organization or open source project on the Who Uses Pants page [https://www.pantsbuild.org/page/who-uses-pants](https://www.pantsbuild.org/page/who-uses-pants)\\n- Add a testimonial [https://www.pantsbuild.org/docs/testimonials](https://www.pantsbuild.org/docs/testimonials)\\n- Publish a case study of how your goals are being served by Pants. This is easily one of the most powerful things you can do!\\n- [Give a talk about Pants, or about one of our other favorite topics.](../2023-03-02-write-or-speak-about-pants-communitys-favorite-topics/index.mdx) We always love to see more talks about subjects such as build engineering, developer tooling, devops, developer productivity, CI/CD, testing, code quality, scaling, remote execution, Python, Rust, etc. We\'re also happy to help speakers develop the talk, and provide a friendly audience for rehearsing it.\\n- Ask your organization to consider partnering with us on things like [adding support for JavaScript](https://www.pantsbuild.org/page/language-support), other languages, or a key new feature. The more resources available, the faster we can add that one more thing you\'ve been eagerly waiting for...\\n- Point out when a community member contributes meaningfully to making the project or culture even better, or even just when a community member made your day better. We want to support and reward people in doing good things, and ideally we\'d also like to help them become future collaborators on [Pants Team](https://www.pantsbuild.org/docs/team).\\n- Guest post on this very blog, and/or blog elsehwere. Here are [lots of great topic ideas to help kickstart your brainstorming!](../2023-03-02-write-or-speak-about-pants-communitys-favorite-topics/index.mdx)\\n\\nWe welcome more ideas for this list. We invite you to join us on Slack and contribute your own suggestions. Thanks for supporting Pants with your time, knowledge, perspective, kind spirit, enthusiasm, and energy. Pants is better because of you."},{"id":"/2023/03/02/write-or-speak-about-pants-communitys-favorite-topics","metadata":{"permalink":"/blog/2023/03/02/write-or-speak-about-pants-communitys-favorite-topics","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-03-02-write-or-speak-about-pants-communitys-favorite-topics/index.mdx","source":"@site/blog/2023-03-02-write-or-speak-about-pants-communitys-favorite-topics/index.mdx","title":"Write (or speak) about any of Pants community\'s favorite topics!","description":"Photo by [Unseen","date":"2023-03-02T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":4.64,"hasTruncateMarker":true,"authors":[{"name":"Carina C. Zona","title":"Pants Maintainer","url":"https://github.com/cczona","imageURL":"https://github.com/cczona.png","key":"cczona","page":null}],"frontMatter":{"authors":["cczona"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"What we mean by \\"contributing\\" to Pants","permalink":"/blog/2023/03/02/what-we-mean-by-contributing-to-pants"},"nextItem":{"title":"Linting Python at warp speed with Pants+Ruff","permalink":"/blog/2023/02/28/linting-python-at-warp-speed"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Unseen\\n  Studio](https://unsplash.com/@craftedbygc?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nInterested in blogging about Pants? Any member of the community is encouraged to pitch topics for the [Pants Blog](https://pantsbuild.org/blog). You can DM pitches to me (@cczona) over at [pantsbuild.slack.com](https://pantsbuild.slack.com). Likewise, we encourage writing for your company blog, personal blog, or other organizations\' blogs where appropriate for your topic. If you\'d like a Pants maintainer\'s feedback on a draft post, or would like other writing assistance, we\'re happy to provide 1:1 support so you can feel maximum confidence in what you\'ve written.\\n\\nHere are some of the topics that make particularly great posts:\\n\\n## Tutorials\\n\\nWalk people through how to solve a particular problem. How to write a Pants plugin is always a popular topic. So is how to contribute to Pants in other ways, such as contributing a new backend. Also great are tutorials about how to use other features of Pants, big picture conceptual explanations, or how to make optimal use of any of the many tools that Pants supports. For example, getting a better understanding of using mypy with Pants.\\n\\n## Pro tips\\n\\nIf you have accumulated a collection of tips about e.g. Black, Thrift, Docker, MyPy, or something else Pants supports, consider writing a post highlighting the tool itself and your tips. Don\'t forget to include a passage showing how combining it with Pants superpowers that tool\'s capabilities!\\n\\n## Architecture\\n\\nHow to convert your codebase from one approach (e.g. Tox, Poetry, Bazel, ad hoc shell scripts, etc) to Pants is a common question. Pants tries not to impose any one way of doing things, to allow you maximum flexibility. But new users often want to know \\"what\'s a good way for me to approach this\\". Your example, of how and why you chose to arrange the codebase and make that transition, can be very useful to others who are weighing their options.\\n\\n## Using Pants in CI\\n\\nHow do you use Pants in CI? How nicely does your CI system play with Pants? What handy tips should others know about? What caveats? If you\'ve used Pants with more than one CI system, how do they compare? How has using Pants in CI affected the way your team works? How has it affected build time, velocity, or scaling?\\n\\n## Case study\\n\\nPants team really appreciates those, by the way. It\'s really rewarding for open source contributors when we get to hear details of how Pants is being used in the real-world to address your day-to-day challenges. Moreover, when people are considering whether to try Pants, a relatable case study from an organization in an industry similar to theirs can be extremely influential.\\n\\nA case study needn\'t be highly structured. You can see some nice examples in Resource Hub\'s case studies section. Generally the format starts with an introduction to your organization, your team, the challenges you were experiencing, and the priorities you applied in trying to solve it. Then a summary of solutions attempted, where Pants fits in, what your ultimate choice of solution was, the process of implementing it, and your reflections on the outcome. It\'s a personal experience report shared with peers, to lend insights to others experiencing challenges similar to what you confronted.\\n\\n## Concepts\\n\\nNot everyone has used a build system before, or worked with a monorepo, or coded for a hermetic environment, or even is aware of our community\'s specialist professions such as build engineering and productivity engineering. Big-picture conceptual explanations of topics can be very helpful for newcomers to Pants, who may appreciate an introduction to its conceptual underpinnings.\\n\\n## New or upcoming features\\n\\nEspecially if you\'ve recently contributed something to Pants, please know you are very welcome to blog all about that feature, who it\'s for, what use cases it addresses, how to get the most out of it, etc. Note that you absolutely do not need to have contributed a given feature in order to blog about it. Sometimes the best person to write about it is an enthusiastic adopter, who can really highlight the strengths of the feature under real-life conditions.\\n\\n## PEX\\n\\nWhatever you\'re doing with PEX, if you find it interesting others probably will too. PEX is maintained by Pants Team and others, so we consider PEX on-topic at Pants blog and are always happy to see it get more of the love it deserves.\\n\\n## SCIE\\n\\n[SCIE](../2023-02-23-the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants/index.mdx) is the latest project from the Pantsbuild team, and we\'re very excited about its potential. We\'d love to see some posts about how you\'re using SCIE and highlighting its merits for others to tap.\\n\\n## Public speaking\\n\\nNotice something about all of these topics? They make great topics of a talk too! Whether it\'s a lunch-time presentation to your team, a meetup talk, lightning/ignite talk, or conference session, these are topics that developers and data scientists appreciate learning more about. Your experience and perspective on any of these topics can be a valued contribution to peers\' professional development and productivity. Just like blogging, feel free to reach out for assistance with talk development/prep. We\'re happy to provide the support you need, upon request \u2014 whether that be a sounding board, mentorship, a friendly audience for a rehearsal, or feedback. Here\'s also a \\\\[running list of open CFPs\\\\], so you can catch relevant speaking opportunities!"},{"id":"/2023/02/28/linting-python-at-warp-speed","metadata":{"permalink":"/blog/2023/02/28/linting-python-at-warp-speed","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-02-28-linting-python-at-warp-speed/index.mdx","source":"@site/blog/2023-02-28-linting-python-at-warp-speed/index.mdx","title":"Linting Python at warp speed with Pants+Ruff","description":"Photo by [Mathew","date":"2023-02-28T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":6.46,"hasTruncateMarker":true,"authors":[{"name":"Berkay \xd6zt\xfcrk","url":"https://github.com/ozturkberkay","imageURL":"https://github.com/ozturkberkay.png","key":"berkay","page":null}],"frontMatter":{"authors":["berkay"],"tags":["python"]},"unlisted":false,"prevItem":{"title":"Write (or speak) about any of Pants community\'s favorite topics!","permalink":"/blog/2023/03/02/write-or-speak-about-pants-communitys-favorite-topics"},"nextItem":{"title":"Challenges in choosing a Python packaging format","permalink":"/blog/2023/02/24/choosing-a-python-packaging-format"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Mathew\\n  Schwartz](https://unsplash.com/@cadop?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nNow that Pants 2.15 is out, let\'s whet your appetite for 2.16: lint your Python monorepo faster than ever with Pants and Ruff, two projects that share a passion for combining the raw power of Rust with the elegance of Python.\\n\\n{/* truncate */}\\n\\n## Status Quo\\n\\nTools like [Pylint](https://github.com/PyCQA/pylint) and [Flake8](https://github.com/pycqa/flake8) are some of the most common static code analyzers used in the Python community. They allow us to improve code quality by checking for errors and \\"code smells\\", as well as enforcing coding standards. It is very common to use such tools in the CI pipelines and local development environments. However, as the team and the code gets bigger, the number of tools being used and the time it takes to run them increases. This reduces productivity and increases compute costs due to longer CI runs, especially in bigger teams.\\n\\nJust to give a sense of the _cold-run_ speed of these tools, I cloned the Pants project from Github and ran Pylint with the default configurations using WSL2 on a 6-core 12-thread Intel i7-5820K Windows PC with 32 GB of RAM.\\n\\n| Metrics                | Results                                                                                        |\\n| ---------------------- | ---------------------------------------------------------------------------------------------- |\\n| SLOC                   | 161,410                                                                                        |\\n| Version                | pylint 2.16.1<br/>astroid 2.14.1<br/>Python 3.11.1 (main, Jan 28 2023, 18:50:01) \\\\[GCC 9.4.0\\\\] |\\n| Time (with `--jobs=0`) | 475.83s user<br/>4.07s system<br/>99% cpu<br/>8:00.03 total                                    |\\n\\nThat\'s _a lot_ of time spent just on a single linting tool. Let\'s look at another usual suspect, Flake8; which will be my main reference point in this blog post.\\n\\n| Metrics                                               | Results                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\\n| ----------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\\n| SLOC                                                  | 161,410                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\\n| Version                                               | 6.0.0 (flake8-2020: 1.7.0, flake8-annotations: 3.0.0, flake8-bandit: 4.1.1, flake8-blind-except: 0.2.1, flake8-boolean-trap: 0.1.0, flake8-bugbear: 23.1.20, flake8-builtins: 2.1.0, flake8-commas: 2.1.0, flake8-comprehensions: 3.10.1, flake8-datetimez: 20.10.0, flake8-debugger: 4.1.2, flake8-executable: 2.1.3, flake8-import-conventions: 0.1.0, flake8-logging-format: 0.9.0, flake8-no-pep420: 2.3.0, flake8-pie: 0.16.0, flake8-print: 5.0.0, flake8-pyi: 23.1.2, flake8-pytest-style: 1.7.0, flake8-quotes: 3.3.2, flake8-return: 1.2.0, flake8-simplify: 0.19.3, flake8-tidy-imports: 4.8.0, flake8-type-checking: 2.3.0, flake8-unused-arguments: 0.0.13, flake8-use-pathlib: 0.3.0, flake8_errmsg: 0.4.0, flake8_implicit_str_concat: 0.4.0, mccabe: 0.7.0, pycodestyle: 2.10.0, pyflakes: 3.0.1) CPython 3.11.1 on Linux |\\n| Time (with `--jobs=auto`)                             | 159.24s user<br/>1.71s system<br/>1101% cpu<br/>14.617 total                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\\n| Time (without any Flake8 plugins, with `--jobs=auto`) | 42.24s user<br/>0.58s system<br/>1089% cpu<br/>3.930 total                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\\n\\nInstalling the plugins decreased the speed by ~272%! It would be nice to have a linting tool with a similar feature set and much better performance.\\n\\nPlease also note that the purpose of this blog post is not to extensively benchmark these tools. I\'m trying to provide some first impressions using a simple setup with the default configurations.\\n\\n## Enter Ruff\\n\\n[ruff](https://github.com/charliermarsh/ruff#flake8-blind-except-ble) is the new cool kid in the block which claims to be 10 to 100 times faster than the existing linters. That\'s because ruff is written in Rust. (Pants v2 execution engine is written in Rust as well! Read more [here](../2020-10-27-introducing-pants-v2/index.mdx).)\\n\\nIt is already almost on par with Flake8, including the majority of the rules from Flake8 plugins. There is even a way to automatically convert your Flake8 configurations into ruff-compatible `pyproject.toml` configurations, so migration should be fairly simple.\\n\\nHowever, it is worth noting that **ruff is not close to being on par with Pylint yet**. You can track the roadmap to cover Pylint rules from [this](https://github.com/charliermarsh/ruff/issues/970) Github issue.\\n\\nAside from being nearly on par with Flake8, ruff is aiming to be a replacement for tools like `pyupgrade`, to \\"fix\\" your codebase instead of just sticking to formatting. Unfortunately, [ruff doesn\'t expose](https://github.com/charliermarsh/ruff/issues/455#issue-1413887821) sub-commands to distinguish the use cases like Pants do with `fmt` and `fix`.\\n\\nOne of the reasons that make ruff a good fit for projects using Pants is that ruff is monorepo-friendly. You can implement hierarchical configurations with multiple `pyproject.toml` files. When you run ruff against a path, it finds the nearest `pyproject.toml` file with the `[tool.ruff]` section and loads the corresponding configurations.\\n\\n[![Star History Chart](https://api.star-history.com/svg?repos=charliermarsh/ruff&type=Date)](https://star-history.com/#charliermarsh/ruff&Date)\\n\\nRuff is actively developed (as of writing this blog post, the last commit was 1 hour ago and the last release was 13 hours ago) and already gaining adoption from major open-source projects like pandas, airflow, fastapi and scipy.\\n\\nLet\'s repeat the previous tests, but with ruff this time:\\n\\n| Metrics                | Results                                                       |\\n| ---------------------- | ------------------------------------------------------------- |\\n| SLOC                   | 161,410                                                       |\\n| Version                | ruff 0.0.245                                                  |\\n| Time (with `--jobs=0`) | 1.19s user<br/>0.21s system<br/>645% cpu<br/>0.217 total<br/> |\\n\\nIt ran under a fraction of a second. That\'s _very_ impressive.\\n\\n## My First Contribution\\n\\nAs a Pants user, I was very excited about ruff. So I kept asking myself how hard would it be to implement a ruff backend for Pants. Turns out, it\'s not that hard! Thanks to the [comprehensive documentation](https://www.pantsbuild.org/docs/contributor-overview), I was able to [write the backend](https://github.com/pantsbuild/pants/pull/17945) in just a few hours by using the existing backend implementations as a reference. There are still _a lot_ of things about Pants that I\'m clueless about though. Thankfully, Pants have an [internal architecture documentation](https://www.pantsbuild.org/docs/internal-rules-architecture) for curious minds.\\n\\nPants community is also very active on [Slack](https://docs.google.com/forms/d/e/1FAIpQLSf9zgf-MXRnVDJbrVEST3urqneq7LCcy0zw8qU-GH4hPMn52A/viewform?usp=sf_link). I was very surprised by the immediate feedback and overall positivity of the maintainers. This was my very first non-documentation contribution to a major open-source project. After seeing the response from the maintainers, I got motivated to keep contributing to more open-source projects.\\n\\n## Pants \u2764\uFE0F Ruff\\n\\nOn January 30th, Pants [released](https://github.com/pantsbuild/pants/releases/tag/release_2.16.0.dev6) `v2.16.0.dev6` which includes the experimental ruff backend!\\n\\nHere are the steps to get started:\\n\\n1.  Create your monorepo. Notice that we are injecting an unused import statement, ruff will take care of this.\\n\\n    ```shell-session\\n    $ mkdir ~/projects/monorepo\\n    $ cd ~/projects/monorepo\\n    $ mkdir -p src/python/demo\\n    $ touch src/python/demo/__init__.py\\n    $ touch src/python/demo/app.py\\n    $ echo \\"import unused\\" > src/python/demo/app.py\\n    $ tree\\n    .\\n    \u2514\u2500\u2500 src\\n        \u2514\u2500\u2500 python\\n            \u2514\u2500\u2500 demo\\n                \u251C\u2500\u2500 __init__.py\\n                \u2514\u2500\u2500 app.py\\n\\n    3 directories, 2 files\\n    ```\\n\\n2.  Install `pants` into your project\'s root directory.\\n\\n    ```shell-session\\n    $ curl -L -O https://static.pantsbuild.org/setup/pants\\n    $ chmod +x ./pants\\n    $ echo \\"\\"\\"\\n    [GLOBAL]\\n    pants_version = \\\\\\"2.16.0.dev6\\\\\\"\\n    backend_packages = [\\n        \\\\\\"pants.backend.python\\\\\\",\\n        \\\\\\"pants.backend.experimental.python.lint.ruff\\\\\\",\\n    ]\\n\\n    [anonymous-telemetry]\\n    enabled = false\\n    \\"\\"\\" > pants.toml\\n    $ ./pants --version\\n    22:17:19.20 [INFO] Initializing scheduler...\\n    22:17:20.91 [INFO] Scheduler initialized.\\n    2.16.0.dev6\\n    $ ./pants tailor ::\\n    Created src/python/demo/BUILD:\\n    - Add python_sources target demo\\n    $ tree\\n    .\\n    \u251C\u2500\u2500 pants\\n    \u251C\u2500\u2500 pants.toml\\n    \u2514\u2500\u2500 src\\n        \u2514\u2500\u2500 python\\n            \u2514\u2500\u2500 demo\\n                \u251C\u2500\u2500 BUILD\\n                \u251C\u2500\u2500 __init__.py\\n                \u2514\u2500\u2500 app.py\\n\\n    3 directories, 5 files\\n    ```\\n\\n3.  Start using the fix [goal](https://www.pantsbuild.org/docs/python-goals). As you can see, ruff fixed the file with the unused import.\\n\\n    ```shell-session\\n    $ ./pants fix ::\\n    12:20:59.81 [INFO] Completed: Building ruff.pex from ruff_default.lock\\n    12:20:59.86 [WARN] Completed: Format with ruff - ruff made changes.\\n    src/python/demo/app.py\\n\\n    + ruff made changes.\\n    ```\\n\\nThat\'s it! Feel free to visit the [Getting Started](https://www.pantsbuild.org/docs/getting-started) page of the documentation to start using Pants. If you have any questions about the experimental ruff integration, drop a message in the [Slack channel](https://docs.google.com/forms/d/e/1FAIpQLSf9zgf-MXRnVDJbrVEST3urqneq7LCcy0zw8qU-GH4hPMn52A/viewform?usp=sf_link) or use the [GitHub issues](https://github.com/pantsbuild/pants/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc) to provide report bugs."},{"id":"/2023/02/24/choosing-a-python-packaging-format","metadata":{"permalink":"/blog/2023/02/24/choosing-a-python-packaging-format","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-02-24-choosing-a-python-packaging-format/index.mdx","source":"@site/blog/2023-02-24-choosing-a-python-packaging-format/index.mdx","title":"Challenges in choosing a Python packaging format","description":"Photo by [Kira auf der","date":"2023-02-24T00:00:00.000Z","tags":[{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"},{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"}],"readingTime":9.99,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":["deployment","docker","concepts"]},"unlisted":false,"prevItem":{"title":"Linting Python at warp speed with Pants+Ruff","permalink":"/blog/2023/02/28/linting-python-at-warp-speed"},"nextItem":{"title":"Pants 2.15: Easier multi-platform workflows, Docker build support, automatic code cleanup, and more!","permalink":"/blog/2023/02/24/pants-2-15"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Kira auf der\\n  Heide](https://unsplash.com/@kadh?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nAlexey reviews the Python packaging landscape. You\'ll learn more about the options you have, their pros and cons, and how to find the best approach to distribute your Python applications.\\n\\n{/* truncate */}\\n\\n---\\n\\nThere is a good reason why Python is a very popular language. It has a very concise yet expressive syntax, there are all kinds of open-source frameworks and libraries available, and the Python community is healthy and vibrant. Many companies adopt Python for various reasons: some use it primarily for automation and scripting, and others write server-side applications. It\'s heavily used in the machine learning and AI industry as well as data science and analytics. Python being not the most performant language is often not a concern as this is compensated by the speed of development; the performance-critical parts are also often written in a system language and wrapped as a native extension.\\n\\nConventionally, Python libraries are distributed via a central repository, pypi.org, in the form of Python [wheels](https://packaging.python.org/en/latest/glossary/#term-Wheel) and/or [source distributions](https://packaging.python.org/en/latest/glossary/#term-Source-Distribution-or-sdist). The tooling to support setting up a virtual environment with all the necessary packages needed either for development or runtime production has improved over the years and serves the needs of individual users adequately. Various well-established tools such as `poetry`, `piptools`, and `pip` help with development environment setup and dependency management.\\n\\nFor Python applications, however, the story is somewhat different: distributing ready-to-use applications has been historically challenging as this has almost always implied the need to have a Python interpreter on the machine where the application is supposed to be run. If distributing only the first-party code, users are expected to have an Internet connection to be able to download the third-party dependencies the application needs. Running multiple applications in the same Python environment has also presented a challenge due to potentially conflicting requirements.\\n\\nIn this blog post, we\'ll review the Python packaging landscape so that you can learn more about the options you have, and their pros and cons. This should help you find the best approach to distribute your applications as you\'ll be navigating the Python packaging ecosystem and tooling.\\n\\n## Shipping first-party code\\n\\nDistributing your application as a wheel or a source distribution is still a viable option, particularly if its dependencies are simple enough. The actual application would be typically accessed via an [entry point](https://setuptools.pypa.io/en/latest/userguide/entry_point.html) defined by the package author. A wheel or sdist would be produced with the help of standard Python tooling and later distributed via an internal binary repository manager or the PyPI. The `setuptools` support multiple target formats including source distributions, Python wheels, archive files, and even [RPM packages](https://setuptools.pypa.io/en/latest/deprecated/distutils/builtdist.html#creating-rpm-packages). Visit the [official Python packaging guide](https://packaging.python.org/en/latest/tutorials/packaging-projects/) and [Building distributions with Pants](https://www.pantsbuild.org/docs/python-distributions) to get started.\\n\\n## Shipping first-party and third-party code\\n\\nWhile the strategy above works in many cases, it still expects the application consumer to be responsible for obtaining all the application dependencies and preparing the runtime environment. The conflicting requirements problem has been partially addressed by tools such as [pipx](https://pypa.github.io/pipx/) that let you install multiple packages by hiding away the fact that each tool would have an own Python virtual environment created specifically for this tool. For instance, running `pipx install jc` would make the [jc](https://github.com/kellyjonbrazil/jc) command available on your system path.\\n\\nA more serious concern with the distribution of Python wheels is non-determinism: installing a Python wheel today may (and often will) bring a different set of dependencies compared to the one that will be obtained upon installation taking place tomorrow. This is because transitive dependencies of the application dependencies are often specified with an open version range: this is done to be able to install multiple Python wheels into the same virtual environments. Transitively pinning the dependencies for the wheels would very soon result in the inability to co-install two wheels due to conflicting requirements. The version \\"freeze\\" happens on the consumer\'s side instead: one can use tools such as `pip-compile` to produce a list of requirements with versions pinned, transitively, for all the applications and their dependencies that are supposed to be installed in the runtime environment.\\n\\nThis does not, however, guarantee the presence of the external dependencies at the moment of installation: the PyPI servers may be down or your server may have a flaky network connection. In addition, there is a security concern with regards to pulling an external resource into your physical environment - supply chain attacks using identical (or very similarly named) PyPI packages are common ([1](https://www.fortinet.com/blog/threat-research/supply-chain-attack-using-identical-pypi-packages-colorslib-httpslib-libhttps), [2](https://www.bitdefender.com/blog/hotforsecurity/supply-chain-attack-detected-in-pypi-library/)). This is usually addressed by mirroring the external repositories into your corporate ones to minimize the security risks and improve build stability as well as verifying the checksum of the downloaded packages.\\n\\nA step further is to pre-package the application along with all its transitive dependencies. Two popular ways to package first and third-party code into a single executable file are [PEX](https://github.com/pantsbuild/pex) and [XAR](https://github.com/facebookincubator/xar). When an application is run, the virtual environment is bootstrapped out of this archive and Python code can be executed. This is perhaps an ideal way to distribute standalone tools and self-contained applications that only require having a compatible Python interpreter on the target machine. There\'s no need to install anything and one can have multiple versions of the application accessible side-by-side since they are just files. Pants, for instance, relies heavily on PEX mechanisms to prepare the runtime environment necessary for its operations. There have also been similar attempts to create a virtual environment with all the packages installed which could be compressed into an archive file and distributed as is or as part of an operating system package. This is how Python virtual environments can be distributed as Debian packages with [dh-virtualenv](https://github.com/spotify/dh-virtualenv), for instance.\\n\\nHowever, distributing raw executable files is associated with certain difficulties:\\n\\n- files contain only limited metadata and there is no notion of a version\\n- there are no standard tools for managing these types of distributions: in contrast to wheels, self-contained packages cannot be hosted on a public or private PyPI server and installed with `pip` or other package managers\\n\\nUsing a system packaging ecosystem such as Debian or RPM to package a Python executable, in contrast, may bring various benefits:\\n\\n- there is software for managing system packages such as `dpkg`/`apt`, and `yum`/`dnf` which can be used to search for, install, update, and uninstall system packages\\n- one can add an arbitrary amount of metadata to be placed into the package and later discovered using the `dpkg-query` / `rpmquery` tools\\n- packages have a native versioning notation which is understood by system tools\\n- packages can be installed via a binary repository similar to how Python wheels can be installed from the PyPI\\n- users are not responsible for installing a compatible Python interpreter to be able to install the package as the package dependencies will be satisfied by the operating system\\n- every Python file that will be installed is going to be owned by a package which makes removal of the installations a lot easier\\n\\nHowever, using operating system packages in a similar way to Python wheels (where deployable artifacts can be produced weekly or daily) comes with its shortcomings. There is an argument that Debian/RPM packages haven\'t been designed for that kind of software distribution: the initial intention was to use them to distribute system software and packages required by the operating system. This means, for example, that you cannot have multiple versions of the same package co-installed (unless using some sort of a meta package or symlinks) which makes it difficult to upgrade your running application in an atomic transaction. It is also not conventional to pin the dependencies transitively for the system packages, so it\'s not often possible to know exactly what third-party package version will be pulled upon an upgrade of your deployment.\\n\\n## Shipping the system runtime requirements\\n\\nIn contrast to compiled code, Python applications require having a compatible Python interpreter. For production deployments, this is less of an issue given the full control over the server environment. For end-user distributions, however, this may present certain challenges. Installing Python on consumer\'s devices has become a lot easier recently, but is still non-trivial as it requires installing an additional piece of software and may result in conflicts with existing system applications.\\n\\nDocker is a very popular choice for server-side deployment of Python applications and distributing executable code as it makes it ready to be run on demand. Docker is, however, a non-trivial dependency, and distributing Docker images in a corporate environment would likely require having a binary repository manager. Writing, debugging, and packaging Python code in Docker may also require ensuring the compatibility of the tooling used by your engineering organization while satisfying the security team\'s concerns. You can visit [pythonspeed.com](https://pythonspeed.com/docker/) to learn more about Docker packaging for Python code. Including static resources and Python executable files such as PEX files into a Docker image does, however, combine the best of two worlds: you get a sealed image containing the Python interpreter and the application itself, ready to be run. This is how [Docker images can be produced with Pants](https://www.pantsbuild.org/docs/docker).\\n\\nTo avoid dealing with the virtualization of the deployments, there have been attempts to include a Python interpreter in the application bundle that is being distributed. This kind of full-stack package includes first-party code (code that you write), third-party code (PyPI packages), and a compatible Python interpreter that could be run in the target environment. This is how [PyOxidizer](https://github.com/indygreg/PyOxidizer) and [PyInstaller](https://github.com/pyinstaller/pyinstaller) work: they package your project\'s files (including external dependencies) and the specified Python interpreter into a single executable file. You can experiment [building executable Python binaries with Pants using PyOxidizer](https://www.pantsbuild.org/docs/pyoxidizer).\\n\\nSimilarly, the [scie project](https://github.com/a-scie/jump) provides a way to package executable code along with an arbitrary binary such as a Python interpreter. To learn how this framework can be used in practice, take a look at the new [scie-pants](https://github.com/pantsbuild/scie-pants) project that is used to distribute the Pants executable. [You can read more about scie-pants in this week\'s blog post.](../2023-02-23-the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants/index.mdx)\\n\\nWhen shipping Python interpreter along with the application, the distribution size increases significantly, but it also makes your application much more accessible to a wider audience who may not have a compatible Python interpreter installed. For maximum reproducibility, some companies choose to compile the Python interpreter from sources before including it into the distribution, optionally, applying optimizations, as required.\\n\\n## Conclusion\\n\\nFinding the right strategy to package and distribute your Python applications and libraries requires careful thought. Each of the options come with its nuances and limitations, so you may need to experiment and iterate. It may help to speak to others and ask what works for them, and we hope you find a strategy that works for you. If you have questions, please feel free to raise a GitHub issue or ask on the Pants community Slack! It\'s a friendly and supportive community that is happy to respond to your questions and feedback."},{"id":"/2023/02/24/pants-2-15","metadata":{"permalink":"/blog/2023/02/24/pants-2-15","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-02-24-pants-2-15/index.mdx","source":"@site/blog/2023-02-24-pants-2-15/index.mdx","title":"Pants 2.15: Easier multi-platform workflows, Docker build support, automatic code cleanup, and more!","description":"\\"Blue Bill Duck\\" by","date":"2023-02-24T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":6.73,"hasTruncateMarker":true,"authors":[{"name":"Christopher Neugebauer","title":"Pants Maintainer","url":"https://github.com/chrisjrn","imageURL":"https://github.com/chrisjrn.png","key":"chrisjrn","page":null}],"frontMatter":{"authors":["chrisjrn"],"tags":["announcement"]},"unlisted":false,"prevItem":{"title":"Challenges in choosing a Python packaging format","permalink":"/blog/2023/02/24/choosing-a-python-packaging-format"},"nextItem":{"title":"Pantsbuild Community Survey 2023","permalink":"/blog/2023/02/24/pantsbuild-community-survey-2023"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  \\"[Blue Bill Duck](https://www.flickr.com/photos/43603415@N08/4738192538)\\" by\\n  Richard Ashurst licensed under CC BY 2.0\\n</CaptionedImg>\\n\\nThe 2.15 series represents the biggest change to Pants since version 2.0, and we\'re excited to share how it can let you complete more workflows, more easily, in more places. Including cross-platform builds, containerized builds with Docker, and easier configuration for local builds\u2026\\n\\n{/* truncate */}\\n\\n---\\n\\nWe\'re excited to announce Pants 2.15.0. Under the hood, the 2.15 series represents the biggest change to Pants since version 2.0, and we\'re excited to share how it can let you complete more workflows, more easily, in more places.\\n\\nAlong with our usual assortment of new tool support and incremental improvements to existing features, this update brings support for cross-platform builds, containerized builds with Docker, and easier configuration for local builds, while minimizing disruption for those of you who are only just upgrading.\\n\\nYou can update by setting `pants_version = \\"2.15.0\\"` in your `pants.toml` file. See [upgrade tips](https://www.pantsbuild.org/v2.15/docs/upgrade-tips) for more information.\\n\\n## Support for easier multi-platform development with Target Environments\\n\\nPants 2.15\'s biggest new feature is [Target Environments, unlocking support for workflows that span multiple platforms](https://www.pantsbuild.org/v2.15/docs/environments).\\n\\nWith Target Environments, you can launch workflows from your development machine, or a CI machine that include any combination of tasks that run locally, tasks that run on a local Docker container, or even tasks that run on remote build servers.\\n\\nFor users that need to test or build packages for multiple systems, Target Environments mean that you can now perform platform-independent tasks once and farm out the platform-specific pieces of your workflow to compatible systems, all from a single invocation of Pants.\\n\\nPants\' fine-grained concurrency and caching works across Target Environments, which means that Pants can run as many individual tasks as there are compatible worker machines available to you.\\n\\nAs an example, if you need to build a Mac OS package and a Linux package, it\'s possible to do it from the same workflow with Target environments:\\n\\n```python title=\\"BUILD\\"\\nlocal_environment(\\n    name=\\"macos\\",\\n    compatible_platforms=[\\"macOS_x86_64\\"],\\n    ...\\n)\\n\\ndocker_environment(\\n    name=\\"local_busybox\\",\\n    platform=\\"linux_x86_64\\",\\n    ...\\n\\n)\\n\\npex_binary(\\n    name=\\"bin\\",\\n    environment=parametrize(\\"linux\\", \\"macos\\"),\\n)\\n```\\n\\nAdditionally, Target Environments streamlines configuration in codebases whose developers do their local development on a variety of platforms. Where users previously had to individually set environment variables or command line flags to locate specific tools or runtime dependencies, it\'s now possible to set different `local_environment` targets with configuration for each platform. When Pants is run on a machine that matches those specifications, the configuration values from that environment are used.\\n\\n```python title=\\"BUILD\\"\\nlocal_environment(\\n    name=\\"macos\\",\\n    compatible_platforms=[\\"macOS_x86_64\\"],\\n    ...\\n)\\n\\nlocal_environment(\\n    name=\\"macos_arm\\",\\n    compatible_platforms=[\\"macos_arm64\\"],\\n    ...\\n)\\n```\\n\\nTarget Environments represent one of the biggest internal changes to Pants since version 2.0, unlocking a huge variety of new use cases, while keeping the user API for existing workflows entirely the same. This means you can adopt Target Environments as you need them, but remain blissfully unaware of them until you do.\\n\\nTo read more about this quite large feature, you can read our in-depth blog post.\\n\\n## Containerized local development support with the Docker command runner\\n\\nIf you\'re in an organization that deploys applications in containers, it can often make sense for developers to do their testing and local verification in a containerized environment. In previous versions of Pants, if you wanted to run tools or check behaviors inside a container, you\'d need to import your codebase into a container and run Pants itself within the container.\\n\\nNow, thanks to Target Environments and our new Docker command runner, Pants can use its precise understanding of the files required in your build to run tools, tests, and other processes transparently inside a local Docker container. Just [define a `docker_environment` to define your container\'s properties](https://www.pantsbuild.org/v2.15/docs/reference-docker_environment), set the `environment` on the parts of your codebase that you want to handle in Docker, and Pants will take care of the rest.\\n\\n## Stop making linters pass manually, `fix` your code automatically!\\n\\nPants supports a wide array of quality checkers that can point out where your code is unsafe, uses deprecated code patterns, or fails documentation standards. Often, running `./pants lint` means being faced with a pile of small, trivial changes to make.\\n\\nPants also supports code formatters through `./pants fmt`, which takes care of style fixes that are purely mechanical, and result in structurally identical code.\\n\\nWhile many quality checkers supported by `./pants lint` have fixup modes, previously we haven\'t supported that since many quality checkers make changes that may not result in identical code. Running these tools with `./pants fmt` can sometimes have unexpected consequences.\\n\\nPants 2.15 lets you run your tools in fixup mode! [Use `./pants fix`](https://www.pantsbuild.org/v2.15/docs/reference-fix), and Pants will ask your underlying tools to automatically apply all the changes they can, from simple formatting changes, to adjustments that may have semantic consequences. If you happen to have a workflow where you want to only run formatters, `./pants fmt` is still around.\\n\\nWe\'ve been using `./pants fix` internally for a few months now, and we\'ve appreciated the time saved from not having to manually fix simple linting errors. Now you can, too!\\n\\n## OpenAPI support with dependency inference for JVM projects\\n\\nPants 2.15.0 adds [initial support for OpenAPI](https://www.pantsbuild.org/v2.15/docs/reference-openapi_source), along with `./pants tailor` support for OpenAPI schemas, and support for automatically generating JVM bindings based on OpenAPI schemas in your repository.\\n\\nFor JVM users, this means that writing code that depends on bindings generated from an OpenAPI schema is as simple as declaring an `openapi_document` target that depends on your schema and importing the resulting package in your JVM code. Bindings will be automatically built when you build your code, with no need to deploy extra artifacts. When your schema changes, new bindings will automatically be available.\\n\\n## Describe your codebase better with synthetic targets\\n\\nPlugins can now programmatically create their own targets, which can be used as dependencies in your `BUILD` files or as goal targets when invoking a Pants command line.\\n\\nIt\'s early days yet, but in future releases synthetic targets will allow users and plugin authors to better specify the structure of their codebase along with dependencies that can\'t currently be effectively modeled with Pants.\\n\\n## Other notable changes\\n\\n- A plethora of improvements in Go, including access to the `go` binary in tests, `go generate` support, and better lint and `./pants tailor` functionality\\n- Formatters and linters can now operate on any file in the project without prior configuration\\n- Tests can now be run in batches, reducing the amount of time lost to starting up test runners\\n- Adds the `preamble` plugin, which ensures that applicable files start with a standardized message, such as a copyright or licensing notice\\n\\nWe also recently released the new self-contained Pants launcher, which allows you to run Pants without needing to install a compatible Python installation first. It works with previous versions of Pants, as early as 2.12.\\n\\nSee the full [changelog](https://github.com/pantsbuild/pants/blob/release_2.15.0/src/python/pants/notes/2.15.x.md) for more changes, along with our [plugin upgrade guide](https://www.pantsbuild.org/docs/plugin-upgrade-guide).\\n\\n---\\n\\nTry out one of our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)\\n\\nFor those of you paying close attention, you may have noticed that the 2.15 release has taken quite some time while we worked to make sure that things didn\'t break. The good news is that in the meantime, we\'ve been hard at work on new features that will land in 2.16, including support for [Python linting with Ruff](../2023-02-28-linting-python-at-warp-speed/index.mdx), support for integrating new tools into your Pants codebase without writing plugins, and more!"},{"id":"/2023/02/24/pantsbuild-community-survey-2023","metadata":{"permalink":"/blog/2023/02/24/pantsbuild-community-survey-2023","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-02-24-pantsbuild-community-survey-2023/index.mdx","source":"@site/blog/2023-02-24-pantsbuild-community-survey-2023/index.mdx","title":"Pantsbuild Community Survey 2023","description":"Photo by [Jon","date":"2023-02-24T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":1.14,"hasTruncateMarker":true,"authors":[{"name":"Carina C. Zona","title":"Pants Maintainer","url":"https://github.com/cczona","imageURL":"https://github.com/cczona.png","key":"cczona","page":null}],"frontMatter":{"authors":["cczona"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"Pants 2.15: Easier multi-platform workflows, Docker build support, automatic code cleanup, and more!","permalink":"/blog/2023/02/24/pants-2-15"},"nextItem":{"title":"The pants launcher binary - a much simpler way to install and run Pants","permalink":"/blog/2023/02/23/the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Jon\\n  Tyson](https://unsplash.com/@jontyson?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nEvery year, we do a survey to identify community members\' wishlist for the year ahead, and get a sense of what\'s highest priority for you. Please take the survey now!\\n\\n{/* truncate */}\\n\\n---\\n\\nHello friends! Every year around this time, we do a survey of the community, to identify community members\' wishlist for the year ahead, and get a sense of what\'s highest priority. Your responses help the Pantsbuild team figure out how to make the most impact on your productivity. The survey has two rounds: in round 1, we gather your freeform ideas and then either connect them to an existing issue or open new issues. In round 2, we ask you to help rank the issues.\\n\\nThank you for your responses to round 1 of the survey! We have gone through all of the responses, and now it\'s time for round 2. This survey asks you how important certain features would be to your continued or increased use of Pants. [Take the survey now!](https://forms.gle/BK6muo7oWQFSiAmh6) Please respond to the survey only once, but feel free to send it to any Pants-using friends you may have. Thanks again, we\'re excited to hear what you\'re interested in!"},{"id":"/2023/02/23/the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants","metadata":{"permalink":"/blog/2023/02/23/the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-02-23-the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants/index.mdx","source":"@site/blog/2023-02-23-the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants/index.mdx","title":"The pants launcher binary - a much simpler way to install and run Pants","description":"Photo by Granada, used under the [CC Attribution-ShareAlike 4.0","date":"2023-02-23T00:00:00.000Z","tags":[],"readingTime":4.97,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":[]},"unlisted":false,"prevItem":{"title":"Pantsbuild Community Survey 2023","permalink":"/blog/2023/02/24/pantsbuild-community-survey-2023"},"nextItem":{"title":"My experience as a Pantsbuild maintainer","permalink":"/blog/2023/02/14/my-experience-as-a-pantsbuild-maintainer"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by Granada, used under the [CC Attribution-ShareAlike 4.0\\n  International](https://creativecommons.org/licenses/by-sa/4.0/) license\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\n_TL;DR Ensuring that an appropriate Python interpreter is available for running Pants has always been a stumbling block. Now Pants embeds its own interpreter and you don\'t have to worry about it! With the new `pants` launcher binary, developing, publishing and using Pants gets a whole lot easier._\\n\\n### Why Pants needs a Python interpreter\\n\\nPants consists of two main layers: The core, generic execution engine is written in Rust, for performance, while the pluggable rules that implement specific build functionality are written in Python, for familiarity and ease of use.\\n\\nThis architecture is powerful and has many benefits. But there was always one drawback: any system you ran Pants on, whether a developer laptop or a CI machine, had to have a suitable Python interpreter available. The `./pants` runner script then had logic in it to detect that appropriate (i.e., Python 3.7, 3.8 or 3.9) interpreter on the `$PATH`, or fail if it couldn\'t find one.\\n\\nNote that this interpreter selection was distinct from the method used to select the interpreter your code runs on. After all, Pants can run your tests using Python 3.10, 3.11, or even 2.7! But it still needed a 3.7-3.9 interpreter to run its own rule code on. And yes, this often caused confusion for users.\\n\\n### Interpreter Hell\\n\\nEnsuring that a suitable interpreter is available was often annoying to users. And this was especially true as more codebases moved to Python 3.10 or 3.11 for their own code, or didn\'t use Python at all (Pants is now increasingly used in JVM and Go repos), yet still needed to keep an older interpreter around to run Pants on.\\n\\nIt was also not uncommon for the `./pants` script to fail to find or use the right interpreter. For example, interpreters installed using [pyenv](https://github.com/pyenv/pyenv), with their fluctuating shim files, sometimes caused issues. And the situation on macOS was particularly finicky: the system interpreters are often unable to run Pants, and installing Python 3.7/3.8 interpreters on [Apple Silicon](https://en.wikipedia.org/wiki/Apple_silicon) machines is tricky.\\n\\nWe could have partially solved this problem by supporting more versions of Python. But because Pants includes a lot of native code written in Rust, each Python version requires a separate wheel, so this would have become an ever-increasing maintenance burden.\\n\\n### Embedding an interpreter\\n\\nInstead, we\'ve implemented the [Alexandrian solution](https://www.thefreedictionary.com/Alexandrian+solution#:~:text=n.-,1.,an%20intricate%2C%20seemingly%20insoluble%20problem.) of releasing Pants with its own embedded interpreter.\\n\\nStarting with the upcoming 2.15.0 release, we\'re introducing an [entirely new way](https://www.pantsbuild.org/v2.15/docs/installation) of installing and running Pants. Instead of checking a `./pants` launcher script into your repo, you install a new `pants` launcher binary. You can install this binary by running [this script](https://github.com/pantsbuild/setup/blob/gh-pages/get-pants.sh) or, on macOS, using `brew`.\\n\\nThe launcher binary is not tied to a specific Pants version. When you run `pants` in a repo, it first ensures that it has bootstrapped its embedded interpreter. Then it reads the version of Pants used in the repo out of your `pants.toml` and ensures that version is bootstrapped. And finally it delegates the actual command processing to that version of Pants. This means that you continue to control the version of Pants used in your repo via `pants.toml`, and you don\'t need to futz around with installing different versions. A single `pants` launcher binary can work with different Pants versions in different repos on your machine.\\n\\nAnd, as an added bonus, launching Pants via the `pants` binary is about 33% faster than using the `./pants` script!\\n\\nYou cannot use the embedded interpreter for your own code, so if you have Python in your repo you\'ll still have to ensure that an interpreter is available for running your tests etc. But that\'s a pretty sensible requirement, that enforces the separation between Pants\'s internal use of Python as an implementation detail and your repo\'s use of Python.[^1]\\n\\nThe embedded interpreter is currently Python 3.9, and we will continue to [release Pants](https://pypi.org/project/pantsbuild.pants/) for 3.7 and 3.8 for a while. But in the long run the plan is to release Pants for just a single embedded interpreter, which we can upgrade as new versions of Python are released.\\n\\nIf you\'re using Pants in a GitHub Actions workflow, we\'ve updated the [init-pants](https://github.com/pantsbuild/actions/tree/main/init-pants) action to take care of installing the `pants` launcher binary. Use `pantsbuild/actions/init-pants@v4-scie-pants` to pick up this functionality. If you\'re using a different CI provider you can follow the lead of that action in that provider\'s config vernacular.\\n\\n### How does this work?\\n\\nThe `pants` launcher binary uses a new technology we\'ve developed called [SCIE](https://github.com/a-scie/jump) (Self-Contained Interpreted Executable). SCIEs support embedding an interpreter with the code to run on it, creating a truly self-contained binary. SCIE works with Python, Ruby, JS and even JVM! And SCIE is pronounced \\"ski\\", to afford good \\"scie pants\\" puns.\\n\\nWe\'ll talk more about SCIEs, and how to build them, in a future blog post. And we hope to make Pants able to build SCIEs from your own code soon.\\n\\n### Kudos\\n\\nWe provide the embedded interpreter using the [Python Standalone Builds](https://gregoryszorc.com/docs/python-build-standalone/main/), so many thanks to [@indygreg](https://github.com/indygreg) for making these available!\\n\\n---\\n\\n[^1]: The one slight exception is if you have custom Pants plugin code in your repo. Such code has two facets: It runs in the Pants engine, so it executes on the embedded interpreter, but it is code in your repo, which presumably has tests (you did write tests, yes?) and those need to run on an interpreter (3.9 in this case) that you install."},{"id":"/2023/02/14/my-experience-as-a-pantsbuild-maintainer","metadata":{"permalink":"/blog/2023/02/14/my-experience-as-a-pantsbuild-maintainer","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-02-14-my-experience-as-a-pantsbuild-maintainer/index.mdx","source":"@site/blog/2023-02-14-my-experience-as-a-pantsbuild-maintainer/index.mdx","title":"My experience as a Pantsbuild maintainer","description":"Photo by [Xavi","date":"2023-02-14T00:00:00.000Z","tags":[],"readingTime":5.28,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":[]},"unlisted":false,"prevItem":{"title":"The pants launcher binary - a much simpler way to install and run Pants","permalink":"/blog/2023/02/23/the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants"},"nextItem":{"title":"Tweag case study: From adopting Pants, to generalizing our CI to multiple Python versions","permalink":"/blog/2023/01/03/tweag-case-study"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Xavi\\n  Cabrera](https://unsplash.com/@xavi_cabrera?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nA Pants maintainer\'s personal and professional retrospective on nearly two years of involvement in the project, starting as a curious newcomer.\\n\\n{/* truncate */}\\n\\n:::info\\nAlexey Tereshenkov has been an active contributor to Pants community since mid-2021. Starting in February 2022, he has also been a Pants core maintainer. Alexey looks back on the personal and professional experience of deepening one\'s involvement in this open source project.\\n:::\\n\\nIn this post, I\'d like to share my experience being involved in Pants project during the past year and a half, and what being involved as a team member has been like.\\n\\nAfter spending some time evaluating Pants build system in the summer of 2021, I\'ve started working on integrating it into a Python monorepository at my workplace. I\'ve spent most of the time reading the documentation and searching for answers by raising GitHub issues and interacting with the community in Slack.\\n\\nPants didn\'t have support for the `yapf` Python formatter (which we used at work back then), so I have decided to write a plugin to make it a core feature of Pants. I have already shared some insights about [my plugin development experience](../2021-09-27-contributing-yapf-support/index.mdx) in an earlier post.\\n\\nAfter making a few more minor improvements to the project, in July 2021, I was offered becoming a [contributor](https://www.pantsbuild.org/docs/the-pants-community#contributors) and accepted the offer. There are multiple advantages to being a recognized contributor, for example, you are more likely to get attention when you are troubleshooting an issue and receive mentorship in activities like code review. The Pants team made it very clear that there are no obligations or expectation of any commitments in terms of the contributions in any form.\\n\\nWhile completing the adoption of Pants at work, I have made a few more minor contributions in the form of documentation improvement and simple minor code refactorings. At some point, I have decided to start working on adding [Debian packaging support in Pants](https://github.com/pantsbuild/pants/issues/12421) which is how we preferred to distribute Python tools in our organization. At about this time, I was offered to become a [maintainer](https://www.pantsbuild.org/docs/maintainers). This sounded more serious and it is in fact a more significant change in comparison to becoming a contributor since a maintainer does have a list of [responsibilities](https://www.pantsbuild.org/docs/maintainers#what-do-maintainers-do) which is why I was hesitant at first. I was worrying that I would struggle to combine my current job, Pants contributions, and personal life. However, becoming a maintainer does come with a variety of benefits: you have more control over the course of project development, you get a chance to work more closely with the rest of project maintainers and have more powerful GitHub permissions to speed up PR approvals and interact with the CI pipeline.\\n\\n:::note [Editors note]\\nEditors note: Thanks to feedback by Alexey and others, the team later thoroughly rewrote the maintainer description to better communicate what is and isn\'t expected. [Take a look](https://www.pantsbuild.org/docs/maintainers)!\\n:::\\n\\nI have always been interested in being a part of a community of open-source project developers, so I decided to give it a try and the team voted to accept my candidacy. That was an exciting time! Among the good things I mentioned earlier about being a maintainer, I also got a privilege to interact more closely and get to know better other core maintainers which I have really, really enjoyed.\\n\\nAt some point, I was just too busy with the rest of my job duties, so I haven\'t written much code, and only fixed a few minor issues over the course of many months. However, it\'s important to keep in mind that project contributions may come in different shapes! For example, I have curated the docs and wrote quite a few blog posts hoping to help with Pants adoption and share some practical advice on using Pants in a Python monorepository. I\'ve also lately been writing a series of tutorials on plugin development. As I became more familiar with the Pants build system, I have also started interacting with other Pants users trying to help them with their issues and questions in the public Slack workspace.\\n\\nBeing involved in Pants development has also let me feel welcomed in a community of peer developers who share the same passion for the build systems I do which is something I value a lot. Everyone understands, though, that maintaining a high cadence of contributions to an open-source project when your main focus at work isn\'t all about that project is very difficult. Your involvement will vary with time: there will be time when you won\'t have any chance to contribute because you are snowed under at work, and there will be periods when you will be absorbed by it perhaps when thinking about a new plugin development or when driving adoption of Pants for a new language in your repository. Despite not being able to ship any code for months, I have never felt any pressure from the team which, in contrast, championed my efforts when I was blogging and tidying up the docs.\\n\\nFrom an engineering perspective, becoming a Pants project contributor or a maintainer gives you a chance to become more familiar with the [open-source development model](https://www.pantsbuild.org/docs/contributor-setup). It is a fairly large Python codebase with rigid standards on code quality in terms of structure, formatting, type checking, and linting. The team faces the challenge to make sure Pants operate correctly on popular architectures (x86 and arm) and platforms (Linux and Darwin). The codebase features concurrent Python code, [Rust interaction](https://www.pantsbuild.org/docs/contributions-rust), and sophisticated CI pipeline. Pants project is a safe place that provides a great platform to grow as a Python software engineer. There is a sheer variety of integrations with other programming languages such as Java and Go and systems such as Docker and Shell.\\n\\nCome and join the project - you may be our next contributor and maintainer who will help drive Pants project to keep software developers happy and productive!"},{"id":"/2023/01/03/tweag-case-study","metadata":{"permalink":"/blog/2023/01/03/tweag-case-study","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-01-03-tweag-case-study/index.mdx","source":"@site/blog/2023-01-03-tweag-case-study/index.mdx","title":"Tweag case study: From adopting Pants, to generalizing our CI to multiple Python versions","description":"At Tweag we have a lot of experience with Bazel, as we maintain the Haskell rules. However, I had feedback that Bazel\'s Python support was not ideal. In contrast, Python is Pants\' strong point. My client\'s fear of boilerplate also made Bazel unappealing. Whereas, Pants reduces boilerplate\u2026","date":"2023-01-03T00:00:00.000Z","tags":[{"inline":true,"label":"case-studies","permalink":"/blog/tags/case-studies"},{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"users","permalink":"/blog/tags/users"}],"readingTime":8.21,"hasTruncateMarker":true,"authors":[{"name":"Cl\xe9ment Hurlin","title":"Director of Engineering at Tweag","url":"https://github.com/smelc","imageURL":"https://github.com/smelc.png","key":"clement","page":null}],"frontMatter":{"authors":["clement"],"tags":["case-studies","python","users"]},"unlisted":false,"prevItem":{"title":"My experience as a Pantsbuild maintainer","permalink":"/blog/2023/02/14/my-experience-as-a-pantsbuild-maintainer"},"nextItem":{"title":"How we get quick feedback on new features via \\"experimental\\" backends","permalink":"/blog/2022/11/21/quick-feedback-on-new-features-via-experimental-backends"}},"content":"<CaptionedImg src={require(\\"./splash.png\\").default}></CaptionedImg>\\n\\nAt Tweag we have a lot of experience with Bazel, as we maintain the Haskell rules. However, I had feedback that Bazel\'s Python support was not ideal. In contrast, Python is Pants\' strong point. My client\'s fear of boilerplate also made Bazel unappealing. Whereas, Pants reduces boilerplate\u2026\\n\\n{/* truncate */}\\n\\n---\\n\\nI\'m a principal engineer at [Tweag](https://www.tweag.io/), a consultancy company offering expertise in robust build systems, functional programming, and data science. In Spring 2022 I was put in charge of setting up the monorepo of a healthcare startup: [kaiko.ai](https://www.kaiko.ai/). Kaiko was dedicated to starting its development with a monorepo from nearly day 0, as the CTO wanted to spread best practices and great CI support to all projects and developers. This project culminated in adopting Pants in our setup. In this post I want to detail our journey:\\n\\n1.  How we came to choose Pants as our scalable build tool for this monorepo,\\n2.  How we proceeded to adopt Pants smoothly, and\\n3.  How we generalized our existing Pants CI to support multiple Python versions.\\n\\n---\\n\\n## Motivating Pants in a healthcare startup\\n\\nKaiko\'s monorepo is hosted on GitHub. To deliver a working repository as fast as possible, I initially made its CI modular by using GitHub Actions [paths triggers](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#running-your-workflow-based-on-files-changed-in-a-pull-request). Concretely, a library living in `libs/A` had a `paths` trigger of the form `libs/A/**` in its CI pipeline. While this was an easy way to start, it did not scale very well: everytime a library was added, its trigger needed to be written manually. Even worse, as the dependency graph between libraries was complexifying, the triggers had to be adapted accordingly: if `libs/B` depends on `libs/A`, the trigger of `B`\'s CI must be both `libs/B/**` and `libs/A/**`.\\n\\nSo, a few months after the monorepo\'s initial version, people started to worry about the CI\'s level of boilerplate. In addition, a number of triggers had been erroneous a number of times already: we had evidence manual maintenance was too error prone to be sustainable in the long term.\\n\\nAt this point I did a quick tour of the build tools available for monorepos:\\n\\n1. At Tweag we have had a lot of experience with Bazel, as we maintain the [Haskell rules](https://github.com/tweag/rules_haskell) and work for various clients in other languages. However I had feedback that the Python support with Bazel was not ideal. In contrast, Python is Pants\' strong point.\\n2. Kaiko\'s fear of boilerplate did not make Bazel appealing. Whereas the reduced boilerplate offered by Pants was very attractive.\\n3. Kaiko already had a developer internally advocating for Pants.\\n\\nPants was the strongest candidate for the monorepo.\\n\\n## Initial adoption of Pants\\n\\nAt this point, I listed the tools in use in Kaiko\'s monorepo. It was pretty standard: [black](https://github.com/psf/black), [flake8](https://flake8.pycqa.org/en/latest/), [isort](https://pycqa.github.io/isort/), [shellcheck](https://www.shellcheck.net/), [bandit](https://bandit.readthedocs.io/en/latest/), etc. All these tools were supported already in Pants, but two weren\'t: [yamllint](https://github.com/adrienverge/yamllint) and Microsoft\'s [pyright](https://github.com/microsoft/pyright) Python typechecker. Pants\' not supporting pyright was a potential blocker for Kaiko, as it was used in their regular CI already, and also locally by developers. Pyright\'s ability to report errors as you type was a big plus over [mypy](http://mypy-lang.org/), so we didn\'t want to switch. This is how I first came in touch with Pants\' community: I opened [an issue](https://github.com/pantsbuild/pants/issues/17141) on Pant\'s GitHub to ask whether pyright support could be added.\\n\\nIn a matter of hours, I was blown away by the responsiveness of the community as the issue\'s comments show, as well as the discussions on Pant\'s Slack. [Suresh Joshi](https://github.com/sureshjoshi) rolled out a proof of concept of pyright integration within Pants in a matter of days and he then iterated to improve it, based on feedback from me trying his code on our production use case. This caused a streak of issues to be created (here is [one](https://github.com/pantsbuild/pants/issues/17225), here is [another](https://github.com/pantsbuild/pants/issues/17816)) and this fast feedback loop contributed to Kaiko committing to using Pants, even if, at this point, pyright support is not yet mature enough to support our production use case. But we are confident it will be the case soon!\\n\\nThe second tool that we needed support for in Pants is [yamllint](https://github.com/adrienverge/yamllint). At [Tweag](https://www.tweag.io/), we seized this occasion to evaluate how easy it was to write plugins in Pants and created our [pants-yamllint-poc](https://github.com/tweag/pants-yamllint-poc) repository. While there is a bit of boilerplate when writing plugins, we deemed it acceptable, and we could get away by taking inspiration from [shellcheck\'s plugin](https://github.com/pantsbuild/pants/tree/97c4ede10978fe20750ddc2642149d8b8a841126/src/python/pants/backend/shell/lint/shellcheck). After having validated our proof of concept in production, we opened [a PR](https://github.com/pantsbuild/pants/pull/17821) to have yamllint support merged into Pants. We received helpful feedback on the PR to move it forward.\\n\\nTo adopt Pants serenely, I proposed internally that we bring our new Pants CI on par with the features of our regular CI. One nice feature of our regular CI is that it was parameterized with a matrix to use multiple versions of Python. In the rest of this post, I will describe how I brought this feature to our Pants CI.\\n\\n## Using multiple Python versions\\n\\nOne strong argument for using Pants was the quality of the documentation. However, when looking at the documentation for [using multiple interpreters in Python](https://www.pantsbuild.org/docs/python-interpreter-compatibility), I was at first puzzled that the doc indicated how to _declare_ multiple interpreters but not how the multiple interpreters are actually used to (spoiler alert: the doc is getting updated regarding this)! This is why, after having added `interpreter_constraints=parametrize(py38=[\\"==3.8.*\\"], py39=[\\"==3.9.*\\"])` to one `python_sources` declaration, I tried to reproduce my regular CI setup with Pants, using a [matrix](https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs) with one Python version available in each instance of the matrix, and restricting targets to the running interpreter with [`\u2013filter-tag-regex`](https://www.pantsbuild.org/docs/advanced-target-selection#--filter-tag-regex).\\n\\nWhat a fool I was! After having asked for helped on Pants\' [#general Slack channel](https://pantsbuild.slack.com/archives/C046T6T9U), I realized that **the interpreter used to run Pants is independent from the interpreters that Pants uses for executing targets. This simplified the CI setup, because I could get rid of the matrix and simply install all required Python versions in a single job**, which is straightforward because the GitHub [`setup-python`](https://github.com/actions/setup-python) action can be used multiple times in a single job.\\n\\nPants\' documentation gives its `interpreter_constraints` example on a `python_sources` declaration, which is the first thing I tried. However, having multiple Python versions in `python_sources` is contaminating, because many targets depend on `python_sources`. For example `python_distribution` depends on `python_sources`, but `python_distribution` doesn\'t support multiple interpreters: it requires specifying an exact version. Generalizing `python_sources` hence proved creating noise in `BUILD` files, for little advantages.\\n\\nA simpler way to proceed was to put `interpreter_constraints` on `python_tests` declarations. This is less intrusive because `python_tests` declarations typically do not have other targets depending on them. Tests are also the first thing you usually want to generalize, because they are obviously sensitive to different Python versions. Typechecking is another such target, but I wasn\'t able to try generalizing it yet, since we are waiting for pyright support to be production ready, as explained above.\\n\\nFinally, to support multiple Python versions, you need to generalize the `interpreter_constraints` declaration in the top-level `pants.toml` file. When you change this declaration, you typically need to regenerate lockfiles with `./pants generate-lockfiles`, because lockfiles are affected by the possible Python version. While doing so, I encountered two issues which were quickly solved by discussing on Pants\' Slack:\\n\\n1.  Despite having regenerated its lockfile, black was failing with: `InvalidLockfileError: You are using the lockfile at pants-utils/3rdparty/python/black_lockfile.lock to install the tool black, but it is not compatible with your configuration.` This proved to be caused by Pants sometimes picking up a default `interpreter_constraints` instead of the global one declared in _pants.toml_. Copying the `interpreter_constraints` declaration of the `[python]` section to the `[black]` section solved the problem.\\n2.  When generalizing to use both Python 3.8 and Python 3.9, I had written _`interpreter_constraints`_ in the form `[\\"==3.8.*\\", \\"==3.9.*\\"]`. However I was facing error messages of the form _`Expected a single interpreter constraint for libs/kaiko:kaiko-lib-dist, got: CPython!=3.9.*,==3.8.* OR CPython!=3.9.*,==3.9.*.`_ At this point I was puzzled since the conjunction to the right is unsatisfiable and I expected it would be eliminated automatically. However, it turned out that my `interpreter_constraints` was better written `[\\">=3.8,<3.10\\"]`. Albeit equivalent to the previous one, this one is better supported. My initial `[\\"==3.8.*\\", \\"==3.9.*\\"]` constraint uses a historical disjunction that dates back to Pants v1 and is now legacy. Better avoid it.\\n\\n## Conclusion\\n\\nMy overall impression of introducing Pants to my client is very positive. Because day-to-day developers were sensitive to limiting boilerplate, Pants was easily accepted. For authors and maintainers of the CI, Pants greatly simplified the existing pipelines, by avoiding the need for matrices, and by avoiding manual triggers for scaling (we use Pants\' [`\u2013changed-since`](https://www.pantsbuild.org/docs/reference-changed) feature for having the CI scale).\\n\\nThe fast feedback loop with Pants\' developers as well as helpful support on Slack also made for a great journey. Thanks everyone for your support! \u2764\uFE0F"},{"id":"/2022/11/21/quick-feedback-on-new-features-via-experimental-backends","metadata":{"permalink":"/blog/2022/11/21/quick-feedback-on-new-features-via-experimental-backends","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-11-21-quick-feedback-on-new-features-via-experimental-backends/index.mdx","source":"@site/blog/2022-11-21-quick-feedback-on-new-features-via-experimental-backends/index.mdx","title":"How we get quick feedback on new features via \\"experimental\\" backends","description":"Image by NTNU, Faculty of Natural Sciences","date":"2022-11-21T00:00:00.000Z","tags":[{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"},{"inline":true,"label":"under-the-hood","permalink":"/blog/tags/under-the-hood"}],"readingTime":3.84,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["concepts","under-the-hood"]},"unlisted":false,"prevItem":{"title":"Tweag case study: From adopting Pants, to generalizing our CI to multiple Python versions","permalink":"/blog/2023/01/03/tweag-case-study"},"nextItem":{"title":"Case Study: Introducing Pants to Oxbotica","permalink":"/blog/2022/11/04/introducing-pants-to-oxbotica"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Image by NTNU, Faculty of Natural Sciences\\n  ([license](https://creativecommons.org/licenses/by/2.0/))\\n</CaptionedImg>\\n\\nPants balances release velocity and end-user stability via judicious use of deprecation cycles. Experimental backends are a way to get quick feedback on new functionality, before \\"graduating\\" it to the formal deprecation policy. Experimental features are still well-supported, and not to be feared!\\n\\n{/* truncate */}\\n\\n---\\n\\nPants is a large project, with a lot of moving parts. It ships with, at the time of writing, dozens of opt-in [backends](https://www.pantsbuild.org/docs/enabling-backends) and over 900 [options](https://www.pantsbuild.org/docs/options) to configure various aspects of those backends as well as of the core system. As a result, the system has a large \\"surface area\\".\\n\\nGranted, almost all options have sensible defaults, and the repo administrators use the `pants.toml` config file, and sometimes wrapper scripts, to set up Pants workflows for their end users. So the majority of end users only interact with a small part of the total user interface in their day-to-day work. But nonetheless, Pants upgrades can cause disruptive changes.\\n\\nSo how do we make changes while reducing frustration for our users?\\n\\n### Balancing velocity and stability\\n\\nIntroducing changes without causing frequent disruption is a delicate balancing act: admins and users want new features and improvements, but don\'t want to constantly have to undo muscle memory and relearn config settings and command-line incantations.\\n\\nOften, changes \u2014 even substantial ones \u2014 don\'t affect the existing user interface. For example, performance improvements, or new configuration options whose default value continues some existing behavior. In those cases we can introduce changes without disruption.\\n\\nIn other cases, where the existing user interface is affected by a change, we employ [deprecation cycles](https://www.pantsbuild.org/docs/deprecation-policy), so that users can transition to new behavior smoothly, with ample warning, and clear instructions on how to migrate.\\n\\nDeprecations are useful handrails that allow us to improve and develop Pants without sharp disruptions to users. But they have a cost - during a deprecation cycle we typically have to support both old and new behavior, and the interaction between them.\\n\\n### Experimental features\\n\\nSo what happens when we introduce brand-new features, such as new language support backends? Since Pants is an open-source project, we don\'t have a team of product managers, UX researchers or UI designers to figure out the detailed design of a feature. Instead, we have to rely on some amount of trial and error. During these initial R&D phases, we want to be able to move rapidly towards a stable interface for the new feature, without the burden of deprecation cycles, while still subjecting the existing parts of Pants to our more rigorous stability policy.\\n\\nSo how do we telegraph to users that a backend or feature is in this nascent, feedback stage? We refer to them as `experimental`.\\n\\nFor example, to opt in to Terraform support, you add `pants.backend.experimental.terraform` to your `backend_packages` in `pants.toml`. That `experimental` name tells you that Terraform support is still subject to interface changes without a deprecation cycle.\\n\\n### Don\'t fear the experiment!\\n\\nBut `experimental` does NOT mean that a backend is \\"lesser\\" in some way. It doesn\'t designate \\"alpha\\" or \\"beta\\" quality - we use alpha and rc releases for that. It doesn\'t mean that you should expect errors. It just means that the API \u2014such as BUILD file definitions and output paths \u2014 might change without a deprecation cycle (there will still be warnings in the [changelog](https://www.pantsbuild.org/docs/changelog)).\\n\\nAll the `experimental` backends are fully supported or maintained by the Pants developers, and they will be part of Pants for the long run. In fact, it is the destiny of every \\"experimental\\" backend to lose its `experimental` designation, and become, e.g., just `pants.backend.terraform`. As `experimental` backends tend to be newer, they may not yet have every capability you might want, but hearing from you about missing features is a good way to prioritize them!\\n\\nSo think of `experimental` as a preview program - in fact, we are considering using the term `preview` instead (watch this space!)\\n\\nSo you can use `experimental` backends with confidence - they are not second tier, or lower quality. The only downside of using an `experimental` feature is that its interface might change on you as you upgrade to a newer Pants version, but the upside is that as an early adopter you get to influence the development of that interface!\\n\\nGot ideas for new experimental backends? Want to help develop one? Have feedback on an existing one? Come [chat with us](https://www.pantsbuild.org/docs/getting-help) on Slack!"},{"id":"/2022/11/04/introducing-pants-to-oxbotica","metadata":{"permalink":"/blog/2022/11/04/introducing-pants-to-oxbotica","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-11-04-introducing-pants-to-oxbotica/index.mdx","source":"@site/blog/2022-11-04-introducing-pants-to-oxbotica/index.mdx","title":"Case Study: Introducing Pants to Oxbotica","description":"Photo by [Jake","date":"2022-11-04T00:00:00.000Z","tags":[{"inline":true,"label":"ci","permalink":"/blog/tags/ci"},{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"case-studies","permalink":"/blog/tags/case-studies"}],"readingTime":23.24,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":["ci","python","case-studies"]},"unlisted":false,"prevItem":{"title":"How we get quick feedback on new features via \\"experimental\\" backends","permalink":"/blog/2022/11/21/quick-feedback-on-new-features-via-experimental-backends"},"nextItem":{"title":"Celebrating two years of Pants 2","permalink":"/blog/2022/10/27/celebrating-two-years-of-pants-2"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Jake\\n  Blucker](https://unsplash.com/@jakeblucker?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nA year in, builds take only a few minutes (~150K LOC, ~1500 tests), PRs have become smaller as devs no longer try to squeeze as much as code as possible into a single change, code reviews get completed much faster (and are more likely to provide useful feedback), development velocity has increased\u2026\\n\\n{/* truncate */}\\n\\n## Background\\n\\nAt [Oxbotica](https://www.oxbotica.com/), we are on a mission to make the Earth move. The company is a global leader in autonomous vehicle software for businesses. This year an Oxbotica vehicles set the Europe-first precedent for zero-occupancy autonomous vehicle journey on publicly-accessible roads. Founded in 2014 and headquartered in Oxfordshire, England, we are a fast-growth company focused on artificial intelligence engineering, machine learning and modular software design.\\n\\nOur Python code repository represents a unified codebase containing code for multiple projects that share underlying dependencies, functionality, tooling, and processes. There are multiple teams within Oxbotica working on separate parts of the repository, but they very often overlap, particularly on these shared dependencies. However, as the organization and the codebase grew, the repository and its build complexity grew with it. Our company has used Pants in the Python monorepository for over a year now, and in this post I\'ll share our experience and the motivation to introduce Pants as a new build system for the our Python codebase.\\n\\n## Challenges\\n\\nAs our company got bigger, more and more engineers started contributing to the Python repository. Each project was a `conda` package that has its 3rd party dependencies as well as peer dependencies (i.e. other projects in the same repo) declared in the `conda` build files. Local development workflow was fairly streamlined as developers spent most of their time within a single project and could run project tests. However, ensuring cross-project compatibility wasn\'t easy because `conda` had to resolve dependencies of each project independently. In addition, each package was versioned independently which meant that developers couldn\'t easily run the tests that span multiple projects since that would require spending too much time resolving dependencies and preparing the `conda` environments. This approach was quite inefficient as it\'s often unnecessary to rebuild and retest a project if its code and code of its dependencies haven\'t changed.\\n\\nThis way, even though all the code was stored in a single Git repository, technically, it was just a common storage of interdependent projects. It wasn\'t possible any longer to complete the local and CI builds in feasible time and after doing some research, we have decided that its time to move to a monorepository approach. This would ideally require bringing a special build system. That\'s how we discovered Pants.\\n\\n## Why a build system?\\n\\nDespite Python being an interpreted language that doesn\'t require compiling in a sense of compiled languages such as C++ or Java, the build process refers to build in a general sense. This refers to all the steps that one takes to go from writing the source code all the way through to having a deployable artifact that can be installed in an arbitrary Python environment. The build steps are likely to include:\\n\\n- resolving and downloading external dependencies (from a global and/or a self-hosted private PyPI)\\n- generating code if a code generator such as [Protobuf](https://developers.google.com/protocol-buffers) is used\\n- type checking and static code analysis\\n- running linters and formatters\\n- running tests\\n- packaging artifacts\\n\\nStandard Python ecosystem tools were not designed for monorepos, and they may do a lot of repeated work that may be unnecessary. However, the tooling already provides all the necessary functionality (e.g. `pip` for dependency resolution, `pytest` for running tests, `flake8` for linting), so we really only needed an orchestration system. As more advanced Python engineering practices will be enforced across all projects of the monorepo, as a Python developer, one will need to do a lot more than just to run the tests to validate that the code is correct and can be checked in. All the tools mentioned above need to be invoked with the right arguments, at the right time during the workflow, and in a way that the entire team will be able to reproduce.\\n\\n## Build system requirements\\n\\nWe strongly believe that a good build system should coordinate all of those tools to provide a much smaller command-line interface to the team of software engineers. While one could write bespoke per-repo scripts (e.g. Shell or Makefile) to assist the developers (\\"use this command for this and these sequence of commands for that\\"), we really hoped to have a build system that could become a higher-level solution. Another benefit of using a build system we hoped to take advantage of was to invoke the tools in a way would allow using caching and incrementalism mechanisms (to minimize the amount of work that is re-done on the subsequent run). As testing within our codebase is often data driven and may involve reading large files and be quite time consuming, being able to cut the time spent running tests was critical to us.\\n\\n### Change management\\n\\nIn his talk [Python monorepos: what, why and how](https://www.youtube.com/watch?v=N6ENyH4_r8U), Benjy Weinberger put well that the hardest problem of the monorepo is managing changes, managing dependencies and, most importantly, the overlap between those. Managing changes is hard per se, however, managing changes in the presence of dependencies is much harder, and vice versa.\\n\\nAfter making changes to one of the projects within the monorepo, the necessary workflow would be:\\n\\n1.  Find all the consumers of this project.\\n2.  Ensure that they still work with the changes you made (by running their tests).\\n3.  Make changes as needed until their tests pass.\\n4.  Repeat recursively for all the projects you changed.\\n\\nAt that time, it was done by building all projects using [conda-build](https://docs.conda.io/projects/conda-build/en/latest/index.html) recipes and then re-creating environments for each individual project pulling their updated dependencies and running the tests. Since all the clients of all the code are in the same repository, the breakages are immediately visible since one can run tests of all the relevant projects. However, this approach slows down a developer significantly, because running tests becomes very expensive since one has to run tests not only in the project they make changes in, but also across all other projects unless they know what the dependees of the project they work on are.\\n\\n## Why Pantsbuild?\\n\\n[Pants v2](https://www.pantsbuild.org/docs/python) was specifically designed for the Python use case in contrast to other popular choices such as [Bazel](https://bazel.build/), [Buck](https://buck.build/), or [Please](https://please.build/). It is a ground-up redesign of based on lessons from 10 years of Pants v1 development.\\n\\nWe came to the conclusion that Pants v2 is a much better choice for Python monorepo because our only language of interest is Python and v2 removes friction present in v1 that caused some companies to migrate their multi-language monorepos to Bazel. As Pants v2 develops, support for additional languages continue to be added, which should provide us with the necessary tooling straight out-of-the-box should we start writing tools in, for example, Go.\\n\\n[Pants project](https://github.com/pantsbuild/pants/) is actively developed, and the contributors are friendly and helpful. In 2018, [Toolchain Labs](https://toolchain.com/) was founded by Pants\' originators, John Sirois and Benjy Weinberger. The company leads development of Pants, and is staffed by other longtime Pants core team members. The open source project is foundational for these people. We reasoned that this should provide some guarantees on the long-term commitment to the open-source project and make it a safe investment.\\n\\n## Enabling Pants in the repository\\n\\nPants documentation is a great place to learn [how to incrementally add Pants to an existing repository](https://www.pantsbuild.org/docs/existing-repositories). Setting up Pants in the monorepo was done in multiple steps as we wanted to merge changes in small bulks and with no disruption to the current users.\\n\\n### Project directory layout\\n\\nPants makes it easy to adopt for existing codebases, because it doesn\'t require all Python projects within the monorepo to have the same [directory layout](https://www.pantsbuild.org/docs/source-roots#examples). We didn\'t want to make any structural changes to the code layout and in fact it wasn\'t necessary thanks to sensible defaults set in the `BUILD` metadata files. For example, some projects stored test modules along with the source modules while others had a dedicated `tests` directory. We noticed that source modules may have been stored in the root directory of a project or in a layout of the `src`/`tests` directory structure.\\n\\nHowever, if you have to follow a standard project structure (perhaps because you rely on tooling that makes certain assumptions), you may want to split sources and tests and move some code around. While in some programming languages using a build project such as Apache Maven there are some standards to the [directory layout](https://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html), Python ecosystem is much more flexible in terms of conventions. [Pytest documentation](https://docs.pytest.org/en/6.2.x/goodpractices.html#choosing-a-test-layout-import-rules) currently supports two common project layouts. There are a few helpful resources ([here](https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure) and [here](https://docs.python-guide.org/writing/structure/)) where you can find out more. If you need some inspiration, it may be worth taking a look at how other large Python projects such as [pytest](https://github.com/pytest-dev/pytest), [click](https://github.com/pallets/click), [flake8](https://github.com/PyCQA/flake8), and [black](https://github.com/psf/black) structure their projects.\\n\\nWe have [Multiple top-level projects](https://www.pantsbuild.org/docs/source-roots#multiple-top-level-projects) layout and have enabled Pants for the projects one by one over the course of a few months. This meant we had more time to fix issues and learn more about Pants features and best practices before we rolled Pants across all the projects.\\n\\n### 3rd party dependencies\\n\\nWe have decided to use a single list of the 3rd party dependencies for the entire monorepo, with the requirement that the package versions need to be conflict-free, so that all code in the monorepo can be reused. This makes it possible to create a single virtual environment containing all the requirements which we\'ll discuss later in the post.\\n\\nPants will set up a virtual environment for every build, so any dependency conflicts are detected right away. However, thanks to the [dependency inference](../2022-10-27-why-dependency-inference/index.mdx), each build (e.g. when running a test or packaging an artifact) will pull only those dependencies that are truly required.\\n\\nSince there is only one place in the monorepo for defining any external dependencies, this simplifies the dependency management. You don\'t have to deal with the situations that can occur if you try to import a Python module that depends on a different version of a 3rd party dependency than your current project. For example, it is not possible to have project A to depend on a 3rd party package X of version 1 and project B to depend on the 3rd party package X of version 2. If a certain project needs a newer version of a package than the one defined in the monorepo root requirements, one would need to upgrade this package, and make sure all other clients of this package remain functional.\\n\\nHowever, we do allow defining individual requirements that may be specific to a particular project. This is common when a project owners would like to bring an experimental dependency and take advantage of the Pants build system, but are not yet ready to make it accessible to everyone via the root requirements. Another time we had to use this approach was when there was a project with experimental code with a dependency on a PyPI package with native code that didn\'t have a wheel for devices on certain hardware architecture.\\n\\nSince we have a variety of platforms and architecture to support (macOS on Intel and Apple silicon chips and Linux on Intel and ARM chips), it was necessary to make sure that all 3rd party dependencies that have native code are available as Python wheels so that they are readily available for Pants builds. We have managed to build those packages without rolling out a new CI pipeline that would automate this process as most of the projects finally caught up and started publishing Python wheels for missing platforms. If you would like to use open-source Python projects on Linux with ARM processors, you may have no choice, but automate the build process as it\'s still very rare for them to have a CI plan with ARM agents. For macOS builds, [tart](https://github.com/cirruslabs/tart) driven workflow worked really well and for Linux Docker builds, you can take a look at [pypa/manylinux](https://github.com/pypa/manylinux).\\n\\nA single place for pinned dependencies allows us upgrading a certain package for all the projects in the monorepo at once. This greatly simplifies doing security audits and package version upgrades. In addition to downloading the necessary public PyPI packages, Pants also support accessing a private package index via [PyPI servers](https://www.pantsbuild.org/docs/reference-python-repos) or a binary repository manager which is where we host wheels internally.\\n\\nPants does support having multiple versions for 3rd party requirements for individual projects as long as they are not dependent on each other in either way. If they are, however, it won\'t be possible to resolve the requirements for the virtual environment where the tests will be run. Despite Pants having excellent support for [multiple lockfiles](https://www.pantsbuild.org/docs/python-third-party-dependencies#multiple-lockfiles), we have decided to have a single consistently resolvable universe of requirements.\\n\\n### Adding build metadata\\n\\nThe metadata files were generated in semi-automated manner using `./pants tailor` goal after [enabling Python support](https://www.pantsbuild.org/docs/python-backend). Each project directory has `BUILD` files with minimal information about the internal and external dependencies.\\n\\nWe have decided to [enable linters and formatters](https://www.pantsbuild.org/docs/python-linters-and-formatters) incrementally, per project basis. Because there were multiple legacy projects that were written without any linters and formatters in mind, we didn\'t want to make massive changes across them at once. This meant that project owners could decide themselves when they are ready to commit to format and lint their code. We felt that it would be better to empower engineers by giving them all the tooling they may need and let them use it when appropriate.\\n\\nWe have written scripts to automate making changes to the `BUILD` metadata files. You can learn more about it the blog post [Updating Pants BUILD files programmatically](../2022-01-06-updating-pants-build-files-programmatically/index.mdx).\\n\\n### Adding a CI pipeline\\n\\nOnce we had our first project to trial in Pants adoption, we were ready to start CI builds of the monorepo using Pants. Pants docs share lots of useful advice on [Using Pants in CI](https://www.pantsbuild.org/docs/using-pants-in-ci). Enabling caching was trivial as the repo checkouts are built inside Docker containers and the cache can be shared between them. Pants guarantees safe interactions between processes that make simultaneous writes to the cache which is what will happen as builds take place in parallel, so you don\'t need to worry about resource contention.\\n\\nWe were not comfortable at that point to set up a cache that could be shared between the build nodes and we kept keeping one Pants cache directory per machine used as a CI node. Because a build can be started on an arbitrary node, the caches have filled fairly quickly and we have started seeing excellent cache hit rates. We may explore setting up a dedicated file server to be used as a single Pants cache, but given the build size, at the moment this feels like overkill, as a typical build currently takes only a few minutes (~150K LOC, ~1500 tests).\\n\\nAs a side effect, since the build time got down significantly, we noticed that the pull requests became smaller as developers are no longer trying to squeeze as much as code as possible in a single change. Code reviews get completed much faster (and are more likely to provide useful feedback) and development velocity increases.\\n\\nPants is source control aware and can figure out which tests need to be [run based on changed files](https://www.pantsbuild.org/docs/using-pants-in-ci#approach-1-only-run-over-changed-files). However, if your repository is not that big and takes advantage of caching, you may just run over everything (while still benefiting from having the cache set up). It may also be helpful to re-run all the tests in each build to observe the performance improvements when comparing with your current build approach (in case you have been running all the tests for every build earlier).\\n\\nWe have also invested heavily in the monorepository linting which takes place in CI builds from the very start, to ensure consistency and best practices across the codebase. For example, we identify fragile dependencies between projects, forbid certain options in the targets metadata, warn about files not owned by any target, and many more. Please see [Monorepository linting via Pants\'s project introspection](../2022-08-05-monorepository-linting-via-pants-project-introspection/index.mdx) to learn more.\\n\\n### Packaging artifacts\\n\\nBefore Pants, each project was distributed as a `conda` package. With Pants and the monorepo approach, this is no longer necessary as projects interact between each other directly via the source files. We have studied what projects are dependencies for engineers and systems outside of the monorepo (as we have multiple Git repositories) and started providing packages in a suitable format.\\n\\nTo avoid creating too many distributions, we have decided that any new Python code that needs to be written should be brought into the monorepo and packaged here. The core Python libraries used in other repositories are shipped as wheels (known as a [distribution](https://www.pantsbuild.org/docs/python-distributions) in the Pants land). We produce Docker images used in data processing pipelines with each image containing Shell scripts and [PEX](https://pex.readthedocs.io/en/v2.1.104/index.html) files. We also produce Debian packages (currently with the standard Debian tooling) with each package containing one or more PEX files; please see [Packaging PEX files as Debian packages](https://github.com/pantsbuild/pants/issues/12421) to learn more about the motivation.\\n\\nWhen designing the packaging strategy, we have tried to be very thoughtful with regards to the versioning approach. If you distribute Python wheels of different libraries that may have shared code, you may run into the issues if they share some code, so you have to be very careful making sure these projects don\'t have overlapping scope. Since the version 2.13, Pants supports [generating version tags from Git](https://www.pantsbuild.org/docs/generating-version-tags) which may help you in case you already rely on Git driven versioning.\\n\\nPackaging Python code into PEX files became such a popular option so that it is currently used outside of Python monorepo where Pants is not used. A typical use case is to package command line tools into a single executable files to avoid copying or creating virtual environments from scratch.\\n\\nPEX has also been used for ad hoc packaging to produce executable files for a foreign hardware architecture which has been for a while a preferred way to get some arbitrary Python code running in Linux environment on ARM (before we could run Pants on ARM natively).\\n\\n### Developer tooling\\n\\nTo provide optimal developer experience, we wanted to provide instructions on how to set up two most popular IDEs for Python development in the organization - PyCharm and VSCode - to work with the monorepo. We found the Pants documentation section [Setting up an IDE](https://www.pantsbuild.org/docs/setting-up-an-ide) to be very helpful. It can also be helpful to take advantage of any existing automation systems developers are used to. For instance, we use `Makefile` to bring a simpler interface to the Pants command (e.g. `make fmt` to format both the sources and the build metadata files and `make deps project=name` to list 3rd party dependencies of a project).\\n\\nWe also try not to enforce any particular tooling on a developer and instead only share available options in case they don\'t have a strong opinion. For example, we let users decide on how they want to ensure their code is formatted. A CI build will fail if the code is unformatted, so how the code gets formatted locally doesn\'t really matter. We leave it up to a developer to decide whether they want to use Git or pre-commit hooks, run the commands manually, using a `make` command or a Bash alias, or have the code formatted by their IDE.\\n\\n#### `BUILD` files\\n\\nWe have also spent some time looking for support of `BUILD` files as many IDEs and text editors already support syntax highlighting out of the box. There is some limited support for code navigation and interaction as well such as reporting syntax errors, ability to comment/uncomment blocks of code, and collapse/expand code sections.\\n\\nFor PyCharm users, we suggested installing the [Bazel plugin](https://plugins.jetbrains.com/plugin/8609-bazel) and adding the `BUILD` file name pattern to the `Bazel BUILD language` in the `Recognized File Types` section. See [Change filename patterns associated with file type](https://www.jetbrains.com/help/pycharm/creating-and-registering-file-types.html#change-extension) to learn more. For VSCode users, we suggested installing the [Bazel plugin](https://marketplace.visualstudio.com/items?itemName=BazelBuild.vscode-bazel) with any additional configuration being optional.\\n\\nThere is some research in progress to bring proper support of Pants build metadata files in popular IDEs using Language Server and Build Server protocols ([LSP](https://microsoft.github.io/language-server-protocol/) and [BSP](https://build-server-protocol.github.io/)).\\n\\n#### Virtual environments\\n\\nBecause we have a single list of requirements for the whole monorepository, we were able to resolve them into a [constraints](https://pip.pypa.io/en/stable/user_guide/#constraints-files) file using the [pip-tools](https://github.com/jazzband/pip-tools). Developers can use `pip` to create virtual environment from the `requirements.txt` file (applying the `constraints.txt` generated with the `pip-compile`). Pants provide mechanisms for generating a virtual environment via the [`export`](https://www.pantsbuild.org/docs/reference-export), however, we wanted to keep things simple. The request to be able to run tests for a given project or run an arbitrary Python module without using Pants was quite common. Many developers felt it was easier/faster to run a `pytest` command when they are iterating writing code and they switch to the Pants tooling once they are done with a chunk of work and wanted to run the tests across the repository before starting a CI build.\\n\\nWe also have to support hardware engineers, researchers, and other users who do not normally \\"live\\" in the repo and may be interacting with the repo only occasionally and therefore missing the build system context. For instance, users often want to create a virtual environment with only the 3rd party dependencies (identifiable with the help of [`dependencies`](https://www.pantsbuild.org/docs/reference-dependencies) goal) of a particular project for rapid prototyping. This is why we have documented how to use standard Python tooling for quick experiments, so that they never really needed to get to know Pants build system.\\n\\n### Python runtime environment\\n\\nFinding the right strategy to decide on Python interpreter constraints to be used in the Pants monorepository required some careful thinking. Because we had enough users who are not Python programmers or are not familiar with the Python ecosystem and tooling, we needed to make sure there is a simple way to get a Python interpreter installed. Because our development infrastructure team is rather small, we couldn\'t have the privilege to be open to any CPython 3.8 interpreter users may have installed. This is to avoid dealing with support requests from developers who experience issues running the code or tests as their Python interpreter may have come from a `pyenv` interpreter, system Python, `conda` environment, `brew` formula, or anything else discovered on the system `$PATH`.\\n\\nAs we had a well established macOS setup, we\'ve decided to stick to the [Xcode](https://developer.apple.com/xcode/) Python which we can automate installing using [jamf](https://www.jamf.com/). As the expectation is that the users will already have Xcode installed, we declare `search_path = [\\"/usr/bin\\"]` in the `pants.toml` file. This way, we ensure that once a user\'s machine is bootstrapped, the repository checkout can immediately be used with Pants and it just works. However, we also allow engineers to override this or, in fact, any setting using the [.pants.rc](https://www.pantsbuild.org/docs/options#pantsrc-file) file, so that we remain flexible and allow devs to use any compatible Python interpreter they may prefer. See [Choosing a Python interpreter for a Pants project](../2022-02-15-choosing-a-python-interpreter-for-a-pants-project/index.mdx) so that you can find a strategy that works for you.\\n\\n### Documentation\\n\\nPants documentation is extremely sophisticated and exhaustive, however, it may also feel a bit overwhelming for a newcomer. In fact, we don\'t think our developers need to know anything about Pants unless they really want to. This is the opposite of what is expected from our developers working in the C++ repository - they need to be fairly proficient in [CMake](https://cmake.org/) to be able to write and maintain build metadata files. We maintain our own documentation on how to operate in Oxbotica\'s monorepository, covering standard internal workflows, and have extended it over the past year as we observed common questions and points of confusion.\\n\\n## Conclusion\\n\\n**After using Pants over a year now, we can say with confidence it was worth every effort.**\\n\\nThe repository build workflows can now accommodate a much larger number of contributors thanks to Pants caching mechanisms used in tests and very smart dependency inference thanks to which the builds do only what\'s truly required. It has also removed the cognitive burden from the developers who can focus on the domain code instead of dealing with the build system nuances. The engineers are happy to make occasional changes to the `BUILD` files (e.g. adding new `resource` and `pex_binary` targets) and find the API very intuitive. We strive to hide the Pants internal details from the user to keep things simple, however, they found error messages given by Pants extremely helpful \u2014 not only because they are short and full of context, but also because they tell you how to fix the error (e.g. run another goal or fix a typo in a target\'s name).\\n\\nIt\'s great to see the project being actively developed, bringing support for new frameworks and tools. For instance, we are exploring using [PyOxidizer](https://www.pantsbuild.org/docs/pyoxidizer) to produce a package with the Python interpreter baked in to facilitate sharing applications with non-developers. We are also very pleased to see the Pants community growing attracting more users and providing a space to improve developer productivity across multiple organizations. It\'s said that with Python, [programming is fun again](https://xkcd.com/353/). With Pants, building Python is fun again!\\n\\n:::info[About the author]\\nAlexey Tereshenkov led Oxbotica\'s 2021 migration to Pants, and in the process became a committed contributor to the open source project. Since becoming involved with Pants through Oxbotica, Alexey has made many contributions to the project, notably including Yapf formatter support for Python, writing blog posts, docs improvements, and adding a long-requested `python_distribution` improvement. He also drives Debian packaging support in Pants. [In 2022 he joined the project\'s core team of maintainers.](../2022-02-28-meet-our-newest-maintainer-alexey-tereshenkov/index.mdx)\\n:::"},{"id":"/2022/10/27/celebrating-two-years-of-pants-2","metadata":{"permalink":"/blog/2022/10/27/celebrating-two-years-of-pants-2","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-10-27-celebrating-two-years-of-pants-2/index.mdx","source":"@site/blog/2022-10-27-celebrating-two-years-of-pants-2/index.mdx","title":"Celebrating two years of Pants 2","description":"\\"[Happy Birthday","date":"2022-10-27T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":6.85,"hasTruncateMarker":true,"authors":[{"name":"Christopher Neugebauer","title":"Pants Maintainer","url":"https://github.com/chrisjrn","imageURL":"https://github.com/chrisjrn.png","key":"chrisjrn","page":null}],"frontMatter":{"authors":["chrisjrn"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"Case Study: Introducing Pants to Oxbotica","permalink":"/blog/2022/11/04/introducing-pants-to-oxbotica"},"nextItem":{"title":"Dependency inference: Pants\'s special sauce","permalink":"/blog/2022/10/27/why-dependency-inference"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  \\"[Happy Birthday\\n  Balloon](https://www.flickr.com/photos/93322500@N00/6077474404)\\" by [Shelley &\\n  Dave](https://www.flickr.com/photos/93322500@N00) is licensed under [CC BY-NC\\n  2.0](https://creativecommons.org/licenses/by-nc/2.0/?ref=openverse).\\n</CaptionedImg>\\n\\nPants 2\'s design incorporated many lessons learned from the first version of Pants, and many of its contemporary build systems. On Pants 2\'s 2nd anniversary, we return to some of the earliest decisions we made when rewriting Pants and look back at how they\'ve helped us evolve at a remarkable pace\u2026\\n\\n{/* truncate */}\\n\\n---\\n\\n27 October 2022 (that\'s today!) marks the second anniversary of the release of Pants 2.0, a from-the-ground-up rewrite of the Pants build system, which had been around for almost 10 years at the time of Pants 2\'s release.\\n\\nPants 2\'s design incorporated many lessons learned from the first version of Pants, and many of its contemporary build systems. On our second anniversary, we thought it would be a great opportunity to return to [some of the earliest decisions we made when rewriting Pants](../2020-10-27-introducing-pants-v2/index.mdx), and see how they\'ve helped us evolve at a remarkable pace over the last two years.\\n\\n### Builds for large-scale codebases without the metadata\\n\\nPants 1, like most other build tools for larger codebases and monorepos, was a configuration-heavy tool. It required you to write out huge amounts of metadata in `BUILD` to describe how your codebase fit together. [Build metadata is hard to make accurate and hard to maintain.](../2021-11-18-pants-vs-bazel/index.mdx)\\n\\nPants 2 came from an observation that in retrospect was very simple: most of the metadata that went into `BUILD` files in Pants 1 was information that already existed in your codebase. [Pants 2 introduced dependency inference, allowing Pants to harness that latent information](../2022-10-27-why-dependency-inference/index.mdx). If you need to specify dependencies at all, it\'s usually only for complex cases that can\'t be statically inferred, and these cases are becoming vanishingly infrequent.\\n\\nDependency inference transformed `BUILD` files from something that needed to be updated every time you add or remove an `import` statement into ones that need to be updated very infrequently indeed.\\n\\nNow, most Pants 2 users rarely need to update a `BUILD` file once it\'s created.\\n\\nBut what about creating `BUILD` files? Pants 2.3 introduced the `tailor` goal. [`tailor` gave Pants the ability to automatically create a first pass at a codebase\'s `BUILD` files.](../2021-03-19-tailoring-pants-to-your-codebase/index.mdx) Once your initial `BUILD` files were created, you only needed to focus on the small amount of metadata that Pants couldn\'t automatically infer.\\n\\nPants 2\'s core feature of dependency inference combined with `tailor` meant that Pants went from a system where `BUILD` files were difficult to manage, to one where you barely think about them at all. It\'s now much easier to get your build tooling running optimally, with less time wasted on configuration tasks. We\'re continuing to work out how to make it easier to get started and maintain Pants installations, so that you can spend even less time configuring things!\\n\\n### Designing for plugins has proven its value\\n\\nPants 2 was designed with a plugin architecture, and most importantly, that architecture is used internally as well as for actual third-party plugins. This meant even though our initial supported language was Python, we had to design a system with concepts that could be adapted to any language that we decided we wanted to support.\\n\\nIt didn\'t take long for this design to prove itself! [Pants 2.5, released in May 2021, included support for Shell scripting workflows](../2021-05-20-introducing-pants-2-5/index.mdx), with support for the `test`, `check`, and `fmt` goals already established for Python, all using established tools from the shell scripting community.\\n\\nSince then, we\'ve been able to [add support for Golang](../2021-11-10-golang-support-pants-28/index.mdx), as well as [Java, Scala](../2022-01-12-pants-2-9/index.mdx) and Kotlin on the JVM into the Pants distribution, each bringing with it [support for dependency inference](../2021-11-22-automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference/index.mdx), and orchestrating those language\'s testing, linting, formatting, and quality checking tools, all using the same command-line interface that we introduced in Pants 2.0 for Python.\\n\\nThe plugin architecture turned out to be more flexible than we\'d expected, leading to some contributions from outside the initial core team that we couldn\'t have imagined when we released Pants 2.0. [Pants 2.7 added support for Docker](../2021-09-28-docker-support/index.mdx), allowing users of any Pants-supported language to produce a Docker image containing artifacts built with Pants. [Pants 2.10 added experimental PyOxidizer support](../2022-02-18-packaging-python-with-the-pyoxidizer-pants-plugin/index.mdx), giving Python users an alternative way to package their Python applications, alongside the Python packaging formats that we support in the core Pants distribution. [Finally, Pants 2.14 has added a `deploy` goal, along with experimental Helm support](../2022-10-26-pants-2-14/index.mdx).\\n\\nWe\'ve heard of Pants users working on experimental-quality third-party plugins for other languages and tools, including C and C++, too, so we\'re confident that users can already start adapting Pants to their use case if they need to.\\n\\nIn future releases, we\'re excited to add support for even more languages and tools, and we know our architecture gives us a starting point that will make it easier than other build systems would have made it.\\n\\n### Concurrency, caching, and distributed builds\\n\\nPants 2.0 was released with a goal of unlocking better build performance with less effort than its predecessors. Firstly, by writing our core in Rust, any CPU-intensive core task can run as close to the metal as possible, while still being as memory-safe as tasks written in Python. Our Python API (which lets us write rules quickly and easily) for v2 has always made use of coroutines, driven by a Rust-based event loop that focuses on CPU-bound parallelism rather than the IO focus of other Python event loops.\\n\\n[Pants 2.0 came with support for a remote cache](https://www.pantsbuild.org/docs/remote-caching), and thanks to dependency inference, most cacheable results are automatically as granular as possible, and can easily be run in parallel. Now there are remote caching providers for Pants 2, and we\'re seeing some pull requests on the Pants Open Source repository take less than 5 minutes to complete in CI, down from more than 40, now that it\'s using [Pants project sponsor Toolchain\'s remote cache](https://toolchain.com).\\n\\n[For Pants 2.13, we added support for sharding, as a happy medium between running on a single machine and using a full remote execution cluster](../2022-09-01-introducing-pants-2-13/index.mdx). This turned out to be a remarkably [simple change of barely 100 lines of code](https://github.com/pantsbuild/pants/pull/15417/files) (including comments, error handling, and tests), which was possible because Pants\'s understanding of a codebase is deterministic across multiple executions.\\n\\nFor Pants 2.15, we\'re starting Pants on a path to truly take advantage of remote execution, adding experimental support for running tools in a Docker environment, and laying the groundwork to run multi-platform cross builds from a single parent instance of Pants.\\n\\n### Building a community\\n\\nWith Pants 2, we\'ve also made a real effort to grow our community beyond our initial contributors, who mostly came from the Pants v1 world. Now we have [a team of 18 Maintainers and 12 Contributors](https://www.pantsbuild.org/docs/team), [and Pants 2 is used in notable companies all around the world.](https://www.pantsbuild.org/page/who-uses-pants) There are [testimonials](https://www.pantsbuild.org/docs/testimonials), and [case studies](https://www.pantsbuild.org/docs/media#posts--articles) from happy users who\'ve found that Pants 2 meets their needs where other build tools weren\'t ready.\\n\\nIt\'s been exciting to see Pants 2 progress from a promising idea with initial Python support, through to a multi-language scalable build tool with adoption in many really cool places. We can\'t wait to see where\xa0the next two years of Pants takes us!"},{"id":"/2022/10/27/why-dependency-inference","metadata":{"permalink":"/blog/2022/10/27/why-dependency-inference","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-10-27-why-dependency-inference/index.mdx","source":"@site/blog/2022-10-27-why-dependency-inference/index.mdx","title":"Dependency inference: Pants\'s special sauce","description":"Unlike earlier build systems, Pants v2 automatically infers your code\'s internal and external dependencies. And it does this at the file level, so that you get optimal invalidation, caching, and concurrency performance without having to manually create and maintain mountains of BUILD file metadata.","date":"2022-10-27T00:00:00.000Z","tags":[{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"},{"inline":true,"label":"under-the-hood","permalink":"/blog/tags/under-the-hood"}],"readingTime":10.07,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["concepts","under-the-hood"]},"unlisted":false,"prevItem":{"title":"Celebrating two years of Pants 2","permalink":"/blog/2022/10/27/celebrating-two-years-of-pants-2"},"nextItem":{"title":"Pants 2.14: Less boilerplate, more Rust, better support for Go monorepos, interactive debugging support, and more!","permalink":"/blog/2022/10/26/pants-2-14"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}></CaptionedImg>\\n\\nUnlike earlier build systems, Pants v2 automatically infers your code\'s internal and external dependencies. And it does this at the file level, so that you get optimal invalidation, caching, and concurrency performance without having to manually create and maintain mountains of BUILD file metadata.\\n\\n{/* truncate */}\\n\\n---\\n\\nScalable build systems need to know about the structure and dependencies of your codebase in order to correctly invalidate work, compute cache keys, and apply concurrency. But how do they get this data?\\n\\nAn important distinguishing feature of Pants v2 is its ability to automatically [infer your code\'s internal and external dependencies](../2020-10-29-dependency-inference/index.mdx). This is in contrast to earlier systems, such as Bazel, Buck, and Pants v1, which rely on handwritten metadata provided in BUILD files and checked into the repo alongside the code they describe.\\n\\nWhy did we make this design choice? Read on to find out!\\n\\n### The Adoption Challenge\\n\\nIn the early iterations of the Pants v2 design, we imagined that it would continue to rely on these heavyweight BUILD files that had become almost traditional in the space. But in 2020, as we began working towards the eventual Pants 2.0.0 launch, and started to imagine what widespread adoption would look like, we began to have second thoughts...\\n\\nThose other systems were primarily designed for and around the use-cases of a single company (Google, Meta, and Twitter, respectively). And when you design for a single organization, you\'re working in the context of a single adoption process that you tightly control. You can design for a particular codebase structure, refactoring towards it if necessary. Plus, once onboarding is complete, you have a captive user base that isn\'t free to seek alternatives. So the difficulty of adoption and of ongoing maintenance tend not to be primary influences on the design.\\n\\nBut with Pants v2, we were, fairly uniquely, creating a system to be used by a wide variety of software engineering teams of all manner of sizes, codebase structures and development practices. We wanted Pants v2 to be adopted over and over and over again. And once the system was in use, we wanted it to delight users, not encumber them.\\n\\nSo we took a deep look at what the burdens are in evaluating, adopting and using a system of this sort. And creating and maintaining dependency information in BUILD files stood out as one of the biggest obstacles.\\n\\n### Handwritten BUILD files are a pain\\n\\nSelecting the right level of granularity for BUILD file dependency metadata is tricky:\\n\\nFile-level data is the most precise, but that creates much larger BUILD files, that are correspondingly more laborious to maintain. So, in practice, handwritten BUILD file \\"targets\\" (the sources and destinations of dependencies) typically span an entire directory or package. But then the data is coarser-grained, which leads to more invalidation, fewer cache hits and less concurrency. Plus, coarser granularity makes it harder to model real-world codebase warts, such as dependency tangles and cycles.\\n\\nAnd once you select a level of granularity, it\'s hard to change: if you split or unify targets, you have to update every single reference to the original targets in any dependent BUILD files.\\n\\nNow, assuming you\'ve chosen an appropriate level of granularity, every time you add an `import` statement in a file, you annoyingly have to go and add some corresponding - and redundant! - dependency metadata in a BUILD file. And removing an `import` statement can be even more laborious: before removing the corresponding dependency from the BUILD file you first have to check that some other file in the same target isn\'t also importing that dependency. This is a hassle! So, in practice, dependencies are not always added or removed when they should be, and inconsistencies build up over time.\\n\\nThe burden of BUILD file maintenance is widely acknowedged as a barrier to adoption of these sorts of build systems. For example, a [recent Bazel community talk](https://www.youtube.com/watch?v=E1-U7EAfhXw&t=371s) reiterated that:\\n\\n> Developers don\'t want to maintain BUILD files every single time that they edit a change or add a new dependency. These are all overhead that\'s stopping people from adopting Bazel today. It\'s just a lot more work that they have to do on top of their normal development workflow, and this extra work slows them down. So adopting Bazel slows down your developer productivity.\\n\\nAnd although we were just as guilty of this in Pants v1, it always struck us as a little absurd, because all the dependency information that bloats those BUILD files is already available in the source files themselves, in the form of `import` statements! It quickly became clear to us that Pants v2 should grab these dependencies via static analysis of your code, instead of you having to manually provide them in BUILD files.\\n\\n### Auto-generating BUILD files\\n\\nThe first approach we considered was to use dependency inference to generate and update BUILD files, but continue to check those files into the repo. This is the path taken by the [Gazelle tool](https://github.com/bazelbuild/bazel-gazelle) for Bazel.\\n\\nHowever this approach still has some major drawbacks, as acknowledged by this [this upcoming BazelCon talk](https://opensourcelive.withgoogle.com/events/bazelcon2022?talk=day1-talk5):\\n\\n> Developers often have to laboriously enumerate dependencies in their BUILD files, which is toilsome and a major source of friction.\\n\\nFor one thing, many BUILD files cannot be completely generated. They still need to be manually edited, both to tweak the generated dependencies and to add any other, non-inferrable metadata. Having an automatic process modify human-edited files, and vice versa, gets messy quickly. How do you customize and correct the generator\'s output? How do you ensure that human edits aren\'t erased or overwritten?\\n\\nGenerated BUILD files may be even more verbose than handwritten ones, which bloats pull requests. And they still suffer from the granularity issue: A generator can easily create dependency metadata at the fine-grained file level, which is best for invalidation, cache and concurrency performance, but then any manual metadata, such as setting a resolve, has to be applied at that same granular level, which adds even more verbose boilerplate. So, again, in practice a coarser granularity is usually applied, which harms performance.\\n\\nWhat we want, in practice, is very fine-grained dependency metadata, but coarse-grained metadata of other kinds. So we ended up rejecting BUILD file generation as the simplifying mechanism for dependency management.\\n\\n:::note\\nPants does do a bit of simple BUILD file generation, using the built-in `tailor` goal, to streamline onboarding. But these BUILD files are perfunctory and tiny, and notably don\'t contain dependencies!\\n:::\\n\\n### Dependency inference\\n\\nThe alternative we landed on was _dependency inference_: Pants performs the static analysis at runtime, as needed, and uses the data on the fly. Dependency information doesn\'t - usually - live in BUILD files at all.\\n\\nThis allows you to have very small, simple BUILD files, often just 1-3 lines. These exist to denote code that Pants should operate on, and as a location for you to provide custom metadata (e.g., to specify a test timeout, or a named resolve).\\n\\nDependency inference happens at the file level, so is very fine-grained, to support optimal invalidation, cache and concurrency performance. But manual metadata can conveniently be applied at a much coarser grain, leading to a \\"best of both worlds\\" situation.\\n\\nIn fact, thanks to new features like [target generators](https://www.pantsbuild.org/docs/targets#target-generation), [parametrization](https://www.pantsbuild.org/docs/targets#parametrizing-targets), and [subtree defaults](https://www.pantsbuild.org/docs/targets#field-default-values), we are on the way to allowing you to have a lot fewer BUILD files, sometimes even just one for an entire source tree! But, thanks to inference, your dependencies are still modeled at the per-file level.\\n\\nYou can read more about the details and advantages of dependency inference in [this post](../2020-10-29-dependency-inference/index.mdx).\\n\\n### Detecting dependencies\\n\\nSo, how does Pants\'s dependency inference work?\\n\\nThere are two main steps:\\n\\n- Examine source files to see which symbols they import and which symbols they provide\\n- Create a mapping from each symbol to the file that provides it\\n\\nWith this mapping in place, it\'s straightforward to map a file\'s imported symbols to the files that provide those symbols. And this work is cached on disk and memoized in the Pants daemon\'s memory, so repeated incremental updates are very fast.\\n\\nAs you can imagine, most of this has to be implemented per-language, e.g. for Python, Java, Scala, Kotlin, Go, Shell and so on, as it requires understanding each language\'s import/export syntax and semantics (see [here](../2021-11-22-automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference/index.mdx) for more details about the implementation of dependency inference for JVM languages). And, in fact, we implement dependency inference not just for programming languages but also for frameworks!\\n\\nFor example, the Docker backend can map images referenced in a Dockerfile (e.g., in FROM statements) back to the Dockerfiles that created those images. And the Protocol Buffer backend can map a dependency between .proto files into the corresponding dependency between the source files generated from them!\\n\\nIn fact, we even have support for detecting dynamic dependencies, where code is loaded at runtime via a string. For example, you can optionally have Pants consider literal strings that \\"look like\\" Python module or class names (such as `foo.bar.baz`, or `foo.bar.baz.Baz`) as \\"soft imports\\". This is useful for cases such as Django apps, where the `settings.py` file references many other external and internal dependencies via strings, rather than import statements.\\n\\nAnd if your code has custom dependency inference needs, such as dynamic dependencies named in config files, you can always write a plugin to extend the dep inference logic to your liking.\\n\\n### And if all else fails...\\n\\nSometimes, despite all our best efforts, and your customizations, there is no escaping the need for manual dependency metadata. A common case is a dependency on a data file.\\n\\nIn such cases you can simply add dependencies in your BUILD files, the old-school way. But you only need to add the ones that can\'t be inferred, to augment dep inference, so this still keeps your BUILD files nice and small. And these handful of manual dependencies can still be at the file level, to preserve the fine granularity:\\n\\n```python title=\\"BUILD\\"\\nresources(name=\\"my_data\\", sources=[\\"my_data.txt\\"])\\n\\npython_sources(\\n  dependencies=[\\":my_data\\"],\\n)\\n```\\n\\nIn the rare case that you want to _prevent_ pants from inferring a dependency, such as one provided at runtime by some mechanism outside Pants\'s control, you have two options:\\n\\nYou can negate the dependency in the BUILD file, by preceding it with a `!`:\\n\\n```python title=\\"BUILD\\"\\npython_sources(\\n  dependencies=[\\"!provided/dep.py\\"],\\n)\\n```\\n\\nYou can add a `# pants: no-infer-dep` pragma on the import line:\\n\\n```python\\nimport provided.dep  # pants: no-infer-dep\\n```\\n\\n### Looking back, and forward\\n\\nIn the exactly two years since we released Pants 2.0.0, dependency inference has come a long way, and has become an important selling point for teams looking for scalable build tooling without the hassle of maintaining huge BUILD files, as exemplified by [this case study](https://developer.ibm.com/blogs/case-study-incrementally-migrating-a-python-monorepo-from-bazel-to-pants) from IBM. So with hindsight, we\'re really happy with this design choice.\\n\\nDependency inference is one of several features we\'ve implemented that help cut down on BUILD file boilerplate. Others include sensible global defaults for target fields, [target generators](https://www.pantsbuild.org/docs/targets#target-generation), [parametrization](https://www.pantsbuild.org/docs/targets#parametrizing-targets), and [subtree defaults](https://www.pantsbuild.org/docs/targets#field-default-values).\\n\\nWe\'ll continue to lean into dependency inference in the future, and find even more ways to reduce and even eliminate BUILD file boilerplate. Our goal is to keep making Pants easier to adopt, use, and customize, while also adding new languages and features, and dependency inference will play a big role in this effort.\\n\\nIf you want to speed up and scale up your builds without the boilerplate, [come and talk to us](https://www.pantsbuild.org/docs/community)!"},{"id":"/2022/10/26/pants-2-14","metadata":{"permalink":"/blog/2022/10/26/pants-2-14","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-10-26-pants-2-14/index.mdx","source":"@site/blog/2022-10-26-pants-2-14/index.mdx","title":"Pants 2.14: Less boilerplate, more Rust, better support for Go monorepos, interactive debugging support, and more!","description":"Photo by [James","date":"2022-10-26T00:00:00.000Z","tags":[{"inline":true,"label":"jvm","permalink":"/blog/tags/jvm"},{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"golang-2","permalink":"/blog/tags/golang-2"},{"inline":true,"label":"language-support-helm","permalink":"/blog/tags/language-support-helm"},{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":6.69,"hasTruncateMarker":true,"authors":[{"name":"Stu Hood","title":"Pants Maintainer","url":"https://github.com/stuhood","imageURL":"https://github.com/stuhood.png","key":"stu","page":null}],"frontMatter":{"authors":["stu"],"tags":["jvm","python","golang-2","language-support-helm","announcement"]},"unlisted":false,"prevItem":{"title":"Dependency inference: Pants\'s special sauce","permalink":"/blog/2022/10/27/why-dependency-inference"},"nextItem":{"title":"Skipping GitHub Actions jobs while keeping branch protection rules that require them","permalink":"/blog/2022/10/10/skipping-github-actions-jobs-without-breaking-branch-protection"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [James\\n  Wainscoat](https://unsplash.com/@tumbao1949?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nHighlights include: less boilerplate via hierarchical defaults for target field values, better Golang monorepo support, with multiple `go.mod`s, do more of your workflows in Pants with the experimental `deploy` goal (with initial support for Helm), and much more\u2026\\n\\n{/* truncate */}\\n\\n---\\n\\nWe\'re pleased to announce [Pants 2.14.0](https://www.pantsbuild.org/v2.14/docs), the latest release of Pants, the scalable and ergonomic build system.\\nTo update, set `pants_version = \\"2.14.0\\"` in your `pants.toml`. See [upgrade tips](https://www.pantsbuild.org/docs/upgrade-tips) for more information.\\n\\n## Less boilerplate via hierarchical defaults for target field values\\n\\nA key goal of Pants is reducing the amount of BUILD boilerplate that users have to maintain in order to quickly and reliably build their code. To that end, Pants `2.14` introduces [`__defaults__`](https://www.pantsbuild.org/v2.14/docs/targets#field-default-values): a mechanism to set the default arguments used for the targets defined in a directory.\\n\\nAs an example: suppose that you wanted to use a non-default thirdparty `resolve` \\"spark3\\" for all targets in a particular subdirectory. To do that, you\'d declare `__defaults__` in a `BUILD` file in that subdirectory:\\n\\n```python title=\\"BUILD\\"\\n__defaults__(all=dict(resolve=\\"spark3\\"))\\n```\\n\\n\u2026 and then all targets defined at or below that BUILD file would default to using `resolve=\\"spark3\\"` (but could still override that default if they choose)!\\n\\n`__defaults__` also supports setting defaults for individual target types, or can be combined with `parametrize`. For more examples, see [the docs for `__defaults__`](https://www.pantsbuild.org/v2.14/docs/targets#field-default-values)!\\n\\n## Better Golang monorepo support, with multiple `go.mod`s\\n\\nPants `2.14` adds support for using multiple `go.mod` files in one repository, by adapting dependency inference to infer dependencies only within the scope of a single parent `go.mod`.\\n\\nSimilar to our support for [using multiple `resolves`](https://www.pantsbuild.org/v2.14/docs/python-third-party-dependencies#user-lockfiles) (for Python, Java, Scala, Kotlin, etc), support for multiple `go.mods` can be really helpful for projects which can\'t fully migrate (or just haven\'t yet) to a single set of shared thirdparty dependencies in their repository.\\n\\n## Do more of your workflows in Pants with the experimental `deploy` goal, with initial support for Helm\\n\\nPants\' philosophy around CLI \\"goals\\" (like `test`, `fmt`, `run`, etc) is to support caching, parallelism, and a consistent user interface across tools which accomplish similar tasks across different languages or ecosystems.\\n\\nFor example: the `test` goal provides a consistent interface to running and caching tests using `pytest`, `junit`, `shunit2`, etc, while the `fmt` goal safely pipelines (and even partially parallelizes) the running of code formatters like `scalafmt`, `go fmt`, `black`, `isort`, etc.\\n\\nTo that end: Pants `2.14` introduces an (experimental) `deploy` goal, with initial support for [Helm](https://helm.sh/) installs. The [Helm implementation of the `deploy` goal](https://www.pantsbuild.org/v2.14/docs/helm-deployments) will:\\n\\n1.  Infer the Docker image dependencies of your Helm charts\\n2.  Build and `publish` image dependencies\\n3.  Post-process the Kubernetes manifests to use the `publish`ed image names\\n4.  Run the Kubernetes deployment resulting from the post-processing\\n\\nWe\'d love your feedback on both the `deploy` goal and [the support for Helm](https://www.pantsbuild.org/v2.14/docs/helm-overview)!\\n\\n## Easier interactive debugging for Python in VS Code using the DAP protocol\\n\\nPants usually runs processes in hermetic sandboxes for reproducibility. But in order to attach a console-based debugger like Python\'s [PDB](https://docs.python.org/3/library/pdb.html), [the `test --debug` flag](https://www.pantsbuild.org/v2.14/docs/reference-test#debug) has long supported forcing a test to run in \\"interactive\\" mode in the foreground in your console.\\n\\nIn Pants `2.14`, there is a new and shiny alternative to using console debuggers: using [the `--debug-adapter` flag](https://www.pantsbuild.org/v2.14/docs/reference-test#debug_adapter) to launch an implementation of [the DAP protocol](https://microsoft.github.io/debug-adapter-protocol/) for graphical debugging (particularly in VS Code) for either the `test` goal or `run` goal.\\n\\nTo try it out, run a test with `./pants test --debug-adapter $filename`. You\'ll see a prompt like:\\n\\n```log\\n[INFO] Launching debug adapter at \'127.0.0.1:5678\', which will wait for a client connection\u2026\\n```\\n\\n\u2026 then set a breakpoint in VS Code, and use the `Remote Attach` action to run the test to your breakpoint!\\n\\nAlthough the Python backend has the only implementation of the `--debug-adapter` flag so far, there are DAP server implementations for [many other languages](https://microsoft.github.io/debug-adapter-protocol/implementors/adapters/): we\'d love [to help you](https://www.pantsbuild.org/docs/getting-help) add support for your favorite language!\\n\\n## Better dependency computation performance by porting more critical paths to Rust\\n\\nSince Pants 2.0, the \\"engine\\" of Pants has been implemented in Rust, with all language support added via the plugin API as Python 3 `@rules`.\\n\\nPython and Rust make a great combination! They allow us to make it easy to write plugins using type safe async Python 3, while the most CPU intensive portions of Pants are written in safe and performant Rust.\\n\\nThe `2.14.x` release brings a good example of this pairing: by porting a single codepath in the plugin API from Python to Rust (transparently to consumers!), we got [a 12% speedup for the computation of dependencies](https://github.com/pantsbuild/pants/pull/16160).\\n\\nWe\'re always on the lookout for more API boundaries which can move to Rust: if you\'re interested in helping out, check out [our page on profiling and benchmarking](https://www.pantsbuild.org/docs/contributions-debugging)!\\n\\n## `BUILD` file formatters run in `fmt` and `lint`\\n\\nIn previous versions, `BUILD` file formatting and linting only ran in the `update-build-files` goal. But in `2.14`, enabling a `BUILD` file formatter will cause it to run in the `fmt` and `lint` goals as well!\\n\\nIf you hadn\'t already enabled `BUILD` file formatting, you can do so by enabling one of the following backends:\\n\\n- `pants.backend.build_files.fmt.black` - to use [Black](https://black.readthedocs.io/en/stable/)\\n- `pants.backend.build_files.fmt.buildifier` - to use [Buildifier](https://github.com/bazelbuild/buildtools/blob/master/buildifier/README.md)\\n- `pants.backend.build_files.fmt.yapf` - to use [YAPF](https://github.com/google/yapf)\\n  Happy formatting!\\n\\n## Other notable changes\\n\\nThere are [a long list of additional changes in 2.14](https://github.com/pantsbuild/pants/blob/main/docs/notes/2.14.x.md), but highlights include:\\n\\n- [`mypy`\'s incremental cache will now be used](https://github.com/pantsbuild/pants/pull/16290), which should significantly reduce the latency of typechecking.\\n- Concurrent execution of Python test _methods_ is now [natively supported](https://www.pantsbuild.org/v2.14/docs/python-test-goal#pytest-version-and-plugins) via `pytest-xdist`! If your test methods are concurrency safe, you can set `[pytest].xdist_enabled = True` to run individual test methods concurrently, in addition to Pants\' usual file-level parallelism.\\n- The file downloading intrinsic which is used to fetch fingerprinted remote binaries now has [built in retry to reduce flakiness](https://github.com/pantsbuild/pants/pull/16879).\\n- When a locally-run test times out, the `stdio` of the process [will now be preserved](https://github.com/pantsbuild/pants/pull/16880), to assist with debugging which test(s) were slow.\\n- `mypy`\'s output will now render [in color](https://github.com/pantsbuild/pants/pull/16586), and at a [reasonable width for all terminals](https://github.com/pantsbuild/pants/pull/16488) (without breaking cache keys: huzzah!)\\n- Pants\' dependency inference for Scala has [been](https://github.com/pantsbuild/pants/pull/15865) [significantly](https://github.com/pantsbuild/pants/pull/15880) [improved](https://github.com/pantsbuild/pants/pull/16692)!\\n- You can now add to dict-valued options in config files, using a similar syntax to that used for adding to list-valued options. To add a key to a dict option named `[scope].example`, you could use a `pants.toml` entry like:\\n\\n```toml title=\\"pants.toml\\"\\n[scope]\\nexample.add = { an_additional_key = and_a_value }\\n```\\n\\n- `grpc-java` codegen [is now supported](https://github.com/pantsbuild/pants/pull/16350).\\n- A few different JVM `@rules` became [more deterministic by default](https://github.com/pantsbuild/pants/pull/16950), while others have gained [optional timestamp stripping for deterministic outputs](https://github.com/pantsbuild/pants/pull/16134).\\n\\n## Thanks\\n\\nThanks to all of the contributors to `2.14`, including everyone who shared feedback on changes and who tested release candidates!"},{"id":"/2022/10/10/skipping-github-actions-jobs-without-breaking-branch-protection","metadata":{"permalink":"/blog/2022/10/10/skipping-github-actions-jobs-without-breaking-branch-protection","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-10-10-skipping-github-actions-jobs-without-breaking-branch-protection/index.mdx","source":"@site/blog/2022-10-10-skipping-github-actions-jobs-without-breaking-branch-protection/index.mdx","title":"Skipping GitHub Actions jobs while keeping branch protection rules that require them","description":"How we worked around some quirks and limitations of GitHub Actions to skip CI jobs that aren\'t necessary in certain scenarios, without breaking branch protection rules that normally require those CI jobs to succeed.","date":"2022-10-10T00:00:00.000Z","tags":[{"inline":true,"label":"ci","permalink":"/blog/tags/ci"},{"inline":true,"label":"under-the-hood","permalink":"/blog/tags/under-the-hood"}],"readingTime":4.04,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["ci","under-the-hood"]},"unlisted":false,"prevItem":{"title":"Pants 2.14: Less boilerplate, more Rust, better support for Go monorepos, interactive debugging support, and more!","permalink":"/blog/2022/10/26/pants-2-14"},"nextItem":{"title":"Meet our newest Maintainer: A. Alonso Dominguez","permalink":"/blog/2022/09/02/meet-our-newest-maintainer-a-alonso-dominguez"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default} />\\n\\nHow we worked around some quirks and limitations of GitHub Actions to skip CI jobs that aren\'t necessary in certain scenarios, without breaking branch protection rules that normally require those CI jobs to succeed.\\n\\n{/* truncate */}\\n\\n---\\n\\nThe Pants [documentation site](https://www.pantsbuild.org/) is generated from markdown sources in a top-level [docs/](https://github.com/pantsbuild/pants/tree/main/docs) folder in the repo. So editing the docs requires a pull request, a review, a passing CI, followed by a publishing step.\\n\\nIn order to encourage documentation updates, we want to make them less burdensome, and one way to do that is by not running a full CI workflow. Why bother running tests and lint checks when we know that no code has changed?\\n\\nThis seems like it should be straightforward, but it\'s actually surprisingly finicky. Read on to find out how we did it!\\n\\n## First pass: path filtering\\n\\nOne seemingly simple way to achieve this is to use GitHub Actions\' path filtering with \\\\`paths-ignore\\\\`. In fact, their [usage example](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#example-excluding-paths) is exactly our docs/ use case! On every CI workflow, set\\n\\n```yaml\\npaths-ignore:\\n  - \\"docs/**\\"\\n```\\n\\nAnd that workflow will only run if at least one changed file is outside the docs/ directory. Problem solved, right?\\n\\n## Branch protection racket\\n\\nNot so fast\u2026 There\'s a catch:\\n\\nWe have a [branch protection rule](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/about-protected-branches) on our main branch that prevents a merge unless various CI jobs, such as testing and linting, pass. If the jobs don\'t run due to path filtering, GitHub actions considers them pending, not passing, so we won\'t be able to merge.\\n\\nThe workaround is, as is [so often the case](https://en.wikipedia.org/wiki/Fundamental_theorem_of_software_engineering), to add a level of indirection:\\n\\nInstead of having a branch protection rule that directly requires those test and lint jobs to pass, have a rule that requires some single job named \\"Merge OK\\" to pass. Since branch protection rules only look at the name of the job, we can have two \\"Merge OK\\" jobs - one that runs for regular changes that affect code, and depends on all the test and lint jobs passing before it can run, and another, for \\"docs only\\" changes, that runs immediately. Now, problem solved, right?\\n\\n## The trouble with path filtering\\n\\nNot so fast\u2026 There is _another_ catch:\\n\\nPath filtering can only handle \\"run a workflow if any path is under docs/\\" or \\"skip a workflow if all paths are under docs/\\". It does not provide \\"run a workflow if all paths are under docs/\\". So there is no way to use path filtering to run that other \\"Merge OK\\" job in the \\"docs only\\" case.\\n\\nTo solve this, we don\'t use GitHub Actions\' built-in path filtering. Instead, we use the [changed-files](https://github.com/tj-actions/changed-files) action, and check the files it reports in the \\"if\\" condition of the job. \xa0Surely, now, problem solved, right?\\n\\n## Skipping successfully\\n\\nNot so fast\u2026 Try not to fall over when I tell you that there is _yet another_ catch:\\n\\nGitHub Actions treats jobs skipped due to an \\"if\\" condition as successful. So we can\'t have our branch protection rule check for a \\"Merge OK\\" job directly: The \\"docs only\\" variant of that job will _always_ be successful, either because this is a \\"docs only\\" change, so it actually ran, or because this is not a \\"docs only\\" change, so the job was skipped due to its \\"if\\" condition.\\n\\nThe workaround here is to add, you guessed it, another level of indirection:\\n\\nInstead of two \\"Merge OK\\" jobs, we have two \\"Set Merge OK\\" jobs, and a single \\"Merge OK\\" job that depends on both of them. The \\"Set Merge OK\\" jobs set an output, and the \\"Merge OK\\" job checks for the presence of that output. A job needs to actually run to set an output, so if \\"Merge OK\\" does see that output we know that one of the \\"Set Merge OK\\" jobs ran, which means one of two things:\\n\\n1.  This was a \\"docs only\\" change\\n2.  This was not a \\"docs only\\" change, and all the regular CI jobs passed\\n\\nAnd now, finally, problem solved!\\n\\nYou can see how all this fits together [here](https://github.com/pantsbuild/pants/blob/cbaf090219/.github/workflows/test.yaml), and that YAML is generated by [this script](https://github.com/pantsbuild/pants/blob/cbaf090219/build-support/bin/generate_github_workflows.py).\\n\\nAnd since if you\'re reading this you probably care about CI performance, you may want to learn more about [Pants](https://www.pantsbuild.org/), and how it can help speed up your builds. If you\'re curious, come and say hi on our [Slack](https://www.pantsbuild.org/docs/getting-help)!"},{"id":"/2022/09/02/meet-our-newest-maintainer-a-alonso-dominguez","metadata":{"permalink":"/blog/2022/09/02/meet-our-newest-maintainer-a-alonso-dominguez","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-09-02-meet-our-newest-maintainer-a-alonso-dominguez/index.mdx","source":"@site/blog/2022-09-02-meet-our-newest-maintainer-a-alonso-dominguez/index.mdx","title":"Meet our newest Maintainer: A. Alonso Dominguez","description":"I was born in the early 80\'s in a small fishing town in the Spanish Atlantic Coast, far away from the big urban sprawls and common traits of miles-long beaches, year-round summertime and chill out vibes normally identified with life in Spain. This is the autonomous region named Galicia\u2026","date":"2022-09-02T00:00:00.000Z","tags":[{"inline":true,"label":"meet-the-team","permalink":"/blog/tags/meet-the-team"},{"inline":true,"label":"users","permalink":"/blog/tags/users"}],"readingTime":5.01,"hasTruncateMarker":true,"authors":[{"name":"Carina C. Zona","title":"Pants Maintainer","url":"https://github.com/cczona","imageURL":"https://github.com/cczona.png","key":"cczona","page":null}],"frontMatter":{"authors":["cczona"],"tags":["meet-the-team","users"]},"unlisted":false,"prevItem":{"title":"Skipping GitHub Actions jobs while keeping branch protection rules that require them","permalink":"/blog/2022/10/10/skipping-github-actions-jobs-without-breaking-branch-protection"},"nextItem":{"title":"Pants 2.13: Easier at the command line, easier parallel execution in CI, Kotlin support, and better Python and JVM support!","permalink":"/blog/2022/09/01/introducing-pants-2-13"}},"content":"import Admonition from \\"@theme/Admonition\\";\\n\\n\\n<CaptionedImg src={require(\\"./splash.jpeg\\").default}></CaptionedImg>\\n\\nI was born in the early 80\'s in a small fishing town in the Spanish Atlantic Coast, far away from the big urban sprawls and common traits of miles-long beaches, year-round summertime and chill out vibes normally identified with life in Spain. This is the autonomous region named Galicia\u2026\\n\\n{/* truncate */}\\n\\n---\\n\\nWelcome to our newest Maintainer, Alonso! He joined the team this April as a Contributor and recently was elected to the highly trusted role of Maintainer. Among [Alonso\'s contributions to Pants](https://github.com/pantsbuild/pants/commits?author=alonsodomin) so far:\\n\\n- Improvements to Coursier handling, and bug reports upstream.\\n- Support for generating Java code from WSDL files.\\n- A surprisingly complete Helm backend, which he kindly split into multiple commits for review, and followed with a series of further improvements to the Helm backend.\\n- Added support for JVM memory controls, and per-process options.\\n- Implemented transitive file dependencies for tests.\\n- Feedback on the JVM backend in general, and assistance to other JVM users in Slack.\\n- Advocated for Pants with new JVM adopters in Slack.\\n\\nAlonso has consistently been a pleasure to work with during code review, and has become known for his thoughtful design decisions. But all of this is the professional side alone. I recently invited him to introduce himself in-depth to the community, and was delighted to get this personal story in return. Enjoy!\\n\\n---\\n\\n<CaptionedImg src={require(\\"./coast-of-death.jpg\\").default}>\\n  [\\"Laxe, Costa da\\n  Morte\\"](https://www.flickr.com/photos/24326886@N03/4204899447) by\\n  [amaianos](https://www.flickr.com/photos/aamaianos/)\\n</CaptionedImg>\\n\\n> I was born in the early 80\'s in a small fishing town in the Spanish Atlantic Coast, far away from the big urban sprawls and common traits of miles-long beaches, year-round summertime and chill out vibes normally identified with life in Spain. This is the autonomous region named Galicia and here winters are tough, the coast line is gnarly and the seas are rough (a part of it\'s even dubbed as \'[The Coast of Death](https://www.spain-holiday.com/Finisterre/articles/galicias-dramatic-coast-of-death)\'!); in short, a paradise for nature lovers.\\n>\\n> Spain was starting its third attempt at democracy and opening itself to the world with a lot of new technology arriving to the common people. The tough winters, my curiosity and long time spent indoors motivated the self-learner in me into learning BASIC. By my teenage years I was already coding in Turbo Pascal and some Delphi. Good and reliable Internet was not a thing at the time in that part of the world, so all copy-pasting had to be done manually typing the code I could find in books and magazine articles of the time, a habit that I still carry out today when learning new languages or tools.\\n>\\n> Being raised surrounded by the beautiful landscapes of the Spanish North-West I also developed quite a lot of interest in photography and outdoor activities. While growing up I was always the kid that pretended to be into mainstream sports (i.e. basketball, football/soccer, etc) just to feel accepted in the small community I belonged to. But as a teenager I developoed the personal confidence to stop pretending and to give a go at hiking, skiing and surfing, enjoying the feeling of freedom of being in nature. My interest in photography took me in the opposite direction of technology, developing a fetish for analog photography (and its whole DIY process). The pursuit of freedom in the outdoors took me to the sky, becoming a skydiver in my early 30\'s, which is the sport I dedicate most of my free time to nowadays.\\n>\\n> Supported by family, I left my hometown while I still was in my teens; searching for learning and career growth opportunities. Initially not far away from home, I moved into the cities of Santiago de Compostela and A Coru\xf1a. Then the global financial crisis brought me to London and Manchester in the UK. After many years away, some of my roots starting calling back. So I returned to Spain, into the sunny city of Barcelona where I\'m now based.\\n>\\n> Thanks to working in many different projects and companies from small to big tech (i.e. Booking.com), making some contributions to OSS projects, and self-teaching myself new languages and programming practices I decided to become an independent Software Engineer Consultant a couple of years ago. My interest in [Pants](https://pantsbuild.org/) and monorepos in general comes from the overhead that comes from maintaining multiple small repositories that are part of a larger system that needs to be kept cohesive and up-to-date.\\n>\\n> Unfortunately monorepos are not yet a very common thing in the industry and most of the tools designed to work with them feel a bit clunky, not very onboarding-friendly and demand a considerable amount of effort from repository maintainers. So it was a great relief to find Pants since \u2014 from the very first moment of using it \u2014 it was easy to understand that the team had in mind to solve those specific problems in its design by providing [dependency inference](https://www.pantsbuild.org/docs/how-does-pants-work#dependency-inference) and goals like [`tailor`](../2021-03-19-tailoring-pants-to-your-codebase/index.mdx). Very shortly after trying it out, I was convinced that even though Pants didn\'t have as wide a range of features and tool chains as a tool like Bazel, it was worth contributing to Pants to help it grow and become the best multi-paradigm monorepo build tool.\\n\\n---\\n\\n<Admonition type=\\"info\\" icon=\\"\u{1F7E9}\\" title=\\"\\">\\n  Interesting in joining Pants team too? Terrific! We regularly usher in new\\n  teammates, and we are happy to offer mentorship to support your goals. Here\'s\\n  where to learn more about [who is on the\\n  team](https://www.pantsbuild.org/docs/team) , [how the community and team are\\n  structured](https://www.pantsbuild.org/docs/the-pants-community), and [some of\\n  the varied paths that led others to Pants team](blog/tags/meet-the-team).\\n</Admonition>"},{"id":"/2022/09/01/introducing-pants-2-13","metadata":{"permalink":"/blog/2022/09/01/introducing-pants-2-13","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-09-01-introducing-pants-2-13/index.mdx","source":"@site/blog/2022-09-01-introducing-pants-2-13/index.mdx","title":"Pants 2.13: Easier at the command line, easier parallel execution in CI, Kotlin support, and better Python and JVM support!","description":"Photo by [Henry &","date":"2022-09-01T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"jvm","permalink":"/blog/tags/jvm"},{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":7.38,"hasTruncateMarker":true,"authors":[{"name":"Christopher Neugebauer","title":"Pants Maintainer","url":"https://github.com/chrisjrn","imageURL":"https://github.com/chrisjrn.png","key":"chrisjrn","page":null}],"frontMatter":{"authors":["chrisjrn"],"tags":["python","jvm","announcement"]},"unlisted":false,"prevItem":{"title":"Meet our newest Maintainer: A. Alonso Dominguez","permalink":"/blog/2022/09/02/meet-our-newest-maintainer-a-alonso-dominguez"},"nextItem":{"title":"Astranis Case Study: Wrangling Python In a Monorepo","permalink":"/blog/2022/08/12/astranis-case-study-wrangling-python-in-a-monorepo"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Henry &\\n  Co.](https://unsplash.com/@hngstrm?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nWe\'re pleased to announce Pants 2.13.0. Highlights include better command line arguments for file sets, improved JVM support, easier access to parallel execution in CI, and lower barriers to adoption for Python projects that currently use existing distribution and build tools.\\n\\n{/* truncate */}\\n\\n---\\n\\nWe\'re pleased to announce Pants 2.13.0, the latest release of Pants, the scalable and ergonomic build system. Highlights of this release include experimental support for Kotlin on the JVM, better command line arguments for file sets, improved JVM support, easier access to parallel execution in CI, and lower barriers to adoption for Python projects that currently use existing distribution and build tools.\\n\\nYou can update by setting `pants_version = \\"2.13.0\\"` in your `pants.toml` file. See [upgrade tips](https://www.pantsbuild.org/docs/upgrade-tips) for more information.\\n\\n## Making it easier to work with file sets at the command line\\n\\nWe\'ve improved our command line arguments to make it easier to run Pants against multiple files, and making the behavior of different goals more consistent, so they\'re easier to learn and remember.\\n\\n[You can now `filter` targets in a goal](https://www.pantsbuild.org/v2.13/docs/reference-filter#target_type), which lets you select targets of a specific type from a broader set of targets. For example, it\'s now easy to run just the Python tests when running the `test` goal over your entire codebase:\\n\\n- **Before**: `./pants filter --target-type=python_test :: | xargs ./pants test`\\n- **After**: `./pants --filter-target-type=python_test test ::` \\\\[[#15599](https://github.com/pantsbuild/pants/pull/15599)\\\\]\\n\\nYou can now easily run Pants against all targets in a directory by [specifying a directory name at the command line](https://www.pantsbuild.org/v2.13/docs/goals#goal-arguments). Previously, specifying a directory name was a shorthand for a specific target in a directory.\\n\\n[You can now selectively ignore targets, files, and directories](https://www.pantsbuild.org/v2.13/docs/goals#goal-arguments) when running a goal against a set of files. To ignore targets, add an extra argument, prefixed with a `-`, for example, to run all of your Python tests, except the `integration_tests` directory, you could run `./pants test src/py:: -src/py/integration_tests`. \\\\[[#15619](https://github.com/pantsbuild/pants/pull/15619)\\\\]\\n\\nFinally, you can now supply files to any Pants goal in the same way! Previously, some goals handled arguments in their own way, making it difficult to switch between goals, or use multiple goals for the same invocation. Now, the `::` glob, or the `--changed-since` command line option works for any goal that needs a list of targets. For example, try `./pants count-loc ::` to get the lines of code in your project (previously, you\'d need to use `**`), or `./pants --changed-since=HEAD update-build-files` to only format changed `BUILD` files \\\\[[#15577](https://github.com/pantsbuild/pants/pull/15577)\\\\], \\\\[[#14434](https://github.com/pantsbuild/pants/pull/14434)\\\\]\\n\\n## Easy parallel execution in CI with test sharding\\n\\nOne goal of Pants is to make it easier to speed up your build and CI suites. Up until now, Pants\' support for speeding up builds with parallelism has been limited to [remote execution](https://www.pantsbuild.org/v2.13/docs/remote-execution) services. Remote execution is highly flexible, at a cost of higher complexity.\\n\\nFor an easier first step into speeding up your test suite in CI, Pants 2.13 adds support for [sharded test suites](https://www.pantsbuild.org/v2.13/docs/reference-test#shard), which splits test execution across a configurable number of machines. Parallelism with sharding can give faster results than running on a single machine, while being easier to get started than a remote execution suite.\\n\\nTo enable, use the `PANTS_TEST_SHARD` environment variable or `--test-shard` command line option. Setting a value of `k/N` will deterministically split your test suite into `N` shards (by number of files only) and run the `k`th subset of that shard. \\\\[[#15417](https://github.com/pantsbuild/pants/pull/15417)\\\\]\\n\\n## Experimental Kotlin on JVM Support\\n\\nFresh after adding support for Java and Scala, we\'ve added initial support for Kotlin on the JVM, which brings all of the features from other JVM languages including multiple lockfile support for third-party dependencies, and JUnit for running your tests, along with integration with popular Kotlin tools including KtLint.\\n\\nKotlin support is still work-in-progress, but we\'d love for you to try it out and let us know how we can improve it.\\n\\n## Improved fine-tuning in JVM builds with per-tool options\\n\\nFollowing on from our initial experimental JVM support first released last year, Pants 2.13 now allows you to provide per-tool configuration for the underlying steps in your build. This is particularly handy for adjusting memory allocations for [more heavyweight compilers](https://www.scala-lang.org/) without increasing the memory for tools that don\'t need it.\\n\\nThe end result is that you should be able to run more JVM build steps in parallel on the same machine.\\n\\nTo enable, you can set the `jvm_options` setting in the relevant tool\'s configuration block in your `pants.toml` file. See, for example, our [JUnit support documentation](https://www.pantsbuild.org/v2.13/docs/reference-junit#jvm_options). \\\\[[#15505](https://github.com/pantsbuild/pants/pull/15505)\\\\]\\n\\n## Improved IDE support for JVM languages\\n\\nOur Build Server Protocol-based IDE support has gained a few more features since the initial release in Pants 2.12. We now support automatic JDK configuration for Scala projects, and it\'s now possible for IntelliJ to run tests against class files that have been built by Pants \\\\[[#15408](https://github.com/pantsbuild/pants/pull/15408)\\\\], \\\\[[#15347](https://github.com/pantsbuild/pants/pull/15347)\\\\].\\n\\n## More efficient remote cache access\\n\\nWe\'ve added new behaviors to our [remote cache support](https://www.pantsbuild.org/docs/remote-caching) which can improve the efficiency and performance by optionally skipping downloads of cache entries where possible.\\n\\nWith the new [`[GLOBAL].cache_content_behavior = \\"validate\\"`](https://www.pantsbuild.org/v2.13/docs/reference-global#section-cache-content-behavior) flag, Pants will register a cache hit after validating that the contents exist, rather than first requiring a successful download. Depending on the shape of their code, users have seen anywhere from 25% to 75% fewer bytes downloaded in CI runs with `\\"validate\\"` set. Please try it out and let us know what you think!\\n\\nBecause this can change the behavior of builds when a remote cache is flaky or unavailable, `\\"validate\\"` mode remains optional behavior, with the old-style `\\"fetch\\"` behavior remaining the default.\xa0 \\\\[[#16409](https://github.com/pantsbuild/pants/pull/16409)\\\\]\\n\\n## Lower barriers to adoption for Python open source projects\\n\\nWe\'re also working towards making it easier to adopt pants in Python projects that use the setuptools or distutils workflows. This release adds support for `setuptools_scm` and `mypyc`.\\n\\nPants 2.13 [adds support for the `setuptools_scm` tools](https://www.pantsbuild.org/v2.13/docs/reference-vcs_version), which allow Python projects to [use git tags and commit hashes to set the project version in built packages](https://www.pantsbuild.org/v2.13/docs/generating-version-tags#the-vcs_version-target). Files generated by `setuptools_scm` are fully supported by existing Pants features\\\\`, including dependency inference \\\\[[#15374](https://github.com/pantsbuild/pants/pull/15374)\\\\], \\\\[[#15385](https://github.com/pantsbuild/pants/pull/15385)\\\\].\\n\\nWe\'ve also started building out initial support for Python build-time requirements, starting with producing dists that use `mypyc` in their existing `setup.py` file \\\\[[#15380](https://github.com/pantsbuild/pants/pull/15380)\\\\].\\n\\n## Other notable changes\\n\\nAs always, this release brings a [whole pile of smaller features, improvements, and bugfixes](https://github.com/pantsbuild/pants/blob/2.13.x/src/python/pants/notes/2.13.x.md), including:\\n\\n- `./pants test` and `./pants run` support for visual debuggers in Python \\\\[[#15799](https://github.com/pantsbuild/pants/pull/15799)\\\\]\\n- `./pants run` support for arbitrary Python targets \\\\[[#16022](https://github.com/pantsbuild/pants/pull/16022)\\\\]\\n- Numerous `tailor` improvements including support for `poetry_requirements` and `pipenv_requirements` \\\\[[#15352](https://github.com/pantsbuild/pants/pull/15352)\\\\],\\n- Adding file downloading support to asset targets \\\\[[#15457](https://github.com/pantsbuild/pants/pull/15457)\\\\]\\n- Support for Kotlin JUnit tests \\\\[[#15382](https://github.com/pantsbuild/pants/pull/15382)\\\\]\\n- Added the option `lint --skip-formatters` to avoid running formatters like Black and Scalafmt in check-only mode. \\\\[[#15427](https://github.com/pantsbuild/pants/pull/15427)\\\\]\\n- Improved error messages for invalid target addresses. \\\\[[#15751](https://github.com/pantsbuild/pants/pull/15751)\\\\]\\n\\nSee the full [changelog](https://github.com/pantsbuild/pants/blob/release_2.13.0/src/python/pants/notes/2.13.x.md) for more changes, along with our [plugin upgrade guide](https://www.pantsbuild.org/docs/plugin-upgrade-guide).\\n\\n---\\n\\nTry out one of our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-kotlin](https://github.com/pantsbuild/example-kotlin)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)\\n\\n## Thanks!\\n\\nPants wouldn\'t be possible without everyone who contributed to 2.13, including everyone who shared feedback on changes and who tested release candidates! Thank you all!"},{"id":"/2022/08/12/astranis-case-study-wrangling-python-in-a-monorepo","metadata":{"permalink":"/blog/2022/08/12/astranis-case-study-wrangling-python-in-a-monorepo","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-08-12-astranis-case-study-wrangling-python-in-a-monorepo/index.mdx","source":"@site/blog/2022-08-12-astranis-case-study-wrangling-python-in-a-monorepo/index.mdx","title":"Astranis Case Study: Wrangling Python In a Monorepo","description":"Photo by","date":"2022-08-12T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"case-studies","permalink":"/blog/tags/case-studies"}],"readingTime":11.33,"hasTruncateMarker":true,"authors":[{"name":"Nathanael England","url":"https://github.com/engnatha.png","imageURL":"https://github.com/engnatha","key":"nathanael","page":null}],"frontMatter":{"authors":["nathanael"],"tags":["python","case-studies"]},"unlisted":false,"prevItem":{"title":"Pants 2.13: Easier at the command line, easier parallel execution in CI, Kotlin support, and better Python and JVM support!","permalink":"/blog/2022/09/01/introducing-pants-2-13"},"nextItem":{"title":"Monorepository linting via Pants\'s project introspection","permalink":"/blog/2022/08/05/monorepository-linting-via-pants-project-introspection"}},"content":"import Admonition from \\"@theme/Admonition\\";\\n\\n\\n<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by\\n  [NASA](https://unsplash.com/@nasa?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n\\"Code development at Astranis has been migrating towards a monorepo structure. Astranis has grown rapidly since this migration started and, along with it, so has the volume of Python hosted in our monorepo. We went looking for new tooling to bring us into the future.\\"\\n\\n{/* truncate */}\\n\\n<Admonition type=\\"info\\" icon=\\"\u{1F7E9}\\" title=\\"About the guest author...\\">\\n  Nathanael England is a Ground Software Engineer at Astranis Space Technologies\\n  Corp., a private American geostationary communications satellite operator and\\n  manufacturer headquartered in San Francisco, California.\\n</Admonition>\\n\\n---\\n\\n## Internal Requirements\\n\\nCode development at [Astranis](https://www.astranis.com/) has been migrating towards a monorepo structure and this has been a net improvement for a variety of reasons. A major portion of code migrated to this monorepo was written in Python and had legacy usages of setuptools and more classical forms of distribution tooling. Astranis has grown rapidly since this migration started and, along with it, so has the volume of Python hosted in our monorepo. It was becoming apparent that this solution was not scalable long term. Knowing that this problem was only going to get worse as time went on, we went looking for some new tooling to bring us into the future. To start that journey, we made a wishlist. We wanted...\\n\\n- Something that will cache test results and identify dependencies to minimize what has to be tested.\\n- A faster, simpler process for packaging our Python microservices into Docker containers.\\n- Better third-party dependency resolution and locking support.\\n- An easy way to package code to share internal libraries with repos that hadn\'t been migrated.\\n- To minimize disturbance to developers\' workflows. Changing the monorepo structure overnight could critically inhibit our mission at Astranis. The best way to do this is to incrementally adopt a new tool and slowly deprecate the legacy system.\\n- A build system that wasn\'t specific for Python since we develop in multiple languages.\\n\\n## What Did We Explore?\\n\\n### Poetry\\n\\nAstranis certainly wasn\'t the first to make use of a monorepo with a heavy helping of Python. One tool caught our eye during initial explorations for more modern tooling: [Poetry](https://python-poetry.org/). For the uninitiated, Poetry is a dependency management and packaging tool specifically for Python. They offer excellent support for lockfiles, cache virtual environments to allow easily switching between projects, and have native support for packaging and publishing projects. While not natively supported, they do give excellent insights as to how Python microservices can be containerized with Docker from the information Poetry stores about a particular project.\\n\\nIn reading up on it, we found a helpful article over on Medium specifically addressing the problems that come with a Python monorepo and how their team had solved it. Here\'s some of our key takeaways after investigating Poetry for our needs:\\n\\n- **Intuitive command line tooling** - The Poetry CLI was very easy to pick up. With simple commands, dependencies could be added with lockfiles automatically updated and modules could be run without having to worry about which virtual environment to activate.\\n- **Good documentation** - The Poetry tool has a good mix of practical/use case driven documentation and specific details about their API.\\n- **Our code structure would have to change** - Poetry makes heavy use of the notion of libraries (i.e. code to be shared/published) and projects (i.e. a microservice). Our code did not follow any kind of obvious segmentation between libraries are projects. The organization would have to be heavily reworked to create minimal microservices that had exactly only the dependencies (both internal and third-party) that they needed. A transition like this would require us to develop good rules for what constitutes a library and a project and consistently apply those across Astranis.\\n- **No test caching** - Even after a restructure, as the team at Medium has pointed out, Poetry doesn\'t offer any support for intelligent test caching. For large monorepos, developers must choose between maintaining complex rules to walk the dependees of changed projects and libraries or rerun all tests every commit to guarantee nothing has been broken.\\n- **Only supports Python** - Poetry is a tool specifically for Python and will not be extended.\\n\\nWhile we enjoyed how much of an improvement Poetry was over our existing setuptools + pip legacy system, it didn\'t seem to check enough boxes to warrant a switch.\\n\\n### Bazel\\n\\n[Bazel](https://bazel.build/) was next on the investigation list. We\'d been using it successfully for managing our C++ portions of our monorepo and has good support for Python. Bazel is a completely different style of tool compared to Poetry. It works by constructing dependency graphs from the repository structure. Because it intimately knows the structure of the source code, it will know exactly what needs to be tested or rebuilt as code is developed. The open source community for extending Bazel is very expansive, but we wanted to limit our tooling to only what we felt would be maintained by a set of core developers. This restricted our investigation to `rules_python`. Here\'s what we learned in attempting to work Bazel into our existing Python infrastructure:\\n\\n- **Difficult or missing documentation** - Bazel seems to prioritize documentation about their API. This often made it hard to understand how to extend more simple examples of rules_python usage.\\n- **Tedious BUILD file management** - BUILD files would have to get updated every time Python module names changed or got restructured. This could significantly slow down development for those not as familiar with the build tooling. `rules_python` does attempt to provide some support for Gazelle to automate the BUILD file management process, but our team found it in too much of an alpha stage to be useful at this time.\\n- **Native lockfile support** - Rules like compile_pip_requirements could be used to easily generate lockfiles which maintain reproducibility across different developer and CI/CD machines.\\n- **Intuitive containerization support** - If we could get our code successfully framed into py_binary and py_library targets, it was a simple extension to use something like rules_docker to package up and deploy our microservices.\\n\\nWhile Bazel solved many of the problems that Poetry couldn\'t, our team found maintaining BUILD files properly far too difficult to feel confident about managing our Python source code. We would also be losing the existing capabilities we had for things like running static type checking engines and packaging code to send out to other internal repositories.\\n\\n### Pants\\n\\n[Pants](https://pantsbuild.org) ([sometimes called Pantsbuild](../2022-01-12-you-can-call-us-pantsbuild-or-pants-whichever-you-prefer/index.mdx)) was the last tool we investigated and was inspired by [the good things said by the team over at Semaphore](https://semaphoreci.com/blog/building-python-projects-with-pants). Our initial impressions were that it [seemed to be a lot like Bazel, but with more intentional support for Python projects](../2021-11-18-pants-vs-bazel/index.mdx). After installing their tool, _what took many hours of setup in Bazel took just over half an hour with Pants_. Some features that particularly surprised us were integrations for Google\'s [protocol buffers](https://www.pantsbuild.org/docs/protobuf-python), [PEX](https://www.pantsbuild.org/docs/pex-files) binaries, and targets for [building and running Docker images](../2022-08-02-optimizing-python-docker-deploys-using-pants/index.mdx). Here\'s a summary of what we learned after investigating Pants:\\n\\n- **Great Documentation** - The Pants team has written [incredible documentation](https://pantsbuild.org/docs/). It ranges from high-level API descriptions all the way down to thorough example use cases and esoteric debugging tips. Whether you\'re just starting to integrate Pants into your project or you\'re trying to figure out why your third party dependencies aren\'t being inferred properly, there\'s a good chance there\'s a doc for it.\\n- **Simple BUILD files** - Pants is intentionally developed to have minimal boilerplate inside BUILD files. A huge benefit of this is we often don\'t have to modify the BUILD files at all when we\'re working with our Python code. [If things get renamed or added in, there\'s a good chance Pants will pick it up like it was there all along.](https://www.pantsbuild.org/docs/how-does-pants-work#dependency-inference) To further simplify the developer experience, Pants ships with tooling that scans the repository to determine if BUILD files are missing or need updating. The tools are incredibly fast and [can even be used in a CI system to inform authors of potential errors](https://www.pantsbuild.org/docs/using-pants-in-ci).\\n- **Expansive Python support** - We touched on this already, but the native support for tooling like [protobufs](https://www.pantsbuild.org/docs/protobuf-python) and [containerization](https://www.pantsbuild.org/docs/docker) were huge for us. The team has also taken on efforts to support [more tooling for linting](../2022-08-05-monorepository-linting-via-pants-project-introspection/index.mdx) and formatting, static typing analysis, and packaging.\\n- **Few supported languages** - While the support for Python has been great, it seems most other aspects are in more alpha and beta stages. Since the Pants team has focused so much on building out a strong backing infrastructure, it seems likely that getting support for more languages is only a matter of time. _\\\\[Editor\'s note: Pants now supports [Python](https://www.pantsbuild.org/docs/python), [Go](https://www.pantsbuild.org/docs/go), [Java](https://www.pantsbuild.org/docs/jvm-overview), [Kotlin](https://www.pantsbuild.org/docs/reference-kotlin), Protobuf, [Scala](https://www.pantsbuild.org/docs/jvm-overview), [Shell](https://www.pantsbuild.org/docs/shell), and [Thrift](https://www.pantsbuild.org/docs/thrift-python). Javascript/Typescript and Rust are next on the [language support roadmap](https://www.pantsbuild.org/page/language-support).]_\\n- **Intentional CI support** - We didn\'t start our search for new tooling with this in mind, but Pants pleasantly surprised us with [how much the documentation speaks to working with continuous integration systems](https://www.pantsbuild.org/docs/using-pants-in-ci). They give detailed examples of code to add for builds and provide tooling to hook in [remote caching and execution](https://www.pantsbuild.org/docs/remote-caching-execution). The guidance made it very easy to determine how we should adjust our CI build steps.\\n\\nOverall, Pants checked enough boxes on our wishlist and would solve some substantial development problems we were having in our repository.\\n\\n## What Did Our Migration Look Like?\\n\\nInitial investigations are fun, but you might be wondering how the migration really went. Thankfully, Pants put together some nice recommendations on [how to incrementally adopt](https://www.pantsbuild.org/docs/existing-repositories) their tooling, which wasn\'t something we had seen from other tools we investigated. We\'re still very early in our adoption process, but here\'s what it has looked like so far.\\n\\n### Set up a minimal pants.toml file\\n\\nOur first pass at a toml file was intentionally minimal and aimed to keep Pants restricted to only the portions of our monorepo that we were ready to migrate. We chose to [name our BUILD files BUILD.pants to avoid confusion with existing Bazel integrations](https://www.pantsbuild.org/docs/existing-repositories#migrating-from-other-build-tools-set-custom-build-file-names). For almost all of the BUILD.pants files we added (thanks to the help of `tailor`) we decided to add a `skip_tests=True` for the `python_tests` targets that got added.\\n\\n### Work through the code and remove `skip_tests=True` where possible\\n\\nOur next step was to go through the repository and pull in small groups of tests to be executed by Pants. Many times, we found that the tests already worked, and it was as simple as removing the `skip_tests` declaration. Other times, tests were dependent on other file types (yaml, prototxt, etc.) and needed to be manually included into the BUILD files. The last type of cases that took more work were actually due to the structure of our code. We had modules that fundamentally did not work with the [sandboxing](../2022-05-01-pycon-us-2022-talk/index.mdx) that tools like Pants use.\\n\\n### Tune continuous integration performance\\n\\nOne of the main reasons for choosing Pants was the ability to make our build system more scalable and only execute what was necessary. We found it incredibly easy to hook in our existing [remote caching](https://www.pantsbuild.org/docs/remote-caching) systems to Pants, and added other nice features like running [`tailor`](https://www.pantsbuild.org/docs/reference-tailor) in a check-only mode to highlight any inconsistencies in our repo. As a side benefit, Pants has helped us gain better insight into our repository by being able to easily scan for and report the transitive dependencies of modules. Having that insight has helped us plan out how to minimize the coupling of our modules.\\n\\n### Use Docker integrations for packaging microservices\\n\\nPrior to using Pants, we had a laborious process that involved building our repository as a wheel and installing that into our Docker containers. This process only got worse as our repo grew, so it was high on our list to remediate. Pants solved this issue for us fairly easily through the use of [PEX binaries in Docker containers](../2022-08-02-optimizing-python-docker-deploys-using-pants/index.mdx). Pants already has great support for both of these targets, so the transition was easy to manage. The only issue we came across was learning that some of our files targets had to be turned into resources to get packaged along with our PEX binaries.\\n\\nOverall, there has been a pretty minimal impact to our developer workflows and our software developers have adopted it fairly easily. As with any new tool, there are always interesting edge cases of memory and CPU usage that pop up from time to time. We\'re excited for the future of Pants to see how we can continue to integrate it more deeply into our repository!"},{"id":"/2022/08/05/monorepository-linting-via-pants-project-introspection","metadata":{"permalink":"/blog/2022/08/05/monorepository-linting-via-pants-project-introspection","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-08-05-monorepository-linting-via-pants-project-introspection/index.mdx","source":"@site/blog/2022-08-05-monorepository-linting-via-pants-project-introspection/index.mdx","title":"Monorepository linting via Pants\'s project introspection","description":"Photo by","date":"2022-08-05T00:00:00.000Z","tags":[{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"}],"readingTime":6.95,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":["concepts"]},"unlisted":false,"prevItem":{"title":"Astranis Case Study: Wrangling Python In a Monorepo","permalink":"/blog/2022/08/12/astranis-case-study-wrangling-python-in-a-monorepo"},"nextItem":{"title":"Optimizing Python + Docker deploys using Pants","permalink":"/blog/2022/08/02/optimizing-python-docker-deploys-using-pants"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by\\n  [Sigmund](https://unsplash.com/@sigmund?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nPantsbuild provides a common interface to run all code quality tools in parallel. This post explores how Pants augments excellent linters such as bandit, flake8, shellcheck, etc. by offering its own linting mechanisms, too, including regex matches, dependency analysis, and metadata checks.\\n\\n{/* truncate */}\\n\\n---\\n\\nSome excellent linters now exist to discover bugs and issues in your code through static analysis. Some of our favorites:\\n\\n- [Hadolint](https://github.com/hadolint/hadolint) for Dockerfiles\\n- [Shellcheck](https://www.shellcheck.net) for shell/bash scripts\\n- [Flake8](https://flake8.pycqa.org/en/latest/) for Python bugs\\n- [Bandit](https://pypi.org/project/bandit/) for Python security vulnerabilities\\n\\nThe [Pants build system](https://www.pantsbuild.org/docs) provides a common interface to run all those tools in parallel, e.g. `./pants lint ::` to check your whole project, regardless of language and tool.\\n\\nThis blog explores how Pants augments those linters by offering its own linting mechanisms, too, including regex matches, dependency analysis, and metadata checks.\\n\\n## Finding fragile dependencies\\n\\nIt is a common practice for applications to depend on libraries (shared code), however, it is also possible (but less ideal) for an application to use code from another application. If multiple applications have some code they both need, it is often suggested that this code is extracted into a shared library so that both applications can depend on that instead.\\n\\nWith Pants and its [dependency inference](https://www.pantsbuild.org/docs/how-does-pants-work#dependency-inference) feature, you know exactly what code your application depends on.\\n\\nFor example\u0431 you may enforce that application tests should only use resources and test data from its own project directory or from a shared (repository wide) test data directory. Therefore, if you introspect the `python_tests` targets of a project, the raw dependencies should either be local targets (sourcing project\'s files only) or a known directory with test data that can be used by any project in your repository.\\n\\nIn the example below, by inspecting the `dependencies_raw` field, we can see that tests in the `projectA` depend on local test data (`:testdata`), test data from a known shared location (`commons`), and data from another project (`projectB`).\\n\\n```shell-session\\n$ ./pants peek projectA/projectA/tests::\\n[\\n  {\\n    \\"address\\": \\"projectA/projectA/tests/scripts/test_module.py:../../tests\\",\\n    \\"target_type\\": \\"python_test\\",\\n    \\"dependencies_raw\\": [\\n      \\":testdata\\",\\n      \\"commons/commons/base/tests:test_data\\"\\n      \\"projectB/projectB/tests:local_tests_data\\"\\n    ],\\n    ...\\n  },\\n  ...\\n]\\n```\\n\\nLikewise, if you would like to prevent your applications from depending on each other, you could take a look at the `dependencies` field to see if there are any imports that would imply applications being dependent on each other\'s code. Since the information is accessible via the project introspection tools, you could either chain a sequence of Pants commands or write a plugin to make this functionality readily available with Pants.\\n\\nIn the example below, by inspecting the `dependencies` field, we can see that source modules in the `projectA` depend on local modules and a module from another project (`projectB`).\\n\\n```shell-session\\n$ ./pants peek projectA/projectA/src::\\n[\\n  {\\n    \\"address\\": \\"projectA/projectA/src/module.py:../projectA\\",\\n    \\"target_type\\": \\"python_source\\",\\n    \\"dependencies\\": [\\n      \\"projectA/projectA/src/__init__.py:../projectA\\",\\n      \\"projectA/projectA/src/module1.py:../projectA\\",\\n      \\"projectA/projectA/src/module2.py:../projectA\\",\\n      \\"projectB/projectB/src/module.py\\",\\n    ],\\n    ...\\n  },\\n  ...\\n]\\n```\\n\\nThe Pants team has also said they hope to soon add built-in \\"visibility\\" support to make this workflow easier.\\n\\n## Linting arbitrary repository files\\n\\nPants provides a [`regex-lint`](https://www.pantsbuild.org/docs/reference-regex-lint) linter to validate any file in your project with custom regexes, such as checking for copyright headers.\\n\\nFor example, you could use `regex-lint` to confirm that all your `constraints.txt` files (used by `pip` package manager) start with a comment about when exactly the file was generated.\\n\\nGiven this configuration:\\n\\n```json\\n{\\n  \\"required_matches\\": {\\n    \\"constraints-files\\": [\\"constraints-generated-date-pattern\\"]\\n  },\\n  \\"path_patterns\\": [\\n    {\\n      \\"name\\": \\"constraints-files\\",\\n      \\"pattern\\": \\"constraints.txt\\",\\n      \\"inverted\\": false,\\n      \\"content_encoding\\": \\"utf8\\"\\n    }\\n  ],\\n  \\"content_patterns\\": [\\n    {\\n      \\"name\\": \\"constraints-generated-date-pattern\\",\\n      \\"pattern\\": \\"^#(\\\\\\\\s)Generated(\\\\\\\\s)on*\\",\\n      \\"inverted\\": false\\n    }\\n  ]\\n}\\n```\\n\\nStarting with Pants 2.13+, this command would report any violations of this config:\\n\\n```shell-session\\n$ ./pants lint ::\\n```\\n\\n## Linting metadata from `BUILD` configuration files\\n\\nYou set Pants metadata for your project in lightweight `BUILD` files. Usually, there are only a few auto-generated lines, thanks to sensible defaults and [dependency inference](../2020-10-29-dependency-inference/index.mdx). For example:\\n\\n```python title=\\"BUILD\\"\\npython_tests(\\n    name=\\"tests\\",\\n    timeout=120,\\n)\\n```\\n\\nBecause `BUILD` files are valid Python code, you can employ Python linters like Black.\\n\\nYou can also use Pants\'s `peek` goal to query the metadata of your project. Especially, when combined with `jq` to parse JSON, you can then lint your project metadata.\\n\\nFor example, you can ensure that none of your Python `pex_binary` targets try to support banned OS and Python versions (here we search for targets that would support MacOS on Apple silicon with Python 3.8):\\n\\n```shell-session\\n./pants peek :: | jq \'.[] | select(.target_type==\\"pex_binary\\" and (.platforms | index( \\"macosx_11_0_arm64-cp-38-cp38\\") ))\'\\n```\\n\\nYou can also ensure that your Python `pex_binary` targets do not get packaged for multiple platforms (here we search for any targets that have more than one platform defined):\\n\\n```shell-session\\n$ ./pants peek:: | jq \'.[] | select(.target_type==\\"pex_binary\\" and .platforms != null and (.platforms | length) > 1)\'\\n```\\n\\nOr, check which source files are opting out of Black formatting:\\n\\n```shell-session\\n$ ./pants peek :: | jq \'.[] | select(.target_type==\\"python_source\\" and .skip_black == true)\'\\n```\\n\\n### Finding files that cannot be discovered by Pants\\n\\nWhen you declare the files you would like to become a part of a target, for example, by specifying `sources` of a `python_sources` target, you tell Pants that all files that will be found using this globbing expression are going to be owned by this target.\\n\\n```python title=\\"BUILD\\"\\npython_sources(\\n    sources=[\\n        \\"src/*.py\\",\\n        \\"missing-directory/*.py\\",\\n        \\"main.py\\",\\n    ]\\n)\\n```\\n\\nIf, after expanding the globbing expression, there are no files found, this is most likely an error.\\n\\nPants defaults to only warning when globs do not match, but you can configure it to error by setting this in `pants.toml`:\\n\\n```toml title=\\"pants.toml\\"\\n[GLOBAL]\\nunmatched_build_file_globs = \\"error\\"\\n```\\n\\nThen, for example:\\n\\n```shell-session\\n$ ./pants lint ::\\n19:56:20.39 [ERROR] 1 Exception encountered:\\n\\n  Exception: Unmatched glob from foo/bar:baz\'s `sources` field: \\"foo/bar/missing-directory/*.py\\"\\n```\\n\\n### Finding orphan files\\n\\nIt is possible that a developer added a file that is under version control, but is not used by Pants. For example, this could be a test module that is not globbed due to incorrect naming, e.g. the `sources` field is set to `test_*.py` but the file is named `tes_project.py`. This file would not be found. Likewise, it is possible that there is a source module in a directory that the developer forgot to list under target\'s sources.\\n\\nThese \\"orphan\\" files are tricky to find because having a test module that is not sourced is not really an error from the build system perspective. However, if you have a test module that is never run, this gives a false impression to developers that tests in this module have been exercised since it\'s under the `tests` directory and there is `python_tests` target with the sources. If you have hundreds of test modules spread across multiple projects, it will be very easy to miss the typo in a file name.\\n\\nSuch files can be found using `./pants tailor --check` command which will report any unmatched glob expressions in your `BUILD` files.\\n\\nIf your workflow requires some custom inspection of the files in the monorepository, you can also get a list of all files that Pants is aware of (`BUILD` files, Python modules, test data and resources). The [`filedeps`](https://www.pantsbuild.org/docs/reference-filedeps) goal lists all source and `BUILD` files a target depends on.\\n\\n## Conclusion\\n\\nWith Pants and its rich project introspection functionality, you can ensure high code quality and robust application design across the whole repository. By combining output of Pants goals such as `peek`, `paths`, `filedeps`, and `filter`, you can build sophisticated linting rules that you can run on an ad hoc basis or in an automated fashion in your CI pipeline. Being able to find issues in build configuration and application design will save time in code reviews and ensure best software design practices across the whole repository.\\n\\nYou can try out our [example-python](https://github.com/pantsbuild/example-python) repository to see how some of the project introspection commands work. And feel free to reach out to us in [Slack](https://www.pantsbuild.org/docs/getting-help) if you have any questions!"},{"id":"/2022/08/02/optimizing-python-docker-deploys-using-pants","metadata":{"permalink":"/blog/2022/08/02/optimizing-python-docker-deploys-using-pants","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-08-02-optimizing-python-docker-deploys-using-pants/index.mdx","source":"@site/blog/2022-08-02-optimizing-python-docker-deploys-using-pants/index.mdx","title":"Optimizing Python + Docker deploys using Pants","description":"The Python and Docker logos, with a plus sign between them","date":"2022-08-02T00:00:00.000Z","tags":[{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":7.29,"hasTruncateMarker":true,"authors":[{"name":"Joshua Cannon","title":"Pants Maintainer","url":"https://github.com/thejcannon","imageURL":"https://github.com/thejcannon.png","key":"joshua","page":null}],"frontMatter":{"authors":["joshua"],"tags":["docker","python"]},"unlisted":false,"prevItem":{"title":"Monorepository linting via Pants\'s project introspection","permalink":"/blog/2022/08/05/monorepository-linting-via-pants-project-introspection"},"nextItem":{"title":"Better CI/CD caching with Pants","permalink":"/blog/2022/07/28/better-ci-cd-caching-with-pants"}},"content":"<CaptionedImg src={require(\\"./splash.png\\").default}>\\n  The Python and Docker logos, with a plus sign between them\\n</CaptionedImg>\\n\\nPants can build a PEX file, an executable zip file containing your Python code and all transitive dependencies. Deploying your application is as simple as copying the file. This post elaborates on how to get best performance out of the powerful combination of Pants+PEX+Docker.\\n\\n{/* truncate */}\\n\\n---\\n\\nThe [Pantsbuild system](https://www.pantsbuild.org) ships with support for building an all-in-one distributable Python file called a [PEX](https://www.pantsbuild.org/docs/pex-files). A PEX file is an executable zip file containing your Python code and all its transitive dependencies. Deploying your Python application is as simple as copying a PEX file to a system or image with a suitable Python interpreter.\\n\\nPants also supports building [Docker images](https://www.pantsbuild.org/docs/docker) and embedding code it packages into those images. With the combination of PEX+Docker, [Pants allows you](../2021-10-13-pants-pex-and-docker/index.mdx) to easily containerize your Python application with minimal boilerplate.\\n\\nThis post builds off of our [previous post](../2021-10-13-pants-pex-and-docker/index.mdx) about Pants + PEX + Docker, and elaborates on how to squeeze the best build-time performance out of this powerful combination.\\n\\n## A very simple example\\n\\n```python title=\\"BUILD\\"\\npython_sources()\\n\\npex_binary(\\n    name = \\"binary\\",\\n    entry_point = \\"app.py\\",\\n    # Optimal settings for Docker builds\\n    layout = \\"packed\\",\\n    execution_mode = \\"venv\\",\\n)\\n\\ndocker_image(\\n    name = \\"img\\",\\n    repository = \\"app\\",\\n    instructions = [\\n        \\"FROM python:3.10-slim\\",\\n        \'ENTRYPOINT [\\"/usr/local/bin/python3.10\\", \\"/bin/app\\"]\',\\n        \\"COPY path.to.here/binary.pex /bin/app\\",\\n    ]\\n)\\n```\\n\\nThe example BUILD file above demonstrates how simple Pants makes building a docker image containing a Python application.\\n\\nIn production environments, however, simplicity at build-time comes with trade-offs. Since a PEX is meant to be an all-in-one distributable, it has a few thorns when used as a container\'s entrypoint.\\n\\n- It must extract itself before it can run, increasing application startup times\\n- After extraction, your running container has the PEX and the extracted contents on disk, increasing space required to run\\n- Changing a first-party source file requires a full rebuild of the PEX and the container, which doesn\'t leverage Pants or Docker\'s caches\\n\\n### Metrics\\n\\nUsing some metrics from a real-world use case (a PEX with 56 third-party requirements, a few large assets, and about a hundred source files) using DOCKER_BUILDKIT set to 1:\\n\\n|                               |        |\\n| ----------------------------- | ------ |\\n| PEX: Build time               | 10s    |\\n| PEX: Size                     | ~3.3GB |\\n| Docker: Total build time      | 30s    |\\n| Docker: Context transfer time | ~3.3GB |\\n| Docker: Export time           | 11s    |\\n| Docker: Startup time          | 18s    |\\n| Docker: Image size            | 3.63GB |\\n\\nTouching a 1stparty source results in similar metrics. I.e., we get no incrementality.\\n\\n## Simple Multi-Stage Build\\n\\nWe can leverage Docker multi-stage builds and interesting PEX features to solve some of these challenges. Using [this recipe](https://pex.readthedocs.io/en/latest/recipes.html#pex-app-in-a-container) in PEX\'s documentation, we can:\\n\\n1.  Create a Python virtual environment containing only our third-party dependencies in one stage\\n2.  Create an identical virtual environment containing only our first-party sources in another stage\\n3.  COPY them both onto our final \\"production image\\" stage\\n\\nOur BUILD file becomes:\\n\\n```python title=\\"BUILD\\"\\npython_sources()\\n\\npex_binary(\\n    name = \\"binary\\",\\n    entry_point = \\"app.py\\",\\n    layout = \\"packed\\",\\n    execution_mode = \\"venv\\",\\n    include_tools = True,\\n)\\n\\ndocker_image(\\n    name = \\"img\\",\\n    repository = \\"app\\",\\n    instructions = [\\n        \\"FROM python:3.10-slim as deps\\",\\n        \\"COPY path.to.here/binary.pex /binary.pex\\",\\n        \\"RUN PEX_TOOLS=1 /usr/local/bin/python3.10 /binary.pex venv --scope=deps --compile /bin/app\\",\\n\\n        \\"FROM python:3.10-slim as srcs\\",\\n        \\"COPY path.to.here/binary.pex /binary.pex\\",\\n        \\"RUN PEX_TOOLS=1 /usr/local/bin/python3.10 /binary.pex venv --scope=srcs --compile /bin/app\\",\\n\\n        \\"FROM python:3.10-slim\\",\\n        \'ENTRYPOINT [\\"/bin/app/pex\\"]\',\\n        \\"COPY --from=deps /bin/app /bin/app\\",\\n        \\"COPY --from=srcs /bin/app /bin/app\\",\\n    ]\\n)\\n```\\n\\nThis approach has several benefits:\\n\\n- It moves the extraction of the PEX to \\"build time\\" and also compiles each Python file, so that the application has the lowest-possible startup latency\\n- Running the final image doesn\'t require any additional space\\n- The `COPY  --from=deps` instruction in the final image can be cached between runs when only touching first-party code\\n\\nIt also has some drawbacks:\\n\\n- Even though the final layer of the deps stage is re-used if deps don\'t change, the input PEX has changed, and so docker must still re-RUN the extraction\\n- Having docker pre-extracting the PEX incurs extra build time\\n\\n### Metrics:\\n\\n|                               |                    |\\n| ----------------------------- | ------------------ |\\n| PEX: Build time               | 10s (unchanged)    |\\n| PEX: Size                     | ~3.3GB (unchanged) |\\n| Docker: Total build time      | 75.7s (+45.7s)     |\\n| Docker: Context transfer time | 13.1s (unchanged)  |\\n| Docker: Extract deps time     | 35.4s              |\\n| Docker: Extract srcs time     | 22.5s              |\\n| Docker: Export time           | 9.3s (unchanged)   |\\n| Docker: Startup time          | \\\\<1s (-17s)        |\\n| Docker: Image size            | 5.01GB (+1.38GB)   |\\n\\nIf we touch a first-party source (leveraging Docker\'s layer caches) here\'s what changes:\\n\\n|                               |                |\\n| ----------------------------- | -------------- |\\n| Docker: Total build time      | 59.7s (-16.9s) |\\n| Docker: Context transfer time | ~0s (-13.1s)   |\\n\\n## Multi-stage build leveraging 2 PEXs\\n\\nIn order to fully leverage Pants and Docker caches, we can split our all-in-one PEX into two: one for transitive third-party dependencies and one for first-party code.\\n\\n```python title=\\"BUILD\\"\\npython_sources()\\n\\npex_binary(\\n    name=\\"binary-deps\\",\\n    entry_point=\\"app.py\\",\\n\\nlayout=\\"packed\\",\\n    include_sources=False,\\n    include_tools=True,\\n)\\n\\npex_binary(\\n    name=\\"binary-srcs\\",\\n    entry_point=\\"app.py\\",\\n\\nlayout=\\"packed\\",\\n    include_requirements=False,\\n    include_tools=True,\\n)\\n\\ndocker_image(\\n    name = \\"img\\",\\n\\nrepository = \\"app\\",\\n    instructions = [\\n        \\"FROM python:3.10-slim as deps\\",\\n        \\"COPY path.to.here/binary-deps.pex /binary-deps.pex\\",\\n        \\"RUN PEX_TOOLS=1 /usr/local/bin/python3.10 /binary-deps.pex venv --scope=deps --compile /bin/app\\",\\n\\n        \\"FROM python:3.10-slim as srcs\\",\\n        \\"COPY path.to.here/binary-srcs.pex /binary-srcs.pex\\",\\n        \\"RUN PEX_TOOLS=1 /usr/local/bin/python3.10 /binary-srcs.pex venv --scope=srcs --compile /bin/app\\",\\n\\n        \\"FROM python:3.10-slim\\",\\n        \'ENTRYPOINT [\\"/bin/app/pex\\"]\',\\n        \\"COPY --from=deps /bin/app /bin/app\\",\\n        \\"COPY --from=srcs /bin/app /bin/app\\",\\n    ]\\n)\\n```\\n\\n### Metrics\\n\\n|                               |                           |\\n| ----------------------------- | ------------------------- |\\n| Deps PEX: Build time          | 5s                        |\\n| Deps PEX: Size                | 936MB                     |\\n| Srcs PEX: Build time          | 5s                        |\\n| Srcs PEX: Size                | 2.4GB                     |\\n| Docker: Total build time      | 68.3s (roughly unchanged) |\\n| Docker: Context transfer time | 13s (unchanged)           |\\n| Docker: Extract deps time     | 30.2s (-5.2s)             |\\n| Docker: Extract srcs time     | 7.9s (-14.s)              |\\n| Docker: Export time           | 9.3s (unchanged)          |\\n| Docker: Startup time          | \\\\<1s                      |\\n| Docker: Image size            | 5.01GB (unchanged)        |\\n\\nIf we touch a first-party source (leveraging Pants and Docker\'s layer caches) here\'s what changes:\\n\\n|                               |               |\\n| ----------------------------- | ------------- |\\n| Deps PEX: Build time          | 0s (-5s)      |\\n| Docker: Total build time      | 23s (-45.3s)  |\\n| Docker: Context transfer time | ~0s (-13s)    |\\n| Docker: Extract deps time     | 0s (-30.2s)   |\\n| Docker: Extract srcs time     | 4.7s (-3.9.s) |\\n\\n## Multiple Images and tagging\\n\\nThis approach leads to significant speedup in both the cold and warm build times, but it can be improved even further:\\n\\n- The important layers that allow for a faster incremental build aren\'t in an image, so they will get cleaned when docker is pruned\\n- If we tell Pants to tag our image, docker will tag the intermediate images before tagging the final one, leading to two `<none>`\\\\-tagged images in addition to the final, tagged, image\\n\\nWe can fix this by using several `docker_image` targets in tandem:\\n\\n```python title=\\"BUILD\\"\\n...\\n\\ndocker_image(\\n    name = \\"img-deps\\",\\n    repository=\\"app\\",\\n    registry=[\\"companyname\\"],\\n    image_tags=[\\"deps\\"],\\n    skip_push=True,\\n    instructions = [\\n        \\"FROM python:3.10-slim\\",\\n        \\"COPY path.to.here/binary-deps.pex /\\",\\n        \\"RUN PEX_TOOLS=1 /usr/local/bin/python3.10 /binary-deps.pex venv --scope=deps --compile /bin/app\\",\\n    ]\\n)\\n\\ndocker_image(\\n    name = \\"img-srcs\\",\\n    repository=\\"app\\",\\n    registry=[\\"companyname\\"],\\n    image_tags=[\\"srcs\\"],\\n    skip_push=True,\\n    instructions = [\\n        \\"FROM python:3.10-slim\\",\\n        \\"COPY path.to.here/binary-srcs.pex /\\",\\n        \\"RUN PEX_TOOLS=1 /usr/local/bin/python3.10 /binary-srcs.pex venv --scope=srcs --compile /bin/app\\",\\n    ]\\n)\\n\\ndocker_image(\\n    name = \\"img\\",\\n    dependencies=[\\":img-srcs\\", \\":img-deps\\"],\\n    repository=\\"app\\",\\n    instructions = [\\n        \\"FROM python:3.10-slim\\",\\n        \'ENTRYPOINT [\\"/bin/app/pex\\"]\',\\n        \\"COPY --from=companyname/app:deps /bin/app /bin/app\\",\\n        \\"COPY --from=companyname/app:srcs /bin/app /bin/app\\",\\n    ]\\n)\\n```\\n\\nPants will build the dependent images before building the final one. (Note the registry value \\"companyname\\" can be any string (or set the registry to an empty list), we just need to hardcode something that we can reference in the final image\'s COPY instructions).\\n\\nNow after building the image, we are free to prune untagged images and layers.\\n\\n## Further Optimizations\\n\\nThere are avenues to squeezing even more performance out of this approach, such as declaring our large assets as files, and using a dedicated stage to COPY them into the virtual environment.\\n\\nAdditionally, the above targets can all be wrapped into a handy [Pants macro](https://www.pantsbuild.org/docs/macros) for simplicity and re-usability.\\n\\n## In Conclusion\\n\\nPants\' support for Python and Docker is well-equipped to easily cater to varying business needs and interesting use-cases. And although support for everything listed here is primed and ready as of the upcoming Pants 2.13 release, the Pants community hopes to make even the most complex use-case (such as the final example) as simple to declare as the straightforward use-case (such as the first example) in future versions.\\n\\nIf you want to learn more about Pants, PEX and how they can help you deploy Python applications efficiently, [come and say hi](https://www.pantsbuild.org/docs/getting-help) on Slack!"},{"id":"/2022/07/28/better-ci-cd-caching-with-pants","metadata":{"permalink":"/blog/2022/07/28/better-ci-cd-caching-with-pants","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-07-28-better-ci-cd-caching-with-pants/index.mdx","source":"@site/blog/2022-07-28-better-ci-cd-caching-with-pants/index.mdx","title":"Better CI/CD caching with Pants","description":"Terminal output of a Pants run that retrieved test results from a remote cache","date":"2022-07-28T00:00:00.000Z","tags":[{"inline":true,"label":"ci","permalink":"/blog/tags/ci"},{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"},{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"}],"readingTime":1.75,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["ci","concepts","deployment"]},"unlisted":false,"prevItem":{"title":"Optimizing Python + Docker deploys using Pants","permalink":"/blog/2022/08/02/optimizing-python-docker-deploys-using-pants"},"nextItem":{"title":"Pants 2.12: Improved performance for common cases, IDE support for Java and Scala","permalink":"/blog/2022/06/29/pants-2-12"}},"content":"<CaptionedImg src={require(\\"./splash.png\\").default}>\\n  Terminal output of a Pants run that retrieved test results from a remote cache\\n  instead of having to run the tests.\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nPants is designed to utilize fine-grained caching to speed up builds. Users are often interested in how this interacts with CI providers\' own caching features, which are necessary since CI jobs typically run in fresh containers, with no direct access to previous state. In particular, we get questions about how a remote caching service, such as that offered by [Toolchain](https://toolchain.com/) (full disclosure - that\'s where I work) relates to CI caching.\\n\\nThe topic of CI caching also came up on Twitter recently:\\n\\n> It\'s pretty crazy how inefficient most CI setups are. We\'re spending 99% of the time reinstalling 99% the same dependencies as last time and recompiling the same code as last time etc. How did we end up in this situation?\\n>\\n> \u2014 Erik Bernhardsson (@bernhardsson) [July 23, 2022](https://twitter.com/bernhardsson/status/1550659837981343744?ref_src=twsrc%5Etfw)\\n\\nTo provide some info I recently wrote a [post on dev.to](https://dev.to/benjyw/better-cicd-caching-with-new-gen-build-systems-3aem) with some background on how the cache solutions offered by CI providers work, why they are often of limited benefit, and how a modern build system like Pants can support a much more effective caching paradigm.\\n\\nHead over to dev.to for the [full post](https://dev.to/benjyw/better-cicd-caching-with-new-gen-build-systems-3aem), but in a nutshell:\\n\\n- CI caches have major drawbacks because they are coarse-grained, so you waste a lot of time uploading and downloading data you don\'t actually need, and because they require you to manually compute a semantically correct cache key.\\n- Pants + a remote cache solves these problems with automatic reading and writing of fine-grained, intermediate and final build products against cache keys that are computed for you and guaranteed to be semantically correct.\\n\\nIf you\'re interested in learning more about Pants in general, caching in particular, and remote caching even more specifically, [come say hi on Slack](https://www.pantsbuild.org/docs/getting-help)!"},{"id":"/2022/06/29/pants-2-12","metadata":{"permalink":"/blog/2022/06/29/pants-2-12","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-06-29-pants-2-12/index.mdx","source":"@site/blog/2022-06-29-pants-2-12/index.mdx","title":"Pants 2.12: Improved performance for common cases, IDE support for Java and Scala","description":"{/ truncate /}","date":"2022-06-29T00:00:00.000Z","tags":[{"inline":true,"label":"jvm","permalink":"/blog/tags/jvm"},{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":3.84,"hasTruncateMarker":true,"authors":[{"name":"Stu Hood","title":"Pants Maintainer","url":"https://github.com/stuhood","imageURL":"https://github.com/stuhood.png","key":"stu","page":null}],"frontMatter":{"authors":["stu"],"tags":["jvm","python","announcement"]},"unlisted":false,"prevItem":{"title":"Better CI/CD caching with Pants","permalink":"/blog/2022/07/28/better-ci-cd-caching-with-pants"},"nextItem":{"title":"How we streamlined Apple M1 Support with self-hosted Github Actions runners","permalink":"/blog/2022/06/17/m1-support-self-hosted"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}></CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'re pleased to announce [Pants 2.12.0](https://www.pantsbuild.org/v2.12/docs), the latest release of Pants: the scalable and ergonomic build system.\\n\\nTo update, set `pants_version = \\"2.12.0\\"` in your `pants.toml`. See [upgrade tips](https://www.pantsbuild.org/docs/upgrade-tips) for more information.\\n\\n## Initial IDE support for Java and Scala\\n\\nPants 2.12 includes [initial support](https://www.pantsbuild.org/v2.12/docs/jvm-overview#working-in-an-ide) for Pants 2.x integrating with IntelliJ! Unlike in Pants 1.x, the integration is accomplished via the [BSP protocol](https://build-server-protocol.github.io/), which means that there is no IntelliJ plugin to update.\\n\\nThis initial integration includes support for code indexing (including go-to-definition and find-references). Full support for building and running tests is also implemented, but will first be available in the 2.13 release.\\n\\nAlthough VSCode is not supported yet for Java and Scala, this is an important step toward that support: the Scala [Metals LSP server](https://scalameta.org/metals/docs/editors/vscode/) also uses BSP to communicate with the build tool. We\'d love to help a contributor [add support for Metals](https://github.com/pantsbuild/pants/issues/15965)!\\n\\n## Improved performance when running both \\\\`fmt\\\\` and \\\\`lint\\\\`\\n\\nIf you use auto-formatters with Pants, it\'s likely that you frequently run the combination of the `fmt` and `lint` goals in order to \\"auto-format and then validate linters\\":\\n\\n```bash\\n./pants fmt lint ...\\n```\\n\\nPants 2.12 makes this very common combo faster, by sharing any redundant work between `fmt` and `lint` such that an auto-formatter which finds nothing to do runs exactly once per input.\\n\\n## Better validation of Python interpreter constraints\\n\\nBefore 2.12, Pants allowed Python sources to declare that the set of interpreters that they were compatible with (i.e. their [interpreter constraints](https://www.pantsbuild.org/v2.12/docs/reference-python_sources#codeinterpreter_constraintscode)) was larger than those of their dependencies. For example, a file could claim it worked with Python 2 or 3, even if it depended on something that was only compatible with Python 2. The intention behind this feature was that during migrations between Python versions, it might be helpful to be able to indicate that the source-level compatibility of particular files had increased (by porting it to newer APIs, syntaxes, etc), even before its dependencies had been made fully compatible.\\n\\nIn practice though, this feature cost more than it was worth: it meant that determining the interpreter to use for any particular task might require a transitive graph walk below a particular file, rather than being able to directly use and trust the [interpreter_constraints](https://www.pantsbuild.org/v2.12/docs/reference-python_sources#codeinterpreter_constraintscode) field.\\n\\nIn Pants 2.12, the [interpreter_constraints](https://www.pantsbuild.org/v2.12/docs/reference-python_sources#codeinterpreter_constraintscode) of a target are validated up front to be a subset of that target\'s dependencies. This new behavior is easier to reason about, improves reuse of work across runs, and improves the performance of goals like `lint`, `fmt`, `test`, and `check` for Python.\\n\\n## Other notable changes\\n\\nThere are a [long list of additional changes in 2.12](https://github.com/pantsbuild/pants/blob/main/docs/notes/2.12.x.md), but highlights include:\\n\\n- Adding support for restricting specific Python requirements to consuming only wheels or only sdists. ([details](https://github.com/pantsbuild/pants/pull/14985))\\n- After lots of stabilization work, the [default lockfile generator](https://www.pantsbuild.org/v2.12/docs/reference-python#section-lockfile-generator) is now [Pex](https://pex.readthedocs.io/en/latest/). Pex lockfiles bring improved performance when consuming many different subsets of a large resolve, and improved compatibility with `pip` features.\\n- Consuming environment variables in `pants.toml` [is now supported](https://www.pantsbuild.org/v2.12/docs/options#config-file-interpolation) via the `env` template variable namespace: e.g. `%(env.AWS_ACCESS_KEY_ID)s`.\\n- JVMs spawned via the [nailgun protocol](https://github.com/facebook/nailgun) for low latency access now have [default memory limits](https://www.pantsbuild.org/v2.12/docs/reference-global#section-process-per-child-memory-usage) applied, and the [total amount of memory](https://www.pantsbuild.org/v2.12/docs/reference-global#section-process-total-child-memory-usage) used for JVMs can be capped.\\n- Python users taking advantage of Pants\' [support for multiple resolves](../2022-05-25-multiple-lockfiles-python/index.mdx) now get extra helpful error messages when dependencies [only exist in another resolve](https://github.com/pantsbuild/pants/pull/15439), or when the set of interpreters they\'ve requested [are not compatible with their resolve](https://github.com/pantsbuild/pants/pull/15364).\\n- Plugin authors can now write `@rule_helper`s in situations where only code reuse or isolation (and not memoization or dependency injection) are necessary for portions of their `@rule` code.\\n\\n## Thanks!\\n\\nThanks to all of the contributors to 2.12, including everyone who shared feedback on changes and who tested release candidates!"},{"id":"/2022/06/17/m1-support-self-hosted","metadata":{"permalink":"/blog/2022/06/17/m1-support-self-hosted","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-06-17-m1-support-self-hosted/index.mdx","source":"@site/blog/2022-06-17-m1-support-self-hosted/index.mdx","title":"How we streamlined Apple M1 Support with self-hosted Github Actions runners","description":"We ended up setting up a self-hosted GitHub Actions runner, on a hosted Mac M1. Getting the machine itself up and running was easy, thanks to MacStadium\'s simple, effective UX. But setting up the GHA runner on it was a little trickier, for a couple of reasons...","date":"2022-06-17T00:00:00.000Z","tags":[{"inline":true,"label":"under-the-hood","permalink":"/blog/tags/under-the-hood"},{"inline":true,"label":"ci","permalink":"/blog/tags/ci"}],"readingTime":2.81,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["under-the-hood","ci"]},"unlisted":false,"prevItem":{"title":"Pants 2.12: Improved performance for common cases, IDE support for Java and Scala","permalink":"/blog/2022/06/29/pants-2-12"},"nextItem":{"title":"Multiple lockfiles in Python repos","permalink":"/blog/2022/05/25/multiple-lockfiles-python"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}></CaptionedImg>\\n\\nWe ended up setting up a self-hosted GitHub Actions runner, on a hosted Mac M1. Getting the machine itself up and running was easy, thanks to MacStadium\'s simple, effective UX. But setting up the GHA runner on it was a little trickier, for a couple of reasons...\\n\\n{/* truncate */}\\n\\n---\\n\\nThe [Pants](https://pantsbuild.org/) build system is written in a combination of Python and Rust. We release Pants as a Python distribution on [PyPI](https://pypi.org/project/pantsbuild.pants/), but since it contains native code compiled from Rust, we must publish [wheels](https://packaging.python.org/en/latest/guides/distributing-packages-using-setuptools/#wheels) for all the platforms we support.\\n\\nOur [GitHub Actions](https://github.com/features/actions) workflows create the published wheels automatically, which means we need GitHub Actions runners on every platform we support.\\n\\n## Our temporary solution\\n\\nBack in June 2021 we wanted to start releasing wheels for macOS on the ARM64 architecture. This would allow early adopters of Apple hardware based on the then-new [M1 processor](https://en.wikipedia.org/wiki/Apple_M1) to use Pants without the inconvenience and performance hit of running it via [Rosetta 2](https://support.apple.com/en-us/HT211861).\\n\\nUnfortunately, however, GitHub Actions didn\'t yet have hosted macOS ARM64 runners. So, in the spirit of not making the great be the enemy of the good, we came up with an [interim scheme](../2021-06-21-how-we-added-apple-silicon-support-to-pants/index.mdx) for releases that involved one of our contributors, who owned an Apple Silicon machine, manually building release wheels. We hoped that this solution would be temporary.\\n\\n## Nothing is as permanent as a temporary solution...\\n\\nFast-forward a year, and GitHub Actions still does not have hosted macOS ARM64 runners (although they are apparently [planning to](https://github.com/github/roadmap/issues/528) at some point)... Relying on a single person to be a manual link in an otherwise automated release process for so long had become untenable. So we looked for other solutions.\\n\\n## A self-hosted solution\\n\\nWe ended up setting up a self-hosted GitHub Actions runner, on a hosted Mac M1 that we rent from [MacStadium](https://www.macstadium.com/).\\n\\nGetting the machine itself up and running was easy, thanks to MacStadium\'s simple, effective UX. But setting up the GHA runner on it was a little trickier, for a couple of reasons:\\n\\n1. There\'s not much documentation online about how to set up self-hosted GHA runners in general, and especially not on macOS ARM64.\\n\\n2. The runner itself is an X86_64 binary that requires Rosetta to run on M1 processors. So we must ensure that when it spawns subprocesses, they run as native ARM64 binaries.\\n\\nThe setup is somewhat manual, as befits a bespoke machine. We\'ve documented the process in detail so that we can repeat it if we have to, and also so that other projects with similar needs can benefit from our work.\\n\\nSo if you\'re interested in how we set up our M1 self-hosted runner to build macOS ARM64 binaries, head over to the [Pants documentation site](https://www.pantsbuild.org/v2.12/docs/ci-for-macos-on-arm64) for a lot of excruciating detail. \xa0And if you have any questions about that, or about how Pants can make working with Python, JVM, Go and shell fast, stable and fun, swing by our [Slack workspace](https://www.pantsbuild.org/docs/getting-help#slack)!"},{"id":"/2022/05/25/multiple-lockfiles-python","metadata":{"permalink":"/blog/2022/05/25/multiple-lockfiles-python","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-05-25-multiple-lockfiles-python/index.mdx","source":"@site/blog/2022-05-25-multiple-lockfiles-python/index.mdx","title":"Multiple lockfiles in Python repos","description":"Photo by [Georgia de","date":"2022-05-25T00:00:00.000Z","tags":[{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":5.73,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["concepts","python"]},"unlisted":false,"prevItem":{"title":"How we streamlined Apple M1 Support with self-hosted Github Actions runners","permalink":"/blog/2022/06/17/m1-support-self-hosted"},"nextItem":{"title":"Pants 2.11 adds Go Protobuf codegen, Pex lockfiles for Python, and parametrization","permalink":"/blog/2022/05/02/introducing-pants-2-11"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Georgia de\\n  Lotz](https://unsplash.com/@georgiadelotz?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nRather than forcing global or per-project lockfiles, Pants uses a hybrid approach...This allows a repo to operate with the minimum number of lockfiles required to support their conflicting library versions, without necessarily going to the costly extreme of per-project lockfiles.\\n\\n{/* truncate */}\\n\\n---\\n\\nThe [Pantsbuild](https://www.pantsbuild.org) community\'s top-voted priority from January\'s 2022 Community Roadmap Survey is our redesign of Python lockfiles. So we were excited to ship in Pants 2.11 support for multiple lockfiles, with a novel hybrid approach.\\n\\n## What\'s a lockfile?\\n\\nA lockfile pins every dependency your project installs, including both your direct dependencies and their own dependencies, i.e. \\"transitive\\" dependencies.\\n\\nFor example, if your project only uses `freezegun`, an (abbreviated) lockfile might look like:\\n\\n```json\\n{\\n  \\"locked_requirements\\": [\\n    {\\n      \\"artifacts\\": [\\n        {\\n          \\"algorithm\\": \\"sha256\\",\\n          \\"hash\\": \\"15103a\u2026\\",\\n          \\"url\\": \\"https://files.pythonhosted.org/\u2026/freezegun-1.2.1-py3-none-any.whl\\"\\n        }\\n      ],\\n      \\"project_name\\": \\"freezegun\\",\\n      \\"version\\": \\"1.2.1\\"\\n    },\\n    {\\n      \\"artifacts\\": [\\n        {\\n          \\"algorithm\\": \\"sha256\\",\\n          \\"hash\\": \\"961d03\u2026\\",\\n          \\"url\\": \\"https://files.pythonhosted.org/\u2026/python_dateutil-2.8.2-py2.py3-none-any.whl\\"\\n        }\\n      ],\\n      \\"project_name\\": \\"python-dateutil\\",\\n      \\"version\\": \\"2.8.2\\"\\n    }\\n  ]\\n}\\n```\\n\\n## Why lockfiles?\\n\\n- **Stability**: by locking down every dependency, you don\'t have to worry about waking up to your build breaking because a new version of a dependency was released the night before.\\n- \\\\***\\\\*Reproducibility**:\\\\*\\\\* such as being able to go back to older versions of your project and using the same dependencies as before.\\n- **Security**: checksum validation ensures that the artifacts you download are what you expect, reducing the risk of [supply chain attacks](https://docs.microsoft.com/en-us/windows/security/threat-protection/intelligence/supply-chain-malware).\\n- \\\\***\\\\*Performance:\\\\*\\\\*** when installing a lockfile, you only download (in parallel) the pre-chosen versions and artifact URLs. No need to resolve which versions to use.\\n\\n## Multiple Lockfiles\\n\\nWhen you only have one project, things are simple: only one set of requirements, and one lockfile.\\n\\nBut what happens when you add a second project, e.g. a second Django project? You have two options:\\n\\n- Use the same lockfile for both projects.\\n- Use a distinct lockfile per project.\\n\\n### Typical Python approach: distinct lockfile per project\\n\\nSeveral Python tools like Poetry allow you to have one lockfile per project, e.g.:\\n\\n```text\\n\u251C\u2500\u2500 data_science\\n\u2502   \u251C\u2500\u2500 poetry.lock\\n\u2502   \u2514\u2500\u2500 pyproject.toml\\n\u251C\u2500\u2500 web_app1\\n\u2502   \u251C\u2500\u2500 poetry.lock\\n\u2502   \u2514\u2500\u2500 pyproject.toml\\n\u2514\u2500\u2500 web_app2\\n    \u251C\u2500\u2500 poetry.lock\\n    \u2514\u2500\u2500 pyproject.toml\\n```\\n\\nOften, each project lives in a distinct Git repository, or the \\"polyrepo\\" approach. But it\'s also possible for the distinct projects to live near each other in a \\"[monorepo](../2022-03-09-the-monorepo-approach-to-code-management/index.mdx)\\".\\n\\nWhile this approach seems simple at first, teams often run into problems when projects depend on other projects, such as having a common utils project. Projects shared together must have compatible dependencies. When they do not, you typically:\\n\\n1.  Update the common project\\n2.  Release a new version\\n3.  Figure out who all consumers are, then update all consumers to check that they still work. (If any consumer is not using the latest version, you might also have to update them.)\\n4.  If any consumers are not compatible, repeat.\\n5.  Release a new version of the consumers, and repeat with their consumers. And so on.\\n\\nOne lockfile per project looks simple, but often hides real dependencies between projects: aka \\"dependency hell.\\"\\n\\n<CaptionedImg src={require(\\"./dependency-hell.png\\").default}>\\n  Dependency hell.\\n</CaptionedImg>\\n\\nOther downsides of one lockfile per project include:\\n\\n- Unnecessary maintenance burden and duplication. For example, if you have five Django projects and four of them should still be using Django 3.3, you have to duplicate that version four times, and possibly make sure that they stay compatible with each other.\\n- Performance hit during dependency installation. You have to install each distinct project, rather than reusing, which can often be slower.\\n- Not having consistent versions of transitive dependencies across projects, potentially leading to behavior differences in each consumer.\\n\\nOne user described this process as taking multiple developer days in a Poetry-based monorepo (>100 projects) to release a bugfix for a common utility project.\\n\\n### Alternative: single lockfile for everything\\n\\nOften, the optimal approach is to use only one lockfile for your whole repository. Some benefits can include:\\n\\n- **Simplicity**. For example, ensuring that you\'re using up-to-date dependencies in all projects at once.\\n- **Compatibility**. Such as code sharing across multiple projects without worrying about dependency conflicts.\\n- **Performance**. You only need to resolve one time to work in the whole repository.\\n\\nHowever, you lose flexibility with a single lockfile because every project must be using the same pinned version of dependencies.\\n\\nEspecially as you mix distinct projects in a single monorepo, you may need the flexibility of multiple lockfiles. For example, if one project wants to migrate to Django 4 but the rest of your projects are not yet able to upgrade.\\n\\n### Pants\'s hybrid approach: granular \\"resolves\\"\\n\\nRather than forcing global or per-project lockfiles, Pants uses a hybrid approach. Lockfiles are named, and can be used on a per-file basis. This allows a repository to operate with the minimum number of lockfiles required to support their conflicting library versions, without necessarily going to the costly extreme of per-project lockfiles.\\n\\nFirst, you define several \\"resolves\\", which are logical names for lockfiles.\\n\\n```toml\\n[python.resolves]\\ndata-science = \\"3rdparty/data_science.lock\\"\\nweb-app = \\"3rdparty/web_app.lock\\"\\n```\\n\\nThen, you declare which lockfiles (aka \\"resolves\\") particular requirements should belong to, if they don\'t use your default. Pants is able to parse Poetry\'s `pyproject.toml` and pip\'s `requirements.txt`; often you will tell Pants that that entire file belongs to a particular lockfile. But you can also get more granular, such as declaring a particular requirement to be used in multiple lockfiles.\\n\\nFinally, you declare which lockfile particular code, tests, binaries etc. should use, if they don\'t use your default.\\n\\n```python title=\\"BUILD\\"\\npex_binary(\\n    name=\\"app\\",\\n    entry_point=\\"gunicorn.py\\",\\n    resolve=\\"web-app\\",\\n)\\n```\\n\\nPants will only [infer dependencies](../2020-10-29-dependency-inference/index.mdx) on code using the same lockfile. For example, if `helpers.py` doesn\'t work with the `data-science` lockfile, Pants won\'t let your `data_science_app.py` file incorrectly use it.\\n\\nIt\'s possible for requirements and source code to work with multiple lockfiles. For example, you can have a file like `utils.py` that works with all your lockfiles.\\n\\n```python title=\\"src/py/utils/BUILD\\"\\npython_sources(\\n    # The files in this folder can be used with both resolves.\\n    resolve=parametrize(\\"data-science\\", \\"web-app\\"),\\n)\\n```\\n\\nThis granularity allows you to have the minimum number of lockfiles necessary, while ergonomically sharing common code across multiple projects.\\n\\n## Trying out Pants\\n\\nPants 2.10 added initial support for multiple lockfiles, which was improved in the recently released [Pants 2.11](../2022-05-02-introducing-pants-2-11/index.mdx).\\n\\nTry out our [example-python](https://github.com/pantsbuild/example-python) repository to see more how lockfile support works, along with other ways Pants improves Python builds like running all your formatters and linters in parallel with caching. And let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)"},{"id":"/2022/05/02/introducing-pants-2-11","metadata":{"permalink":"/blog/2022/05/02/introducing-pants-2-11","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-05-02-introducing-pants-2-11/index.mdx","source":"@site/blog/2022-05-02-introducing-pants-2-11/index.mdx","title":"Pants 2.11 adds Go Protobuf codegen, Pex lockfiles for Python, and parametrization","description":"{/ truncate /}","date":"2022-05-02T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"golang-2","permalink":"/blog/tags/golang-2"},{"inline":true,"label":"jvm","permalink":"/blog/tags/jvm"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":5.85,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["announcement","golang-2","jvm","python"]},"unlisted":false,"prevItem":{"title":"Multiple lockfiles in Python repos","permalink":"/blog/2022/05/25/multiple-lockfiles-python"},"nextItem":{"title":"Talk Notes: PyCon US 2022 - Hermetic Environments in Pantsbuild","permalink":"/blog/2022/05/01/pycon-us-2022-talk"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}></CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'re pleased to announce Pants 2.11.0, the latest release of Pantsbuild, the scalable and ergonomic build system.\\n\\nTo update, set `pants_version = \\"2.11.0\\"` in your `pants.toml`. See [upgrade tips](https://www.pantsbuild.org/docs/upgrade-tips), including the `update-build-files` goal to automate some of the upgrade.\\n\\n## Protobuf codegen for Golang\\n\\nPants now can generate Go from Protobuf!\\n\\nFor example, given:\\n\\n```protobuf\\nsyntax = \\"proto3\\";\\n\\npackage simple_example.v1;\\n\\noption go_package = \\"github.com/pantsbuild/example-codegen/gen\\";\\n\\nmessage Person {\\n  string name = 1;\\n  int32 id = 2;\\n  string email = 3;\\n}\\n```\\n\\nPants will detect whenever your first party code uses the package set by `option go_package`, and then generate and compile the precise code for you using Protoc.\\n\\n```go\\npackage examples\\n\\nimport \\"testing\\"\\nimport \\"github.com/pantsbuild/example-codegen/gen\\"\\n\\nfunc TestGenerateUuid(t *testing.T) {\\n    person := gen.Person{\\n        Name:  \\"Thomas the Train\\",\\n        Id:    1,\\n        Email: \\"allaboard@trains.build\\",\\n    }\\n    if person.Name != \\"Thomas the Train\\" {\\n        t.Fail()\\n    }\\n}\\n```\\n\\nThere\'s no need to manually regenerate your code or check generated files into version control. Pants will [ensure](../2022-03-07-thrift-python/index.mdx) you are always using up-to-date files in your builds.\\n\\nWe are excited that this is our first instance of code generation for a compiled language. With this foundation, we are adding codegen for Scala and Java. (Pants already supports [Thrift](https://www.pantsbuild.org/docs/thrift-python) and [Protobuf](https://www.pantsbuild.org/docs/protobuf-python) for Python.)\\n\\nFor instructions, see our [docs](https://www.pantsbuild.org/v2.11/docs/protobuf-go).\\n\\n## Protobuf formatting and linting\\n\\nPants now integrates with the [Buf](https://docs.buf.build/lint/overviewhttps://docs.buf.build/lint/overview) Protobuf formatter and linter. This means that you can easily lint your Protobuf files in parallel to the rest of your languages, e.g.:\\n\\n```shell-session\\n$ ./pants lint ::\\n\u2713 black succeeded.\\n\u2713 buf-format succeeded.\\n\u2713 buf-lint succeeded.\\n\u2713 flake8 succeeded.\\n\u2713 gofmt succeeded.\\n\u2713 google-java-format succeeded.\\n\u2713 isort succeeded.\\n\u2713 shellcheck succeeded.\\n\u2713 shfmt succeeded.\\n```\\n\\nTo use, add `pants.backend.codegen.protobuf.lint.buf` to `[GLOBAL].backend_packages` in `pants.toml`.\\n\\nThank you to Pants\'s [new Contributor Jonas Stendahl](https://groups.google.com/g/pants-devel/c/WRZanfHS_cs/m/yA0PhAr6AQAJ) for adding this integration (only one day after it was released!)\\n\\n## Pex lockfiles\\n\\nPants 2.11 expands on the [lockfile support added in 2.10](../2022-03-23-introducing-pants-2-10/index.mdx) by allowing you to use to the new lockfile mechanism from the Pex tool, as an alternative to generating the lockfile with Poetry.\\n\\nThis change brings several improvements:\\n\\n- Support for VCS (Git) requirements, with support for local file requirements coming soon.\\n- Support for private indexes, including pip\'s `--find-links`.\\n- Faster lockfile installation. _**Before**_: Pants would install your entire lockfile, but then quickly extract out the specific third-party dependencies you need for a particular task like running `test`. That gave you fine-grained caching. **_Now_**: we directly install only the dependencies you need without having to first install the entire lockfile. That gives you fine-grained caching, and avoids installing irrelevant dependencies.\\n\\nWe [appreciate feedback](https://www.pantsbuild.org/docs/getting-help) on how this new locking mechanism is working in your repository. It is plausible there are edge cases we are not yet accounting for, given how vast the Python packaging ecosystem is.\\n\\nStay tuned for a blog explaining why we made the decision to add first-class lockfile support to Pex.\\n\\n## Target parametrization\\n\\nIn Pants, a _target_ is an addressable set of metadata describing some of your code.\\n\\n```python title=\\"BUILD\\"\\npython_tests(\\n    name=\\"tests\\",\\n    timeout=120,\\n)\\n```\\n\\nSometimes, you may want conflicting metadata to describe the same entity. For example, to run the same Python tests with both Python 2 and Python 3.\\n\\nPants 2.11 add the `parametrize` mechanism to make it more ergonomic to set conflicting metadata for the same entity:\\n\\n```python title=\\"BUILD\\"\\nshunit2_tests(\\n    name=\\"tests\\",\\n    shell=parametrize(\\"bash\\", \\"zsh\\", \\"ksh\\"),\\n)\\n```\\n\\nEach parameter creates a uniquely identifiable target, so that you can, for example, run only one of the test variations. But you can also reference them all together. For example, `./pants test ::` will run every test in parallel.\\n\\nThis feature pairs particularly well with the [multiple resolves](../2022-05-25-multiple-lockfiles-python/index.mdx) (lockfiles) feature added in Pants 2.10. You can now more easily declare that some code should work with multiple lockfiles.\\n\\n```python title=\\"BUILD\\"\\npython_sources(\\n    resolve=parametrize(\\"web-app\\", \\"data-science\\"),\\n)\\n```\\n\\nFor more information, see our [updated docs](https://www.pantsbuild.org/v2.11/docs/targets#parametrizing-targets).\\n\\n## Dependency inference for assets/resources\\n\\nPants can now detect in some cases when your Python code depends on a resource file. For example:\\n\\n```python title=\\"project/app.py\\"\\n# Uses: project/data/logo.svg\\n\\npkgutil.get_data(__name__, \\"data/logo.svg\\")\\n```\\n\\n```shell-session\\n$ ./pants dependencies project/app.py\\nproject/data/logo.svg\\n```\\n\\nAs explained in our [blog on dependency inference](../2020-10-29-dependency-inference/index.mdx), this granular dependency information unlocks benefits like fine-grained cache invalidation.\\n\\nTo try this out, set `[python-infer].assets = true` in `pants.toml`.\\n\\nThis dependency inference is not fully comprehensive and you may still need to manually declare some dependencies. You must also still manually declare `resource` and `file` targets. We are excited that with this foundation, we will continue to improve inference in future versions.\\n\\n## Performance improvements\\n\\nThe `2.11.0` release also includes several performance enhancements:\\n\\n- Builds will capture 15x less tracing information by default (although [the level can still be increased](https://www.pantsbuild.org/v2.11/docs/reference-global#section-streaming-workunits-level), which reduces memory usage and improves performance slightly.\\n- Filesystem operations used to prepare running processes require significantly less IO due to holding [more state in memory-efficient data structures](https://github.com/pantsbuild/pants/issues/13112).\\n- MyPy and Pylint have reduced startup overhead.\\n- Finally (as mentioned above): PEX lockfiles [significantly improve the performance](https://github.com/pantsbuild/pants/pull/14944) of running tests locally after a lockfile has changed.\\n\\nCollectively, some `2.11.x` testers observed a 30-40% speedup for warm (fully cached) of larger repositories due to the first two changes, and local test and lint runs were significantly improved by the latter two.\\n\\n## Other changes\\n\\n- `python_distribution` has a new field `long_description_path`. When Pants generates `setup.py` for you, it can now read the description from a file like `README.md`.\\n- `./pants export` now includes `pip` when creating virtual environments, e.g. for IDE integrations.\\n- Target generators like `python_sources` now only show with `./pants dependencies` their dependencies on their generated targets, even if you set the `dependencies` field explicitly. Those explicit dependencies are moved to the generated targets directly, as before. This better reflects how Pants target generators work and unlocks some necessary semantics for `parametrize`.\\n- Pants no longer defaults to your code working with Python 3.6 (`[python].interpreter_constraints`).\\n- New `build_file_dir()` symbol in BUILD files.\\n\\nSee the full [changelog](https://github.com/pantsbuild/pants/blob/release_2.11.0/src/python/pants/notes/2.11.x.md) for more changes, along with our [plugin upgrade guide](https://www.pantsbuild.org/docs/plugin-upgrade-guide).\\n\\n---\\n\\nTry out one of our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docker)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)"},{"id":"/2022/05/01/pycon-us-2022-talk","metadata":{"permalink":"/blog/2022/05/01/pycon-us-2022-talk","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-05-01-pycon-us-2022-talk/index.mdx","source":"@site/blog/2022-05-01-pycon-us-2022-talk/index.mdx","title":"Talk Notes: PyCon US 2022 - Hermetic Environments in Pantsbuild","description":"Photo by [Charles","date":"2022-05-01T00:00:00.000Z","tags":[{"inline":true,"label":"under-the-hood","permalink":"/blog/tags/under-the-hood"},{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":0.68,"hasTruncateMarker":true,"authors":[{"name":"Christopher Neugebauer","title":"Pants Maintainer","url":"https://github.com/chrisjrn","imageURL":"https://github.com/chrisjrn.png","key":"chrisjrn","page":null}],"frontMatter":{"authors":["chrisjrn"],"tags":["under-the-hood","concepts","python"]},"unlisted":false,"prevItem":{"title":"Pants 2.11 adds Go Protobuf codegen, Pex lockfiles for Python, and parametrization","permalink":"/blog/2022/05/02/introducing-pants-2-11"},"nextItem":{"title":"Pants 2.10 adds multiple Python lockfile support, PyOxidizer, Thrift codegen, and better linter parallelization","permalink":"/blog/2022/03/23/introducing-pants-2-10"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Charles\\n  Salutan](https://unsplash.com/@sarls?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nOn Sunday 1 May 2022, Pants Maintainer, Christopher Neugebauer gave a talk about Pantsbuild\'s hermetic environments.\\n\\n<iframe\\n  width=\\"560\\"\\n  height=\\"315\\"\\n  src=\\"https://www.youtube.com/embed/0INmW9KaAp4?si=Ws0FKZuJAUI9khuO\\"\\n  title=\\"YouTube video player\\"\\n  frameborder=\\"0\\"\\n  allow=\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\\"\\n  allowfullscreen\\n></iframe>\\n\\nHere are some useful resources:\\n\\n- [Example Python repo](https://github.com/pantsbuild/example-python) \u2014 the codebase where you can run the demos from the start of the talk.\\n- [Stu Hood - Faster incremental builds with Speculation (Build Meetup 2021)](https://www.youtube.com/watch?v=i12qaEWWJ8Q) \u2014 this talk discusses some other features that are enabled by Pants\' hermetic environments"},{"id":"/2022/03/23/introducing-pants-2-10","metadata":{"permalink":"/blog/2022/03/23/introducing-pants-2-10","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-03-23-introducing-pants-2-10/index.mdx","source":"@site/blog/2022-03-23-introducing-pants-2-10/index.mdx","title":"Pants 2.10 adds multiple Python lockfile support, PyOxidizer, Thrift codegen, and better linter parallelization","description":"{/ truncate /}","date":"2022-03-23T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"codegen","permalink":"/blog/tags/codegen"}],"readingTime":5.64,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["announcement","python","codegen"]},"unlisted":false,"prevItem":{"title":"Talk Notes: PyCon US 2022 - Hermetic Environments in Pantsbuild","permalink":"/blog/2022/05/01/pycon-us-2022-talk"},"nextItem":{"title":"The 2022 annual community survey is a wrap, and the results are in!","permalink":"/blog/2022/03/21/the-2022-annual-community-survey-is-a-wrap-and-the-results-are-in"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}></CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'re pleased to announce Pants 2.10.0, the latest release of Pantsbuild, the scalable and ergonomic build system.\\n\\nTo update, set `pants_version = \\"2.10.0\\"` in your `pants.toml`. See [upgrade tips](https://www.pantsbuild.org/docs/upgrade-tips), including the `update-build-files` goal to automate some of the upgrade.\\n\\n## Multiple Python user lockfiles\\n\\nThe community\'s top-voted priority from [January\'s 2022 Community Roadmap Survey](../2022-03-21-the-2022-annual-community-survey-is-a-wrap-and-the-results-are-in/index.mdx) is our redesign of Python lockfiles. So we\'re excited to announce that Pants 2.10 introduces support for:\\n\\n1.  More robust lockfiles than the old constraints file feature, including enforcing that all dependencies are pinned and adding `--hash` support to reduce the risk of supply chain attacks.\\n2.  Support for multiple lockfiles.\\n3.  Generating lockfiles (with the caveat that there are still several issues).\\n\\nRead [our blog](../2022-05-25-multiple-lockfiles-python/index.mdx) to learn more about Pants\'s hybrid approach which gives you the flexibility of multiple lockfiles, but does not force you into one lockfile-per-project.\\n\\nWe encourage existing users to upgrade from constraints files to `[python].resolves`\u2014even if you only have one lockfile\u2014due to the better security and reproducibility.\\n\\n## PyOxidizer\\n\\n[PyOxidizer](https://pyoxidizer.readthedocs.io/en/stable/) empowers you to distribute your application as a single binary with a Python interpreter included, which can dramatically simplify deployment when you are not using Docker.\\n\\n```shell-session\\n$ ./pants package src/py/project:bin\\n14:15:31.18 [INFO] Completed: Building src.py.project:bin with PyOxidizer\\n14:15:31.23 [INFO] Wrote dist/src.py.project/bin/aarch64-apple-darwin/debug/install/bin\\n\\n$ dist/bin/x86_64-apple-darwin/release/install/bin\\nHello, world!\\n```\\n\\n[Check out our blog](../2022-02-18-packaging-python-with-the-pyoxidizer-pants-plugin/index.mdx) from one of Pants\'s newest contributor SJ diving into this new feature, along with the [docs](https://www.pantsbuild.org/docs/pyoxidizer).\\n\\n## Thrift \u2192 Python codegen\\n\\nPants can now generate Python code from Apache Thrift files, in addition to [already supporting](https://www.pantsbuild.org/docs/protobuf-python) generating Python from Protobuf and gRPC.\\n\\nPants understands precisely which files to generate through [dependency inference](../2020-10-29-dependency-inference/index.mdx), which automatically maps your import statements to the rest of your code.\\n\\nFor example, if you have this Thrift file:\\n\\n```thrift\\ninclude \\"models/name.thrift\\"\\nnamespace py codegen.models.user\\n```\\n\\nPants will understand that this Python import means to generate that Thrift file:\\n\\n```python\\nfrom codegen.models.user.ttypes import User\\n```\\n\\nNo need to check-in the generated file to your version control; you can be confident that you\'re always using the most up-to-date file.\\n\\n[Check out our blog](../2022-03-07-thrift-python/index.mdx) on Thrift codegen this new feature, along with the [docs](https://www.pantsbuild.org/v2.10/docs/thrift-python).\\n\\n(We\'ve also made progress on generating Go from Protobuf, and Java/Scala from both Thrift and Protobuf. We hope to land these in Pants 2.11.)\\n\\n## Formatter & linter parallelization\\n\\nA major benefit of Pants is that it gives you a consistent and single interface for running all your linters and formatters, regardless of the language:\\n\\n```shell-session\\n$ ./pants lint ::\\n\u2713 autoflake succeeded.\\n\u2713 black succeeded.\\n\u2713 docformatter succeeded.\\n\u2713 flake8 succeeded.\\n\u2713 gofmt succeeded.\\n\u2713 google-java-format succeeded.\\n\u2713 isort succeeded.\\n\u2713 shellcheck succeeded.\\n\u2713 shfmt succeeded.\\n```\\n\\nPants was already running linters in parallel, and it is now even more intelligent. Pants will now:\\n\\n1.  Set the parallelism options for each tool dynamically (e.g. `--jobs` options), based on your machine\'s # of CPUs and what else is already running.\\n2.  Split up each run into smaller batches. Each batch gets cached independently, so if you only change a few files then the other batches can be satisfied from the cache.\\n\\nPants 2.10 also adds the new improvements of setting each tool\'s parallelism + batching to the `fmt` goal.\\n\\nFinally, we added the options `fmt --only` and `lint \u2013only` to make it easier to run only certain tools:\\n\\n```shell-session\\n$ ./pants lint --only=black --only=shfmt ::\\n\u2713 black succeeded.\\n\u2713 shfmt succeeded.\\n```\\n\\n## `python_requirements` target generators\\n\\nPants 2.10 gives you the option to use the new \\"target generation\\" mechanism for `python_requirements` and `poetry_requirements`, whereas it was before using a macro system that predates Pants v2\'s rules engine and Target API.\\n\\nThe main change for users is that addresses now look like `3rdparty/py#django`, rather than `3rdparty/py:django`. The `./pants update-build-files` goal automates updating your `BUILD` files and `pants.toml` to the new syntax, when you\'re ready.\\n\\nMaking this change brings several benefits:\\n\\n- Proper file watching from the engine, meaning when you change `requirements.txt` or `pyproject.toml`, Pants always picks up the change. Before, Pants had to be configured to restart the Pants daemon. If this isn\'t configured the right way, Pants would not restart the daemon which caused confusing behavior.\\n- A consistent address scheme, aligning Python with other languages like Go.\\n- The target generators now show up in `./pants help target`.\\n\\nWe\'re eager for [feedback](https://www.pantsbuild.org/docs/getting-help) on your experience migrating with `./pants update-build-files` so that we can make this even more seamless for other users.\\n\\n## Improved Go third-party dependency management\\n\\nBased on user feedback, we [changed](https://github.com/pantsbuild/pants/pull/14157) how Pants downloads and analyzes third-party dependencies.\\n\\nBefore, you had to run `go list \u2026`, which resulted in `go.mod` and `go.sum` files that the rest of the Go ecosystem (e.g. IDEs) did not like. Now, you instead run `go mod download all` and `go mod tidy`, like the rest of the Go ecosystem.\\n\\nThank you to our Go users for this valuable [feedback](https://www.pantsbuild.org/docs/getting-help)!\\n\\n## Other changes\\n\\n- The Docker backend has graduated to stable! You can now activate `pants.backend.docker`.\\n- The `validate` goal was merged into the `lint` goal and is now the `regex-lint` linter. You can use it to check for regex patterns you define, such as copyright headers. We\'re excited that this merge is possible thanks to new APIs to run linters on files without owning targets.\\n- `update-build-files` can now use Yapf instead of Black by setting `[update-build-files].formatter = \'yapf\'`.\\n- Flake8 now [supports](https://www.pantsbuild.org/docs/reference-flake8#advanced-options) first-party plugins.\\n- Memory usage was reduced by ~30% in most cases.\\n- By default, Pants now recognizes the file `<build root>/.pants.rc` to have repo-specific config overrides.\\n\\nSee the full [changelog](https://github.com/pantsbuild/pants/blob/release_2.10.0/src/python/pants/notes/2.10.x.md) for more changes, along with our [Plugin Upgrade Guide](https://www.pantsbuild.org/docs/plugin-upgrade-guide).\\n\\n\\\\-\\\\-\\n\\nTry out one of our example repositories:\\n\\n- [example-python](https://github.com/pantsbuild/example-python)\\n- [example-golang](https://github.com/pantsbuild/example-golang)\\n- [example-jvm](https://github.com/pantsbuild/example-jvm)\\n- [example-codegen](https://github.com/pantsbuild/example-codegen)\\n- [example-docker](https://github.com/pantsbuild/example-docke)\\n\\nAnd let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)"},{"id":"/2022/03/21/the-2022-annual-community-survey-is-a-wrap-and-the-results-are-in","metadata":{"permalink":"/blog/2022/03/21/the-2022-annual-community-survey-is-a-wrap-and-the-results-are-in","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-03-21-the-2022-annual-community-survey-is-a-wrap-and-the-results-are-in/index.mdx","source":"@site/blog/2022-03-21-the-2022-annual-community-survey-is-a-wrap-and-the-results-are-in/index.mdx","title":"The 2022 annual community survey is a wrap, and the results are in!","description":"Photo by Burst on","date":"2022-03-21T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":8.44,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"Pants 2.10 adds multiple Python lockfile support, PyOxidizer, Thrift codegen, and better linter parallelization","permalink":"/blog/2022/03/23/introducing-pants-2-10"},"nextItem":{"title":"Effective monorepos with Pants","permalink":"/blog/2022/03/15/effective-monorepos-with-pants"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Burst](https://stocksnap.io/author/burstshopify) on\\n  [StockSnap](https://stocksnap.io)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe recently conducted our [annual survey](https://groups.google.com/g/pants-devel/c/UFt3Os--6ps/m/FCjGTnlRBQAJ) of the Pants community. The purpose, as usual, was to inform the project roadmap for the year.\\n\\nThe survey proceeded in two phases: First, we gathered all the potential projects and needs from the community, then we conducted a round of voting, to help prioritize the gathered ideas.\\n\\nWe got lots of great responses, with participation by everyone from long-time users to recent adopters to people with future interest in the project. This netted us many great ideas and a lot of valuable feedback.\\n\\n### Remembering 2021\\n\\nIf you\'re wondering to what extent this survey will benefit the user community, looking back at last year is instructive. We got some excellent suggestions from the [2021 survey](https://groups.google.com/u/1/g/pants-devel/c/F8Saug3BrFw?hl=en), and were able to implement many of them, such as support for [multiple Python lockfiles](https://www.pantsbuild.org/v2.11/docs/python-third-party-dependencies#lockfiles), The [tailor](../2021-03-19-tailoring-pants-to-your-codebase/index.mdx) goal, support for live reload with `[--loop](https://www.pantsbuild.org/docs/goals#running-goals)` for the \\\\`repl\\\\` and \\\\`run\\\\` goals, [exporting](https://www.pantsbuild.org/docs/reference-export) a virtualenv and generated code for IDE consumption, and more.\\n\\nSo the 2021 survey was a great example of how community feedback drives major improvements to Pants, and we will continue this trend in 2022.\\n\\n### Who is this \\"We\\", anyway?\\n\\nThe Pants project thrives and grows thanks to the work of its expanding team of [contributors and maintainers](https://www.pantsbuild.org/docs/the-pants-community#how-is-the-community-structured).\\n\\nMany of the most active current contributors work for [Toolchain](https://toolchain.com/), the lead sponsor of the project. However there have been increasing numbers of substantial contributions from individuals at a variety of other companies, including some that have lead to maintainer status.\\n\\nWe\'re always looking to grow the active contributor base, and several of the ideas that emerged from the 2022 survey are very suitable for new contributors to work on (and I call those out below). So if you\'re interested in working on any of these issues, or any other ones you personally care about that didn\'t come up, or didn\'t make the prioritization cut, [let us know](https://www.pantsbuild.org/docs/getting-help)!\\n\\n### Community priorities for 2022\\n\\nSo, without further fanfare, here are some of the main themes from the 2022 survey results:\\n\\n#### Improving Python 3rd party dependency resolution\\n\\nThe current Python [lockfile support](https://www.pantsbuild.org/docs/python-third-party-dependencies#lockfiles) is a work in progress, and we\'re committed to completing it soon, to make it easy to generate and use multiple, potentially incompatible lockfiles. This is really important for providing repeatable, consistent builds and preventing supply chain attacks.\\n\\nWe\'re also keenly aware that Python dependency resolution can be a performance bottleneck, due to it running in a [hermetic environment](https://github.com/pantsbuild/pants/issues/14127) as opposed to an incrementally-updated virtualenv. Some efforts [coming soon](https://github.com/pantsbuild/pants/issues/13964) will improve that, but improving performance here remains a high priority.\\n\\n#### IDE Support\\n\\nTwo of the most heavily upvoted issues were [IntelliJ](https://github.com/pantsbuild/pants/issues/13260)/[PyCharm](https://github.com/pantsbuild/pants/issues/11151) support and [VS Code support](https://github.com/pantsbuild/pants/issues/10920). These integrations would involve Pants providing the necessary dependency metadata to the IDE to support code comprehension and navigation, as well as allowing the IDE to delegate build, test and run commands to Pants.\\n\\nWe are already committed to providing first-class IntelliJ support for Java and Scala soon, and hope to extend this work to provide PyCharm support for Python later in the year (this would be a great thing for a keen community member to work on!).\\n\\nThis work relies on neutral standards ([LSP](https://microsoft.github.io/language-server-protocol/) and [BSP](https://build-server-protocol.github.io/)) and so it should be possible to leverage it for VS Code support as well, but this might depend on code contributions from VS Code experts, so if you\'re interested, let us know!\\n\\n#### Building inside local Docker containers\\n\\nCurrently, Pants builds directly on the local system. So, for example, if you\'re running on a Mac, you get macOS-specific artifacts. One popular idea was to [support cross-building, testing and running](https://github.com/pantsbuild/pants/issues/13682) inside Docker containers.\\n\\nThis would allow all users, including macOS users, to have a single, uniform environment while running only the relevant portion of the build inside Docker (which can be quite slow on macOS), in parallel with other work.\\n\\nWith images matching your production environment, this can eliminate an entire class of often-thorny problems caused by mismatches in the underlying system (different OSes, different versions of system libraries, and so on).\\n\\n#### Support for more languages\\n\\nToday Pants supports Python, Go, Java, Scala and Shell. By far the most requested next languages are, of course, [JavaScript and TypeScript](https://github.com/pantsbuild/pants/issues/14190).\\n\\nHowever, to advance this work beyond the idea phase, we ideally need contributors who have experience with the underlying JS tool ecosystem, and a driving use-case for this support, to work on it.\\n\\nSo, again, if you\'re interested in helping out with JS support, let us know!\\n\\n#### Support for dependency \\"visibility\\"\\n\\nOne of our most popular requested features, even before the survey, was the [ability to control \\"visibility\\"](https://github.com/pantsbuild/pants/issues/13393) in the repo. That is, to configure which other packages are allowed to use a package. This is really useful for enforcing good codebase hygiene and avoiding dependency tangles.\\n\\nThis feature would be relatively straightforward for a new contributor to implement, with our guidance, so we\'re actively [looking for volunteers](https://www.pantsbuild.org/docs/getting-help) to take this on.\\n\\n#### Performance and resource consumption\\n\\nPeople understandably want builds to be ever faster, and several issues relate to performance of [testing](https://github.com/pantsbuild/pants/issues/12662), [linting](https://github.com/pantsbuild/pants/issues/10542) and [type checking](https://github.com/pantsbuild/pants/issues/10864). Yet people also want Pants to use system resources efficiently, so keeping the memory footprint down when running large numbers of tests, for example, is important.\\n\\nPerformance is a core goal of Pants, so we\'ll definitely be making some significant improvements in this area.\\n\\n#### Documentation improvements\\n\\nWe want to make sure that our [documentation](https://www.pantsbuild.org/docs) is helpful, comprehensive and organized. In 2022 we plan to improve the structure of the documentation site, add more examples and guides on [best practices](https://github.com/pantsbuild/pants/issues/14199), and more [comprehensive docs for the Plugin API](https://github.com/pantsbuild/pants/issues/10945). The latter will probably have to wait until we stabilize that API though.\\n\\n#### Distributing Pants as a standalone binary\\n\\n[T](https://www.pantsbuild.org/docs)oday Pants is distributed as [Python wheels on PyPI](https://pypi.org/project/pantsbuild.pants/). The `./pants` runner script in your repo bootstraps Pants by locating a suitable Python interpreter on the system, and then installing the `pantsbuild.pants` wheel, and its dependencies, into a virtualenv.\\n\\nThis can be a source of problems, as when a suitable interpreter can\'t be found, or when the interpreter gets updated. It also makes the runner script complex.\\n\\nInstead, we\'d like to distribute Pants as a standalone binary, with an embedded Python interpreter. Applying the recently added [PyOxidizer support](../2022-02-18-packaging-python-with-the-pyoxidizer-pants-plugin/index.mdx) to Pants itself seems like a good way to go about this.\\n\\n#### Misc\\n\\nThere were [other ideas](https://github.com/pantsbuild/pants/issues?page=1&q=is%3Aissue+label%3A2022-idea) that we hope to tackle, such as [ARM Linux support](https://github.com/pantsbuild/pants/issues/12183) and [better cache debugging output](https://github.com/pantsbuild/pants/issues/14195), and many more that we probably won\'t be able to get to. Several of these would be great projects for [new contributors](https://www.pantsbuild.org/docs/getting-help)!\\n\\n### A caveat\\n\\nNote that although we\'re taking the community\'s priorities seriously as we lay out the 2022 roadmap, we must also balance those with our big-picture view of the project, of how the various pieces fit together, and of the available developer resources and their own priorities. \xa0So we can\'t promise that the roadmap will exactly reflect the survey results.\\n\\nFor example, even though it didn\'t feature in the survey, we plan to work on supporting [cross-platform remote execution](https://github.com/pantsbuild/pants/issues/11148), as this is a key feature for dramatically improving Pants\'s performance. \xa0Similarly, we plan to polish and improve our recently-added [JVM](../2022-01-12-pants-2-9/index.mdx) and [Go](../2021-11-10-golang-support-pants-28/index.mdx) support, so we can continue to support and grow our user base for those languages.\\n\\nBut the wonderful thing about open-source, is that anyone is free to participate! So if there are ideas and issues that you particularly care about, you\'re [invited to jump in](https://www.pantsbuild.org/docs/getting-help) and work on them. We will gladly mentor you and get you up to speed!\\n\\n### To sum up\\n\\nThe annual survey reflects our commitment to developing the best build system for everyone. We want to make sure we\'re designing and building not just for the use cases we\'re personally familiar with, but for those of a wide range of teams and codebases, including yours.\\n\\nThe currently active contributors will be working through these ideas throughout the year, but we\'re always looking to add to our ranks. So if you want to [join](https://www.pantsbuild.org/docs/getting-help) a growing, friendly, welcoming open-source community, where everyone is treated with respect, we welcome you and are happy to help you get started. As we like to say, there are no dumb questions, only incomplete [documentation](https://www.pantsbuild.org/docs).\\n\\nI\'d like to take this opportunity to thank everyone who participated in the survey, as well as all the maintainers and contributors whose hard work makes this project possible. Here\'s to a productive 2022!"},{"id":"/2022/03/15/effective-monorepos-with-pants","metadata":{"permalink":"/blog/2022/03/15/effective-monorepos-with-pants","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-03-15-effective-monorepos-with-pants/index.mdx","source":"@site/blog/2022-03-15-effective-monorepos-with-pants/index.mdx","title":"Effective monorepos with Pants","description":"Image by Markus Spiske / [CC0","date":"2022-03-15T00:00:00.000Z","tags":[{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"}],"readingTime":8.41,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["concepts"]},"unlisted":false,"prevItem":{"title":"The 2022 annual community survey is a wrap, and the results are in!","permalink":"/blog/2022/03/21/the-2022-annual-community-survey-is-a-wrap-and-the-results-are-in"},"nextItem":{"title":"The monorepo approach to code management","permalink":"/blog/2022/03/09/the-monorepo-approach-to-code-management"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Image by Markus Spiske / [CC0\\n  1.0](https://creativecommons.org/publicdomain/zero/1.0/?ref=openverse)\\n</CaptionedImg>\\n\\nWorking effectively in a monorepo requires appropriate tooling. While Pants can be a really useful system in repos of all sizes and architectures, it has some features that make it particularly appealing in a monorepo setting\u2026\\n\\n{/* truncate */}\\n\\n---\\n\\nThe Software Development Times recently published an [article](https://sdtimes.com/softwaredev/the-monorepo-approach-to-code-management/) I wrote about monorepos - single unified repositories containing code for many projects and libraries. In the article I give various reasons why a monorepo is often a preferable codebase architecture, including that it makes change management more straightforward, and that it encourages organizational coherence and unity.\\n\\nWorking effectively in a monorepo requires appropriate tooling. And while Pants can be a really useful system in repos of all sizes and architectures, it has some [features](https://www.pantsbuild.org/docs/welcome-to-pants#what-are-the-main-features-of-pants) that make it particularly appealing in a monorepo setting.\\n\\nIn this post I\'ll highlight a few Pants features that make working in a monorepo a breeze!\\n\\n### Fine-grained workflow, caching and concurrency\\n\\nOne of the most important focus areas in a monorepo is speed. As your codebase grows, build and test times grow too. There are two ways to speed up work: do less of it overall, or do more of it at once. Pants helps with both of these.\\n\\nThe key to unlocking speedups is having a fine-grained workflow: Pants, thanks to its sophisticated [rule engine](https://www.pantsbuild.org/docs/how-does-pants-work#the-pants-engine) and its [dependency inference](https://www.pantsbuild.org/docs/how-does-pants-work#dependency-inference) capabilities, can decompose a single build command, such as `./pants test ::`, into many hundreds or even thousands of small units of work. Each of these work units can be cached independently, and work units that don\'t directly or indirectly depend on each other\'s outputs can be run concurrently.\\n\\nSo, for example, if you have 8 cores on your laptop, then Pants can first skip running any tests that have cached results for the given inputs, and run the rest 8 at a time, utilizing all your cores. And of course if you have [remote caching and/or remote execution](https://www.pantsbuild.org/docs/remote-caching-execution) set up, your caching and concurrency benefits are even more dramatic! ([Toolchain](https://toolchain.com/), the lead sponsor of Pants, offers remote caching as a service, [reach out](https://toolchain.com/contact) to learn more!)\\n\\n### A consistent interface\\n\\nPants gives you a consistent interface, regardless of the language and underlying tools. So you can run `./pants lint::` to run all configured linters on all your code, across multiple languages. And Pants will even run all those linters concurrently!\\n\\n### Slim deployables\\n\\nA monorepo typically produces many deployable artifacts, such as binaries, container images and serverless functions. \xa0Without the right tooling you might find yourself bundling far too much code into each production artifact, and then having to redeploy every artifact on every change, as you cannot easily know which deployables are truly affected. But, thanks to its dependency analysis, Pants knows exactly which code should be packaged into each artifact. These slim artifacts not only means you don\'t deploy unused code, but also that you\'re not constantly redeploying artifacts due to unrelated changes.\\n\\n### Selective execution\\n\\nAnother way to speed up build work is to request goals on just a specific [subset of files or directories](https://www.pantsbuild.org/docs/goals#file-arguments-vs-target-arguments). For example, if you\'re iterating on a specific test file, you can run just the tests in that file with `./pants test path/to/test_file.py`, or if you only care about Go code in a repo with code in multiple languages, you can run `./pants test src/go::`.\\n\\n### Git integration\\n\\nPants\'s git integration takes selective execution to the next level, using git state to determine which files to act on. For example, instead of naively running your linters on all source files, on every change, you can run them [just on the files](https://www.pantsbuild.org/docs/advanced-target-selection#running-over-changed-files-with---changed-since) that have been edited relative to, say, the main branch: `./pants --changed-since=main lint`. If you know that the code in the main branch has already been linted, this can save huge amounts of time by ignoring code that hasn\'t been touched.\\n\\nAnd if you need to run some work on the changed files and everything that depends on them, you can do that too: `./pants --changed-since=main \u2013changed-dependees=transitive test`.\\n\\n### Code introspection\\n\\nFor cases when the streamlined Git integration isn\'t sufficient, or when you want to manually query the structure of your codebase, Pants has a rich set of [project introspection goals](https://www.pantsbuild.org/docs/project-introspection). Among these are `./pants dependencies` (to find the dependencies of a given set of files), `./pants peek` (to print detailed JSON data about a set of files), and \xa0`./pants filter`, to filter a set of files by various criteria, and more.\\n\\nThese goals can be combined using shell pipes (and sometimes [`xargs`](https://en.wikipedia.org/wiki/Xargs) and [`jq`](https://stedolan.github.io/jq/)) to solve complex queries such as \\"which Docker images do I need to redeploy if I change this file\\", or \\"which tests cover code needed for this AWS Lambda function?\\"\\n\\nAs you can imagine, this kind of introspection is very useful for reasoning about changes and dependencies in a large codebase with many deployables and moving parts.\\n\\n### Dependency Inference\\n\\nUnlike other systems, you do not have to laboriously provide huge amounts of dependency metadata (e.g., in BUILD files). Instead, the data is [inferred](../2020-10-29-dependency-inference/index.mdx) by static analysis. Not having to create and maintain heaps of metadata spares you a lot of effort, and removes many headaches caused by inevitable mismatches between that manually provided information and the true state of your code.\\n\\n### Flexible codebase structure\\n\\nWith Pants you don\'t have to structure your codebase around the expectations of the tooling. Instead, thanks to dependency inference, you can structure your codebase in whatever way makes sense to you.\\n\\nFor example, It\'s quite common to have all tests in a repo live under an entirely separate directory than the code they test. This layout has historically been imposed by tooling that cannot otherwise distinguish sources from tests. Pants does support this layout, but because it is aware of the distinction between source and test files, it also supports having tests live right alongside the code they test.\\n\\nIn this layout, the tests for `src/python/util/files.py` can simply live in `src/python/util/files_test.py`. This makes it much easier to find the relevant tests when reading and editing code, and provides a gentle nudge to update tests when you add new code.\\n\\nIt\'s also common to have multiple top-level projects in a repo, which is necessary when you have to package and publish entire source trees as one item. But with Pants you can have a single big package tree, and the tool will figure out what actually needs to be packaged and published for each entry point.\\n\\n### Source roots\\n\\nProgramming languages, and their runtime environments, typically have a package hierarchy of some sort, used by the import mechanism to locate code to load. Underlying tools that build and test your code need to know how to map package names to source files. Therefore in a monorepo you must have some way of knowing which directories in your repo represent roots of package hierarchies (called [source roots](https://www.pantsbuild.org/docs/source-roots) in Pants terminology). For example, if you import the module at `src/py/my_project/foo.py` using `import my_project.foo`, then `src/py` is a source root.\\n\\nA monorepo often has many source roots, and they can be tricky to manage. \xa0But Pants makes this easy by identifying common default source root locations, such as the repo root and directories with names like `src/python`, or `test/java`. If these defaults don\'t work for your repo, you can configure your own patterns, to match the conventions in your codebase. And you can also designate a marker file, so that every directory containing a file of this name is considered a source root.\\n\\nOnce your source roots are configured, Pants takes care of setting up and running the underlying tools in the right way, so that your code\'s package structure is properly understood by those tools.\\n\\n### Multiple runtimes\\n\\nDifferent parts of a monorepo might contain code targeting different runtimes, such as Python 3.6 vs. 3.8, or Java 8 vs Java 12. \xa0Managing these manually is complex and prone to error. Pants, however, can model which parts of your codebase target each runtime, and even which are compatible with multiple runtimes. For example, you may have application code that requires Python 3.8 but depends on common library code that is compatible with both Python 3.6 and 3.8.\\n\\nWith the [right configuration](https://www.pantsbuild.org/docs/python-interpreter-compatibility), Pants knows about the runtime requirements of each part of your codebase, and will use this information appropriately. So, for example, if you run `./pants check ::` to typecheck your code with MyPy, Pants will divide the source files into a \\"Python 3.6\\" subset and a \\"Python 3.8\\" subset, and run MyPy separately on each subset in parallel, with the common library code present in both subsets, as needed.\\n\\n### Conflicting dependencies\\n\\nSimilarly, different parts of a monorepo might contain code that depends on conflicting 3rd party dependencies, such as two different versions of Hadoop. Pants can represent these as different \\"resolves\\" (AKA \\"[lockfiles](https://www.pantsbuild.org/v2.10/docs/python-third-party-dependencies#lockfiles)\\") and partition the code as needed, giving you the flexibility to safely use multiple versions, without dependency hell.\\n\\nThese are just a few prominent examples of ways that Pants makes working in a monorepo effective and productive!\\n\\nHave any questions? Want to share your own monorepo stories and practices? [Reach out to us on Slack](https://www.pantsbuild.org/docs/getting-help), we\'d love to hear from you!"},{"id":"/2022/03/09/the-monorepo-approach-to-code-management","metadata":{"permalink":"/blog/2022/03/09/the-monorepo-approach-to-code-management","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-03-09-the-monorepo-approach-to-code-management/index.mdx","source":"@site/blog/2022-03-09-the-monorepo-approach-to-code-management/index.mdx","title":"The monorepo approach to code management","description":"Photo by [Alex","date":"2022-03-09T00:00:00.000Z","tags":[{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"}],"readingTime":2.51,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["concepts"]},"unlisted":false,"prevItem":{"title":"Effective monorepos with Pants","permalink":"/blog/2022/03/15/effective-monorepos-with-pants"},"nextItem":{"title":"Pants 2.10 adds Apache Thrift support for Python","permalink":"/blog/2022/03/07/thrift-python"}},"content":"import Admonition from \\"@theme/Admonition\\";\\n\\n\\n<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Alex\\n  wong](https://unsplash.com/@killerfvith?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nIf you\'re responsible for your organization\'s codebase architecture, then at some point you have to make some emphatic choices about how to manage this growth in a scalable way. There are two common architectural alternatives to choose from...\\n\\n{/* truncate */}\\n\\n<Admonition type=\\"info\\" icon=\\"\u{1F4F0}\\" title=\\"\\">\\n  This article was originally published by Software Development Times ([January\\n  18,\\n  2022](https://sdtimes.com/softwaredev/the-monorepo-approach-to-code-management/)).\\n  Reprinted with permission.\\n</Admonition>\\n\\n---\\n\\nCodebases are as diverse, unique and interesting as the people who work on them. But almost all of them have this in common: they grow over time (the codebases, not the people). Teams expand, requirements grow, and time, of course, marches on; and so we end up with more developers writing more code to do more things. And while we\'ve all experienced the joy of deleting large chunks of code, that rarely offsets the overall expansion of our codebases.\\n\\nIf you\'re responsible for your organization\'s codebase architecture, then at some point you have to make some emphatic choices about how to manage this growth in a scalable way. \xa0There are two common architectural alternatives to choose from.\\n\\nOne is the \\"multi-repo\\" architecture, in which we split the codebase into increasing numbers of small repos, along subteam or project boundaries. The other is the \\"monorepo,\\" in which we maintain one large, growing repository containing code for many projects and libraries, with multiple teams collaborating across it.\\n\\nThe multi-repo approach can initially be tempting, because it seems so easy to implement. We just create more repos as we need them! We don\'t, at first, appear to need any special tooling, and we can give individual teams more autonomy in how they manage their code.\\n\\nUnfortunately, in practice the multi-repo architecture often leads to a brittle, inconsistent and change-resistant codebase. This in turn can encourage siloing in the engineering organization itself. In contrast, and perhaps counterintuitively, the monorepo approach is frequently a better, more flexible, more collaborative, long-term scaling solution.\\n\\nWhy is this the case? Consider that the hard problem in codebase architecture involves managing changes in the presence of dependencies, and vice versa. And in a multi-repo architecture, repos consume code from other repos via published, versioned artifacts, which makes change propagation much harder.\\n\\nSpecifically, what happens when we, the owners of repo A, need some changes in a consumed repo B? First we must find the gatekeepers of repo B and convince them to accept and publish the change under a new version. Then, in an ideal world, someone would find all the other consumers of repo B, upgrade them to this new version, and republish them. And now we must find the consumers of those initial consumers, upgrade and republish \\\\*them\\\\* against the new version, and so on, recursively and ad nauseam."},{"id":"/2022/03/07/thrift-python","metadata":{"permalink":"/blog/2022/03/07/thrift-python","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-03-07-thrift-python/index.mdx","source":"@site/blog/2022-03-07-thrift-python/index.mdx","title":"Pants 2.10 adds Apache Thrift support for Python","description":"Photo by [Alexander","date":"2022-03-07T00:00:00.000Z","tags":[{"inline":true,"label":"codegen","permalink":"/blog/tags/codegen"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":2.96,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["codegen","python"]},"unlisted":false,"prevItem":{"title":"The monorepo approach to code management","permalink":"/blog/2022/03/09/the-monorepo-approach-to-code-management"},"nextItem":{"title":"Meet our newest Maintainer: Alexey Tereshenkov","permalink":"/blog/2022/02/28/meet-our-newest-maintainer-alexey-tereshenkov"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Alexander\\n  Sinn](https://unsplash.com/@swimstaralex?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nPants\'s codegen support solves one of the biggest problems with code generation: how to make sure that local developers, CI, and production are using the same generated code?\\n\\n{/* truncate */}\\n\\n---\\n\\nThe [Pants build system](https://www.pantsbuild.org/v2.11) now supports generating Python code from [Apache Thrift](https://thrift.apache.org/), in addition to already supporting Protobuf and gRPC.\\n\\nPants\'s codegen support solves one of the [biggest problems](https://stackoverflow.com/questions/893913/should-i-store-generated-code-in-source-control) with code generation: _how to make sure that local developers, CI, and production are using the same generated code?_\\n\\nOrganizations often adopt subpar solutions like writing scripts that must be invoked before building, along with checking in the generated code to version control.\\n\\nInstead, Pants automates generating exactly what is needed for the current task. Rather than writing files to your repository directly\u2014where they can be changed unintentionally\u2014Pants runs processes like tests in hermetic sandboxes, guaranteeing you\'re using the most up-to-date generated files.\\n\\n(If you do want to save your generated files to disk, you can optionally run `./pants export-codegen ::`)\\n\\n## Precise generation, without boilerplate\\n\\nPants understands which files to generate through [_dependency inference_](../2020-10-29-dependency-inference/index.mdx), which automatically maps your import statements to the rest of your code.\\n\\nFor example, if you have this Thrift file:\\n\\n```thrift\\ninclude \\"models/name.thrift\\"\\nnamespace py codegen.models.user\\n```\\n\\nPants will understand that this Python import requires generating that Thrift file:\\n\\n```python\\nfrom codegen.models.user.ttypes import User\\n```\\n\\n```shell-session\\n$ ./pants dependencies project/app.py\\nthrift/models/name.thrift\\n```\\n\\nDependency inference understands the unique semantics of Thrift, like what happens if you leave off `namespace py`. It also understands dependencies amongst Thrift files via `include` directives.\\n\\nThis fine-grained dependency information is what unlocks fine-grained caching of builds, like running tests and [packaging Python binaries with Docker](../2021-10-13-pants-pex-and-docker/index.mdx). If none of the inputs have changed, Pants can safely use the cache.\\n\\nAs discussed in [our post on Pants\'s performance](../2021-02-01-fast-incremental-builds-speculation-cancellation/index.mdx), this inference is 1) very safe and 2) very fast. Because Pants invokes processes hermetically with a sandbox, failing to infer a dependency can never cause the wrong thing to be cached. Further, the inference is fast thanks to Pants\'s core being implemented in Rust, along with a daemon, parallelism, and very fine-grained invalidation.\\n\\n## Trying out Pants\\n\\nIn addition to generating Thrift and Protobuf/gRPC, Pants automates and improves the rest of your builds, including:\\n\\n- Run linters and formatters with a single consistent interface, parallelizing them all when safe. Including: Black, isort, Yapf, Flake8, Pylint, Shellcheck, Shfmt.\\n- Execute tests with hermeticity, safe parallelization, and fine-grained caching.\\n- Package your code into PEX binaries, [PyOxidizer binaries](../2022-02-18-packaging-python-with-the-pyoxidizer-pants-plugin/index.mdx), AWS Lambdas, Google Cloud Functions, and Python wheels/sdists.\\n- Provide insight via [project introspection](https://www.pantsbuild.org/v2.10/docs/project-introspection), such as querying which files depend on which.\\n\\nCheck out the [example-codegen repository](https://github.com/pantsbuild/example-codegen) to try out Pants 2.10\'s Thrift support. And let us know what you think in [Slack](https://www.pantsbuild.org/docs/getting-help) and [GitHub](https://github.com/pantsbuild/pants/issues)!\\n\\nTo use Pants with your project, check out our [Getting started guide](https://www.pantsbuild.org/v2.8/docs/getting-started) and our [Thrift docs](https://www.pantsbuild.org/v2.10/docs/thrift-python)."},{"id":"/2022/02/28/meet-our-newest-maintainer-alexey-tereshenkov","metadata":{"permalink":"/blog/2022/02/28/meet-our-newest-maintainer-alexey-tereshenkov","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-02-28-meet-our-newest-maintainer-alexey-tereshenkov/index.mdx","source":"@site/blog/2022-02-28-meet-our-newest-maintainer-alexey-tereshenkov/index.mdx","title":"Meet our newest Maintainer: Alexey Tereshenkov","description":"{/ truncate /}","date":"2022-02-28T00:00:00.000Z","tags":[{"inline":true,"label":"meet-the-team","permalink":"/blog/tags/meet-the-team"},{"inline":true,"label":"users","permalink":"/blog/tags/users"}],"readingTime":1.81,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["meet-the-team","users"]},"unlisted":false,"prevItem":{"title":"Pants 2.10 adds Apache Thrift support for Python","permalink":"/blog/2022/03/07/thrift-python"},"nextItem":{"title":"Packaging Python with the PyOxidizer Pants Plugin","permalink":"/blog/2022/02/18/packaging-python-with-the-pyoxidizer-pants-plugin"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}></CaptionedImg>\\n\\n{/* truncate */}\\n\\nThis month, the Pants core maintainers voted to invite Alexey Tereshenkov to become a Maintainer. This is a trusted role earned through demonstrating a long-term interest in Pants, by people who make regular contributions for some time and who plan to continue to do so. Maintainers conduct code reviews of pull requests, and may be granted extra permissions, such as write access to the Pants repository, as needed.\\n\\nAlexey has been a Pants user since last spring, and has been contributing to the project from the outset. Moreover, Alexey has been consistently kind, welcoming, and thoughtful. It\'s been a pleasure to have him in the community, and we are thrilled that he is joining the Maintainer group.\\n\\n## About Alexey\\n\\nAlexey lives in Oxford, UK, a home to world-famous Oxford university. He is self-taught as a developer, and has extensive experience working in the geospatial industry building all kinds of software and services for solving problems that can be approached using a digital map - everything from fleet logistics and forest management to retail logistics and school planning.\\n\\nHe first learned QuickBasic 4.5 on a [Soviet BK computer](https://en.wikipedia.org/wiki/Electronika_BK) in the late 1990s and then experimented with Pascal and [Borland Delphi](https://en.wikipedia.org/wiki/Delphi_%28software%29 \\"https://en.wikipedia.org/wiki/Delphi_(software)\\"). He fell in love with Python later on and it has been his language of choice ever since. When not working, Alexey enjoys training and competing in triathlon, taking part in chess tournaments, and spending time with his family.\\n\\nSince becoming involved with Pants, Alexey has made several contributions, notably including [Yapf formatter support for Python](https://github.com/pantsbuild/pants/pull/12317), writing several blog posts, docs improvements, and adding a [long-requested `python_distribution` improvement](https://github.com/pantsbuild/pants/pull/14448). He\'s also been driving [Debian + Python packaging support](https://github.com/pantsbuild/pants/issues/12421) for a while now.\\n\\n## Join the Pants community\\n\\nInterested in becoming an open source contributor too? Newcomers\' contributions are welcome in Pants community. [Here\'s where to learn more about who we are, and how you can get started.](https://www.pantsbuild.org/docs/the-pants-community)"},{"id":"/2022/02/18/packaging-python-with-the-pyoxidizer-pants-plugin","metadata":{"permalink":"/blog/2022/02/18/packaging-python-with-the-pyoxidizer-pants-plugin","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-02-18-packaging-python-with-the-pyoxidizer-pants-plugin/index.mdx","source":"@site/blog/2022-02-18-packaging-python-with-the-pyoxidizer-pants-plugin/index.mdx","title":"Packaging Python with the PyOxidizer Pants Plugin","description":"Photo by [Jay","date":"2022-02-18T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"}],"readingTime":14.09,"hasTruncateMarker":true,"authors":[{"name":"SJ","title":"Pants Maintainer, occasional blogger at sureshjoshi.com","url":"https://github.com/sureshjoshi","imageURL":"https://github.com/sureshjoshi.png","key":"sj","page":null}],"frontMatter":{"authors":["sj"],"tags":["python","deployment"]},"unlisted":false,"prevItem":{"title":"Meet our newest Maintainer: Alexey Tereshenkov","permalink":"/blog/2022/02/28/meet-our-newest-maintainer-alexey-tereshenkov"},"nextItem":{"title":"Choosing a Python interpreter for a Pants project","permalink":"/blog/2022/02/15/choosing-a-python-interpreter-for-a-pants-project"}},"content":"import Admonition from \\"@theme/Admonition\\";\\n\\n\\n<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Jay\\n  Heike](https://unsplash.com/@jayrheike?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nAlliterations aside, this post discusses the new PyOxidizer integration coming in Pants 2.10 for packaging Python applications.\\n\\n{/* truncate */}\\n\\n---\\n\\nLet\'s talk about Python!\\n\\nAs a language, Python is very expressive, succinct, and typically requires the least effort and code to solve my problems - huge win. I can write custom command lines, automation tools, and even API servers in as little as a few minutes. Awesome.\\n\\nPython\'s tooling and ecosystem is fantastic, but the development workflow surrounding dependency management, testing, linting, formatting, and other pre-release tasks is a bit kludgey. I had scripts upon scripts to handle virtual environment creation, pip installs, code generation, and then a bunch of other tasks. It mostly worked, but it wasn\'t pretty. Then I discovered Pants and all of those dev-only bash scripts disappeared overnight in place of a few simple BUILD files and the confidence of reliable, reproducible, and much faster builds. More awesome.\\n\\nPython\'s application packaging and distribution stories, however\u2026 Well, those are significantly less awesome. It\'s always been a bit tricky distributing my Python code because of package management, Python interpreter management, etc. Also, trying to ask non-devs to install/run Python code never goes well.\\n\\nEvery year or so, I take a few days to look at the state of Python\'s packaging and distribution and play around with the options. Every year I try out the latest and greatest from all the usual suspects - but this year was different. I decided to try out PyOxidizer\u2026 and then I made a Pants plugin for it.\\n\\nNow I, at long last, have a fully integrated end-to-end Python workflow that starts with me typing code and ends with a fully tested executable binary.\\n\\n## What is PyOxidizer?\\n\\nPyOxidizer is a command-line tool (or Rust crate) which packages/creates distributions for Python applications. It functionally falls into a class of Python packagers called \\"[freezers](https://docs.python-guide.org/shipping/freezing/)\\".\\n\\n## What is freezing?\\n\\nThe goal of freezing is to create a standalone, single-file executable which can be distributed to end-users. It \\"just works\\".\\n\\nA \\"frozen\\" application comes pre-packaged with all of your application code, dependencies, and a Python interpreter. This way, your application isn\'t reliant on the user having already installed the compatible version of Python on their computer.\\n\\nThis freezing process isn\'t free, however. Embedding a Python interpreter incurs a size hit on the final bundle.\\n\\n## How does PyOxidizer work?\\n\\nThe PyOxidizer process is [thoroughly documented](https://pyoxidizer.readthedocs.io/en/stable/pyoxidizer_overview.html#how-it-works), but as a **very** hand-wavy TLDR: Your Python application, dependencies, and a Python interpreter are all embedded into a Rust application. When you call the resulting binary executable, you\'re actually calling Rust which drives Python (and thus, your Py application).\\n\\n## How is that different from using a PEX?\\n\\nAnyone who has used Pants for Python tooling has inevitably come across [PEX](https://pex.readthedocs.io/en/latest/whatispex.html#whatispex) files (short for \\"Python Executable\\" files). A PEX file is a self-contained, executable Python virtual environment. It\'s basically a special zip file that a Python interpreter knows how to run.\\n\\nFrom the outside, the main functional difference between a PEX file and a PyOxidized application is that the PEX file requires a compatible Python interpreter on the host system, whereas the PyOxidized application embeds the Python interpreter.\\n\\nFor an even better TLDR, I can [quote the docs](https://www.pantsbuild.org/v2.10/docs/pyoxidizer):\\n\\n> PyOxidizer allows you to distribute your code as a single binary file, similar to Pex files. Unlike Pex, these binaries include a Python interpreter, often greatly simplifying distribution.\\n\\n## How can PyOxidizer change my workflow?\\n\\nSince I started on this plugin a few weeks ago, I\'ve had two major modifications in my packaging and deployment workflows.\\n\\n### Command-line Applications\\n\\nI write a lot of CLIs to speed up certain common workflows for team members. Most recently, I wrote a CLI with [Typer](https://typer.tiangolo.com/) to handle user management administration on Firebase.\\n\\nIn order to use this tool, developers would clone the repo and run the commands using Python or alternatively, they would use the latest released PEX file on Github. This works fine, so long as everyone is on roughly the same Python version.\\n\\nThe distribution process became a bit more difficult when dealing with QA or non-technical account managers. Running the script was simple, but it was definitely tedious to have to get on a Zoom call to walk people through installing Python and then debug any problems that arose along the way.\\n\\nNow, with a PyOxidized CLI, I haven\'t had to hop on a Zoom call in weeks.\\n\\n### Server Applications\\n\\nBefore PyOxidizer, my server deployment workflow consisted of creating [Docker](https://www.docker.com/) images with the correct Python base image, copying my `.pex` binaries into those containers, and using that as a distribution. It became easier with [Docker support in Pants](../2021-10-13-pants-pex-and-docker/index.mdx), as Docker handles the copying and a few other tedious items.\\n\\nThis solution has worked well for a long time, but it has always bugged me that I need Docker installed on all of my target systems. I have no problem with Docker, and I use it all the time to create custom development and build environments, but for a lot of my smaller deployments - I feel as though I\'m using a sledgehammer to put up a painting.\\n\\nUsing PyOxidizer, however, my deployments consist of a `scp` and dropping my `systemd` service files in the right location (all using [Ansible](https://www.ansible.com/), of course).\\n\\n<Admonition type=\\"info\\" icon=\\"\u270F\uFE0F\\" title=\\"Aside\\">\\n  This was my first Pants plugin and to make the experience easier for fellow\\n  newcomers, I wrote a post on my personal blog about developing [your first\\n  Pants plugin](https://sureshjoshi.com/development/first-pants-plugin).\\n</Admonition>\\n\\n## I\'m sold, how do I use it?\\n\\nFortunately, I\'ve already answered some/all of that question in the first [Pants PyOxidizer plugin pull request (or PPPPR\u2122 for short)](https://github.com/pantsbuild/pants/pull/14183), so I\'ll just quote that below. This PPPPR was accepted and Pants PyOxidizer support will be included in the 2.10 release.\\n\\n> Adding a new experimental plugin for creating executable binaries using PyOxidizer.\\n>\\n> The plugin\'s current functionality is proof-of-concept, with minimal configuration capabilities, and minimal edge-case checking\\n>\\n> The new `pyoxidizer_binary` target expects a wheel-based python distribution dependency, and optionally supports a PyOxidizer configuration template (with the extension `.bzlt`). If no template is specified, it will use a default configuration with reasonable defaults. The complexity of PyOxidizer\'s configuration, however, would suggest custom configurations will be the norm. Additionally, a `filesystem_resources` target field exists to handle certain edge cases listed in PyOxidizer\'s documentation (unclassified resource dependencies). The `entry_point` field is optional, however, if it is not included - the PyOxidizer binary will default to a REPL.\\n>\\n> Recent versions of PyOxidizer require Python 3.8 or greater - which is setup as a default `interpreter_constraint`.\\n>\\n> The only other option is to set command-line args (e.g. setting release mode, or setting the target tuple).\\n\\n```toml title=\\"pants.toml\\"\\n[pyoxidizer]\\ninterpreter_constraints = [\\">=3.9\\"]\\nargs = [\\"--release\\"]\\n```\\n\\n```python title=\\"BUILD\\"\\npython_sources(name=\\"libhelloworld\\", sources=[\\"**/*.py\\"])\\n\\npython_distribution(\\n    name=\\"helloworld-dist\\",\\n    dependencies=[\\":libhelloworld\\"],\\n    wheel=True,\\n    sdist=False,\\n    provides=python_artifact(\\n        name=\\"helloworld-dist\\",\\n        version=\\"0.0.1\\",\\n        description=\\"A distribution for the hello world library.\\",\\n    ),\\n)\\n\\npyoxidizer_binary(\\n    name=\\"helloworld-bin\\",\\n    entry_point=\\"helloworld.main\\", # Optional\\n    template=\\"pyoxidizer.bzlt\\", # Optional\\n    filesystem_resources=[\\"numpy\\"], # Optional\\n    dependencies=[\\":helloworld-dist\\"],\\n)\\n```\\n\\n```bash\\n./pants --version\\n./pants package helloworld:\\n```\\n\\nPackaging takes about a minute, and then you have a shiny new binary in your `dist` folder (under your architecture and debug/release folders).\\n\\nFor more examples, check out this [sample repo](https://github.com/sureshjoshi/pants-pyoxidizer-example) with some supporting code for this post. For more examples of how to use PyOxidizer with (or without) Pants, I maintain a [pants-plugins repo](https://github.com/sureshjoshi/pants-plugins) where I am working on some new plugins. Additionally, that repo contains example projects using various libraries - and each project has a working PyOxidizer configuration and whatever workarounds I needed to do in order to package them.\\n\\n## This sounds too good to be true, what\'s the catch?\\n\\nWell, that depends on how you look at it.\\n\\n### Chunky files\\n\\nAs mentioned earlier, there is a definite size impact by packaging a Python interpreter. On my MacOS 12.1 system (Intel), a single-file, \\"Hello World\\" application created a 55MB PyOxidized binary file. Whether hosting and distributing packages of this size is a problem is entirely dependent on your workflow. Personally, I don\'t mind it. If I\'m deploying to a server, the ease of copying a few single-file applications, instead of re-running a Docker pipeline outweighs the extra few seconds the transfer takes. This is similar for distributing automation and scripting tools to end-user machines. The files do feel a bit chunky, but not prohibitively so.\\n\\nOn the other hand, deploying some of these applications to my embedded Linux systems is a bit of a harder sell. A single 50MB Hello World application is already twice the size of the rest of the root filesystem and kernel.\\n\\nI should note, if your files are even larger than what I\'ve mentioned, ensure you\'ve set the `--release` argument for PyOxidizer in `pants.toml` as shown in the code and configuration above. Compilation and packaging takes a bit more time, but the final result is smaller.\\n\\n### Single-ish file executable\\n\\nThe \\"single binary file\\" is a bit of a stretch too at the current state. If you\'re simply packaging source code, then yes, it is a single file. However, if you\'re packaging application-level or dependencies with compiled files - then there will need to be a folder of those files on the filesystem next to your binary. This is discussed more below.\\n\\n### All the Pythons\\n\\nSelecting Pants Python interpreters in a coherent manner to avoid differing behaviour on developer machines, CI, and even in production, requires careful thought. Fortunately for all of us, Alexey Tereshenkov has taken care of most of that thought in his great (and aptly named) blog post: [Choosing a Python interpreter for a Pants project](../2022-02-15-choosing-a-python-interpreter-for-a-pants-project/index.mdx)\\n\\nDuring packaging, PyOxidizer will take that Python interpreter and bundle it in each and every binary executable. Some people might find it odd or unsettling that they have so many Python interpreter \\"copies\\" floating around on their machine. Personally, I find it comforting. I think the version of your Python interpreter should be viewed as a classical dependency, and thus, versioned and lockfile\'d just like any other dependency in your project.\\n\\n## Frequently anticipated questions\\n\\nTo get ahead of some inevitable problems/questions/comments that the typical user will run into\u2026\\n\\n### My app doesn\'t run any faster\\n\\nNope. Nor should it - not by any appreciable amount, anyways.\\n\\nPyOxidizer is embedding and bundling resources, maybe running some out of memory, perhaps the filesystem - but fundamentally, it\'s calling a Python interpreter to run your code. It\'s not compiling that code, nor doing any particular optimization that would induce a performance jump.\\n\\nIn fact, there might even be a small hit caused by the Rust to embedded Python overhead, when compared against using a system Python interpreter.\\n\\nOn my Mac Mini (6-core i5, 32GB DDR4), I get the following when comparing a PyOxidized [hellofib](https://github.com/sureshjoshi/pants-pyoxidizer-example/tree/main/hellofib) example (in release mode) against my system Python (3.9.10).\\n\\nOver 10 runs (about 2 seconds per run), the PyOxidized app takes ~100ms more per run. This equates to a 5% performance hit on this completely contrived example. In my day-to-day, real-world applications, I haven\'t really noticed any appreciable differences.\\n\\n```bash\\n#! /bin/bash\\n\\n# Using the release PyOxidized binary\\nfor i in {1..10}; do\\n    time ./dist/build/x86_64-apple-darwin/release/install/hellofib-bin\\ndone\\n\\n# Compared to the system Python calling my .py file\\nfor i in {1..10}; do\\n    time python3 hellofib/hellofib/main.py\\ndone\\n```\\n\\n## `sys.argv[0] is None`\\n\\nIf you\'re writing code or using a library that needs your application\'s executable name (e.g. argparse/Click/Typer), you\'re in for a surprise. For instance, this is what happens when I run a `Typer` application.\\n\\n```txt\\nTraceback (most recent call last):\\n  File \\"runpy\\", line 197, in _run_module_as_main\\n  File \\"runpy\\", line 87, in _run_code\\n  File \\"hellotyper.main\\", line 9, in <module>\\n  File \\"typer.main\\", line 864, in run\\n  File \\"typer.main\\", line 214, in __call__\\n  File \\"click.core\\", line 1128, in __call__\\n  File \\"click.core\\", line 1045, in main\\n  File \\"click.utils\\", line 528, in _detect_program_name\\n  File \\"posixpath\\", line 142, in basename\\nTypeError: expected str, bytes or os.PathLike object, not NoneType\\n```\\n\\nThis is a [known PyOxidizer issue](https://github.com/indygreg/PyOxidizer/issues/307) - and [hellotyper](https://github.com/sureshjoshi/pants-plugins/tree/main/hellotyper) has an example workaround. At the top of your entry point file, you can add the following to force a `sys.argv[0]` if it doesn\'t already exist.\\n\\n```python title=\\"main.py\\"\\nimport sys\\n\\n# Patch missing sys.argv[0] which is None for some reason when using PyOxidizer\\n# Typer fails on this because it tries to emit the filename\\nif sys.argv[0] is None:\\n   sys.argv[0] = sys.executable\\n   print(f\\"Patched sys.argv to {sys.argv}\\")\\n```\\n\\n### I can\'t use `__file__`\\n\\nThis one caused the most confusion when I ran into it.\\n\\nFrom the [documentation](https://pyoxidizer.readthedocs.io/en/stable/oxidized_importer_behavior_and_compliance.html#no-file):\\n\\n> when loading modules from memory, the traditional filesystem hierarchy of Python modules does not exist. In the opinion of PyOxidizer\'s maintainer, exposing `__file__` would be lying and this would cause more potential for harm than good.\\n\\nWhat this means is that neither your application code, nor your dependencies, can have code that uses `__file__` and also be stored in memory. This limitation, however, does not exist when your resources are [stored on the filesystem](https://pyoxidizer.readthedocs.io/en/stable/pyoxidizer_packaging_additional_files.html#installing-classified-resources-on-the-filesystem).\\n\\n> In scenarios where in-memory resource loading doesn\'t work, the ideal mitigation is to fix the offending Python modules so they can load from memory. But this isn\'t always trivial or possible with 3rd party dependencies.\\n>\\n> Your next mitigation should be to attempt to place the resource on the filesystem, next to the built binary.\\n\\nIn the [default configuration template](https://github.com/pantsbuild/pants/blob/main/src/python/pants/backend/python/packaging/pyoxidizer/config.py), there is a hook to place these resources onto the filesystem, but it\'s up to the developer to tell the Pants BUILD target which dependencies need to be on the filesystem. Those deps will be `pip install`\'d as `filesystem-relative` libs.\\n\\nFor example, this target knows to package `numpy` on the filesystem in a `libs` folder next to the `hellonumpy-bin` file.\\n\\n```python title=\\"BUILD\\"\\npyoxidizer_binary(\\n    name=\\"hellonumpy-bin\\",\\n    entry_point=\\"hellonumpy.main\\",\\n    dependencies=[\\":hellonumpy-dist\\"],\\n    filesystem_resources=[\\"numpy\\"],\\n)\\n```\\n\\nFor more context on the above snippet, please refer to the [hellonumpy example](https://github.com/sureshjoshi/pants-plugins/tree/main/hellonumpy).\\n\\nThat folder also contains an example of a Pants-less NumPy [PyOxidizer configuration](https://github.com/sureshjoshi/pants-plugins/blob/main/hellonumpy/pyoxidizer.bzl) which can be run using PyOxidizer outside of the Pants ecosystem. The file represents roughly what Pants uses internally when hydrating the default configuration template with the `pyoxidizer_binary` target fields.\\n\\n### The default configuration template is too limiting\\n\\nIf all else fails, you can always create a custom `pyoxidizer.bzlt`, place it next to the BUILD file, set the `template` field in the target - and your custom template will be used instead. For more information, please refer to the [documentation](https://www.pantsbuild.org/v2.10/docs/pyoxidizer) or run `./pants help pyoxidizer_binary`.\\n\\n[Full template example](https://github.com/sureshjoshi/pants-plugins/tree/main/hellotemplate).\\n\\n```python title=\\"BUILD\\"\\npyoxidizer_binary(\\n    name=\\"hellotemplate-bin\\",\\n    entry_point=\\"hellotemplate.main\\",\\n    template=\\"pyoxidizer.bzlt\\",\\n    dependencies=[\\":hellotemplate-dist\\"],\\n)\\n```\\n\\nIf you do try using the default configuration template but need to fall-back to using a custom template, [please let us know](https://www.pantsbuild.org/docs/getting-help) so we can work on improving the default configuration.\\n\\n## Still a work-in-progress\\n\\nAs this is the first PyOxidizer plugin release for Pants, it has an experimental status and an API subject to change, but hopefully there won\'t be too many breaking changes in the future.\\n\\nBut, being in experimental status means this is also the best time to try it out, [provide feedback](https://www.pantsbuild.org/docs/getting-help), and help improve the Python packaging experience.\\n\\n## Recommended reading\\n\\nBefore you start to use PyOxidizer, or this plugin, I **highly** recommend reviewing the excellent PyOxidizer documentation. In order to have the fewest surprises, these four links explain the parts with the most overlap between PyOxidizer and the Pants plugin.\\n\\n- [Overview](https://pyoxidizer.readthedocs.io/en/stable/pyoxidizer_overview.html)\\n- [Getting Started](https://pyoxidizer.readthedocs.io/en/stable/pyoxidizer_getting_started.html#getting-started)\\n- [Configuration Files](https://pyoxidizer.readthedocs.io/en/stable/pyoxidizer_config.html)\\n- [Packaging Files Instead of In-Memory Resources](https://pyoxidizer.readthedocs.io/en/stable/pyoxidizer_packaging_additional_files.html)"},{"id":"/2022/02/15/choosing-a-python-interpreter-for-a-pants-project","metadata":{"permalink":"/blog/2022/02/15/choosing-a-python-interpreter-for-a-pants-project","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-02-15-choosing-a-python-interpreter-for-a-pants-project/index.mdx","source":"@site/blog/2022-02-15-choosing-a-python-interpreter-for-a-pants-project/index.mdx","title":"Choosing a Python interpreter for a Pants project","description":"Photo by [Javier Allegue","date":"2022-02-15T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":11.69,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":["python"]},"unlisted":false,"prevItem":{"title":"Packaging Python with the PyOxidizer Pants Plugin","permalink":"/blog/2022/02/18/packaging-python-with-the-pyoxidizer-pants-plugin"},"nextItem":{"title":"Meet our newest Maintainer: Joshua Cannon","permalink":"/blog/2022/02/15/new-maintainer-joshua-cannon"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Javier Allegue\\n  Barros](https://unsplash.com/@soymeraki?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nChoosing a compatible Python interpreter carefully is important not only for developers, but for the Pants repository administrators as well. Developers using Pants build system in their project may see various errors and have different behaviors depending on the Python interpreter...\\n\\n{/* truncate */}\\n\\n## Introduction\\n\\nWhen setting up a Python monorepo managed by Pants, there are many things to consider. How should one structure the source code? How should the requirements be declared? How fine-grained should the packaging approach be? Among these and other questions it is also necessary to determine a strategy for specifying a Python interpreter to be used.\\n\\nYou may want to provide maximum freedom or be very restrictive in how Python interpreters will be found on a developer computer. The approach you take will depend on the IT policies of your organization, number of software engineers, and available resources to support the development infrastructure.\\n\\nChoosing a compatible Python interpreter carefully is important not only for developers, but for the Pants repository administrators as well. Developers using Pants build system in their project may see various errors and have different behaviors depending on the Python interpreter used to run the code. This would include missing system dependencies on Linux, having code that requires a framework build of Python on MacOS, or being affected by deprecation of functionality in a certain Python version.\\n\\nWhen deciding how to declare your Python interpreter requirements, you will need to consider a number of things, including for example:\\n\\n- Minimum version of Python that your code should be compatible with\\n- Origin of Python interpreter to be used and how it is installed in the target environments\\n- Frequency of updates for both the supported Python version and the interpreter itself as well as the updating mechanism\\n\\n## Setting the default Python version\\n\\nIf users of a Pants repository can install arbitrary software on their computers, it is possible that a given user could have multiple versions of the Python interpreter available in their system. If the runtime environment of the code is known in advance and is tied to a particular Python version, you may be conservative and configure your default Python interpreter compatibility constraints in `pants.toml` to be tied to a major Python version like this:\\n\\n```toml\\n[python]\\ninterpreter_constraints = [\\"CPython==3.8.*\\"]\\n```\\n\\nThis will ensure that a particular version of Python is always used, to prevent users taking advantage of syntax and functionality of later versions of Python (making the code incompatible with the runtime environment). But with only `interpreter_constraints` set, _how_ and _where_ that version of Python will end up installed on a machine is unconstrained.\\n\\n## Setting interpreter search path\\n\\nPants will by default inspect the `$PATH` environment variable to discover available Python interpreters. If there are many compatible versions of the interpreter found, this may result in subtle, hard to troubleshoot bugs when the order in which the interpreters will be discovered is not deterministic. To be more rigorous, one can change this by setting the option `search_path` in the `[python-bootstrap]` scope, for example:\\n\\n```toml\\n[python-bootstrap]\\nsearch_path = [\\"<PYENV_LOCAL>\\", \\"/usr/bin\\"]\\n```\\n\\n`<PYENV_LOCAL>` is a special notation that Pants understands and it refers to the interpreter specified in the local file `.python-version` used by `pyenv`. See [Changing the interpreter search path](https://www.pantsbuild.org/docs/python-interpreter-compatibility#changing-the-interpreter-search-path) to learn about other special symbols Pants understands when searching for a Python interpreter.\\n\\nIf the responsibility to install a Python interpreter of a particular version is transferred to a developer, then they install the software themselves, optionally using the documentation shared with them. If it is the build system administrators who are in charge, then the software is likely to be pre-installed on a developer\'s machine and is managed by your organization\'s IT staff.\\n\\nIt is possible, however, that the expectations of the software engineers will be in conflict because some developers may have certain preferences with regard to which Python interpreter they would want to use or have installed. It may therefore be necessary to find a sensible solution that would scale and cover the needs of most engineers. To learn more about Python interpreter compatibility, please see [Interpreter compatibility](https://www.pantsbuild.org/docs/python-interpreter-compatibility) in the Pants build system documentation.\\n\\n## Installing Python on Linux\\n\\nOn Debian-based Linux, Python can be installed with the system `python3` package:\\n\\n```shell-session\\n$ sudo apt-get install python3\\n```\\n\\nBy default, the `python3` package will install a predefined version of the interpreter, depending on the operating system version. Installing a Python interpreter of a particular version is trivial:\\n\\n```shell-session\\n$ sudo apt-get install python3.8\\n```\\n\\nBe careful, however, when relying on system Python on Linux, particularly with Debian-derived distros, since system Python is often modified from official (python.org) distributions in subtle, but consequential ways. See [Python in Debian](https://wiki.debian.org/Python) to learn more. In addition, global Python installations can also have arbitrary packages installed and made available on the `PYTHONPATH` if users use `pip` or `easy_install` without creating a virtual environment, which would break hermeticity and reproducibility.\\n\\nIf you do decide to use a Python interpreter from a system package, it is possible to install multiple versions of Python interpreters side by side. One can choose to update what version of Python will be used when a particular symlink is accessed. For instance, the [update-alternatives](https://linux.die.net/man/8/update-alternatives) command would update the `/usr/bin/python3` symlink to point to the `python3.8` system package interpreter. This would be required, for example, if you want to use by default Python 3.8 on an Ubuntu 18.04 system that ships with Python 3.6:\\n\\n```shell-session\\n$ update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.8 1\\n```\\n\\nFor engineers writing Python on Linux, you may want to set expectations that all systems will be configured in such a way that the `python3` command (when not having any virtual environment activated), must point to the interpreter `/usr/bin/python3`. To avoid confusion, developers should be discouraged from modifying their shell start-up scripts in a way that overrides the `python3` interpreter. This may be important if they use the same Python interpreter for development outside of the Pants monorepo or to run Python code locally bypassing Pants for debugging purposes.\\n\\nIf avoiding Python interpreters via system packages on Linux is an option, you may want to look into the `pyenv` which provides a great alternative to the system Python interpreters. You\'ll be able to learn more about `pyenv` below when sources of Python interpreters for MacOS are discussed.\\n\\n## Installing Python on MacOS\\n\\nAt the time of writing, MacOS devices, for example, Big Sur and Monterey, still come with Python 2.7. The assumption, however, is that anyone setting up a Pants repository would be interested in Python 3. A fresh installation of MacOS includes a `/usr/bin/python3` binary, however, it is a stub that will prompt you to install the command line developer tools that provide Python 3 interpreter.\\n\\nThere are a few ways one can get an arbitrary version of Python3 interpreter installed on a MacOS device: with [Homebrew](https://brew.sh/), [Xcode developer tools](https://developer.apple.com/xcode/resources/), or [pyenv](https://github.com/pyenv/pyenv) among others. Setting up Python on MacOS may be slightly more complicated than doing this on Linux. This is because for an arbitrary MacOS computer of a software engineer, there are likely to be a variety of Python interpreters installed.\\n\\n### brew\\n\\n`/usr/local/bin/python3` binary is likely to be managed by `brew` and developers may have versions ranging from Python 3.7 all the way to Python 3.10 (and later, once newer versions are released). Using `brew`\'s Python, however, may prove to be unreliable due to a very frequent update schedule. Most likely developers on MacOS will be using `brew` and running `brew install python` will install the most recent version available.\\n\\n`brew` will try to keep this Python interpreter on the latest version. To stop the Python formula from being updated, you can pin it with `brew pin`. Keep in mind, however, that if a pinned Python formula that another formula depends on becomes outdated, you will need to upgrade it. Therefore, you may want to be careful using the Python coming from `brew` in the Pants repository as your Python interpreter unless you have a clear strategy for managing `brew`\'s updates across your developers\' computers.\\n\\n### Xcode\\n\\nXcode software is free to download and only requires an Apple ID account. On a MacOS computer, the `/usr/bin/python3` is a stub that queries the active Xcode installation (that is set with the `xcode-select` command) and runs it from there. If your developers already have Xcode installed, you may find it convenient to set `search_path = [\\"/usr/bin\\"]` since you can then be sure that a compatible version of Python interpreter is guaranteed to be present on a developer\'s computer. That is, all developers will have only one Python interpreter they really care about and its version won\'t suddenly change (in contrast to how `brew` updates Python).\\n\\nPython from Xcode ships with a [framework build](https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPFrameworks/Concepts/WhatAreFrameworks.html) of Python which may be required to run Python code that needs access to the screen such as wxPython or Qt applications. Keep in mind, however, that the guarantee that Apple makes for Xcode\'s Python is that it\'s sufficient to run the operations and processes in MacOS that need Python, and not necessarily user code. Therefore, this interpreter is often considered to be nonstandard in subtle ways that cause various things to break.\\n\\nRelying on a single Xcode\'s Python interpreter on MacOS, however, will free you from the MacOS operating system upgrades concerns should Apple decide to start shipping Python 3 readily available in the future. If the Xcode installations are managed in your organization, you\'ll also be able to control the Python interpreter version used by developers (for instance, Xcode 12 ships Python 3.8 and Xcode 13 ships Python 3.9).\\n\\nBe advised, however, that if Xcode is installed from the App Store, it can be accidentally updated by a user to a later version (that may come with another Python version) as part of updates offered in the App Store. To avoid this, it is possible that an organization may give their developers computers that already have everything they need for their work pre-installed. This may be the case for a large organization that needs to enforce the same system environment to ensure a universal developer experience.\\n\\nAlternatively, providing instructions on how to start using a Python interpreter that ships as part of Xcode would be helpful since its installation can be scripted (with [xip](https://en.wikipedia.org/wiki/.XIP) command) and can be run in quiet mode when updating the software remotely. Having Xcode installed as part of a scripted developer environment setup (done by a developer or a system administrator) would ensure that it\'s not being updated as part of the standard updates of other system applications via App Store.\\n\\n### pyenv\\n\\n`pyenv` approach makes it possible to have multiple versions of Python installed and users can decide what version to use at a given point of time. `pyenv` is very popular among Python developers, supports both Linux and MacOS, and provides a very clean and stable way to deal with multiple versions of Python interpreters. To be sure that engineers writing Python programs would target a certain Python version, one can install a specific version of Python that is of interest:\\n\\n```shell-session\\n$ pyenv install 3.8.10\\n$ pyenv local 3.8.10\\n$ cat .python-version\\n3.8.10\\n$ python -V\\nPython 3.8.10\\n```\\n\\nYou can choose to rely solely on the local repository settings (with the assumption that `pyenv` is going to be set up for the repository) or be more permissive and search for other interpreters, for example:\\n\\n```toml\\n[python-bootstrap]\\nsearch_path = [\\"<PYENV_LOCAL>\\", \\"/usr/bin\\"]\\n```\\n\\nIn this particular example, if the local `.python-version` file (created after running the `pyenv local <version>` command) with the interpreter specified is not found, then Pants will attempt to run a compatible Python interpreter from the `/usr/bin` directory. You may want to check in the `.python-version` file into the source code repository and provide documentation on how to set up `pyenv` on a computer and install a Python interpreter of interest.\\n\\nHaving Pants project support `pyenv` driven approach may be sensible if you would want to ensure that all engineers are using the same Python interpreter set up in the same way. In addition, with `pyenv`, they would be able to take advantage of any other Python interpreter should they require them for some other local development outside of the Pants repository (while using the same `pyenv` interface). Relying on the presence of a compatible Python 3 interpreter found with the `.python-version` file would also work very well if your Pants repository will be used in a mixed environment, when some of your developers are on MacOS and some are on Linux.\\n\\n## Conclusion\\n\\nFinding the right strategy to declare your Python interpreter in a Pants project requires careful thought. Navigating intricacies of Python interpreters on various platforms may be very demanding and the more diverse set of Python interpreters you will claim to support, the more unnecessary troubleshooting and hand-holding you may end up providing. Also, having a simple way to get a Python interpreter installed may be important if there are enough developers who need to interact with the Pants repository and write or run code, but who are not Python programmers or are not familiar with the Python ecosystem and tooling.\\n\\nWe hope you find a strategy that works for you. If you have questions, please feel free to raise a GitHub issue or ask on the Pants community Slack! It\'s a friendly and supportive community that is happy to respond to your questions and feedback."},{"id":"/2022/02/15/new-maintainer-joshua-cannon","metadata":{"permalink":"/blog/2022/02/15/new-maintainer-joshua-cannon","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-02-15-new-maintainer-joshua-cannon/index.mdx","source":"@site/blog/2022-02-15-new-maintainer-joshua-cannon/index.mdx","title":"Meet our newest Maintainer: Joshua Cannon","description":"{/ truncate /}","date":"2022-02-15T00:00:00.000Z","tags":[{"inline":true,"label":"meet-the-team","permalink":"/blog/tags/meet-the-team"},{"inline":true,"label":"users","permalink":"/blog/tags/users"}],"readingTime":1.61,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["meet-the-team","users"]},"unlisted":false,"prevItem":{"title":"Choosing a Python interpreter for a Pants project","permalink":"/blog/2022/02/15/choosing-a-python-interpreter-for-a-pants-project"},"nextItem":{"title":"Pants 2.9: Alpha support for Java and Scala, improvements for Docker and Go, and more","permalink":"/blog/2022/01/12/pants-2-9"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default} />\\n\\n{/* truncate */}\\n\\nThe Pants [Maintainers](https://www.pantsbuild.org/docs/maintainers) are a group of people with an ongoing commitment to Pants, who help manage and steer the project. Maintainers are a subgroup within the wider [Contributor](https://www.pantsbuild.org/docs/the-pants-community#contributors) population.\\n\\nI\'m very pleased to introduce the latest addition to the Maintainer ranks: [Joshua Cannon](https://github.com/thejcannon).\\n\\nJoshua\'s current interests are his 9 month old twins! Previous hobbies include:\\n\\n- Playing board games, whose boxes weigh more than his twins, such Twilight Imperium and Gloomhaven\\n- Multi-year cross-stitching projects\\n- Long distance running\\n\\nSince becoming involved with Pants, Joshua has added support for [in-repo Flake8 plugins](https://github.com/pantsbuild/pants/pull/14027), running Pylint [with transitive dependencies](https://github.com/pantsbuild/pants/pull/13918), several [enhancements](https://github.com/pantsbuild/pants/pull/14049) to [Python](https://github.com/pantsbuild/pants/pull/14059) [dependency](https://github.com/pantsbuild/pants/pull/14216) inference, [dynamic IU improvements](https://github.com/pantsbuild/pants/pull/14221), and most recently the streamlined, mypy-friendly [option registration](https://github.com/pantsbuild/pants/pull/14331), as well as many bug and documentation fixes. He\'s also been engaged with the community, answering user questions on Slack and making new users feel welcome.\\n\\nJoshua aspires to one day be a university lecturer teaching software engineering (My suggested curriculum: \\"Day 1: Use Pants. Day 2: Here\'s your diploma\\" was soundly rejected...) And I should add that his meme game is on point. When notified of his Maintainer status his response was, well, [nice](https://www.youtube.com/watch?v=qQsvnHJPTGg).\\n\\nThank you Joshua for all your excellent contributions so far, and we look forward to many more in this new role!\\n\\nPS Would you like to become involved with a friendly open-source community building really interesting technology? We\'d love to have you on board! Come [say hi on Slack](https://join.slack.com/t/pantsbuild/shared_invite/zt-d0uh0mok-RLvVosDiX6JDpvStH~bFBA) and we\'ll go from there."},{"id":"/2022/01/12/pants-2-9","metadata":{"permalink":"/blog/2022/01/12/pants-2-9","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-01-12-pants-2-9/index.mdx","source":"@site/blog/2022-01-12-pants-2-9/index.mdx","title":"Pants 2.9: Alpha support for Java and Scala, improvements for Docker and Go, and more","description":"We\'re pleased to announce Pants 2.9.0, the latest release of Pants: the scalable and ergonomic build system!","date":"2022-01-12T00:00:00.000Z","tags":[{"inline":true,"label":"jvm","permalink":"/blog/tags/jvm"},{"inline":true,"label":"golang-2","permalink":"/blog/tags/golang-2"},{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"}],"readingTime":7.2,"hasTruncateMarker":true,"authors":[{"name":"Stu Hood","title":"Pants Maintainer","url":"https://github.com/stuhood","imageURL":"https://github.com/stuhood.png","key":"stu","page":null}],"frontMatter":{"authors":["stu"],"tags":["jvm","golang-2","docker","deployment"]},"unlisted":false,"prevItem":{"title":"Meet our newest Maintainer: Joshua Cannon","permalink":"/blog/2022/02/15/new-maintainer-joshua-cannon"},"nextItem":{"title":"You can call us Pantsbuild (or Pants, whichever you prefer)","permalink":"/blog/2022/01/12/you-can-call-us-pantsbuild-or-pants-whichever-you-prefer"}},"content":"<CaptionedImg src={require(\\"./splash.png\\").default}></CaptionedImg>\\n\\nWe\'re pleased to announce [Pants 2.9.0](https://www.pantsbuild.org/v2.9/docs), the latest release of Pants: the scalable and ergonomic build system!\\n\\n{/* truncate */}\\n\\n---\\n\\nTo update, set `pants_version = \\"2.9.0\\"` in your `pants.toml`. See [upgrade tips](https://www.pantsbuild.org/docs/upgrade-tips) for more information.\\n\\n## Alpha Support for Java and Scala\\n\\nWe\'re very happy to announce that support for Java and Scala has reached alpha quality in the `2.9.0` release!\\n\\nPants 1.x had a long history of support for Java and Scala, going back to when it was first created at Twitter. In fact: they were the first supported languages! Consequently, (re-)adding support for these popular JVM languages has been high on our list ever since [the 2.x release](../2020-10-27-introducing-pants-v2/index.mdx) in late 2020.\\n\\n### Improvements over Pants 1.x\\n\\nIn the last few years, we\'ve learned a lot about how best to deal with more-slowly-compiling, high level languages like Scala.\\n\\n#### Dependency inference and per-file compilation\\n\\nAs described in our recent blog post, [dependency inference for Java and Scala](../2021-11-22-automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference/index.mdx) removes a ton of boilerplate.\\n\\nBut very fine-grained, always-accurate dependencies also enable per-file compilation, reducing the number of files that Pants needs to feed to `scalac`, and allowing for automatic file-level parallelization and the most accurate cache keys possible. From a correctness perspective, that means that unlike tools which use compilation libraries like [Zinc](https://github.com/sbt/zinc) (SBT, Bloop, Mill, optionally Bazel, and others) Pants `2.9.0` supports sandboxed, minimal incremental Java and Scala compilation, while preventing the under-compilation bugs that have historically troubled Scala developers.\\n\\nFor more information on how dependency inference works for the JVM, [check out that post](../2021-11-22-automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference/index.mdx)!\\n\\n#### Multiple resolves of third party dependencies\\n\\nAnother significant improvement for the JVM over 1.x is that Pants `2.9` implements a monorepo-friendly multiple-resolve/lockfile strategy for third party dependencies, allowing for correctness, flexibility, _and_ performance.\\n\\nBuild tools for the JVM tend to either resolve dependencies globally (for an entire repository), or locally (on a project-by-project basis). Global resolves (as in Bazel) remove flexibility, because teams working within a repository cannot diverge from the single blessed versions of any library: if they try, they are nearly guaranteed to encounter classpath incompatibilities. On the other hand, local/per-project resolves (as in SBT, Gradle, Maven) within a monorepo allow for local flexibility, but reduce the performance and compatibility of any particular build by executing one unique resolve per project.\\n\\nRather than forcing global or per-project resolves, Pants `2.9` supports a unique hybrid approach: third party resolves are named and first-class, and can be used on a target by target basis. This allows a monorepo to operate with the minimum number of resolves required to support their conflicting library versions, without necessarily going to the costly extreme of per-project resolves.\\n\\nHaving the minimum number of resolves improves performance, but it doesn\'t come with a correctness cost! To ensure reproducible builds, Pants generates a lockfile per resolve, which is then efficiently consumed to fetch the precise, fingerprinted dependencies of any particular file.\\n\\n### Trying out Java or Scala\\n\\nAlthough this is an alpha release, the features that are implemented so far are expected to give teams enough to work with to validate using Pants with a JVM codebase:\\n\\n- Use of [nailgun](http://martiansoftware.com/nailgun/) to keep warm JVMs for compilers and tools\\n- [ScalaTest](https://www.scalatest.org/) support for Scala, and [JUnit](https://junit.org/junit5/) support for both Java and Scala\\n- [Scalafmt](https://scalameta.org/scalafmt/) and [Google Java Format](https://github.com/google/google-java-format)\\n- Scala Repl support\\n- Protobuf code generation with [ScalaPB](https://scalapb.github.io/)\\n- Debugging support via `./pants test --debug $file`\\n- Scala compiler plugins\\n- Support for compiling cycles between Java and Scala code\\n- Bootstrapping a consistent JVM using [coursier](https://get-coursier.io/)\\n- Multiple first class thirdparty resolves ([coursier](https://get-coursier.io/) again!) with independent lockfiles\\n\\nWe\'d love to help you try out Pants with your JVM codebase: you can start by checking out the [initial documentation](https://www.pantsbuild.org/v2.9/docs/jvm-overview) and [example JVM repository](https://github.com/pantsbuild/example-jvm). If you see anything missing that prevents you from evaluating Pants for Java and Scala, please let us know by [opening a Github issue](https://github.com/pantsbuild/pants/issues/new/choose), or [visiting Slack](https://www.pantsbuild.org/v2.9/docs/community)!\\n\\n## Better visibility into runtime and caching for tests\\n\\nThanks to a great change from a new contributor, Pants `2.9` now renders test runtime and cache status (whether a process ran, hit a cache, or was memoized in memory by `pantsd`) in the test summary for all supported languages!\\n\\n```shell-session\\n$ ./pants test src/python/pants/util:\\n...\\n\u2713 src/python/pants/util/dirutil_test.py:tests succeeded in 1.21s (cached locally).\\n\u2713 src/python/pants/util/osutil_test.py:tests succeeded in 0.72s (memoized).\\n\u2713 src/python/pants/util/strutil_test.py:tests succeeded in 0.98s (cached remotely).\\n```\\n\\nNo more thinking to yourself: \\"Gee, that was even faster than usual! I wonder why?\\"\\n\\n## Improvements to Docker support\\n\\nAmong a number of bug fixes and documentation enhancements, there were a few noteworthy improvements to the Docker backend:\\n\\n- Introduce a new `target_stage` field for the [`docker_image` target](https://www.pantsbuild.org/v2.9/docs/reference-docker_image) as well as the `[docker].build_target_stage` option.\\n- Add [`instructions` field](https://www.pantsbuild.org/v2.9/docs/reference-docker_image#codeinstructionscode) to `docker_image` to support generating an anonymous Dockerfile from scratch.\\n- Log suggestions of how to fix the docker build context when a docker build fails.\\n- New option for the `[docker]` scope, which allows passing additional options when executing `docker run [OPTIONS] <image>`, in addition to the `--run-args` which are passed to the image entrypoint.\\n  - For example: `./pants run --docker-run-args=\\"-p 8080/tcp\\" src/docker:example -- --arg-for-the-image-entrypoint`\\n- Add new [`secrets` field](https://www.pantsbuild.org/v2.9/docs/reference-docker_image#codesecretscode) to `docker_image`.\\n- Include `shell_source(s)` in `docker_image` build context.\\n- Support interpolating Docker build args into the `repository` field of `docker_image` targets.\\n- Allow tailor to create `docker_image` targets for any files with \\"Dockerfile\\" in the file name.\\n\\nCheck out the updated [`docker` documentation](https://www.pantsbuild.org/v2.9/docs/docker) for more information!\\n\\n## Support for running `tailor` continuously\\n\\nThe `./pants tailor` goal automatically updates `BUILD` files to add targets for recognized file types, which makes it great for onboarding a new repository to Pants.\\n\\nPants `2.9` expands `tailor`\'s options to allow it to be run on an ongoing basis in your repository, to ensure that your `BUILD` metadata stays up to date as files are added.\\n\\nTo do this, `tailor` gained a `--check` mode, and now supports [ignoring files](https://www.pantsbuild.org/v2.9/docs/reference-tailor#section-ignore-paths) which should be visible to Pants (i.e., not in [pants_ignore](https://www.pantsbuild.org/v2.9/docs/gitignore)), but not have `BUILD` targets generated for them.\\n\\n## Changes to Go project layouts\\n\\nAfter [adding experimental support for Go](../2021-11-10-golang-support-pants-28/index.mdx) in Pants `2.8`, we decided that a few changes to how Go targets are laid out in BUILD files would help to future proof the support.\\n\\nTo that end, in Pants `2.9`, each Go package now needs its own `go_package` declaration in a `BUILD` file. Thanks to dependency inference and `./pants tailor`, these BUILD files are very simple, can be created automatically, and rarely require adjustments. But when you do need to add metadata, the new layout [follows the 1:1:1 principle](https://github.com/pantsbuild/pants/issues/13488): metadata about your code should live near the code itself.\\n\\n### New Go features\\n\\nIn particular, the changes to target layouts make it easier to use the new Go features in `2.9`.\\n\\n`go_package` targets now support:\\n\\n1\\\\. Setting a `test_timeout` for the package (in seconds), which is propagated down to the Go test runner:\\n\\n```python\\ngo_package(\\n    test_timeout=120,\\n)\\n```\\n\\n2\\\\. Embedding `resource` files in a binary for use at runtime:\\n\\n```python\\ngo_package(dependencies=[\\":resources\\"])\\nresources(\\n    name=\\"resources\\",\\n    sources=[\\"*.txt\\"],\\n)\\n```\\n\\n3\\\\. Adding `files` to the working directory of your tests (i.e. `testdata`):\\n\\n```python\\ngo_package(dependencies=[\\":testdata\\"])\\nfile(\\n    name=\\"testdata\\",\\n    source=\\"testdata/f.txt\\"\\n)\\n```\\n\\n### Updating for Go\\n\\nTo update your `BUILD` files for the new layout in `2.9`, all you need to do is run `./pants tailor`. Thanks for your patience, and for all of your feedback on the new Go support! Please continue to let us know how it can be most useful to you.\\n\\n## Thanks!\\n\\nThanks to all the contributors to `2.9`, including everyone who shared feedback on changes and who tested release candidates!"},{"id":"/2022/01/12/you-can-call-us-pantsbuild-or-pants-whichever-you-prefer","metadata":{"permalink":"/blog/2022/01/12/you-can-call-us-pantsbuild-or-pants-whichever-you-prefer","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-01-12-you-can-call-us-pantsbuild-or-pants-whichever-you-prefer/index.mdx","source":"@site/blog/2022-01-12-you-can-call-us-pantsbuild-or-pants-whichever-you-prefer/index.mdx","title":"You can call us Pantsbuild (or Pants, whichever you prefer)","description":"{/ truncate /}","date":"2022-01-12T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":1.18,"hasTruncateMarker":true,"authors":[{"name":"Christopher Neugebauer","title":"Pants Maintainer","url":"https://github.com/chrisjrn","imageURL":"https://github.com/chrisjrn.png","key":"chrisjrn","page":null}],"frontMatter":{"authors":["chrisjrn"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"Pants 2.9: Alpha support for Java and Scala, improvements for Docker and Go, and more","permalink":"/blog/2022/01/12/pants-2-9"},"nextItem":{"title":"Updating Pants BUILD files programmatically","permalink":"/blog/2022/01/06/updating-pants-build-files-programmatically"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}></CaptionedImg>\\n\\n{/* truncate */}\\n\\nAs more and more people start using and discovering Pants, we\'ve discovered that it\'s difficult to talk about the tool without introducing it as _The Pants Build System_, which isn\'t very snappy or easy to remember. Especially in titles of posts or in tweets without that much context, \\"Pants\\" on its own doesn\'t make a lot of sense to many people, and if you don\'t explicitly append \\"build\\", it\'s also really difficult to search for \\"Pants\\".\\n\\nOver the years, our online presence has sprung up around the name Pantsbuild. We use Pantsbuild as [our Twitter handle](https://twitter.com/pantsbuild), the [project\'s username on Reddit](https://www.reddit.com/user/pantsbuild/), our [domain name](https://pantsbuild.org), and our [GitHub organization name](https://github.com/pantsbuild), to point out just a few. There\'s more than a few articles from people in the community (but not affiliated with the project) that talk about \\"using Pantsbuild\\".\\n\\nAfter some discussion amongst maintainers and [on the Pants Build community Slack](https://pantsbuild.slack.com/archives/C046T6T9U/p1638817238494000), we\'ve decided that _Pantsbuild_ is a perfectly fine thing to call the project too. This doesn\'t mean that _Pants_ is no longer the name of the project, it\'s just that Pantsbuild is a name that you can use if you feel like Pants constrains your expression.\\n\\nSo, if you see us talking about Pantsbuild, that\'s why. Now you can say Pantsbuild too."},{"id":"/2022/01/06/updating-pants-build-files-programmatically","metadata":{"permalink":"/blog/2022/01/06/updating-pants-build-files-programmatically","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-01-06-updating-pants-build-files-programmatically/index.mdx","source":"@site/blog/2022-01-06-updating-pants-build-files-programmatically/index.mdx","title":"Updating Pants BUILD files programmatically","description":"{/ truncate /}","date":"2022-01-06T00:00:00.000Z","tags":[{"inline":true,"label":"getting-started","permalink":"/blog/tags/getting-started"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":5.17,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":["getting-started","python"]},"unlisted":false,"prevItem":{"title":"You can call us Pantsbuild (or Pants, whichever you prefer)","permalink":"/blog/2022/01/12/you-can-call-us-pantsbuild-or-pants-whichever-you-prefer"},"nextItem":{"title":"Happy new year!","permalink":"/blog/2022/01/05/happy-new-year-2022"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}></CaptionedImg>\\n\\n{/* truncate */}\\n\\n### Introduction\\n\\nWorking with a monorepository implies dealing with build metadata files that provide information about the source code and how it should be built. Pants build system uses `BUILD` files which are valid Python files and are evaluated using a Python interpreter as a list of statements. When adding support for Pants in a codebase, one can use the `./pants tailor` command which will generate the minimal `BUILD` files necessary to get started.\\n\\nAs the adoption of Pants goes on, you may want to update your `BUILD` files across some parts or throughout the whole monorepository. This can be the case when you\'d like to update your [`python_sources`](https://www.pantsbuild.org/v2.9/docs/reference-python_sources) targets to enable/disable some code formatters or linters (for instance, by adding `skip_black` and `skip_flake8` arguments). Likewise, updating `BUILD` files may be necessary if you\'d need to tag multiple `python_tests` targets by setting the `tags` argument.\\n\\nAlthough in most cases Pants does not require you to declare the dependencies between targets (thanks to [dependency inference](../2020-10-29-dependency-inference/index.mdx#dependency-inference)), manually updating the `BUILD` files for any codebase of a decent size will get tedious rather soon which is why it is necessary to have appropriate tooling for updating the `BUILD` files programmatically.\\n\\n### Modifying BUILD files by using source code refactoring tools\\n\\nSince the `BUILD` files are valid Python files, it is possible to use an AST / CST (abstract or concrete syntax tree) based approach and refactor the target declarations. This is fairly easy given the low complexity of the files in question.\\n\\nYou may be already using some automated refactoring tools developed in the Python community for large refactorings of the source code. If not, you may explore some tools such as [rope](https://github.com/python-rope/rope), [redbaron](https://github.com/PyCQA/redbaron), [astor](https://github.com/berkerpeksag/astor), or [LibCST](https://github.com/Instagram/LibCST).\\n\\n### Modifying BUILD files by using Bazel build tools\\n\\nIf your use case is rather simple, and you don\'t have enough resources to develop Python refactoring tools in house, you may want to look at the out-of-the-box tools that will let you update the `BUILD` files programmatically. Because `BUILD` files in Pants share a lot of syntax with the `BUILD` files used in [Bazel](https://bazel.build/), it is often possible to use the Bazel build toolchain to interact with the Pants `BUILD` files.\\n\\nWhen adopting Pants incrementally, potentially for only a segment of the monorepository, you would create `BUILD` files only in the projects (i.e. directories) of interest. However, it may be the case that after you have already enabled Pants for a part of your monorepository, you\'d like to have a more fine-grained control over the target declarations. For instance, you may want to edit `BUILD` files within one or more projects by modifying the current arguments values, adding new or removing existing ones.\\n\\nWhen using the Bazel build tools, keep in mind that they reformat the `BUILD` files following the [Bazel formatting style](https://github.com/bazelbuild/buildtools/blob/master/buildifier/README.md) which may be not necessarily how you expect your `BUILD` files to be formatted. If you are migrating from Bazel to Pants, however, you may find it convenient to preserve the same, familiar formatting style of the `BUILD` files used in the monorepository. Either way, if you are already formatting the `BUILD` files using `black`, then you may take advantage of the\\n[`./pants update-build-files`](https://www.pantsbuild.org/v2.9/docs/reference-update-build-files) command which will format all `BUILD` files in your project using `black` (support for `yapf` will come in the future releases).\\n\\nTo modify the Pants `BUILD` files in your project, you can use [buildozer](https://github.com/bazelbuild/buildtools/blob/master/buildozer/README.md). This is how you would add additional arguments to all existing targets across your monorepository:\\n\\n```shell-session\\n$ buildozer \'set skip_yapf True\' \'set skip_mypy True\' ///...:%python_tests\\n$ buildozer \'set skip_yapf True\' \'set skip_mypy True\' ///...:%python_sources\\n```\\n\\nThe input target declaration\\n\\n```python\\npython_sources()\\n```\\n\\nwould be turned into\\n\\n```python\\npython_sources(\\n    skip_flake8 = True,\\n    skip_mypy = True,\\n    skip_yapf = True,\\n)\\n```\\n\\nIf you run a Python formatter on the `BUILD` files afterwards, it would be formatted to something like below:\\n\\n```python\\npython_sources(\\n    skip_flake8=True,\\n    skip_mypy=True,\\n    skip_yapf=True,\\n)\\n```\\n\\nThere are ways to have a more fine-grained control over what targets you\'d like to run the editing command on, but you may need to consult the Bazel docs as the semantics of addressing a particular target or targets within a directory may differ\\nfrom the ones used in Pants. This command, for example, would update only `python_sources` targets within a single project directory:\\n\\n```shell-session\\n$ buildozer \'set skip_yapf False\' projectdir/subdir:%python_sources\\n```\\n\\n### Querying the Pants BUILD files before running the editing commands\\n\\nThe `./pants peek` command would be of help if you would need to query your `BUILD` files for information necessary to update them (e.g. you want to update only those targets that have a particular argument set to a particular value). The `peek` command would also help you confirm that programmatic updates of the `BUILD` files succeeded and made the changes you wanted to make.\\n\\nFor instance, with a little help from [jq](https://stedolan.github.io/jq/) to parse JSON, this command would report all `pex_binary` targets that have something else than `/usr/bin/python3` as its `shebang`:\\n\\n```shell-session\\n$ ./pants peek project-name:: | jq \'.[] | select(.target_type == \\"pex_binary\\" and .shebang != \\"/usr/bin/python3\\")\'\\n```\\n\\nIf you already have experience using `buildozer`, you may want to prefer using its querying functionality to learn more about `BUILD` files targets before running the editing commands. This command would print the `name` and the `dependencies` arguments for all `pex_binary` targets for a particular project:\\n\\n```shell-session\\n$ buildozer \'print name dependencies\' project-name:%pex_binary\\n```\\n\\nBuildozer documentation has lots of code snippets that will help you learn how to update your `BUILD` files.\\n\\n_Happy coding!_\\n\\nWant to explore more of Pants open source project or its first-class support for Python? Check out [`example-python`](https://github.com/pantsbuild/example-python) and come say hi on the [Pants community Slack](https://pantsbuild.slack.com)! It\'s a friendly and supportive community that is happy to respond to your questions and feedback."},{"id":"/2022/01/05/happy-new-year-2022","metadata":{"permalink":"/blog/2022/01/05/happy-new-year-2022","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-01-05-happy-new-year-2022/index.mdx","source":"@site/blog/2022-01-05-happy-new-year-2022/index.mdx","title":"Happy new year!","description":"Photo by [Anastasiia","date":"2022-01-05T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":1.38,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"Updating Pants BUILD files programmatically","permalink":"/blog/2022/01/06/updating-pants-build-files-programmatically"},"nextItem":{"title":"Docs improvements","permalink":"/blog/2021/12/16/docs-improvements"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Anastasiia\\n  Rozumna](https://unsplash.com/@rozumna?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nHi Pants community,\\n\\n2021 was another massive year for the project, even as the pandemic continued to disrupt our lives in so many challenging ways.\\n\\nWe grew our Python user base significantly, engaged in critical [developer relations](https://www.pantsbuild.org/docs/media) efforts, gained new community members, including several new maintainers and contributors, and added support for new languages and frameworks, including Shell, [Go](../2021-11-10-golang-support-pants-28/index.mdx), [Java, Scala](../2021-11-22-automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference/index.mdx) and [Docker](../2021-10-13-pants-pex-and-docker/index.mdx).\\n\\n2022 will be another busy year, in which we plan to continue to grow the user community, add further language support, and improve performance. In fact, you can help shape the roadmap by submitting ideas [here](https://groups.google.com/g/pants-devel/c/UFt3Os--6ps/m/FCjGTnlRBQAJ)!\\n\\nThanks to all who contributed this past year, whether by patches, documentation, community building, bug reports or feature suggestions.\\n\\nAnd to the many new teams who adopted Pants this year - thanks for your faith in the project, and our apologies for any bumps in the road. Your feedback allows us to continue to develop and improve the system. Our goal continues to be to create the best build system, with the most supportive community, out there. Your help is crucial in realizing that goal.\\n\\nI hope you all remain safe through this latest pandemic surge.\\n\\nHappy new year!"},{"id":"/2021/12/16/docs-improvements","metadata":{"permalink":"/blog/2021/12/16/docs-improvements","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-12-16-docs-improvements/index.mdx","source":"@site/blog/2021-12-16-docs-improvements/index.mdx","title":"Docs improvements","description":"Photo credit: [pages by Amy Loves","date":"2021-12-16T00:00:00.000Z","tags":[{"inline":true,"label":"getting-started","permalink":"/blog/tags/getting-started"},{"inline":true,"label":"community","permalink":"/blog/tags/community"},{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"golang-2","permalink":"/blog/tags/golang-2"}],"readingTime":1.39,"hasTruncateMarker":true,"authors":[{"name":"Carina C. Zona","title":"Pants Maintainer","url":"https://github.com/cczona","imageURL":"https://github.com/cczona.png","key":"cczona","page":null}],"frontMatter":{"authors":["cczona"],"tags":["getting-started","community","docker","golang-2"]},"unlisted":false,"prevItem":{"title":"Happy new year!","permalink":"/blog/2022/01/05/happy-new-year-2022"},"nextItem":{"title":"Automatically unlocking concurrent builds and fine-grained caching on the JVM with dependency inference","permalink":"/blog/2021/11/22/automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo credit: [pages by Amy Loves\\n  Ya](https://flickr.com/photos/amylovesyah/4583629077/), used under [CC BY 2.0\\n  license](https://creativecommons.org/licenses/by/2.0/)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'ve added a spate of new pages in recent months, plus Eric Arellano just completed a thorough audit of the docs which resulted in overhauling several pages. So if you haven\'t checked all of these out docs pages recently, give \'em a read or re-visit:\\n\\n## Overhauled\\n\\n### Getting Started\\n\\n- [Key concepts > Targets and BUILD files](https://www.pantsbuild.org/docs/targets)\\n- [Incremental adoption: How to incrementally add Pants to an existing repository](https://www.pantsbuild.org/docs/existing-repositories)\\n- [Create initial BUILD files](https://www.pantsbuild.org/docs/create-initial-build-files)\\n- [Using Pants in CI](https://www.pantsbuild.org/docs/using-pants-in-ci)\\n\\n### Features\\n\\n- [The targets API](https://www.pantsbuild.org/docs/target-api)\\n- [Python 3rd party dependency management](https://www.pantsbuild.org/docs/using-pants-in-ci)\\n- [Plugin upgrade guide](https://www.pantsbuild.org/docs/plugin-upgrade-guide)\\n\\n## New\\n\\n### Getting Started\\n\\n- [Resource hub](https://www.pantsbuild.org/docs/media)\\n- [News room](https://www.pantsbuild.org/docs/news-room)\\n- [Setting up an IDE](https://www.pantsbuild.org/docs/setting-up-an-ide)\\n- [Testimonials](https://www.pantsbuild.org/docs/testimonials)\\n- [Who uses Pants](https://www.pantsbuild.org/page/who-uses-pants)\\n\\n### Features\\n\\n- [Language support](https://www.pantsbuild.org/page/language-support)\\n  - [Golang support](https://www.pantsbuild.org/docs/go)\\n- [Docker overview](https://www.pantsbuild.org/docs/docker)\\n  - [Tagging Docker images](https://www.pantsbuild.org/docs/tagging-docker-images)\\n\\nWe hope you\'ll find these resources helpful. As always, we invite readers to help us further improve the docs by using the Suggest Edits button anytime. Thanks for your contributions!\\n\\n_Which content should we add, expand, or improve next? Come tell us, over on the community chat at [pantsbuild.slack.com](https://pantsbuild.slack.com)_."},{"id":"/2021/11/22/automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference","metadata":{"permalink":"/blog/2021/11/22/automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-11-22-automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference/index.mdx","source":"@site/blog/2021-11-22-automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference/index.mdx","title":"Automatically unlocking concurrent builds and fine-grained caching on the JVM with dependency inference","description":"Photo by [Samantha","date":"2021-11-22T00:00:00.000Z","tags":[{"inline":true,"label":"jvm","permalink":"/blog/tags/jvm"},{"inline":true,"label":"development","permalink":"/blog/tags/development"}],"readingTime":7.91,"hasTruncateMarker":true,"authors":[{"name":"Christopher Neugebauer","title":"Pants Maintainer","url":"https://github.com/chrisjrn","imageURL":"https://github.com/chrisjrn.png","key":"chrisjrn","page":null}],"frontMatter":{"authors":["chrisjrn"],"tags":["jvm","development"]},"unlisted":false,"prevItem":{"title":"Docs improvements","permalink":"/blog/2021/12/16/docs-improvements"},"nextItem":{"title":"pants-vs-bazel","permalink":"/blog/2021/11/18/pants-vs-bazel"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Samantha\\n  Lam](https://unsplash.com/@contradirony?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'ve been busy working on JVM support for the open source Pants Build system, starting with support for Java and Scala. We\'re excited about the progress we\'ve made with Java support, and we want to share with you some of the more exciting work we\'ve done.\\n\\n## What is Pants Build 2 and why do you want it?\\n\\nPants 2 is a developer workflow system that orchestrates the tools that developers use during iterative development and CI runs \u2014 including tasks like compilation and testing that build tools usually provide, as well as linting, formatting, and packaging \u2014 and provides a consistent interface for these tasks across every language that we support.\\n\\nOn top of that, Pants has semantic understanding of different development workflows, which means we can automatically apply fine-grained caching and invalidation, or concurrency to tools that don\'t have these performance features out of the box.\\n\\nFinally, we try to achieve this with minimal manual configuration, so that you can spend your time writing code, rather than fighting your build system.\\n\\nPants has stable Python and Shell script support out of the box, and we recently announced preview support for Golang. Now, we\'re offering preview support for Java and Scala!\\n\\nCheck out [our recent blog post about Go support](../2021-11-10-golang-support-pants-28/index.mdx) to see the benefits of a workflow tool that supports multiple languages. All of the `pants` commands that we support for Go also work for the JVM. This means your development team can jump between languages and not need to learn an entirely new set of tools for each language \u2014 you can use the best language for the job.\\n\\nEach language we support is implemented as a separate plug-in backend, which means each language\'s toolchain runs in isolation, and as we add new languages you\'ll keep that same consistent interface.\\n\\n## Avoiding dependency management tradeoffs with inference\\n\\nEven if you only have JVM code in your codebase, Pants can provide benefits over project-oriented build tools like Gradle, Ant, sbt, or Maven.\\n\\nJVM compilers expect all source files and dependency JARs to be available when the compiler gets invoked, and for an entire project\'s source to be compiled at once. In project-oriented tools, the tool supplies the compiler with all of those files, this is fine when your projects are small, but as your set of first party projects grows, you need a strategy to manage them.\\n\\nIn many organisations, in-house dependencies are managed by publishing JAR files to an internal repository. This means publishing a new JAR when new features are added or bugs are patched, and then making sure that downstream projects keep dependency versions up-to-date.\\n\\nYou can avoid this by keeping all of your source files at hand, such as by using a monorepo approach.\\n\\nPrevious-generation monorepo build tools like Bazel can build small, fine-grained sets of files with minimal dependencies \u2014 enabling better concurrency and cache performance \u2014 but require large amounts of boilerplate when configured optimally: the finer-grained your dependencies, the more dependencies you need to hardcode (either manually, or with the help of a compiler plugin like Zinc). This can become difficult to maintain as you add more internal packages.\\n\\nPants 2 solves this dilemma with dependency inference, where we use static analysis to intelligently determine what dependencies the compiler needs to be able to build a source file, before the compiler even runs.\\n\\nAs in our other supported languages, you usually only need to specify external requirements once per repo, and Pants takes care of figuring out all the dependencies. And because Pants runs each build step in a sandbox, missing inferred dependencies can\'t cause correctness issues for your build.\\n\\n## Import parsing\\n\\nThe easiest piece of dependency inference in Java and Scala involves parsing import statements. If a file contains an import statement, then it probably depends on the code that was imported (this is a good reason to lint for unused imports, which Pants also makes easy).\\n\\nIf a Java source contains `import org.pantsbuild.java.Frobnicator;` then Pants can go looking for a class called `org.pantsbuild.java.Frobnicator`. If this is a first-party Java source file, then it\'s easy to find: source files include a package declaration.\\n\\nThis is harder for third-party dependencies: these dependencies are often in JAR files that Pants won\'t even download until it\'s sure that it needs them. Sometimes the name of the artifact\'s group can give us a clue \u2014 an artifact in the `com.google.truth` group may well contain `com.google.truth` class files \u2014 but the rest of the time, we need more data. You can supply a list of JVM packages provided by a maven artifact when you define your dependencies, and for other artifacts, we make use of an internal database of packages to unversioned maven coordinates.\\n\\nThis database is still pretty new and bare, but [the public mapping](https://github.com/pantsbuild/pants/blob/227a33d4667c21e8cd6472ecb43c149680161613/src/python/pants/jvm/dependency_inference/jvm_artifact_mappings.py) is an easy place to contribute your first pull request and make a meaningful improvement to our dependency inference support.\\n\\n## Consumed type analysis\\n\\nAnnoyingly, not every dependency type in a JVM source file has to be imported. For example, if you use a fully qualified type name to declare a variable or return (e.g. `org.pantsbuild.java.Frobnicator frobnicator = new org.pantsbuild.java.Frobnicator();`) rather than importing that type first, then that type needs to be included as a dependency too.\\n\\nPants uses [Scalameta](https://scalameta.org/) and the [JavaParser library](https://javaparser.org/) to quickly parse Scala and Java source files, and return all of the symbols that may be dependency types. Once we have those symbols, we can compute possible fully-qualified type names and include matching source or JAR files as dependencies.\\n\\n## Export types\\n\\nFinally, some dependencies in Java files are hidden a bit more deeply. If we have even a slightly nested hierarchy like: `public class Blinker extends Light {}` and `public class Light implements Switchable {}`, then any code that depends on `Blinker` also depends on `Light` and `Switchable`. These create a concept called an export type. Exports are types that belong to a direct dependency that a compiler needs to know about in order to have a full understanding of that dependency.\\n\\nWhile this could be solved by transitively walking an entire tree of dependencies, in practice, this is inefficient: we\'d end up supplying a lot of dependencies that are not export types, and aren\'t needed to compile a given unit of Java code.\\n\\nOur JavaParser tool makes note of which types are likely to be required as export types, and Pants ensures that these types are available when compiling dependent files.\\n\\n## What does this mean?\\n\\nWe\'ve been testing our inference code against Google\'s Guice codebase. Guice has a non-trivial number of maven dependencies, and uses just about every Java language feature available to specify dependency types.\\n\\nAs an example [`LineNumbersTest`](https://github.com/google/guice/blob/e960b66d3d5931b9cb1aebd49e452e2c489a921e/core/test/com/google/inject/internal/util/LineNumbersTest.java) depends on maven artifacts from Junit, `aopalliance`, and ObjectWeb2, as well as a large number of 1st-party imports. These dependencies are specified with imports, with static factory method calls, and in the middle of method call chains.\\n\\nAfter defining maven dependencies once for the repository, the BUILD file for `LineNumbersTests`\'s source directory is minuscule:\\n\\n```python\\njunit_tests()\\n```\\n\\nEverything else is supplied through repo-wide defaults, or calculated automatically: if you ask Pants the (direct) dependencies of `LineNumbersTest`, you\'ll see that precise dependency information has been computed:\\n\\n```shell-session\\n$ ./pants dependencies core/test/com/google/inject/internal/util/LineNumbersTest.java\\ncore/src/com/google/inject/AbstractModule.java\\ncore/src/com/google/inject/CreationException.java\\ncore/src/com/google/inject/Guice.java\\ncore/src/com/google/inject/Injector.java\\ncore/src/com/google/inject/internal/InternalFlags.java\\ncore/src/com/google/inject/matcher/Matchers.java\\ncore/test/com/google/inject/Asserts.java\\ncore/test/com:junit_junit\\ncore:aopalliance_aopalliance\\ncore:javax.inject_javax.inject\\ncore:org.ow2.asm_asm\\n\\n```\\n\\nA comparable Bazel BUILD file would need to manually specify each maven dependency, along with 4 first-party Java source dependencies. In Guice, this would involve maintaining 23 BUILD files containing 622 individual `java_library` targets, each with many dependencies and exports listed. In larger monorepos, there\'d be even more.\\n\\nBecause Pants automatically caches results of tasks, these dependencies \u2014 along with compile and test results \u2014 are only recalculated when they\'re needed. Finally, if you want or need to specify any dependencies manually, [you can still do that](https://www.pantsbuild.org/docs/targets#dependencies-field).\\n\\n## Scala support\\n\\nWhile most of the examples in this post focus on Java, both import parsing and consumed type analysis are implemented for Scala. At the moment, our Scala support uses transitive dependencies for compilation, so export types aren\'t as important a concept there.\\n\\nWe\'ll be expanding our support for Java and Scala projects in the coming months, so expect more updates soon! We\'d love your feedback to help guide our priorities: check out the [prioritised issues](https://github.com/pantsbuild/pants/projects/22), and stop by the [Pants slack](https://join.slack.com/t/pantsbuild/shared_invite/zt-d0uh0mok-RLvVosDiX6JDpvStH~bFBA) to let us know what you\'d like to see from JVM support.\\n\\n## Where can I learn more?\\n\\nYou can check out the docs for Pants at [pantsbuild.org](https://pantsbuild.org), or sign up to our newsletter at [newsletter.pantsbuild.org](https://newsletter.pantsbuild.org). To use Pants with your project, see our [Getting Started guide](https://www.pantsbuild.org/v2.8/docs/getting-started)."},{"id":"/2021/11/18/pants-vs-bazel","metadata":{"permalink":"/blog/2021/11/18/pants-vs-bazel","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-11-18-pants-vs-bazel/index.mdx","source":"@site/blog/2021-11-18-pants-vs-bazel/index.mdx","title":"pants-vs-bazel","description":"Photo by [Jeremy","date":"2021-11-18T00:00:00.000Z","tags":[{"inline":true,"label":"getting-started","permalink":"/blog/tags/getting-started"},{"inline":true,"label":"concepts","permalink":"/blog/tags/concepts"}],"readingTime":9.16,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["getting-started","concepts"]},"unlisted":false,"prevItem":{"title":"Automatically unlocking concurrent builds and fine-grained caching on the JVM with dependency inference","permalink":"/blog/2021/11/22/automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference"},"nextItem":{"title":"Pants 2.8 adds Autoflake & Pyupgrade, Docker publishing, Golang, and Google Cloud Functions","permalink":"/blog/2021/11/17/introducing-pants-2-8"}},"content":"export const Hero = ({ children, color }) => (\\n  <div className=\\"hero\\">\\n    <div className=\\"container\\" style={{ \\"text-align\\": \\"center\\" }}>\\n      <div className=\\"hero__title\\">\u{1F456}</div>\\n      <div className=\\"hero__subtitle\\">{children}</div>\\n    </div>\\n  </div>\\n);\\n\\n# Pants vs. Bazel: Why Pants may be the right choice for your team\\n\\n<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Jeremy\\n  Bezanger](https://unsplash.com/@unarchive?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nMany considerations go into evaluating and adopting a new build system: performance, scalability language and framework support, ease of adoption and use, extensibility, compatibility with existing practices, and more.\u2026\\n\\n{/* truncate */}\\n\\n\u{1F4C6} LAST UPDATED: Sept 23, 2022\\n\\n---\\n\\n## Introduction\\n\\nWe in the [Pants Build community](https://www.pantsbuild.org/docs/the-pants-community) have a lot of experience in helping teams evaluate and adopt Pants. And often, the first step involves helping those teams understand why Pants is the best fit for their needs (and honestly recognizing when it isn\'t).\\n\\nAs you may expect, organizations evaluating Pants often also consider [Bazel](https://bazel.build/), which is an open-source variant of Google\'s internal build system. As a result, the two systems are often compared.\\n\\nOf course, many considerations go into evaluating and adopting a new build system: performance, scalability language and framework support, ease of adoption and use, extensibility, compatibility with existing practices, and more. All systems make trade-offs, so there is no magic bullet solution to a problem as multi-faceted, challenging and fascinating as software builds. Ultimately, every team ends up making a nuanced choice based on their needs and priorities.\\n\\nBut we have found that many teams have a similar set of comparison points, and reach similar conclusions, regarding the advantages of Pants for their use cases, when compared to Bazel. We often get asked about these and have therefore decided to publish them in this document.\\n\\nWe have a lot of respect for Bazel. Pants and Bazel share common lineage and inspiration. However, there are important differences between the systems. Many of these can be boiled down to the fact that Bazel\'s design was substantially limited to Google\'s internal engineering practices, while Pants\'s design is informed by the real-world use cases of a variety of organizations. As a result, Pants is often a better fit for your existing codebase, workflows and practices.\\n\\n<Hero>\\n  Bazel\'s design was substantially limited to Google\'s internal engineering\\n  practices, while Pants\'s design is informed by the real-world use cases of a\\n  variety of organizations.\\n</Hero>\\n\\n---\\n\\n## Why choose Pants\\n\\nHere are some reasons why Pants may be a better choice than Bazel for your team:\\n\\n- **Pants is strongly focused on first-class support for the real-world use cases of a variety of software organizations.** Bazel, in contrast, was designed primarily for internal C++ usage at Google. For example:\\n  - Bazel\'s support for consuming published third-party dependencies is haphazard, because Google typically doesn\'t use external code. But your team, like almost all others, probably relies on published code in public repositories such as PyPI or Maven Central, so Pants has strong support for that case, including [a feature for safely managing multiple versions of the same dependency in a single repo](../2022-05-25-multiple-lockfiles-python/index.mdx).\\n  - Pants has first-class [support for Python](https://www.pantsbuild.org/docs/python), and specifically for how real-world organizations use it in practice. Its Python plugin has out-of-the-box support for running pip, setuptools, pytest, mypy, black, yapf, pylint, isort, bandit, flake8, docformatter, protoc, pex, AWS lambda and more. New tools and functionality are being added all the time. Pants also intrinsically handles complex issues such as Python interpreter version compatibility, and can work well with tools like pyenv and asdf. Whereas Bazel\'s Python support was somewhat tacked on as an adjunct to the core functionality, and is often insufficient, leading teams to have to cobble together their own custom logic.\\n\\n- **Pants lets you use the natural idioms of each language and framework.** For example, users naturally think in terms of files and directories, so Pants operates primarily in those terms: you can simply run Pants commands on files and directories, and metadata concepts like targets mostly fade into the background. Bazel foregrounds new conceptual models, such as workspaces and targets, that every user has to comprehend in order to use the system at all. Pants also integrates with Git, so you can [run Pants commands selectively](https://www.pantsbuild.org/docs/advanced-target-selection#running-over-changed-files-with---changed-since) only on files that have changed, and the files that depend on them. Generally, Pants conforms to the natural idioms of each language and framework, whereas Bazel forces everything to conform to its model, even where that leads to \\"impedance mismatch\\".\\n- **Pants requires almost no metadata and BUILD file boilerplate.** Pants relies instead on smart dependency inference, sensible defaults and auto-generation. This not only makes setup and maintenance dramatically easier, but also leads to more accurate (and more performant) builds, since BUILD files don\'t get out of date. Bazel requires a huge amount of handwritten BUILD boilerplate, including enumeration of dependencies, which is laborious and error-prone to keep in sync as code changes. There are tools that attempt to work around this problem by generating BUILD files, but this requires extra setup, more commands to remember, and more complexity. As a result, Pants is much easier to adopt initially, and to maintain during ongoing use.\\n- **Pants natively understands the semantics of a variety of build actions.** These include \\"test\\", \\"lint\\", \\"fmt\\", \\"check\\", \\"package\\", \\"publish\\", \\"run\\", \\"repl\\" and more. It understands what these commands do and how that affects caching and concurrency (e.g., linters don\'t modify sources, so Pants can run them all in parallel, but formatters do modify sources so Pants knows to run them in sequence). And you can add your own custom actions via the Plugin API. Bazel is limited to a handful of built-in build actions - \\"build\\", \\"test\\" and \\"run\\", so getting it to do things like run linters requires extra scripting and complexity.\\n- **Pants has useful built-in features like file watching to automatically rebuild your code.** Rather than needing third-party wrapper scripts to support re-running the build when input files have changed, Pants can automatically re-run a goal when its inputs have changed, via the `--loop` flag. It can also spawn and restart servers via `run`. This enables the fastest possible iteration on changes to your code.\\n- **Pants is easy to extend.** The Pants engine is written in Rust, for performance and security. The Rust engine orchestrates your build logic via a powerful, flexible [Plugin API](https://www.pantsbuild.org/docs/plugins-overview) that uses idiomatic Python 3 async code, so you can use natural control flow and advanced language features (including type hints) in your plugins. In fact, the Plugin API is so powerful that Pants uses it internally to implement its built-in features. So your custom extension code has access to the same capabilities as the core Pants plugins. Bazel\'s external API is more limited and brittle, and it requires you to use Starlark, a less expressive language that is less convenient than Python 3. For example, Bazel rules can\'t view the output of processes or consume file content (If you\'re versed in functional programming, Pants\'s API is monadic, while Bazel\'s is applicative). Of course, with greater power comes greater responsibility - Pants\'s API strives to prevent bugs in your extension rules, rather than defend against malicious code in them. Overall, the combination of Rust and Python gives us a great balance of performance and ease of use.\\n- **Pants has a strong open-source ethos.** It\'s an OSS-first project with a governance model that allows any individual to participate and any org to play an equal role, including yours! Bazel is controlled by Google, and with the needs of their internal users taking precedence. It can be extremely hard to get your needs or changes considered by the Bazel project. We in the Pants community pride ourselves on being responsive, helpful, inclusive and friendly.\\n\\n<Hero>\\n  Google typically doesn\'t use external code. But your team, like almost all\\n  others, probably relies on published code in public repositories such as PyPI\\n  or Maven Central, so Pants has strong support for that case.\\n</Hero>\\n\\n---\\n\\n## Design matters\\n\\nPants\'s advantages stem primarily from the fact that it was designed with codebases like yours in mind. Bazel was designed years ago, for internal use (primarily C++) at Google. Unless your codebase scale and engineering practices are similar to those (and they almost certainly aren\'t...) Bazel was not built with your current or future use cases in mind and may not support them well. Certainly, there may be third-party Bazel rules that provide some support for other use cases, but since those didn\'t factor into the core system design, you are more likely to find that Bazel\'s tradeoffs aren\'t right for you.\\n\\n<Hero>Pants was designed with codebases like yours in mind.</Hero>\\n\\n---\\n\\n## In our users\' own words\\n\\nBut don\'t take our word for it! Here are some quotes from our users:\\n\\n- \\"Easier setup than Bazel\\"\\n- \\"More approachable than Bazel\\"\\n- \\"Bazel was not well-optimized for Python and building Docker images\\"\\n- \\"Pants has felt much more \'batteries included\' than Bazel -- features like \'git smarts baked in\' and \'code formatting support\' make it feel like it has fewer sharper edges\\"\\n- \\"If the comparison was exactly equivalent, I\'d choose Pants for the approachability and support y\'all offer in the Slack and on GitHub. I\'ve never in my career found a dev team as willing to help and improve as y\'all.\\"\\n- \\"Pants has good documentation. Bazel has docs, and in abundance, but you need your PhD in Bazel to understand good chunks of it.\\"\\n- \\"Once we landed on Pants, we got set up pretty easily. Within 30 minutes you could get Pants installed in your project and then start asking Pants, \\"Hey, if I change this file, what depends on it?\\" We could easily integrate this into CI, because Pants is super transportable.\\"\\n- \\"Bazel is very unapproachable. As we explored the inscrutable documentation, we found no clear way to dip our toes in and try building a simple python app. Compare this to Pants where a single page of the docs explained how to get a python codebase building self-contained executable files with a few simple lines of config. Pants\' first-class support for Python means it\'s trivial to get up and running with common python tooling like pip, setuptools, pytest, black, isort, flake8, and more.\\"\\n\\nYou can read more testimonials from Pants users [here](https://www.pantsbuild.org/docs/testimonials).\\n\\n<Hero>\\n  \\"I\'ve never in my career found a dev team as willing to help and improve as\\n  y\'all.\\"\\n</Hero>\\n\\n---\\n\\n## To sum it up\\n\\nPants is state-of-the-art, designed for organizations like yours, with your developers\' happiness and productivity front and center. And with enterprise support from [Toolchain](https://toolchain.com/), the lead sponsor of Pants, you have world-class experts ready to be your build team!"},{"id":"/2021/11/17/introducing-pants-2-8","metadata":{"permalink":"/blog/2021/11/17/introducing-pants-2-8","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-11-17-introducing-pants-2-8/index.mdx","source":"@site/blog/2021-11-17-introducing-pants-2-8/index.mdx","title":"Pants 2.8 adds Autoflake & Pyupgrade, Docker publishing, Golang, and Google Cloud Functions","description":"Photo by [James","date":"2021-11-17T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"},{"inline":true,"label":"golang-2","permalink":"/blog/tags/golang-2"}],"readingTime":6.12,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["announcement","docker","python","deployment","golang-2"]},"unlisted":false,"prevItem":{"title":"pants-vs-bazel","permalink":"/blog/2021/11/18/pants-vs-bazel"},"nextItem":{"title":"Pants 2.8 adds experimental Golang support","permalink":"/blog/2021/11/10/golang-support-pants-28"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [James\\n  Orr](https://unsplash.com/@orrbarone?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nPants 2.8 adds Autoflake & Pyupgrade, Docker publishing, Golang, PEP 517 publishing, and Google Cloud Functions\\n\\n{/* truncate */}\\n\\n---\\n\\nWe\'re pleased to announce [Pants 2.8.0](https://www.pantsbuild.org/docs), the latest release of Pants, the scalable and ergonomic build system.\\n\\nTo update, set `pants_version = \\"2.8.0\\"` in your `pants.toml`. See [upgrade tips](https://www.pantsbuild.org/docs/upgrade-tips), including a new `update-build-files` goal to automate some of the upgrade.\\n\\n## Autoflake and Pyupgrade\\n\\nPants now supports Autoflake and Pyupgrade, in addition to [already supporting](https://www.pantsbuild.org/v2.7/docs/python-linters-and-formatters) Black, isort, Flake8, Bandit, Docformatter, MyPy, Pylint, Yapf, Shfmt, and Shellcheck!\\n\\nAutoflake removes unused imports automatically, and Pyupgrade modernizes your Python syntax to use new features like f-strings.\\n\\nBefore:\\n\\n```python title=\\"app.py\\"\\nimport os\\nname = \\"pantsbuild\\"\\nprint(\\"Hello %s!\\" %  name)\\n```\\n\\nAfter running `./pants fmt app.py` with the tools enabled:\\n\\n```python\\nname = \\"pantsbuild\\"\\nprint(f\\"Hello {name}!\\")\\n```\\n\\n## Publishing Docker images\\n\\nPants 2.7 added experimental Docker support, which gives you a single command to [streamline deploying your Python applications with Docker](../2021-10-13-pants-pex-and-docker/index.mdx).\\n\\nPants 2.8 expands its Docker support to include [publishing images](https://www.pantsbuild.org/v2.8/docs/docker#publishing-images). Now, `./pants publish` will first build the Docker image\u2014including copying in any relevant PEX binaries, Python wheels, and files. Pants will then publish the image to the registries you specify.\\n\\n```shell-session\\n$ ./pants publish src/docker::\\n14:41:51.98 [INFO] Built docker image: docker.registry.net:8181/test-example:1.2.5\\nThe push refers to repository [docker.registry.net:8181/test-example]\\n7c521f914a2d: Layer already exists\\n...\\n62a747bf1719: Layer already exists\\n1.2.5: digest: sha256:961beb6126320d277ad4236f9f12694ad4e077a16f73b896b3292023007a002c size: 2428\\n\\n\u2713 docker.registry.net:8181/test-example:1.2.5 published.\\n```\\n\\nPants 2.8 now also can run your Docker images with `./pants run`, making sure that the image is first built with all your binaries and files copied into it.\\n\\n## Google Cloud Functions\\n\\nPants can now [create a .zip file understood by Google Cloud Function](https://www.pantsbuild.org/v2.8/docs/google-cloud-function-python), allowing you to develop your functions alongside the rest of your projects.\\n\\n```shell-session\\n$ ./pants package project/google_cloud_function_example.py\\nWrote code bundle to dist/project.zip\\n  Runtime: python3.8\\n  Handler: main.handler\\n```\\n\\nThis functionality uses the same technology that allows [Pants to create AWS Lambda functions](https://www.pantsbuild.org/v2.8/docs/awslambda-python).\\n\\n## Experimental Golang support\\n\\nPants now augments Go\'s (already excellent!) tooling with these unique benefits:\\n\\n1.  A consistent interface for all languages and tools in your repository.\\n2.  Integration with Git + advanced project introspection.\\n3.  Remote caching and execution.\\n4.  Unlike legacy build systems, these benefits all come with minimal boilerplate.\\n\\nCheck out our [announcement](../2021-11-10-golang-support-pants-28/index.mdx) post for more, and an [example repository](https://github.com/pantsbuild/example-golang) to try it out.\\n\\n## PEP-517 packaging support\\n\\nAs explained [in a previous post](../2021-10-27-pants-supports-pep-517/index.mdx), Pants can now act as a PEP 517 build frontend.\\n\\nPants has long had the ability to generate setup.py files for you, to streamline creating and managing distributions. Pants 2.8 extends this with support for PEP 517, the Python standard for specifying how distributions should be built.\\n\\nUnder this standard, you can specify a \\"build backend\\" in a `pyproject.toml` file, and Pants will install and invoke it appropriately. This means that Pants can now run any distribution build, including building native extensions via `setup.py` and building Poetry projects.\\n\\n## File-level metadata with overrides\\n\\nSince Pants 2.0, Pants has operated at the file level. Unlike legacy build tools, Pants runs tests on individual files, for example, rather than \\"targets\\" (usually directories). Likewise, Pants understands metadata like your dependencies at the file level, which gives you fine-grained caching.\\n\\nAll this time, Pants has been dynamically generating one \\"target\\" per file, but we hid that from you. Now, we added new targets like `python_test` and `python_source` which correspond to individual files. You can manually create those, or let Pants generate the targets for you:\\n\\n```python\\npython_tests(\\n    name=\\"tests\\",\\n    # Generates two `python_test` targets.\\n    sources=[\\"osutil_test.py\\", \\"dirutil_test.py\\"],\\n)\\n```\\n\\nYou can now easily override metadata at the file-level through a new `overrides` field:\\n\\n```python\\npython_tests(\\n    name=\\"tests\\",\\n    overrides={\\n        \\"dirutil_test.py\\": {\\"timeout\\": 10},\\n        (\\"osutil_test.py\\", \\"contextutil_test.py\\"): {\\n            \\"dependencies\\": [\\":test_data\\"]},\\n        },\\n)\\n```\\n\\nThat is, you get precise, file-level metadata. But without demanding the boilerplate of legacy tools like Bazel.\\n\\n### Impact to existing users\\n\\nImproving this modeling required making some other changes:\\n\\n- Some targets were renamed, like `python_library` to `python_sources`. Run `./pants update-build-files` to automatically update your `BUILD` files. (The old names will still work in Pants 2.8.)\\n- `conftest.py` no longer belongs to the `sources` of `python_tests` by default. Instead, it belongs to `python_test_utils`. Run `./pants tailor` to automatically add these new targets.\\n- `./pants filter --target-type` and `./pants peek` both now differentiate between `python_tests` and `python_test` targets, for example. Usually you will want to update your scripts to use `python_test` rather than `python_tests` and so on.\\n- The command line arguments `dir:` and `dir::` now include generated targets for [project introspection goals](https://www.pantsbuild.org/v2.8/docs/project-introspection) like `list` and `peek`.\\n\\n## Other changes\\n\\n- TOML dictionaries work for `dict` options in `pants.toml`, e.g.\\n\\n```toml\\n[tailor]\\nalias_mapping = { python_sources = \\"custom_python_sources\\", python_tests = \\"custom_python_tests\\" }\\n```\\n\\n```toml\\n[tailor.alias_mapping]\\npython_sources = \\"custom_python_sources\\"\\npython_tests = \\"custom_python_tests\\"\\n```\\n\\n- You can set up CLI aliases, like `./pants green ::` being an alias for `./pants fmt lint check ::`\\n\\n```toml\\n[cli.alias]\\ngreen = \\"fmt lint check\\"\\n```\\n\\n- `[coverage-py].fail_under` option added to fail if Python test coverage is below a certain number.\\n- `pex_binary` has a `script` field to allow setting console scripts, which allows running third-party dependencies.\\n- `pex_binary` has a `restartable` field, which you can set so that Pants will restart the binary when input files have changed. This is particularly useful for auto-reloading Flask and Django servers, for example.\\n- Added `--tailor-check` option as a dry run for automatically adding new targets to your BUILD files.\\n- Added `[tailor].ignore_paths` and `[tailor].ignore_adding_targets` options to avoid adding targets that are false positives.\\n- Added `./pants help tools` to list all tools installed by Pants, including their versions.\\n- `typecheck` is deprecated in favor of `check`, which will run MyPy and compilation for languages like Go and Java.\\n\\nSee the full [changelog](https://github.com/pantsbuild/pants/blob/release_2.8.0/src/python/pants/notes/2.8.x.md) for more changes.\\n\\n## Upcoming in Pants 2.9\\n\\nWe are continuing to work on language support: adding more Go features and getting Java/Scala into alpha/beta state.\\n\\nWe also plan to resume the redesign of Python lockfiles [started with Pants 2.7](../2021-09-27-introducing-pants-2-7/index.mdx)\'s tool lockfiles.\\n\\n\\\\--\\n\\nTry out our [example Python repository](https://github.com/pantsbuild/example-python/), and let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)\\n\\n## Thanks\\n\\nThanks to all the contributors to 2.8, including everyone who shared feedback on changes and who tested release candidates! Some shout-outs:\\n\\n- Chris Williams for Google Cloud Functions.\\n- Andreas Stenius for Docker publishing and CLI aliases.\\n- Tom Dyas and Eric Arellano for Go support.\\n- Benjy Weinberger for PEP 517 support.\\n- Asher Foa for Pyupgrade.\\n- Patrick Lawson for Autoflake.\\n- Stu Hood for auto-reloading when a PEX binary changes.\\n- Nicolas Joseph, Siyan Beverly, Doug Jenkins, Anthony D\'Silva, and Ken Howard for continual feedback on Go support + the ideas of `--tailor-check` and `[tailor].ignore_paths`."},{"id":"/2021/11/10/golang-support-pants-28","metadata":{"permalink":"/blog/2021/11/10/golang-support-pants-28","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-11-10-golang-support-pants-28/index.mdx","source":"@site/blog/2021-11-10-golang-support-pants-28/index.mdx","title":"Pants 2.8 adds experimental Golang support","description":"Why Pants for Golang? A consistent interface for all languages & tools, integration with Git + advanced project introspection, and remote caching and execution. All with minimal boilerplate.","date":"2021-11-10T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"golang-2","permalink":"/blog/tags/golang-2"}],"readingTime":4.97,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["announcement","golang-2"]},"unlisted":false,"prevItem":{"title":"Pants 2.8 adds Autoflake & Pyupgrade, Docker publishing, Golang, and Google Cloud Functions","permalink":"/blog/2021/11/17/introducing-pants-2-8"},"nextItem":{"title":"Pants supports PEP 517","permalink":"/blog/2021/10/27/pants-supports-pep-517"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}></CaptionedImg>\\n\\nWhy Pants for Golang? A consistent interface for all languages & tools, integration with Git + advanced project introspection, and remote caching and execution. All with minimal boilerplate.\\n\\n{/* truncate */}\\n\\n---\\n\\nThe open source [Pants build system](https://www.pantsbuild.org/) adds experimental Golang support to Pants 2.8, in addition to already supporting Python, Shell, and Docker!\\n\\n## What is Pants?\\n\\nPants is a state-of-the-art software workflow system. It orchestrates the various tools you use during iterative development and CI\u2014compilers, testing frameworks, linters, formatters, and packagers\u2014installing, configuring, sequencing, and invoking them in just the right way to create the desired outputs.\\n\\nPants applies fine-grained invalidation, caching, and concurrency to speed up your builds and other workflows, and it uses static analysis to minimize the amount of metadata and other boilerplate required to achieve this.\\n\\n## Why Pants for Go?\\n\\nGo\'s built-in tooling is already excellent! Many projects may be fine using only Go\'s tooling, although Pants offers some unique benefits:\\n\\n1.  A consistent interface for all languages and tools in your repository.\\n2.  Integration with Git + advanced project management.\\n3.  Remote caching and execution.\\n4.  Unlike legacy build systems, these benefits all come with minimal boilerplate.\\n\\n### A consistent interface for all languages & tools in your repository\\n\\n- `./pants fmt ::` \xa0 runs all formatters.\\n- `./pants lint ::` runs all linters and formatters (in check-mode) in parallel.\\n- `./pants test ::` runs all tests in parallel, regardless of language and test framework.\\n- `./pants check ::` runs all compilation and type checkers like MyPy in parallel.\\n- `./pants package ::` builds all binaries, e.g. Go binaries and Python wheels. (Also see [Streamline your Docker builds with Pants](../2021-10-13-pants-pex-and-docker/index.mdx))\\n\\n```shell-session\\n$ ./pants lint ::\\n16:28:34.37 [ERROR] Completed: Lint with gofmt - gofmt failed (exit code 1).\\nThe following Go files require formatting:\\ntestprojects/src/go/pants_test/bar/bar.go\\ntestprojects/src/go/pants_test/foo.go\\n16:28:36.70 [INFO] Completed: Lint with Shellcheck - Shellcheck succeeded.\\n16:28:42.69 [INFO] Completed: Lint with Black - Black succeeded.\\nAll done! \u2728 \u{1F370} \u2728\\n747 files would be left unchanged.\\n16:28:53.63 [INFO] Completed: Lint with Flake8 - Flake8 succeeded.\\n\u2713 Black succeeded.\\n\u2713 Flake8 succeeded.\\n\u2713 Shellcheck succeeded.\\n\u2715 gofmt failed.\\n```\\n\\n### Integration with Git + advanced project introspection\\n\\nPants integrates with Git to allow you to, for example, only format and lint changed files:\\n\\n```shell-session\\n./pants --changed-since=HEAD fmt\\n./pants --changed-since=upstream/main lint\\n```\\n\\nPants can combine this integration with Git with its [advanced project introspection](https://www.pantsbuild.org/v2.8/docs/project-introspection). For example, to only run tests that could have possibly been changed:\\n\\n```shell-session\\n./pants --changed-since=HEAD --changed-dependees=transitive test\\n```\\n\\nThat is, Pants will only run tests when their package or any transitive dependency was changed.\\n\\nYou can also use Pants\'s project introspection to better understand your dependency graph, such as identifying which code will be impacted by updating a third-party dependency:\\n\\n```shell-session\\n$ ./pants dependees --transitive //:mod#github.com/google/uuid\\ncmd/greeter_en\\ncmd/greeter_es\\npkg/greeter\\npkg/uuid\\n```\\n\\n### Remote caching and execution\\n\\nLike Go, Pants locally caches each step of your build so that once you compile a package or run a package\'s tests, for example, you don\'t need to run it again unless that package or any of its transitive dependencies have changed.\\n\\n[Remote caching](https://www.pantsbuild.org/docs/remote-caching-execution) allows you to share this same cache amongst your CI runs and amongst your local team so that you don\'t have to redo work that others on your team have already done\u2014like running tests and downloading third-party dependencies.\\n\\n[Remote execution](https://www.pantsbuild.org/docs/remote-caching-execution) allows you to run your builds directly in the cloud with low-latency workers for extreme parallelism, such as running your entire test suite in total parallelism.\\n\\n### Minimal boilerplate\\n\\nUnlike previous-generation build tools like Bazel, Pants 2\'s benefits come with minimal boilerplate.\\n\\nTo get set up, add just four lines to the `pants.toml` config file:\\n\\n```toml\\n[GLOBAL]\\nbackend_packages = [\\"pants.backend.experimental.go\\"]\\n\\n[golang]\\nexpected_version = \\"1.17\\"\\n```\\n\\nThen run `./pants tailor` to generate a couple of one-line `BUILD` files:\\n\\n```shell-session\\n$ ./pants tailor\\nCreated BUILD:\\n- Added go_mod target root\\nCreated cmd/deploy/BUILD:\\n- Added go_binary target bin\\nCreated cmd/runner/BUILD:\\n- Added go_binary target bin\\n\\n# BUILD\\ngo_mod()\\n\\n# cmd/deploy/BUILD\\ngo_binary(name=\\"bin\\")\\n```\\n\\nIn contrast, Bazel `BUILD` files often have 30-100+ lines per-directory, requiring you to enumerate every import your package has and every package provided by your third-party modules.\\n\\nWith Bazel, whenever you change your code\'s imports or your third-party dependencies, you have to update your `BUILD` files saved on-disk, usually by running a different tool called Gazelle.\\n\\nInstead, with Pants, there is no need to update `BUILD` files. Pants uses this initial setup to analyze dependencies on startup, based on your `require` directives in `go.mod` and `go.sum`, and the import statements in first-party `.go` files in your project.\\n\\n## Trying out Go support\\n\\nCheck out the [example-golang repository](https://github.com/pantsbuild/example-golang) to try out Pants 2.8\'s Go support! And let us know what you think in [Slack](https://www.pantsbuild.org/docs/getting-help) and [GitHub](https://github.com/pantsbuild/pants/issues)!\\n\\nTo use Pants with your project, check out our [Getting started guide](https://www.pantsbuild.org/v2.8/docs/getting-started) and our [Golang docs](https://www.pantsbuild.org/v2.8/docs/go-overview).\\n\\n## What\'s upcoming\\n\\nWe plan to make Pants\'s Go support more comprehensive in Pants 2.9, before the end of 2021. Some features we have planned:\\n\\n- The embed directive / resources\\n- The `testdata` folder\\n- `go vet`\\n- Vendoring\\n- Finalizing the layout of target definitions in BUILD files\\n\\nWe would [love your feedback](https://www.pantsbuild.org/docs/getting-help) on what features your project needs to build with Pants, along with any bug reports. For example, while these features are not yet currently on the roadmap, they can be bumped based on community input:\\n\\n- Cgo files\\n- Non-Go file types, like `.h` files (`.s` assembly files are already supported)\\n- Multiple `go.mod` projects in the same repository\\n- Protobuf support"},{"id":"/2021/10/27/pants-supports-pep-517","metadata":{"permalink":"/blog/2021/10/27/pants-supports-pep-517","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-10-27-pants-supports-pep-517/index.mdx","source":"@site/blog/2021-10-27-pants-supports-pep-517/index.mdx","title":"Pants supports PEP 517","description":"Photo by [Alessandra","date":"2021-10-27T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"}],"readingTime":5.17,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["python","deployment"]},"unlisted":false,"prevItem":{"title":"Pants 2.8 adds experimental Golang support","permalink":"/blog/2021/11/10/golang-support-pants-28"},"nextItem":{"title":"Podcasting Pants","permalink":"/blog/2021/10/21/podcasting-pants"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Alessandra\\n  Caretto](https://unsplash.com/@alessandracaretto?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\n> TL;DR The upcoming Pants 2.8 release has [greatly improved support](https://www.pantsbuild.org/v2.8/docs/python-distributions) for packaging Python distributions (sdists and wheels), including native extensions, by leveraging PEP 517.\\n\\nPants has industry-leading support for Python builds - covering steps such as resolving 3rd-party dependencies, running tests, generating code, running formatters and linters, packaging python executables, building Docker images, and more.\\n\\nOne important build step that Pants has supported for a long time is building Python package distributions, namely [sdists](https://packaging.python.org/overview/#python-source-distributions) and [wheels](https://packaging.python.org/overview/#python-binary-distributions).\\n\\nWe just cut the [first release candidate](https://pypi.org/project/pantsbuild.pants/2.8.0rc0/) for Pants 2.8, so this is a good time to talk about the significant enhancements to its distribution-building capabilities, including support for [native extensions](https://docs.python.org/3/extending/extending.html) and for [PEP-517](https://www.python.org/dev/peps/pep-0517/).\\n\\n## Why package distributions anyway?\\n\\nHistorically, there hasn\'t been an obvious answer to the question \\"how do I deploy my Python code?\\" But typically it has involved some variation on:\\n\\n- Packaging your code into distributions (sdists and/or wheels)\\n- Publishing that code (either to public [PyPI](https://pypi.org/) or to a private package repository)\\n- Consuming it in the deployment environment in the same way as you consume any third-party dependency.\\n\\nThat is, you build a [virtual environment](https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/#creating-a-virtual-environment) and install your own code into it in the same way you would install third-party dependencies, using requirement strings, such as `mypackage==1.2.3`.\\n\\nPants, on the other hand, allows you package your code into a single PEX (Python EXecutable) file, that contains all the first-party source code and third-party dependencies. I\'ve written about some of the advantages of PEX as a deployment format [here](../2021-10-13-pants-pex-and-docker/index.mdx), and we\'ll be posting more on that subject in the near future.\\n\\nSo it\'s true that in many cases Pants allows you to forgo building distributions!\\n\\nHowever, you do often still need to build sdists and wheels, for various reasons, such as:\\n\\n- You want to publish your code, privately or publicly, for consumption by other repos.\\n- You have legacy architecture that expects to consume code as distributions.\\n- You have native extensions that have to be built via legacy mechanisms such as setuptools.\\n- You just prefer to!\\n\\nWhatever the reason, Pants is able to build distributions for you, and in the upcoming 2.8 release that ability has been greatly improved.\\n\\n## Setuptools\\n\\nFor a long time, [Setuptools](https://setuptools.pypa.io/) was the de-facto standard mechanism for building Python distributions. So, naturally, Pants relied on Setuptools to package your Python code into publishable distributions.\\n\\nSetuptools relies on a `setup.py` script that you write, and that contains the instructions on what code to package into the distribution, and what the requirements and other metadata of the distribution should be.\\n\\nA lot of the information needed by a `setup.py` script, such as code and dependency structure, is already known to Pants. So Pants is able to [generate](https://www.pantsbuild.org/docs/python-distributions) the script for you, based on that information. This was really useful in a repo that contains code for many different distributions: Instead of manually maintaining a lot of boilerplate in multiple `setup.py` scripts, Pants would generate that for you, while ensuring that a given source package \\"belongs\\" to only one distribution.\\n\\nBut sometimes you do need to author your own `setup.py` script, to cover custom situations. One important example is when building native extensions. So Pants 2.8 adds support for using pre-existing `setup.py` scripts: if you turn off the auto-generation for a specific distribution, or repo-wide, Pants will use a `setup.py` script in the appropriate location in the source tree.\\n\\n## PEP 517\\n\\nBut there\'s more! [PEP 517](https://www.python.org/dev/peps/pep-0517/) is a newer standard for specifying how a distribution should be built. Under PEP 517 (and its companion standard, [PEP 518](https://www.python.org/dev/peps/pep-0518/)) you use `pyproject.toml` to specify the python requirements and entry point for the builder code. This information is referred to as a \\"build backend\\".\\n\\n> Fun fact: These PEPs were the genesis of `pyproject.toml`! The fact that various tools jumped on the bandwagon and started using that file for their own config is an unintentional byproduct that got retconned into the standard. Learn more in this [very informative post](http://daily.gopython.org/2020/03/brett-cannon-what-heck-is-pyprojecttoml.html) by one of the authors of the PEPs.\\n\\nExamples of build backends include Setuptools (naturally), but also other systems with package-building capabilities, such as [Flit](https://flit.readthedocs.io/en/latest/) or [Poetry](https://github.com/python-poetry/poetry-core).\\n\\nWe\'re pleased to announce that Pants 2.8 supports PEP 517! In the parlance of that standard it is a \\"build frontend\\" - it reads the build backend information from `pyproject.toml`, installs the backend\'s requirements in a virtualenv, ensures that all the relevant sources and resources are present in that environment, and invokes the backend\'s entry point to produce an sdist or wheel.\\n\\nThis means that you can use Pants to orchestrate your PEP 517-compatible packaging operation, whether or not you\'re using Setuptools. And of course your PEP 517 packaging operations enjoy the same concurrency and caching benefits as everything else Pants does.\\n\\nAnother example of a PEP 517 build frontend is [Pip](https://pypi.org/project/pip/). But Pip is more oriented towards building wheels out of downloaded sdists as its primary use-case. Pants is designed more towards building both sdists and wheels from your own code, particularly where you package multiple distributions out of a single repo.\\n\\n## Summary\\n\\nPEP-517 is a big move towards standardizing how Python distribution builds are declared and executed. We\'re excited to have Pants support this important standard.\\n\\nWant to learn more? Take a look at the [documentation](https://www.pantsbuild.org/v2.8/docs/python-distributions) or come [chat with us](https://www.pantsbuild.org/docs/getting-help) on Slack!"},{"id":"/2021/10/21/podcasting-pants","metadata":{"permalink":"/blog/2021/10/21/podcasting-pants","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-10-21-podcasting-pants/index.mdx","source":"@site/blog/2021-10-21-podcasting-pants/index.mdx","title":"Podcasting Pants","description":"{/ truncate /}","date":"2021-10-21T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":1.08,"hasTruncateMarker":true,"authors":[{"name":"Carina C. Zona","title":"Pants Maintainer","url":"https://github.com/cczona","imageURL":"https://github.com/cczona.png","key":"cczona","page":null}],"frontMatter":{"authors":["cczona"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"Pants supports PEP 517","permalink":"/blog/2021/10/27/pants-supports-pep-517"},"nextItem":{"title":"Streamline your Docker builds with Pants","permalink":"/blog/2021/10/13/pants-pex-and-docker"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}></CaptionedImg>\\n\\n{/* truncate */}\\n\\nPants team members periodically get invited to be interviewed about aspects of the project. It\'s a delight to have these conversations, sharing our expertise and passion for build engineering. If you haven\'t heard these stories yet, you\'re in for a treat. And of course if you want to hear more conversations like these, suggest Pants team to your favorite podcasters. We\'re always happy to make time to share more about what we know and love.\\n\\nPants maintainer Benjy Weinberger discusses \\"Monorepo and Building at Scale\\"\\n\\n<iframe\\n  style={{ \\"border-radius\\": \\"12px\\" }}\\n  src=\\"https://open.spotify.com/embed/episode/2fkgheu20VZwgglQnEblTp?utm_source=generator\\"\\n  width=\\"100%\\"\\n  height=\\"352\\"\\n  frameBorder=\\"0\\"\\n  allowfullscreen=\\"\\"\\n  allow=\\"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture\\"\\n  loading=\\"lazy\\"\\n></iframe>\\n\\nBenjy puts on his CEO hat to delve into \\"Shifting Build Execution Paradigm\\"\\n\\n<iframe\\n  sandbox=\\"allow-scripts\\"\\n  security=\\"restricted\\"\\n  src=\\"https://www.angelneers.com/podcast/28-shifting-build-execution-paradigm/embed/\\"\\n  width=\\"100%\\"\\n  height=\\"350\\"\\n  title=\\"\u201C28: Shifting Build Execution Paradigm\u201D \u2014 Angelneers\\"\\n  frameborder=\\"0\\"\\n  marginwidth=\\"0\\"\\n  marginheight=\\"0\\"\\n  scrolling=\\"no\\"\\n  class=\\"wp-embedded-content\\"\\n></iframe>\\n\\nPants maintainers Stu Hood and Eric Arellano pair up to address how \\"Pants Has Got Your Python Monorepo Covered\\"\\n\\n<iframe\\n  src=\\"https://player.fireside.fm/v2/82qp1QFd+pCaGVloR?theme=dark\\"\\n  width=\\"100%\\"\\n  height=\\"200\\"\\n  frameborder=\\"0\\"\\n  scrolling=\\"no\\"\\n></iframe>"},{"id":"/2021/10/13/pants-pex-and-docker","metadata":{"permalink":"/blog/2021/10/13/pants-pex-and-docker","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-10-13-pants-pex-and-docker/index.mdx","source":"@site/blog/2021-10-13-pants-pex-and-docker/index.mdx","title":"Streamline your Docker builds with Pants","description":"Photo by [Ian","date":"2021-10-13T00:00:00.000Z","tags":[{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"getting-started","permalink":"/blog/tags/getting-started"},{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"}],"readingTime":7.45,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["docker","getting-started","deployment"]},"unlisted":false,"prevItem":{"title":"Podcasting Pants","permalink":"/blog/2021/10/21/podcasting-pants"},"nextItem":{"title":"Docker support in Pants 2.7","permalink":"/blog/2021/09/28/docker-support"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Ian\\n  Taylor](https://unsplash.com/@carrier_lost?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\n> TL;DR Pants makes it easy and efficient to incrementally build and deploy multiple Docker images from a single repo, with a single command. Each image can consist of a shared base image plus a single PEX (Python EXecutable) file containing all the code, resources and dependencies required by the entry point. Pants knows exactly which images need to be rebuilt and redeployed given a set of Git changes.\\n\\nDeploying Python applications in Docker images has traditionally been pretty clunky. The [Pants build system](https://www.pantsbuild.org/) now makes it a breeze!\\n\\n[Pants 2.7](../2021-09-27-introducing-pants-2-7/index.mdx) added [support](../2021-09-28-docker-support/index.mdx) for building Docker images, thanks to our new maintainer [Andreas Stenius](../2021-09-14-meet-our-newest-maintainer-andreas-stenius/index.mdx). This support unlocks several really neat optimizations that make deploying Python code in Docker images much more efficient, particularly when multiple services are involved.\\n\\n> I think I need to revisit my previous reply on the best way to put [#python](https://twitter.com/hashtag/python?src=hash&ref_src=twsrc%5Etfw) into [#docker](https://twitter.com/hashtag/docker?src=hash&ref_src=twsrc%5Etfw) containers. The award now goes to [@pantsbuild](https://twitter.com/pantsbuild?ref_src=twsrc%5Etfw) ... [https://t.co/5vb0b8jJ0T](https://t.co/5vb0b8jJ0T)\\n>\\n> \u2014 Stephan Erb (@ErbStephan) [October 22, 2021](https://twitter.com/ErbStephan/status/1451475076545761294?ref_src=twsrc%5Etfw)\\n\\n> The latest Pants 2.7 comes with experimental Docker support. After you change a line of Python code, Pants will not just know which tests to re-run and which package to update, but also what Docker image needs rebuilding [https://t.co/eErV8g3Urg](https://t.co/eErV8g3Urg)\\n>\\n> \u2014 Stephan Erb (@ErbStephan) [October 22, 2021](https://twitter.com/ErbStephan/status/1451475079574048794?ref_src=twsrc%5Etfw)\\n\\n> This is all based on heavy caching with very fine-grained invalidation. I have updated my pants example repo to the latest version if you want to play around with it [https://t.co/jN0FIEF1FE](https://t.co/jN0FIEF1FE)\\n>\\n> cc [@sebineubauer](https://twitter.com/sebineubauer?ref_src=twsrc%5Etfw) [@ChristianKuehn](https://twitter.com/ChristianKuehn?ref_src=twsrc%5Etfw) [@kaktusmimi](https://twitter.com/kaktusmimi?ref_src=twsrc%5Etfw)\\n>\\n> \u2014 Stephan Erb (@ErbStephan) [October 22, 2021](https://twitter.com/ErbStephan/status/1451475081859846144?ref_src=twsrc%5Etfw)\\n\\n## Automatically building dependencies\\n\\nOne key feature of Docker support in Pants is that Pants will automatically rebuild any dependencies that need to be embedded in a Docker image.\\n\\nBefore Docker support was released you\'d have to manually figure out which packages your images depend on, invoke Pants separately to build them, and then run `docker build` externally. You couldn\'t get the benefit of Pants\'s automatic, fine-grained dependency management when it came to Docker images.\\n\\nBut now, if your Dockerfile has a `COPY` command that copies a packaged artifact into the image, then when you run:\\n\\n```text\\n./pants package path/to/Dockerfile\\n```\\n\\nPants will notice the dependency on the packaged artifact, and ensure that it is up to date before embedding it in the image - retrieving it from cache if possible, or rebuilding it if any of its own dependencies have changed. A single command will ensure an up-to-date image, doing just the right amount of incremental work, but no more!\\n\\nEven more conveniently, you don\'t have to manually specify that artifact dependency in a BUILD file. Pants will automatically infer it from the `COPY` command in the Dockerfile! And because Pants runs each subprocess in its own hermetic sandbox, you don\'t have to worry about subtle inference errors: if the dependency cannot be inferred for some reason, the packaged artifact won\'t be available in the sandbox, and the Docker build will fail on the `COPY` command.\\n\\n## Knowing which images to build\\n\\nIf you use Git for revision control, you can now easily find out which Docker images require rebuilding, thanks to Pants\'s built in Git change tracking ability.\\n\\nFor example, this command will rebuild all packages of all types, including Docker images, whose transitive dependencies have changed relative to the Git `main` branch.\\n\\n```text\\n./pants --changed-since=main --changed-dependees=transitive package\\n```\\n\\nAnd of course you can use any branch, tag or other Git reference instead of `main`.\\n\\nOr, if you want to be more selective and focus only on Docker images (and their transitive dependencies):\\n\\n```text\\n./pants --changed-since=main --changed-dependees=transitive filter \\\\\\n  --target-type=docker_image | \\\\\\n  xargs ./pants package\\n```\\n\\n(The main difference between this more complex invocation and the simpler one above, is that this one will focus on just Docker images, and only rebuild other package types if those Docker images depend on them. Whereas the more generic command will focus on packages of all types.)\\n\\n## Deploying PEX files in your Docker images\\n\\nOne of the most interesting features enabled by Pants\'s Docker support is the ability to easily embed a [PEX file](https://www.pantsbuild.org/docs/pex-files) in your Docker images.\\n\\nA PEX is a Python EXecutable - a single executable file that wraps your Python code, any 3rd-party wheels, and an entry point. When you execute a PEX file, it bootstraps itself, locates a suitable Python interpreter on the system, and then runs its embedded Python code from the entry point.\\n\\nPEX files are incredibly useful when used in conjunction with Docker, especially when you deploy many different images, such as in a microservices architecture.\\n\\nHere\'s why:\\n\\n### What you\'re probably doing today...\\n\\nWithout PEX, how do you deploy Python code into a Docker image? Typically you have to choose between variations on these options:\\n\\n1.  Generate separate images for each service, where each image contains a virtualenv with just the code and dependencies needed for that service.\\n2.  Generate a single image for all services, which includes a giant virtualenv with all the code, and all the dependencies, that any service might need. The different services are then executed by invoking different entry points on the single monolithic image.\\n\\nThe disadvantage of the first option is that managing these many images is fiddly - how do you know what code and which dependencies go into each image, and when each image needs to be rebuilt? Do you maintain a separate `requirements.txt` file for each service? If so, how do you keep them all in sync, so you don\'t have version collisions, especially when you have some common code that is shared across multiple services?\\n\\nOn the other hand, the disadvantage of the monolithic image option is that this image becomes unwieldy, and has to be rebuilt for all services when the code or dependencies of any service changes. If you\'re working on service X, you\'re not going to be very happy if your image has to be laboriously rebuilt because of changes to some unrelated service Y.\\n\\n### PEX to the rescue\\n\\nBut now, Pants+PEX offer a best-of-both-worlds solution! This is how it works:\\n\\nYou start with a base image that includes a Python interpreter and any system binaries you might need. This base image typically doesn\'t change very often. Then, for each service you generate a Docker image that just adds a single file to the base image - a PEX file.\\n\\nPants knows how to build a PEX file that contains exactly the code and dependencies for each service. And it can do so very efficiently, For example, it knows how to take just the necessary subset of a resolved set of already-downloaded or built wheels, without re-running a Pip-style resolve separately for each service.\\n\\nBuilding a PEX file is fast, and embedding it into a Docker image is also fast - you don\'t need to rebuild any virtualenvs, you just `COPY` a single file onto the base image.\\n\\nAs we\'ve shown, with Pants, you don\'t have the cost of frequently rebuilding a large monolithic image, but you also don\'t have the hassle of managing multiple independent images. Pants makes managing those multiple images easy - it knows exactly what goes into each image, and exactly when an image needs to be rebuilt, and it will ensure that the embedded PEX file is rebuilt first if necessary.\\n\\nAnd best of all, you don\'t need to provide a huge amount of metadata to get all this to work! Pants uses static analysis to infer your code\'s dependencies, so you don\'t have to maintain a lot of annoying BUILD file boilerplate.\\n\\n## Pants+Docker - a very good fit\\n\\nAs we\'ve shown, Pants makes deploying Python code in Docker images a breeze. Pants and Docker work really well together to create streamlined deployable images. Not to mention the opportunities for [Dockers](https://us.dockers.com/)\\\\-related puns...\\n\\nTo find out more check out the Pants [documentation](https://www.pantsbuild.org/), and come [chat with us](https://join.slack.com/t/pantsbuild/shared_invite/zt-d0uh0mok-RLvVosDiX6JDpvStH~bFBA) on our Slack workspace! We\'d love to hear more about your Python and Docker use-cases, and discover together how Pants can help streamline your builds."},{"id":"/2021/09/28/docker-support","metadata":{"permalink":"/blog/2021/09/28/docker-support","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-09-28-docker-support/index.mdx","source":"@site/blog/2021-09-28-docker-support/index.mdx","title":"Docker support in Pants 2.7","description":"Photo by [Ian","date":"2021-09-28T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"}],"readingTime":4.14,"hasTruncateMarker":true,"authors":[{"name":"Andreas Stenius","title":"Pants Maintainer","url":"https://github.com/kaos","imageURL":"https://github.com/kaos.png","key":"kaos","page":null}],"frontMatter":{"authors":["kaos"],"tags":["announcement","docker","deployment"]},"unlisted":false,"prevItem":{"title":"Streamline your Docker builds with Pants","permalink":"/blog/2021/10/13/pants-pex-and-docker"},"nextItem":{"title":"My experience contributing YAPF formatter support to Pants 2.7","permalink":"/blog/2021/09/27/contributing-yapf-support"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Ian\\n  Taylor](https://unsplash.com/@carrier_lost?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWith [Pants 2.7](../2021-09-27-introducing-pants-2-7/index.mdx) comes a new experimental backend for building [Docker](https://www.docker.com/) images and linting [Dockerfiles](https://docs.docker.com/engine/reference/builder/). This backend offers a seamless experience when bundling your code and files into Docker images - In a single invocation, Pants will build the code artifacts that need to be embedded into the Docker image, and then build the image itself.\\n\\n### Getting started\\n\\nYou represent your Dockerfiles to Pants using the new [`docker_image`](https://www.pantsbuild.org/docs/reference-docker_image) target type in your Pants BUILD files.\\n\\nBut you don\'t need to create these by hand! The Pants `tailor` goal will give you a head start by creating or updating the relevant BUILD files for you:\\n\\n```bash\\n./pants tailor ::\\n```\\n\\nWith your `docker_image()` targets in place, you simply run\\n\\n```bash\\n./pants package path/to/Dockerfile\\n```\\n\\nto build the Docker image for that Dockerfile. Of course you can also use wildcards, so for example you can run\\n\\n```bash\\n./pants package ::\\n```\\n\\nto build all packageable targets in your repo, such as PEX binaries, Python distributions, archives, AWS Lambdas, and now also Docker images!\\n\\nThere is also support for linting your Dockerfiles, to check for errors and get suggestions for potential mistakes or bad practices. This feature relies on [`hadolint`](https://github.com/hadolint/hadolint), and you invoke it just like any other linter in Pants, for example:\\n\\n```bash\\n./pants lint path/to/Dockerfile\\n```\\n\\nRead more about the Docker backend and how to enable it in the [Pants documentation](https://www.pantsbuild.org/v2.7/docs/docker) .\\n\\n### An example\\n\\nTo give a feel for how it works, here is a basic example, from the documentation.\\n\\nConsider these files:\\n\\n```python title=\\"src/docker/helloworld/BUILD\\"\\nfiles(\\n    name=\\"msg\\",\\n    sources=[\\"msg.txt\\"]\\n)\\n\\ndocker_image(\\n    name=\\"helloworld\\",\\n    dependencies=[\\":msg\\", \\"src/python/helloworld:bin\\"],\\n)\\n```\\n\\n```dockerfile title=\\"src/docker/helloworld/Dockerfile\\"\\nFROM python:3.8\\nENTRYPOINT [\\"/bin/helloworld\\"]\\nCOPY src/docker/helloworld/msg.txt /var/msg\\nCOPY src.python.helloworld/bin.pex /bin/helloworld\\n```\\n\\n```text title=\\"src/docker/helloworld/msg.txt\\"\\nHello, Docker!\\n```\\n\\n```python title=\\"src/python/helloworld/BUILD\\"\\npython_library(interpreter_constraints=[\\"=3.8\\"])\\n\\npex_binary(\\n    name=\\"bin\\",\\n    entry_point=\\"main.py\\",\\n)\\n```\\n\\n```python title=\\"src/python/helloworld/main.py\\"\\nimport os\\n\\nif os.path.exists(\\"/var/msg\\"):\\n    with open(\\"/var/msg\\") as fp:\\n        msg = fp.read().strip()\\nelse:\\n    msg = \\"Hello\\"\\nprint(msg)\\n```\\n\\nWhen you run `package` on the Dockerfile:\\n\\n```shell-session\\n$ ./pants package src/docker/helloworld/Dockerfile\\n[...]\\n18:07:29.66 [INFO] Completed: Building src.python.helloworld/bin.pex\\n18:07:31.83 [INFO] Completed: Building docker image helloworld:latest\\n18:07:31.83 [INFO] Built docker image: helloworld:latest\\nTo try out the image interactively:\\n    docker run -it --rm helloworld:latest [entrypoint args...]\\nTo push your image:\\n    docker push helloworld:latest\\n```\\n\\nPants sees that the `docker_image` target depends on a `pex_binary` target, so it builds the executable `.pex` file first, and then builds the Docker image, placing that `.pex` file (as well as the direct `.txt` file dependency) in the build\'s context so that the `COPY` instructions can see them.\\n\\nYou can check that the packaged image works as expected:\\n\\n```shell-session\\n$ docker run -it --rm helloworld:latest\\nHello, Docker!\\n```\\n\\nThis underscores the big advantage of letting Pants build your Docker images: It can automatically and incrementally build any artifacts that your image needs prior to assembling the context and building the Docker image. So with a single `package` command you can ensure all your images are up to date, without having to worry about first handling upstream dependencies. Pants takes care of that for you!\\n\\nIn fact, in the 2.8.0 version Pants will have the ability to infer those upstream dependencies for you, by looking at the COPY statements in your Dockerfiles. So the explicit dependencies on the `docker_image` target in the example above can be deleted. Keep an eye out for this and other great features in the next Pants release.\\n\\n### Background\\n\\nAs a software developer in the Tooling department at [Svenska Spel](https://www.svenskaspel.se/), I am part of creating the infrastructure required to deliver our products into production, as safely, reliably and quickly as possible. To do this, we rely on many tools developed both in-house and by third parties, which we integrate into a complete CI/CD platform. A big part of this platform runs Python code, and almost all of it in Docker containers.\\n\\nIt was in search of better tooling to support our Python code base that I came across Pants, and was drawn in by the features and welcoming community. The lack of Docker support was an invitation for us to contribute something back.\\n\\n### Conclusion\\n\\nAs an experimental backend, it is still not feature complete, and is being actively worked upon. Please do not hesitate to reach out with your use case for Docker support in Pants. We want this to work for as many as possible.\\n\\nWe are really excited by all the possibilities we can realize using the Pants+Docker combo!"},{"id":"/2021/09/27/contributing-yapf-support","metadata":{"permalink":"/blog/2021/09/27/contributing-yapf-support","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-09-27-contributing-yapf-support/index.mdx","source":"@site/blog/2021-09-27-contributing-yapf-support/index.mdx","title":"My experience contributing YAPF formatter support to Pants 2.7","description":"Photo by [Brent","date":"2021-09-27T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":3.65,"hasTruncateMarker":true,"authors":[{"name":"Alexey Tereshenkov","title":"Pants Maintainer","url":"https://github.com/AlexTereshenkov","imageURL":"https://github.com/AlexTereshenkov.png","key":"alexey","page":null}],"frontMatter":{"authors":["alexey"],"tags":["python"]},"unlisted":false,"prevItem":{"title":"Docker support in Pants 2.7","permalink":"/blog/2021/09/28/docker-support"},"nextItem":{"title":"Introducing Pants 2.7: Python tool lockfiles, Yapf, Docker, and ./pants peek","permalink":"/blog/2021/09/27/introducing-pants-2-7"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Brent\\n  Ninaber](https://unsplash.com/@brentninaber?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWith the latest [2.7 release](../2021-09-27-introducing-pants-2-7/index.mdx), Pants now supports the [YAPF Python autoformatter](https://github.com/google/yapf), in addition to Black, isort, Docformatter, and Shfmt!\\n\\nFor example, if we start with this code:\\n\\n```python title=\\"project/app.py\\"\\nx  =     3 +  3\\nprint( x )\\n```\\n\\nYou can run `./pants fmt`:\\n\\n```shell-session\\n$ ./pants fmt project/app.py\\n11:27:34.27 [WARN] Completed: fmt - yapf made changes.\\n\u2713 yapf made changes.\\n```\\n\\nAnd YAPF will reformat the file to:\\n\\n```python title=\\"project/app.py\\"\\nx = 3 + 3\\nprint(x)\\n```\\n\\nRunning `./pants fmt` allows you to use multiple formatters with a single, consistent interface - such as using YAPF to format indentation and isort to order your imports. Pants will be careful to run each formatter sequentially, piping the results of one into the next so that they don\'t overwrite each other.\\n\\nYou can run your formatters in check-only mode with `./pants lint`, which will also run any linters you activate like Flake8, Bandit, Pylint, and Shellcheck. Because check-only mode doesn\'t write files, Pants will even run all your linters/formatters in parallel!\\n\\nPants even facilitates incrementally adding YAPF to your codebase. You can tell Pants to skip running on certain files/directories by setting skip_yapf=True in light-weight metadata files called BUILD files. `./pants fmt` and `./pants lint` will know when to run which tools on which files. This allows you to easily introduce YAPF incrementally, first to a small part of your project and growing from there:\\n\\n```python title=\\"project/BUILD\\"\\npython_library(skip_yapf=True, skip_flake8=True)\\n```\\n\\n## My plugin development experience\\n\\nIn my monorepo, there were already a few projects where YAPF was used, so it was important to make sure developers could continue using the same formatter after integrating the repository with Pants. Similarly, for any new projects to be added, it would be great to offer developers the flexibility to use another formatter in addition to Black.\\n\\nThe Pants build system has been designed with extensibility in mind: it turned out to be very easy to extend Pants to support YAPF via a plugin, which is now part of the core Pants functionality. All Pants built-in formatters and linters use the same API. This means that a new plugin can often be created by copy-pasting and making minor modifications to the code of existing plugins.\\n\\nTesting the new plugin code was also very easy, and only minor changes to existing tests were required. I wasn\'t sure at first whether I\'d like to write a plugin in a separate repository to iterate quickly, or within the main Pants repository to integrate early on. However, because Pants has fine-grained control over the testing targets and test results caching, I was able to work on a plugin within the Pants source code repository. I felt productive and writing code within a large codebase hasn\'t slowed me down.\\n\\nPants is a fairly large Python codebase, and it did look complicated at first glance, but after just a few days of exploratory testing and reading, things started making good sense. I have read through the [documentation section](https://www.pantsbuild.org/docs/plugins-overview) on writing new plugins, which was helpful. If you would like to write a new plugin, for instance, for a new linter, make sure to take a look at the [Common plugin tasks](https://www.pantsbuild.org/docs/common-plugin-tasks) documentation section which provides a step-by-step guidance for plugin authors.\\n\\nOne of the core Pants maintainers reviewed my GitHub pull request with the new YAPF plugin code within days after submission, and the feedback was very helpful. The community of developers were encouraging and friendly which made writing the plugin even more fun!\\n\\n_**Editor\'s Note:** We\'re really happy to have Alexey on board as a contributor, and greatly appreciate his work of YAPF support! It\'s good to know that he had a positive experience interacting with the Pants community. If you\'d like to learn more about how to add custom functionality to Pants to improve the developer experience on your team, or if you just want to find out more about Pants in general, come [say hi on Slack](https://www.pantsbuild.org/docs/getting-help)!_"},{"id":"/2021/09/27/introducing-pants-2-7","metadata":{"permalink":"/blog/2021/09/27/introducing-pants-2-7","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-09-27-introducing-pants-2-7/index.mdx","source":"@site/blog/2021-09-27-introducing-pants-2-7/index.mdx","title":"Introducing Pants 2.7: Python tool lockfiles, Yapf, Docker, and ./pants peek","description":"Photo by [Joakim","date":"2021-09-27T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"}],"readingTime":4.76,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["announcement","python","deployment"]},"unlisted":false,"prevItem":{"title":"My experience contributing YAPF formatter support to Pants 2.7","permalink":"/blog/2021/09/27/contributing-yapf-support"},"nextItem":{"title":"Meet our newest Maintainer: Andreas Stenius","permalink":"/blog/2021/09/14/meet-our-newest-maintainer-andreas-stenius"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Joakim\\n  Honkasalo](https://unsplash.com/@jhonkasalo?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'re pleased to announce Pants 2.7.0, the latest release of Pants, the scalable and ergonomic build system.\\n\\nTo update, set `pants_version = \\"2.7.0\\"` in your pants.toml. See [upgrade tips](https://www.pantsbuild.org/docs/upgrade-tips).\\n\\n## Python tool lockfiles\\n\\nPants now [pins every dependency](https://www.pantsbuild.org/v2.7/docs/python-third-party-dependencies#tool-lockfiles) used when installing Python tools like Black, Pytest, and MyPy. This makes your builds more stable and more secure from supply chain attacks (by using pip\'s checksum validation for downloaded files).\\n\\nEach tool comes with a default lockfile. If you change the tool\'s version or add plugins, you can generate a new lockfile by running `./pants generate-lockfiles`:\\n\\n```shell-session\\n$ ./pants generate-lockfiles\\n19:00:39.29 [INFO] Wrote lockfile for the resolve `flake8` to 3rdparty/flake8_lockfile.txt\\n19:00:39.30 [INFO] Wrote lockfile for the resolve `pytest` to 3rdparty/pytest_lockfile.txt\\n```\\n\\nWhenever you change the tool\'s version or extra requirements, Pants will remind you to regenerate the lockfile.\\n\\n(This new feature lays the foundation for an [upcoming revamp of lockfiles](https://github.com/pantsbuild/pants/issues/12314) for your user code, including supporting using different lockfiles for different portions of your code, and generating the files for you!)\\n\\n## Experimental Docker support\\n\\nPants can now create Docker images for you that include any of Pants\' supported artifact types, including archives, PEX binary files, and Python wheel files!\\n\\nFor example, given this Dockerfile and Pants metadata:\\n\\n```dockerfile title=\\"project/Dockerfile\\"\\nFROM python:3.8\\nENTRYPOINT [\\"/bin/my_app\\"]\\nCOPY project/app.pex /bin/my_app\\n```\\n\\n```python title=\\"project/BUILD\\"\\npex_binary(name=\\"app\\", entry_point=\\"app.py\\")\\ndocker_image(name=\\"docker_app\\", dependencies=[\\":app\\"])\\n```\\n\\nPants will first build your PEX binary, and then insert it into the Dockerfile\'s context.\\n\\n```shell-session\\n$ ./pants package project/Dockerfile\\n18:07:29.66 [INFO] Completed: Building project/app.pex\\n18:07:31.83 [INFO] Completed: Building docker image docker_app:latest\\n18:07:31.83 [INFO] Built docker image: docker_app:latest\\nTo try out the image interactively:\\n    docker run -it --rm docker_app:latest [entrypoint args...]\\nTo push your image:\\n    docker push docker_app:latest\\n$ docker run -it --rm docker_app:latest\\nHello, Docker!\\n```\\n\\nPants also now supports [Hadolint](https://github.com/hadolint/hadolint) to lint your Dockerfiles. This gives you a consistent interface to run all your project\'s linters by running `./pants lint`: Pants will run all activated linters\u2014selected from Hadolint, Shellcheck, Black, Flake8, isort, Pylint, and more\u2014in parallel.\\n\\nSee [https://www.pantsbuild.org/v2.7/docs/docker](https://www.pantsbuild.org/v2.7/docs/docker) to get started, and stay tuned for a blog post from [our newest maintainer](../2021-09-14-meet-our-newest-maintainer-andreas-stenius/index.mdx) Andreas Stenius about adding this highly requested feature.\\n\\nDisclaimer: this backend is still experimental and may change based on user feedback. Share what you think in [Slack](https://www.pantsbuild.org/docs/getting-help)!\\n\\n## Yapf Python formatter\\n\\nPants now supports the Yapf formatter, in addition to [already supporting](https://www.pantsbuild.org/v2.7/docs/python-linters-and-formatters) Black, isort, Docformatter, and Shfmt!\\n\\nFor example, if we start with this code:\\n\\n```python\\nx  =     3 +  3\\nprint( x )\\n```\\n\\nYou can run `./pants fmt` and Yapf will reformat the file to:\\n\\n```python\\nx = 3 + 3\\nprint(x)\\n```\\n\\nStay tuned for a blog post from Pants Contributor Alexey Tereshenkov about his experience writing his first Pants plugin.\\n\\n## `./pants peek`\\n\\nYou can now programmatically query targets to see what metadata you\'re setting for your code, getting back a JSON representation of your metadata.\\n\\n```shell-session\\n$ ./pants peek helloworld/app.py\\n[\\n  {\\n    \\"address\\": \\"helloworld/app.py\\",\\n    \\"target_type\\": \\"python_library\\",\\n    \\"dependencies\\": null,\\n    \\"interpreter_constraints\\": [\\"==3.7.*\\"],\\n    \\"skip_black\\": false,\\n    ...\\n    \\"skip_mypy\\": false,\\n    \\"sources\\": [\\n      \\"app.py\\",\\n    ],\\n  },\\n]\\n```\\n\\nFor example, Pants supports [incremental tool adoption](../2021-05-20-introducing-pants-2-5/index.mdx) where you can say to skip running the tool on some code by setting fields like `skip_flake8=True`. Now, you can combine `./pants peek` with [jq](https://stedolan.github.io/jq/) to find all targets where you set `skip_flake8=True`:\\n\\n```shell-session\\n$ ./pants peek :: | jq -r \'.[] | select(.skip_flake8 == true) | .[\\"address\\"]\'\\nhelloworld/greet:lib\\nhelloworld/greet:tests\\nhelloworld/util:lib\\n```\\n\\nLikewise, you could set up Pants to run only part of your test suite, and then use `./pants peek` and `jq` to find all tests that set `skip_tests=True` and pipe those into your old test runner. This allows you to incrementally switch to Pants\'s test support.\\n\\n## Other changes\\n\\n- Cache reuse is higher for resolving third-party dependencies.\\n- `python_distribution` has a new, more flexible [`entry_points` field](https://www.pantsbuild.org/v2.7/docs/python-distributions#using-a-generated-setuppy), which replaces the now deprecated `.with_binaries()` mechanism.\\n- Pants can now build [existing setup.py files](https://www.pantsbuild.org/v2.7/docs/python-distributions#using-an-existing-setuppy) for you.\\n- macOS ARM (Apple Silicon) is better supported when installing native tools like `protoc`.\\n- ASDF support was added to `[python-setup].interpreter_search_paths`.\\n- Pants now uses PEP 561, meaning that plugin authors will benefit from type hints.\\n\\nSee the full [changelog](https://github.com/pantsbuild/pants/blob/release_2.7.0/src/python/pants/notes/2.7.x.md) for more changes.\\n\\n## Upcoming in Pants 2.8\\n\\nWe\'ve been working on adding support for other languages, starting with Go and Java. We hope to have made enough meaningful progress for alpha/beta testing.\\n\\nOther upcoming improvements in Pants [2.8](https://github.com/pantsbuild/pants/blob/main/docs/notes/2.8.x.md):\\n\\n- TOML dictionaries will work for `dict` options.\\n- Google Cloud Functions, similar to the [AWS Lambda support](https://www.pantsbuild.org/v2.7/docs/awslambda-python).\\n- `pex_binary` has a `script` field to allow setting console scripts.\\n- `[coverage-py].fail_under` option to fail if test coverage is too low.\\n- An `experimental_shell_command` target to support scripting of build steps.\\n\\n\\\\--\\n\\nTry out our [example repository](https://github.com/pantsbuild/example-python/), and let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)"},{"id":"/2021/09/14/meet-our-newest-maintainer-andreas-stenius","metadata":{"permalink":"/blog/2021/09/14/meet-our-newest-maintainer-andreas-stenius","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-09-14-meet-our-newest-maintainer-andreas-stenius/index.mdx","source":"@site/blog/2021-09-14-meet-our-newest-maintainer-andreas-stenius/index.mdx","title":"Meet our newest Maintainer: Andreas Stenius","description":"Andreas lives in Visby, the main city of Gotland, which in turn is the biggest island in Sweden, and home to world-famous rauks. He is mostly self-taught as a developer, and has experience working with embedded systems and hardware engineering.","date":"2021-09-14T00:00:00.000Z","tags":[{"inline":true,"label":"meet-the-team","permalink":"/blog/tags/meet-the-team"},{"inline":true,"label":"users","permalink":"/blog/tags/users"}],"readingTime":1.95,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["meet-the-team","users"]},"unlisted":false,"prevItem":{"title":"Introducing Pants 2.7: Python tool lockfiles, Yapf, Docker, and ./pants peek","permalink":"/blog/2021/09/27/introducing-pants-2-7"},"nextItem":{"title":"Introducing Pants 2.6: Poetry support, third-party type stubs, and linter reports","permalink":"/blog/2021/08/02/introducing-pants-2-6"}},"content":"<CaptionedImg src={require(\\"./splash.jpeg\\").default}></CaptionedImg>\\n\\nAndreas lives in Visby, the main city of Gotland, which in turn is the biggest island in Sweden, and home to world-famous rauks. He is mostly self-taught as a developer, and has experience working with embedded systems and hardware engineering.\\n\\n{/* truncate */}\\n\\n---\\n\\nThe Pants open-source project exists and thrives thanks to the efforts of its various contributors, who do everything from system design to coding to updating [our documentation](https://pantsbuild.org/) to answering questions on our [Slack workspace](https://join.slack.com/t/pantsbuild/shared_invite/zt-d0uh0mok-RLvVosDiX6JDpvStH~bFBA).\\n\\nWithin the larger group of official Contributors are a smaller group of [Maintainers](https://www.pantsbuild.org/docs/maintainers) - people with an ongoing commitment to Pants, who help manage and steer the project.\\n\\nToday I\'m very pleased to announce a new Pants Maintainer: Andreas Stenius.\\n\\n[Andreas](https://www.linkedin.com/in/andreas-stenius-74745a3a/) lives in Visby, the main city of Gotland, which in turn is the biggest island in Sweden, and home to world-famous [rauks](https://en.wikipedia.org/wiki/Rauk). He is mostly self-taught \xa0as a developer, and has experience working with embedded systems and hardware engineering. He first learned BASIC on a Amiga 500 in the early 1990s followed by C and Pascal with friends in high school. When not working, Andreas enjoys kitesurfing, playing board games with his family, spending time out in nature, and volunteering as a sea rescuer ([ssrs.se](https://ssrs.se))!\\n\\nSince becoming involved with Pants, Andreas has made several prominent contributions, notably including [Docker support](https://www.pantsbuild.org/v2.7/docs/docker) (look out for that in the upcoming Pants 2.7 release!) He also regularly helps users [on Slack](https://join.slack.com/t/pantsbuild/shared_invite/zt-d0uh0mok-RLvVosDiX6JDpvStH~bFBA) and weighs in on design documents. We pride ourselves on keeping the Pants community helpful, friendly and respectful, and Andreas exemplifies these traits. His nomination as Maintainer is well-deserved recognition of his enthusiastic, ongoing support of the project.\\n\\nOur thanks go to Andreas for all his excellent contributions so far, and we look forward to many more in his new role!\\n\\nPS Would you like to become involved with a friendly open-source community building really interesting technology? We\'d love to have you on board! Come [say hi on Slack](https://join.slack.com/t/pantsbuild/shared_invite/zt-d0uh0mok-RLvVosDiX6JDpvStH~bFBA) and we\'ll go from there."},{"id":"/2021/08/02/introducing-pants-2-6","metadata":{"permalink":"/blog/2021/08/02/introducing-pants-2-6","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-08-02-introducing-pants-2-6/index.mdx","source":"@site/blog/2021-08-02-introducing-pants-2-6/index.mdx","title":"Introducing Pants 2.6: Poetry support, third-party type stubs, and linter reports","description":"Photo by [Elisa Calvet","date":"2021-08-02T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":3.95,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["announcement","python"]},"unlisted":false,"prevItem":{"title":"Meet our newest Maintainer: Andreas Stenius","permalink":"/blog/2021/09/14/meet-our-newest-maintainer-andreas-stenius"},"nextItem":{"title":"Poetry support for Pants 2.6","permalink":"/blog/2021/07/29/poetry-support-for-pants-2-6"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Elisa Calvet\\n  B.](https://unsplash.com/@elisa_cb?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'re pleased to announce Pants 2.6.0, the latest release of Pants, the scalable and ergonomic build system.\\n\\nTo update, set `pants_version = \\"2.6.0\\"` in your `pants.toml`. See [upgrade tips](https://www.pantsbuild.org/docs/upgrade-tips).\\n\\n## Poetry support\\n\\nPants now understands Poetry\'s `pyproject.toml` configuration for third-party dependency management, addressing one of our most requested features in the last year!\\n\\nPoetry support makes it even easier [to incrementally adopt Pants](https://www.pantsbuild.org/docs/existing-repositories), and you can keep using Poetry for third-party dependency management after Pants adoption. Thanks to Pants\'s dependency inference, you can build multiple distinct wheels/binaries using only a single pyproject.toml.\\n\\nSee our recent blog post [\\"Poetry support for Pants 2.6\\"](../2021-07-29-poetry-support-for-pants-2-6/index.mdx) for a more detailed introduction, along with the personal story behind [Toolchain](https://toolchain.com/)\'s intern Liam Wilson adding this highly requested feature.\\n\\n## Third-party type stubs and MyPy 0.900+\\n\\n[MyPy 0.900+ no longer includes typeshed](https://mypy-lang.blogspot.com/2021/06/mypy-0900-released.html), meaning that you must now install type stubs for many popular libraries. For example, you must install `types-requests` when using the `requests` library for MyPy to work properly.\\n\\nPants now understands how to [infer dependencies](../2020-10-29-dependency-inference/index.mdx) for third-party type stubs. For example, if you have `import requests` in your code, Pants will infer a dependency on both the implementation and the type stub.\\n\\n```shell-session\\n$ ./pants dependencies project/app.py\\n3rdparty/python:requests\\n3rdparty/python:types-requests\\n```\\n\\nPants still only infers dependencies when it is safe to, meaning that it checks for ambiguity. If you have 2+ implementations\u2014like `requests==2.25.1` and `requests==2.22.0`\u2014or 2+ type stub versions, Pants will not infer a dependency and will log a helpful suggestion for how to disambiguate.\\n\\nThe default for `[mypy].version` is now `0.910`. When upgrading to Pants 2.6, you may want to pin `[mypy].version` in `pants.toml` to `0.812` if you are not yet ready to upgrade; otherwise, you will need to add type stub requirements like `types-requests` to your project (MyPy gives helpful error messages).\\n\\nFinally, MyPy `0.900+` now supports `pyproject.toml` config files. Pants 2.6 will auto-discover this config file.\\n\\n## Linter reports\\n\\nPreviously, you could set `[lint].reports_dir` for Pants to instruct Flake8 and Bandit to write reports under that directory. This had [several issues](https://github.com/pantsbuild/pants/pull/12122), including that some tools like Bandit allow you to write multiple formats (e.g. text vs. JSON), and Pants assumed a single format.\\n\\nInstead, now you directly tell Flake8 and Bandit to generate a report by setting their config files or setting `[flake8].args` and `[bandit].args` to write to the `reports/` folder, e.g. setting `[flake8].args = [\\"--output-filer=reports/foo.txt\\"]`. Pants will capture all reports and write them to `dist/lint/<linter_name>`.\\n\\nYou can also now use [MyPy\'s report generation](https://mypy.readthedocs.io/en/stable/config_file.html#report-generation), e.g. by setting `linecount_report = \\"reports\\"` in `mypy.ini`. Pants will capture all files under the `reports/` folder and write them to `dist/typecheck/mypy`.\\n\\n## Other changes\\n\\n- Updated default versions for Black, Pylint, and Bandit.\\n- New [plugin hook](https://github.com/pantsbuild/pants/pull/12091) for setting up Python tests, e.g. starting up databases before test runs.\\n- When there\'s an exception, we now suggest several other things you can try, like running with `-ldebug`.\\n- New `--no-watch-filesystem` option, which allows you to run x86 Docker images from Apple Silicon machines.\\n\\nSee the full [changelog](https://github.com/pantsbuild/pants/blob/release_2.6.0/src/python/pants/notes/2.6.x.md) for more changes.\\n\\n### **Upcoming in Pants 2.7**\\n\\nWe have been re-envisioning Pants\'s support for Python third-party dependencies to be more ergonomic, flexible, and safe. The changes include:\\n\\n- Autogenerating lockfiles.\\n- Adding dedicated lockfiles for each tool you run, e.g. Black and Flake8.\\n- Supporting multiple lockfiles for your repository.\\n- Possibly using [PEP 665](https://www.python.org/dev/peps/pep-0665/)\'s new standardized lockfile format.\\n\\nThe full project may not be complete by Pants 2.7, given the recent developments around PEP 665. We are excited by the push for standardization in the Python ecosystem and eager to play our part in improving the build experience for Python developers. However, at a minimum, Pants 2.7 will have experimental lockfile support using the requirements.txt-style.\\n\\nOther upcoming improvements in Pants 2.7:\\n\\n- Support for the Yapf autoformatter.\\n- Support for the Hadolint Docker autoformatter.\\n- A `./pants peek` goal to inspect your targets\' metadata.\\n\\n\\\\--\\n\\nTry out our [example repository](https://github.com/pantsbuild/example-python), and let us know what you think in [Slack!](https://www.pantsbuild.org/docs/getting-help)"},{"id":"/2021/07/29/poetry-support-for-pants-2-6","metadata":{"permalink":"/blog/2021/07/29/poetry-support-for-pants-2-6","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-07-29-poetry-support-for-pants-2-6/index.mdx","source":"@site/blog/2021-07-29-poetry-support-for-pants-2-6/index.mdx","title":"Poetry support for Pants 2.6","description":"Photo by [Trust \\"Tru\\"","date":"2021-07-29T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":4.76,"hasTruncateMarker":true,"authors":[{"name":"Liam S Wilson","url":"https://github.com/wilsonliam","imageURL":"https://github.com/wilsonliam.png","key":"liam","page":null}],"frontMatter":{"authors":["liam"],"tags":["python"]},"unlisted":false,"prevItem":{"title":"Introducing Pants 2.6: Poetry support, third-party type stubs, and linter reports","permalink":"/blog/2021/08/02/introducing-pants-2-6"},"nextItem":{"title":"PyDev of the Week","permalink":"/blog/2021/06/28/pydev-of-the-week"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Trust \\"Tru\\"\\n  Katsande](https://unsplash.com/@iamtru?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nPants 2.6 can now understand Poetry\'s pyproject.toml configuration for third-party dependency management, addressing one of our most requested features in the last year!\\n\\nPants Contributor Liam Wilson delves into this new feature as well as his experiences developing the macro as a Toolchain intern.\\n\\n{/* truncate */}\\n\\n---\\n\\n_Pants 2.6 can now understand Poetry\'s `pyproject.toml` configuration for third-party dependency management, addressing one of our most requested features in the last year! Pants handles dependencies with more precision than Python projects using `requirements.txt` or Poetry. Pants Contributor Liam Wilson delves into this new feature as well as his experiences developing the macro as a [Toolchain](http://toolchain.com) intern._\\n\\n[Pants](https://www.pantsbuild.org/v2.6/) handles dependencies with more precision than Python projects using `requirements.txt` or [Poetry](https://python-poetry.org/). Whereas normally you have a single virtual environment, Pants can understand precisely which 3rd-party dependendencies each file in your project uses, automatically, through [dependency inference](https://www.pantsbuild.org/docs/how-does-pants-work#dependency-inference). When building your code \u2014 like running tests or packaging your code into wheel files \u2014 Pants only uses the third-party dependencies necessary for that particular file.\\n\\nFor example, given this file:\\n\\n```py caption=\\"Code for project/app.py\\"\\nfrom django.http import HttpResponse\\n\\ndef index(request):\\n    return HttpResponse(\\"Hello, world. You\'re at the polls index.\\")\\n```\\n\\nPants can infer that you depend on Django:\\n\\n```shell-session\\n$ ./pants dependencies --type=3rdparty project/app.py\\nDjango==3.2.5\\n```\\n\\nAmong other benefits, this precise and automatic understanding of your dependencies gives you fine-grained caching. This means, for example, that if none of the dependencies for a particular test file have changed, the cached result can be safely used.\\n\\n---\\n\\nNormally, Pants learns about your third-party dependencies by parsing `requirements.txt` files. Now, Pants can also parse your `pyproject.toml`, including understanding Poetry\'s special operators like `^` and `~`.\\n\\nFor example, given this `pyproject.toml`:\\n\\n```toml\\n[tool.poetry]\\nname = \\"my_project\\"\\nversion = \\"0.1.0\\"\\n\\n[tool.poetry.dependencies]\\npython = \\"^3.8\\"\\nansicolors = \\"1.5\\"\\nzipp = {git = \\"https://github.com/jaraco/zipp.git\\"}\\nrequests = {version = \\"1.2.3\\", extras = [\\"security\\"],  python = \\">2.7\\"}\\n\\n[tool.poetry.dev-dependencies]\\ncomplex_req = [{version = \\">=1.9\\", python = \\"^2.7\\"},{version = \\"^2.0\\", python = \\"3.4 || 3.5\\"}\\nisort = \\">=5.5.1,<5.6\\"\\n```\\n\\nPants will map to these 3rd-party dependencies:\\n\\n```\\nansicolors\\nzipp@git+https://github.com/jaraco/zipp.git\\nrequests[security] == 1.2.3; python_version >= 2.7\\ncomplex_req>=1.9; python_version >= \\"2.7\\" and python_version < \\"3.0\\"\\ncomplex_req<3.0.0,>=2.0; python_version == \\"3.4\\" or python_version == \\"3.5\\"\\n```\\n\\nThis teaches Pants about the universe of all the third-party dependencies your project uses. Pants will then use dependency inference to determine exactly which subset of your dependencies are used by each file. This allows a single repository (i.e. a monorepo) to safely package multiple wheels/binaries for their project using a single `pyproject.toml`, as opposed to having a unique requirements list for every package in their repo: Pants will use the proper subset of dependencies for each package, automatically.\\n\\nThe new Poetry support makes it [even easier to incrementally adopt Pants](https://www.pantsbuild.org/docs/existing-repositories) for Poetry users. Adopting Pants now no longer requires rewriting these requirements to a `requirements.txt` format and allows for consuming `project.toml` as-is. You can also keep using Poetry to update your 3rd-party dependencies (e.g. `poetry add`).\\n\\nYou can also teach Pants about your `poetry.lock` by running `poetry export` and pointing Pants to the generated file, ensuring that Pants uses the same pinned dependencies. (Note: Pants 2.7 will be getting more robust lockfile support).\\n\\nSee the [docs](https://www.pantsbuild.org/v2.6/docs/python-third-party-dependencies#poetry-integration) for how to get set up with Poetry.\\n\\n## My experience as an intern\\n\\nAs an intern developing a feature for Pants, I was surprised at how straightforward it was to introduce a Pants macro.\\n\\nAdding this functionality also highlighted how test-driven development can be extremely helpful, especially in instances where edge cases are very common. Having a firm idea about what cases need to be addressed and in what ways before development was something I already recognized, but I underestimated the value in having a concrete way to evaluate these cases prior to writing implementation details.\\n\\nWith this particular project, a handful of bugs slipped through as I wrote tests in batches. Consider parsing for a requirement in the dictionary form: within that, there are several sub-cases, like handling a git requirement, or handling a version. Each of those consists of a new set of edge cases, and I initially focused first on the finest grain of edge case. In doing this, I let a handful of broader-scale edge cases slip through, and had to patch several bugs as a result.\\n\\nIn retrospect, the better strategy would have been to work top-down, organizing each broad component, then after exhaustively addressing those cases, flesh out the stage below. In other words, considering the \\"feature\\" space as a m-ary tree, a breadth-first traversal makes more sense than a depth-first traversal when implementing a feature ridden with edge cases.\\n\\nLastly, I realized that having readable code is important not just for the feature itself, but also for test cases: deduplicating test cases (like using helper functions) can help highlight precisely what each test case addresses, which in turn can highlight gaps in coverage.\\n\\n## Conclusion\\n\\nI learned a great deal while implementing Poetry, and am very satisfied with my work. I hope you find the added feature helpful when adopting Pants.\\n\\nTry out Pants today with your Poetry project, and [let us know what you think in the Pants Slack](https://www.pantsbuild.org/docs/getting-help) !\\n\\n_NB: The Poetry integration goal requires Pants 2.6+. The latest release is 2.6.0rc4, with a stable release coming this week!_"},{"id":"/2021/06/28/pydev-of-the-week","metadata":{"permalink":"/blog/2021/06/28/pydev-of-the-week","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-06-28-pydev-of-the-week/index.mdx","source":"@site/blog/2021-06-28-pydev-of-the-week/index.mdx","title":"PyDev of the Week","description":"{/ truncate /}","date":"2021-06-28T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":0.3,"hasTruncateMarker":true,"authors":[{"name":"Carina C. Zona","title":"Pants Maintainer","url":"https://github.com/cczona","imageURL":"https://github.com/cczona.png","key":"cczona","page":null}],"frontMatter":{"authors":["cczona"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"Poetry support for Pants 2.6","permalink":"/blog/2021/07/29/poetry-support-for-pants-2-6"},"nextItem":{"title":"How we added Apple Silicon support to Pants","permalink":"/blog/2021/06/21/how-we-added-apple-silicon-support-to-pants"}},"content":"<CaptionedImg src={require(\\"./splash.png\\").default}></CaptionedImg>\\n\\n{/* truncate */}\\n\\nOne of the core Pants maintainers, Benjy Weinberger, was recently interviewed for the PyDev of the Week feature on the [Mouse vs Python blog](https://www.blog.pythonlibrary.org/)! Click through for more about the history of Pants, how Benjy came to be involved, his take on the project\'s strengths, and his favorite Python libraries..."},{"id":"/2021/06/21/how-we-added-apple-silicon-support-to-pants","metadata":{"permalink":"/blog/2021/06/21/how-we-added-apple-silicon-support-to-pants","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-06-21-how-we-added-apple-silicon-support-to-pants/index.mdx","source":"@site/blog/2021-06-21-how-we-added-apple-silicon-support-to-pants/index.mdx","title":"How we added Apple Silicon support to Pants","description":"Photo by [Thomas","date":"2021-06-21T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":4.75,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["announcement"]},"unlisted":false,"prevItem":{"title":"PyDev of the Week","permalink":"/blog/2021/06/28/pydev-of-the-week"},"nextItem":{"title":"Introducing Pants 2.5: Shell support, config autodiscovery, and incremental tool adoption","permalink":"/blog/2021/05/20/introducing-pants-2-5"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Thomas\\n  Ciszewski](https://unsplash.com/@coc6?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nSuccessful open source projects are full of tradeoffs between purity vs. pragmatism. We often remind ourselves \\"Do not let perfect be the enemy of good\\".\\n\\n{/* truncate */}\\n\\n---\\n\\n[Pants](https://www.pantsbuild.org) 2.5+ now supports Apple Silicon natively\u2014including the M1 processor on new MacBooks, Mac Minis, and iMacs\u2014without needing Rosetta.\\n\\n## Problem: Python native extensions\\n\\nPants is distributed as a Python program, but [with a native extension](https://www.pantsbuild.org/docs/how-does-pants-work) written in Rust for performance and parallelism. This native code means that we must distribute a distinct binary\u2014as a Python \\"wheel\\" file\u2014for every platform we support: Linux x86_64, macOS x86_64, and now macOS arm64.\\n\\n(It\'s also possible to release Python programs as an \\"sdist\\", where the user builds the native extension locally. However, Pants\'s Rust extension can take up to 15-25 minutes to build and it requires having modern Rust installed locally, so we do not yet distribute an sdist. Although, we do provide a way for motivated users [to build their own wheel](https://www.pantsbuild.org/docs/installation#building-pants-from-sources).)\\n\\nNormally, we could simply build the wheel with GitHub Actions, which is how we build for macOS x86*64 and Linux. However, GitHub Actions and other CI providers [do not \\\\_yet* support Apple Silicon](https://github.com/actions/virtual-environments/issues/2187).\\n\\n## Original workaround: Rosetta\\n\\nIt has been possible to run Pants using Rosetta (by running `arch -x86_64`). However, Pants is the ergonomic build system, and it should Just Work out of the box.\\n\\nWe also wanted to avoid the [performance hit](https://mjtsai.com/blog/2020/11/16/performance-of-rosetta-2-on-apple-m1/) from Rosetta, given that Pants aims to speed up your build experience.\\n\\n## Rejected solution: cross-compilation\\n\\nCross-compilation allows you to build a native binary for a platform different than the host platform, e.g. building for macOS ARM from macOS x86_64.\\n\\nRust has [strong support for cross-compilation](https://rust-lang.github.io/rustup/cross-compilation.html).\\n\\nHowever, cross-complication can be non-trivial. For example, the FFI library we use, [PyO3](https://pyo3.rs/v0.13.2/building_and_distribution.html#cross-compiling), requires a compiled Python interpreter for the target platform.\\n\\nWhile cross-compilation is promising, we decided to prioritize other project improvements instead of spending the time getting it working.\\n\\n## Solution: build locally\\n\\nInstead, we went with the simplest solution: build the Apple Silicon wheel locally with an M1 machine from one of our core contributors, rather than using CI.\\n\\nAdmittedly, this solution is not very sustainable in the long run: we are coupling our release process to a single contributor\'s machine, along with increasing the risk that a misconfigured developer machine results in an incompatible wheel.\\n\\n**However, successful open source projects are full of tradeoffs between purity vs. pragmatism. We often remind ourselves \\"Do not let perfect be the enemy of good\\"**, and we are passionate about prioritizing an excellent experience for users.\\n\\nHere, we can provide a much better experience for Apple Silicon users for little work, while we wait for the CI ecosystem to improve.\\n\\nWe took some steps to make this more sustainable:\\n\\n- Communicated with users that Apple Silicon support is \\"best-effort\\". The ARM wheel may take an extra 1-2 days to be published. This way, we do not ever block releases by having access to the contributor\'s M1 machine.\\n- [Expanded automation](https://github.com/pantsbuild/pants/pull/12229) of the build and publish process.\\n- Sign the wheel from the contributor\'s trusted machine.\\n\\nFurther, this situation is temporary: once GitHub Actions supports Apple Silicon, we will use CI to automate building ARM wheels.\\n\\n## Other challenges\\n\\n### Python 3.9+\\n\\nWhen we first started this project, only Python 3.9+ worked natively with Apple Silicon. (Since then, the newest versions of Python 3.8 [work too](https://bugs.python.org/issue41100).)\\n\\nThis meant that we had to first [update Pants](https://github.com/pantsbuild/pants/pull/11858) to be able to run with Python 3.9.\\n\\nEven though we currently release wheels for Python 3.7, 3.8, and 3.9 for Linux and macOS x86_64, we only release a wheel for Python 3.9 for macOS arm64.\\n\\n### Docker and Apple Silicon\\n\\nThe Docker team has done an amazing job bringing native support to Apple Silicon.\\n\\nUnfortunately, however, Docker on Apple Silicon is fundamentally [not able to support the `inotify` syscall](https://github.com/docker/for-mac/issues/5321) for amd64 containers, which is used for file watching. Pants uses the Rust `notify` crate, which relies on this syscall, so that it knows when to invalidate builds due to changes on the filesystem. File watching is particularly important for the Pants daemon (pantsd) to safely memoize work across multiple Pants runs.\\n\\nTo work around this limitation, we added an option `--no-watch-filesystem` to Pants 2.6+ to disable file watching. We only allow you to disable file watching if you also disable the Pants daemon. There is a small risk that changing files halfway during a Pants run may invalidate the build and require you to re-run the command. However, this situation is unlikely when using Docker because it would be unusual to make edits to your code mid-run. So, we made a pragmatic choice to unblock using Pants with Docker on Apple Silicon.\\n\\n## Try out Pants\\n\\nRegardless of whether you use Apple Silicon, try out how Pants makes working on repositories with Python or Shell code a joy, even as they grow:\\n\\n- [Video tour](https://www.youtube.com/watch?v=maK3_Ix5Z4I&list=PLwPRXwjURiOzXjgqydxZE9RVjZqaB6OXb)\\n- [Docs](https://www.pantsbuild.org/docs)\\n- [Example Python repository](https://github.com/pantsbuild/example-python)\\n- [Slack](https://www.pantsbuild.org/docs/getting-help#slack)"},{"id":"/2021/05/20/introducing-pants-2-5","metadata":{"permalink":"/blog/2021/05/20/introducing-pants-2-5","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-05-20-introducing-pants-2-5/index.mdx","source":"@site/blog/2021-05-20-introducing-pants-2-5/index.mdx","title":"Introducing Pants 2.5: Shell support, config autodiscovery, and incremental tool adoption","description":"Photo by [Giulia","date":"2021-05-20T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":4.31,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["announcement"]},"unlisted":false,"prevItem":{"title":"How we added Apple Silicon support to Pants","permalink":"/blog/2021/06/21/how-we-added-apple-silicon-support-to-pants"},"nextItem":{"title":"It\'s PyCon US Time!","permalink":"/blog/2021/05/12/pycon_us_2021"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Giulia\\n  May](https://unsplash.com/@giuliamay?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nWe\'re pleased to announce Pants 2.5.0, the latest release of Pants, the scalable and ergonomic build system.\\n\\nTo update, set `pants_version = \\"2.5.0\\"` in your `pants.toml`. See [upgrade tips](https://www.pantsbuild.org/docs/upgrade-tips).\\n\\n## Shell support\\n\\nPants now supports Shell (e.g. Bash), in addition to Python!\\n\\nOur goal is to empower you to follow best practices with your Shell scripts:\\n\\n- [Shellcheck](https://www.shellcheck.net/): lint for common Shell mistakes.\\n- [shfmt](https://github.com/mvdan/sh): autoformat Shell code so that you can instead focus on the logic.\\n- [shUnit2](https://github.com/kward/shunit2/): write light-weight unit tests for your Shell code.\\n\\nPants installs these tools for you deterministically, and integrates them into the workflows you already use with Pants: `./pants lint`, `./pants fmt`, and `./pants test`.\\n\\nPants will run these tools concurrently with your Python builds. For example, you can lint your Shell scripts at the same time as linting your Python code (Flake8, Black, etc.), all with a single consistent interface: `./pants lint ::`.\\n\\n![](./shell-support.png)\\n\\nSee [https://www.pantsbuild.org/docs/shell](https://www.pantsbuild.org/docs/shell) for how to get started with Shell.\\n\\n## Config autodiscovery\\n\\nPants will now autodiscover config files for the tools you run\u2014like Black, isort, and Pytest\u2014using the same semantics that the tools themselves use.\\n\\nIf your config file is in a non-standard location, you can still set options like `[black].config` and `[flake8].config` for Pants to tell the tools to load the config.\\n\\n## Incremental tool adoption\\n\\nYou can now tell Pants to skip running a particular tool on specific files by updating the corresponding `BUILD` file.\\n\\n```python title=\\"helloworld/BUILD\\"\\n# Skip Black and Flake8 for all the non-test files in this folder.\\npython_library(skip_black=True, skip_flake8=True)\\n\\n# Skip isort for all the test files in this folder.\\npython_tests(name=\\"tests\\", skip_isort=True)\\n```\\n\\nPants will still run that tool on everything else, and will still run all your other tools on the skipped file.\\n\\nThis feature gives you a consistent mechanism to adopt tools like MyPy and Flake8 incrementally, regardless of how large your repository becomes.\\n\\n<iframe\\n  width=\\"100%\\"\\n  height=\\"500\\"\\n  src=\\"https://www.youtube.com/embed/BOhcdRsmv0s?si=Dl2IDI8QqJnGvQ9H\\"\\n  title=\\"YouTube video player\\"\\n  frameborder=\\"0\\"\\n  allow=\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\\"\\n  allowfullscreen\\n></iframe>\\n\\n## Fine-grained resolves without a performance hit\\n\\nUnlike most Python workflows (e.g. Poetry, Pipenv, `virtualenv`) that use a single virtual environment for the entire project, Pants understands your file\'s transitive dependencies and only uses what is actually needed for that file to run.\\n\\n```shell-session\\n$ ./pants dependencies --transitive --type=3rdparty project/tests.py\\nansicolors==1.1.8\\ntyping-extensions==3.7.4.3\\n```\\n\\n<figcaption>\\n  The `./pants dependencies` goal shows what exactly each file depends on. See\\n  https://www.pantsbuild.org/docs/project-introspection.\\n</figcaption>\\n\\nFine-grained resolves give you fine-grained caching, meaning that when you change your `requirements.txt`, for example, you only need to rerun tests whose requirements have changed, rather than needing to rerun your whole test suite. Fine-grained resolves also mean that Pants can [build artifacts like PEX files and wheels](https://www.pantsbuild.org/docs/python-package-goal) and use only that code\'s true dependencies, rather than the whole virtual environment.\\n\\nHowever, these fine-grained resolves previously introduced a performance issue: resolving from PyPI and building wheels is extremely slow, and it\'s painful to do this for every permutation of your requirements used in the project. So, Pants had an option to use a single virtual environment, but you would lose the benefits of fine-grained resolves.\\n\\nNow, Pants knows how to get the best of both worlds by resolving your dependencies only once, and then subsetting that resolve to extract only the requirements you actually need. If you use a global constraints file with `[python-setup].requirement_constraints`, Pants will first resolve all those dependencies once, downloading them and building their wheels. Then, Pants uses a new feature from PEX to extract the relevant subsets of that single resolve.\\n\\nThis change means that when you update your `requirements.txt` or `constraints.txt`, only the tests that actually use those requirements will be invalidated with Pants\'s cache\u2014without needing to redownload and build wheels multiple times.\\n\\n## Other changes\\n\\n- Pants can now run with Python 3.9, in addition to 3.7 and 3.8. (Your own code can use a different Python version).\\n- Setting `[isort].config` will now tell isort to load the config file (when safe to do so), meaning that custom config file locations now work without needing to set `[isort].args`.\\n- `[coverage-py]` config files now work with `pyproject.toml`, `setup.cfg`, and `tox.ini`.\\n- `python_tests` targets have a new field `extra_env_vars` to augment the option `[test].extra_env_vars`.\\n- Added `RuleRunner.write_files()` for more declarative tests of Pants plugins.\\n\\nSee the full [changelog](https://github.com/pantsbuild/pants/blob/release_2.5.0/src/python/pants/notes/2.5.x.md) for more changes.\\n\\n## Upcoming in Pants 2.6\\n\\nWe\'re re-envisioning Pants\'s support for Python third-party dependencies to be more ergonomic, flexible, and safe, including:\\n\\n- Autogenerating lockfiles.\\n- Adding dedicated lockfiles for each tool you run, e.g. Black and Flake8.\\n- Supporting multiple lockfiles for your repository."},{"id":"/2021/05/12/pycon_us_2021","metadata":{"permalink":"/blog/2021/05/12/pycon_us_2021","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-05-12-pycon_us_2021/index.mdx","source":"@site/blog/2021-05-12-pycon_us_2021/index.mdx","title":"It\'s PyCon US Time!","description":"Photo by [Marcos Luiz","date":"2021-05-12T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":1.14,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"Introducing Pants 2.5: Shell support, config autodiscovery, and incremental tool adoption","permalink":"/blog/2021/05/20/introducing-pants-2-5"},"nextItem":{"title":"Introducing Pants Build 2.4.0","permalink":"/blog/2021/04/30/introducing-pants-build-2-4-0"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Marcos Luiz\\n  Photograph](https://unsplash.com/@marcosjluiz?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nPyCon US, the largest Python conference in the world, is getting under way (online-only this year), and Pants has a strong presence this year!\\n\\n- On Friday at 9:15 AM PDT Pants contributor [Benjy Weinberger](https://twitter.com/benjy) (that\'s me!) will be speaking about some of the cool and unusual ways we leverage Python in the Pants execution engine, in \\"Creating extensible workflows with off-label use of Python\\".\\n- On Friday at 1:00 PM PDT Pants contributor [Eric Arellano](https://twitter.com/EArellanoAZ) will be speaking, in Spanish, about our experience interoperating Python and Rust, in \\"Cu\xe1ndo usar extensiones nativas en Rust: rendimiento accesible y seguro\\".\\n- On both Friday and Saturday from 11:00-12:00 PDT we\'ll be demoing \\"Fast, Friendly Python Builds With Pants\\" in the virtual expo hall.\\n\\nYou can still register for the conference [here](https://us.pycon.org/2021/registration/information/). It\'s only $100 for an individual registration or $150 for a corporate registration, and proceeds benefit the Python Software Foundation. Perhaps your employer will reimburse the cost of a ticket?\\n\\nPlease tell your friends and co-workers about our talks and demos, and come find us online at the conference!"},{"id":"/2021/04/30/introducing-pants-build-2-4-0","metadata":{"permalink":"/blog/2021/04/30/introducing-pants-build-2-4-0","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-04-30-introducing-pants-build-2-4-0/index.mdx","source":"@site/blog/2021-04-30-introducing-pants-build-2-4-0/index.mdx","title":"Introducing Pants Build 2.4.0","description":"Photo by [Nicholas","date":"2021-04-30T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":1.46,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["announcement","python"]},"unlisted":false,"prevItem":{"title":"It\'s PyCon US Time!","permalink":"/blog/2021/05/12/pycon_us_2021"},"nextItem":{"title":"Monorepos and performance: Pants Build maintainer Benjy Weinberger\'s conversation with SemaphoreCI","permalink":"/blog/2021/04/21/monorepos-and-performance"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Nicholas\\n  Cappello](https://unsplash.com/@bash__profile?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nThe [latest stable release](https://pypi.org/project/pantsbuild.pants/2.4.0/) of Pants is out!\\n\\nThis version introduces opt-in [anonymous telemetry](https://www.pantsbuild.org/docs/anonymous-telemetry), to provide the Pants maintainers with data to help detect and fix bugs and drive development decisions. We\'ve gone to great lengths to ensure that the data is fully anonymized (see link for details) and we hope you\'ll choose to opt in.\\n\\nOther notable new features and bugfixes include:\\n\\n- A warning when an inferred dependency is [skipped due to ambiguity](https://github.com/pantsbuild/pants/pull/11792), and allowing the ambiguity to be resolved by explicitly including or excluding dependency choices.\\n- Enabled use of Pytest plugins that write output to files, \xa0such as [`pytest-html`](https://pypi.org/project/pytest-html/).\\n- [Support](https://www.pantsbuild.org/docs/python-test-goal) for Pytest config files (e.g. `pytest.ini`).\\n- A `--stats-log` option for insights on cache behavior.\\n- A [default](https://github.com/pantsbuild/pants/issues/11634) [`module_mapping`](https://github.com/pantsbuild/pants/issues/11634) for Python 3rd party dependency inference. Previously, when a 3rdparty top-level package name was not the same as the distribution name (such as `pkg_resources` being provided by `setuptools`), you had to provide explicit mapping information. Now Pants can handle many such common cases automatically.\\n- Fixed an issue that could in some cases prevent code-generated sources from having valid source roots.\\n\\nTry out Pants 2.4.0 today! We\'d [love to hear from you](https://www.pantsbuild.org/docs/getting-help) with any impressions, opinions, questions and bug reports.\\n\\nThanks to everyone who contributed to the 2.4.0 release. Now, onward to 2.5.0!"},{"id":"/2021/04/21/monorepos-and-performance","metadata":{"permalink":"/blog/2021/04/21/monorepos-and-performance","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-04-21-monorepos-and-performance/index.mdx","source":"@site/blog/2021-04-21-monorepos-and-performance/index.mdx","title":"Monorepos and performance: Pants Build maintainer Benjy Weinberger\'s conversation with SemaphoreCI","description":"Photo by [Will","date":"2021-04-21T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":2.49,"hasTruncateMarker":true,"authors":[{"name":"Carina C. Zona","title":"Pants Maintainer","url":"https://github.com/cczona","imageURL":"https://github.com/cczona.png","key":"cczona","page":null}],"frontMatter":{"authors":["cczona"],"tags":["community","python"]},"unlisted":false,"prevItem":{"title":"Introducing Pants Build 2.4.0","permalink":"/blog/2021/04/30/introducing-pants-build-2-4-0"},"nextItem":{"title":"Introducing Pants Build 2.3.0","permalink":"/blog/2021/03/22/introducing-pants-2-3-0"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Will\\n  Francis](https://unsplash.com/@willfrancis?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nThere are many benefits of using a monorepo. Among them, cleaner code, enhanced communication, and easier collaboration. _The codebase can scale._ The big catch is performance. If the experience of performance deteriorates for developers or deployers, that deservedly gets firm pushback. The processes and systems we use with monorepos are crucial for fulfilling the promise of monorepo benefits.\\n\\nIn this new [April 2021 conversation with SemaphoreCI](https://semaphoreci.com/blog/monorepo-building-at-scale), long-time Pants Build maintainer Benjy Weinberger discusses some of the key ways Pants ensures snappy performance throughout the stages of developing, building, and deploying from a monorepo.\\n\\n### Ergonomic design priorities\\n\\n> We\'ve put a lot of energy into making it much, much, much easier to adopt this kind of system than it\'s ever been, and that continues to be an active area of work for us because we will not rest until it is really, really easy.\\n\\n### Dependency inference\\n\\n> The first and probably most important one is [dependency inference](../2020-10-29-dependency-inference/index.mdx). So unlike other tools, we do not require you to explicitly enumerate your dependencies in those build metadata files if we can infer them from your import statements. Occasionally, there\'s a dependency you can\'t infer. Sometimes you load code by name at runtime or you depend on assets that are not imported. There are cases like that, and in those cases you have to potentially manually add those dependencies. But 99% of the time you don\'t.\\n>\\n> And also, that logic is itself [pluggable](https://www.pantsbuild.org/docs/plugins-overview), the dependency inference logic.\\n\\n### Sensible defaults\\n\\n> When you declare this directory contains a Python library, or a bunch of Python tests, or whatever, Pants knows that tests are typically called \\\\`test_something\\\\`, or \\\\`something_test\\\\`, or \\\\`test.py\\\\`, or \\\\`conftest.py\\\\` for configuration. So it knows that, and it knows that everything else that ends in \\\\`.py\\\\` or \\\\`.pyi\\\\` is a library or so on.\\n\\n### Eliminate BUILD file clutter with `tailor`\\n\\n> [Tailor](../2021-03-19-tailoring-pants-to-your-codebase/index.mdx) helps you make your \'pants\'. Tailor basically generates build files by looking at what files you have. And it\'s idempotent, so you can just keep running it as you go and it will add new build metadata as it goes.\\n\\nYou can listen to, or read, the whole episode at [https://semaphoreci.com/blog/monorepo-building-at-scale](https://semaphoreci.com/blog/monorepo-building-at-scale).\\n\\n---\\n\\n### Pants documentation\\n\\n\u2022 [How does Pants work?](https://www.pantsbuild.org/docs/how-does-pants-work)\\n\\n\u2022 [An intro to the Pants engine\'s core concepts](https://www.pantsbuild.org/docs/plugins-overview).\\n\\n\u2022 [Dependencies and dependency inference.](https://www.pantsbuild.org/docs/targets#dependencies-and-dependency-inference)\\n\\n### Learn more about Pants\\n\\n\u2022 [What is monorepo? (And should you use it?)](https://semaphoreci.com/blog/what-is-monorepo)\\n\\n\u2022 [How the Pants build systems leverages Python 3 features.](https://www.youtube.com/watch?v=mLyW6oAExW0)"},{"id":"/2021/03/22/introducing-pants-2-3-0","metadata":{"permalink":"/blog/2021/03/22/introducing-pants-2-3-0","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-03-22-introducing-pants-2-3-0/index.mdx","source":"@site/blog/2021-03-22-introducing-pants-2-3-0/index.mdx","title":"Introducing Pants Build 2.3.0","description":"Photo by [Darling","date":"2021-03-22T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":0.8,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["announcement","python"]},"unlisted":false,"prevItem":{"title":"Monorepos and performance: Pants Build maintainer Benjy Weinberger\'s conversation with SemaphoreCI","permalink":"/blog/2021/04/21/monorepos-and-performance"},"nextItem":{"title":"Tailoring Pants to your codebase","permalink":"/blog/2021/03/19/tailoring-pants-to-your-codebase"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Darling\\n  Arias](https://unsplash.com/@darlingarias?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nI\'m psyched to announce that the [latest stable release](https://pypi.org/project/pantsbuild.pants/) of the Pants Build System, 2.3.0, is out now.\\n\\nA major highlight of this release is the `tailor` goal, which [generates BUILD file boilerplate for you](../2021-03-19-tailoring-pants-to-your-codebase/index.mdx)! This makes getting Pants up and running in existing repos a lot easier, as well as streamlining ongoing metadata maintenance.\\n\\nThis release also provides performance improvements and better remote caching support. For more detail, see the [release notes](https://www.pantsbuild.org/docs/release-notes-2-3). And see [here](https://www.pantsbuild.org/) for how to get started with Pants, including how to connect with the Pants Build community. It\'s easier than ever!\\n\\nThanks to everyone that contributed changes to this new release!"},{"id":"/2021/03/19/tailoring-pants-to-your-codebase","metadata":{"permalink":"/blog/2021/03/19/tailoring-pants-to-your-codebase","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-03-19-tailoring-pants-to-your-codebase/index.mdx","source":"@site/blog/2021-03-19-tailoring-pants-to-your-codebase/index.mdx","title":"Tailoring Pants to your codebase","description":"Photo by [Yasamine","date":"2021-03-19T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":3.81,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["announcement"]},"unlisted":false,"prevItem":{"title":"Introducing Pants Build 2.3.0","permalink":"/blog/2021/03/22/introducing-pants-2-3-0"},"nextItem":{"title":"Pants 2.2 adds dependency inference for Protobuf","permalink":"/blog/2021/02/22/pants-2-2-adds-dependency-inference-for-protobuf"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Yasamine\\n  June](https://unsplash.com/@yasamine?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\n**TL;DR The `tailor` goal, newly available in Pants 2.3.0, generates BUILD file boilerplate for you, making adopting Pants easier than ever!**\\n\\nPants is a powerful system that brings speed and stability to your builds thanks to features such as fine-grained invalidation, caching, and concurrent execution.\\n\\nThese features rely on metadata that describes your code and its dependencies. So, as with other build systems, the price you pay for scalability and performance is having to maintain metadata about your code, in the form of [BUILD files](https://www.pantsbuild.org/docs/targets).\\n\\nCreating and updating BUILD files can be quite a chore, especially when first integrating Pants into an existing repo. And a key goal of the Pants Build project is to make users\' lives easier, not harder! \xa0To achieve this goal we\'ve made several ongoing efforts to minimize the burden of creating and maintaining this metadata.\\n\\n## Reducing the BUILD maintenance burden\\n\\nOne way we cut down on BUILD boilerplate is by giving fields in target definitions sensible default values where possible.\\n\\nSo, for example, consider this target:\\n\\n```python caption=\\"src/python/rentacar/models/BUILD - very verbose\\"\\npython_library(\\n  name = \\"models\\",\\n  sources = [\\"car.py\\", \\"driver.py\\", \\"agreement.py\\", \\"insurance.py\\"],\\n  dependencies = [\\n    \\"src/python/rentacar/base\\",\\n    \\"src/python/rentacar/util\\",\\n  ]\\n)\\n```\\n\\nIt can actually be written more succinctly as:\\n\\n```python caption=\\"src/python/rentacar/models/BUILD - more succinct\\"\\npython_library(\\n  dependencies = [\\n    \\"src/python/rentacar/base\\",\\n    \\"src/python/rentacar/util\\",\\n  ]\\n)\\n```\\n\\nbecause the `name` field defaults to the directory name, and the `sources` field for a `python_library` defaults to `*.py` (minus test files such as `*_test.py`)_._ These defaults have been available all the way back to early versions of Pants 1.x.\\n\\nBut in Pants 2.x that same target can be written _even more_ succinctly as:\\n\\n```python caption=\\"src/python/rentacar/models/BUILD - very succinct\\"\\npython_library()\\n```\\n\\nthanks to [dependency inference](https://www.pantsbuild.org/docs/targets#dependencies-and-dependency-inference), which infers the dependencies at runtime based on `import` statements in the source files. Sometimes you do have to manually add dependencies that can\'t be inferred, but those are usually the exception.\\n\\nSo Pants 2.x BUILD files can be very concise, but you do still need to provide at least those trivial target definitions. \xa0And that can be a bit of a hassle.\\n\\nWell now, in Pants 2.3.0, you can use the aptly-named `tailor` goal to generate that remaining BUILD file boilerplate, hassle-free!\\n\\nBecause, you know, a tailor makes your pants fit? I\'ll show myself out...\\n\\n## How it works\\n\\nYou run\\n\\n```\\n./pants tailor\\n```\\n\\nThat\'s it. It\'s that simple!\\n\\nWhen you run the `tailor` goal, Pants will scan your repo for file types it recognizes that don\'t belong to existing targets, and create new targets for them, either appending to existing BUILD files or creating new ones as needed.\\n\\nFor example, if Pants sees the following files in a directory with no BUILD file:\\n\\n```text caption=\\"src/python/rentacar/models\\"\\nagreement.py\\nagreement_test.py\\ncar.py\\ndriver.py\\ndriver_test.py\\ninsurance.py\\nmodels.proto\\nbase.proto\\n```\\n\\nthen it\'ll generate the following BUILD file:\\n\\n```python caption=\\"src/python/rentacar/models/BUILD - generated\\"\\npython_library()\\n\\npython_tests(name=\\"tests\\")\\n\\nprotobuf_library()\\n\\n```\\n\\nIf there was an existing BUILD file in the directory, and some of the files were already owned by targets in that BUILD file, then `tailor` will append targets that cover just the unowned files.\\n\\nThe `tailor` goal tries to generate targets that rely on default values when it can, but it has mechanisms to prevent naming collisions or sources overlapping across multiple targets. So it will give a target an explicit name, or enumerate its sources, if it must.\\n\\nImportantly, `tailor` _never_ modifies existing targets, so you can run it safely without impacting existing metadata.\\n\\n`tailor` works hand-in-hand with dependency inference - generated targets would be of very limited use use if you then had to manually stitch them together by adding dependencies everywhere.\\n\\n`tailor` may not do the right thing in _every_ case, but that\'s OK - you can tweak the generated metadata manually before checking it into the repo.\\n\\nThe `tailor` goal is exceptionally useful for new repos integrating Pants: you can generate the BUILD file scaffolding and get started in minutes. But you can also run `tailor` in an ongoing way: as your repo grows and changes, re-run `./pants tailor` to ensure that your BUILD files keep up.\\n\\nSo give Pants 2.3.0 and `tailor` a whirl - you may find that it\'s a perfect fit for your repo!"},{"id":"/2021/02/22/pants-2-2-adds-dependency-inference-for-protobuf","metadata":{"permalink":"/blog/2021/02/22/pants-2-2-adds-dependency-inference-for-protobuf","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-02-22-pants-2-2-adds-dependency-inference-for-protobuf/index.mdx","source":"@site/blog/2021-02-22-pants-2-2-adds-dependency-inference-for-protobuf/index.mdx","title":"Pants 2.2 adds dependency inference for Protobuf","description":"Photo by [Simon","date":"2021-02-22T00:00:00.000Z","tags":[{"inline":true,"label":"codegen","permalink":"/blog/tags/codegen"}],"readingTime":3.15,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["codegen"]},"unlisted":false,"prevItem":{"title":"Tailoring Pants to your codebase","permalink":"/blog/2021/03/19/tailoring-pants-to-your-codebase"},"nextItem":{"title":"fast-incremental-builds-speculation-cancellation","permalink":"/blog/2021/02/01/fast-incremental-builds-speculation-cancellation"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Simon\\n  Wilkes](https://unsplash.com/@simonfromengland?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nAs of Pants 2.2, Pants now knows how to use dependency inference with Protobuf! This includes:\\n\\n1. Protobuf imports of other Protobuf files\\n2. Python imports of generated Protobuf code, including gRPC.\\n\\n{/* truncate */}\\n\\n---\\n\\nAs discussed [in our post on dependency inference](../2020-10-29-dependency-inference/index.mdx), Pants understands which files depend on which to offer fine-grained caching. If none of the inputs have changed, Pants can safely cache your builds like running tests and generating code.\\n\\nWith conventional scalable build tools, this fine-grained invalidation requires substantial boilerplate: maintaining BUILD files that explicitly declare every dependency. Instead, Pants uses _dependency inference_ to reduce this boilerplate by up to 90% by reading your code and figuring out the dependencies for you.\\n\\nAs of Pants 2.2, Pants now knows how to use dependency inference with [Protobuf](https://developers.google.com/protocol-buffers/)! This includes:\\n\\n- Protobuf imports of other Protobuf files.\\n- Python imports of generated Protobuf code, including gRPC.\\n\\nWhile Pants currently only generates code with Protobuf, we are eager to work with [community members](https://www.pantsbuild.org/docs/community) to support other protocols like Apache Thrift.\\n\\n---\\n\\n### WTH is Pants?\\n\\nPants is a scalable build tool, meaning that it orchestrates the tools you use in a modern Python repository, like Black, Pytest, Protoc (Protobufs), and setuptools. Pants will run these and many other tools concurrently, and brings fine-grained caching with minimal boilerplate, including as your codebase scales up in size.\\n\\nSee [our blog post introducting Pants v2/](../2020-10-27-introducing-pants-v2/index.mdx).\\n\\n---\\n\\n## How it works\\n\\nPants will first look at your repository\'s code layout and your Protobuf and Python file names to develop a global mapping. For example, we know that `protos/project/models.proto` corresponds to the Protobuf import `project/models.proto` and the Python modules `project.models_pb2` and (possibly) `project.models_pb2_grpc`.\\n\\nWith this global mapping computed, Pants then parses the relevant files to extract their import statements and look up the corresponding owner, if any.\\n\\nFor example, given this Proto:\\n\\n```protobuf\\n// protos/build/remote/execution/remote_execution.proto\\npackage build.remote.execution;\\n\\nimport \\"build/semver/semver.proto\\";\\nimport \\"google/api/annotations.proto\\";\\nimport \\"google/rpc/status.proto\\";\\nimport \\"google/protobuf/duration.proto\\";\\n```\\n\\nPants infers dependencies on the correct Protobuf files:\\n\\n```shell-session\\n$ ./pants dependencies protos/build/remote/execution/remote_execution.proto\\nprotos/build/semver/semver.proto\\nprotos/google/api/annotations.proto\\nprotos/google/rpc/status.proto\\nprotos/google/protobuf/duration.proto\\n```\\n\\nPants will also understand Python imports of these Protobuf files, normalizing their full paths into Python module names:\\n\\n```python\\n# src/py/project/app.py\\nimport build.semver.semver_pb2\\nimport google.api.annotations_pb2_grpc\\n```\\n\\n```shell-session\\n$ ./pants dependencies src/py/project/app.py\\nprotos/build/semver/semver.proto\\nprotos/google/api/annotations.proto\\n```\\n\\nAs discussed in [our post on Pants\'s performance](../2021-02-01-fast-incremental-builds-speculation-cancellation/index.mdx), this inference is 1) very safe and 2) very fast. Because Pants invokes processes hermetically with a sandbox, failing to infer a dependency can never cause the wrong thing to be cached. Further, the inference is fast thanks to Pants\'s core being implemented in Rust, along with a daemon, parallelism, and very fine-grained invalidation.\\n\\n## Trying out Pants\\n\\nUsing Pants ensures that your builds always use your up-to-date Protobuf code\u2014no more need to manually invoke scripts! Further, thanks to Pants\'s fine-grained understanding of your project\'s dependencies, you will only ever generate the Protobuf files you actually need.\\n\\nWe optimized Pants to be easy to [add incrementally to existing repositories](https://www.pantsbuild.org/docs/existing-repositories), including an upcoming feature in Pants 2.3 to auto-generate BUILD files (stay tuned for a blog post!).\\n\\nThe [Pants community](https://www.pantsbuild.org/docs/community) would love to help you get started. [www.pantsbuild.org/docs](https://www.pantsbuild.org/v2.1/docs)"},{"id":"/2021/02/01/fast-incremental-builds-speculation-cancellation","metadata":{"permalink":"/blog/2021/02/01/fast-incremental-builds-speculation-cancellation","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-02-01-fast-incremental-builds-speculation-cancellation/index.mdx","source":"@site/blog/2021-02-01-fast-incremental-builds-speculation-cancellation/index.mdx","title":"fast-incremental-builds-speculation-cancellation","description":"Photo by [Craventure","date":"2021-02-01T00:00:00.000Z","tags":[{"inline":true,"label":"under-the-hood","permalink":"/blog/tags/under-the-hood"}],"readingTime":12.24,"hasTruncateMarker":true,"authors":[{"name":"Stu Hood","title":"Pants Maintainer","url":"https://github.com/stuhood","imageURL":"https://github.com/stuhood.png","key":"stu","page":null}],"frontMatter":{"authors":["stu"],"tags":["under-the-hood"]},"unlisted":false,"prevItem":{"title":"Pants 2.2 adds dependency inference for Protobuf","permalink":"/blog/2021/02/22/pants-2-2-adds-dependency-inference-for-protobuf"},"nextItem":{"title":"Talking Pants","permalink":"/blog/2020/11/25/talking-pants"}},"content":"import { Chart } from \\"react-google-charts\\";\\n\\nexport const chartColumns = [\\n  { type: \\"string\\", label: \\"Task ID\\" },\\n  { type: \\"string\\", label: \\"Task Name\\" },\\n  { type: \\"string\\", label: \\"Resource\\" },\\n  { type: \\"date\\", label: \\"Start Date\\" },\\n  { type: \\"date\\", label: \\"End Date\\" },\\n  { type: \\"number\\", label: \\"Duration\\" },\\n  { type: \\"number\\", label: \\"Percent Complete\\" },\\n  { type: \\"string\\", label: \\"Dependencies\\" },\\n];\\n\\nexport const chartOptions = {\\n  width: \\"720px\\",\\n  height: \\"210px\\",\\n  gantt: {\\n    criticalPathEnabled: false,\\n  },\\n};\\n\\nexport const withoutSpeculativeExecution = [\\n  [\\"run\\", \\"Run tests\\", \\"run\\", new Date(2021, 1, 1), null, 301, 0, null],\\n  [\\n    \\"capture\\",\\n    \\"Capture sources\\",\\n    \\"capture\\",\\n    new Date(2021, 1, 1),\\n    null,\\n    13,\\n    0,\\n    null,\\n  ],\\n  [\\"extract\\", \\"Extract imports\\", \\"extract\\", null, null, 26, 0, \\"capture\\"],\\n  [\\n    \\"sandbox\\",\\n    \\"Prepare test sandbox\\",\\n    \\"sandbox\\",\\n    null,\\n    null,\\n    57,\\n    0,\\n    \\"capture,extract\\",\\n  ],\\n  [\\"execute\\", \\"Execute test\\", \\"execute\\", null, null, 205, 0, \\"sandbox\\"],\\n];\\n\\nexport const withSpeculativeExecution = [\\n  [\\"run\\", \\"Run tests\\", \\"run\\", new Date(2021, 1, 1), null, 301, 0, null],\\n  [\\n    \\"capture\\",\\n    \\"Capture sources\\",\\n    \\"capture\\",\\n    new Date(2021, 1, 1),\\n    null,\\n    13,\\n    0,\\n    null,\\n  ],\\n  [\\n    \\"extract\\",\\n    \\"Extract imports\\",\\n    \\"extract\\",\\n    new Date(2021, 1, 1),\\n    null,\\n    26,\\n    0,\\n    null,\\n  ],\\n  [\\n    \\"sandbox\\",\\n    \\"Prepare test sandbox\\",\\n    \\"sandbox\\",\\n    new Date(2021, 1, 1),\\n    null,\\n    57,\\n    0,\\n    null,\\n  ],\\n  [\\n    \\"execute\\",\\n    \\"Execute test\\",\\n    \\"execute\\",\\n    null,\\n    null,\\n    205,\\n    0,\\n    \\"capture,extract,sandbox\\",\\n  ],\\n];\\n\\n# Fast Incremental Builds with Speculation and Cancellation\\n\\n<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Craventure\\n  Media](https://unsplash.com/@craventure?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nFast incremental re-builds are critical in large codebases and monorepos. Thanks to deep support for cancellation and a side-effect free execution model, Pants is able to further reduce re-build latency by speculatively re-executing work.\\n\\n{/* truncate */}\\n\\n## Overview\\n\\nBecause they decouple your iteration time from the total size of your codebase, fast incremental re-builds are critical in large codebases and monorepos. As discussed in [our post about dependency inference](../2020-10-29-dependency-inference/index.mdx), having fine-grained dependency information reduces the amount of work that is invalidated after an edit by ignoring irrelevant changes.\\n\\nBut modern build tools are also able to avoid wasted work when a file that your build depends on _has_ (maybe!) changed. And thanks to its deep support for cancellation and side-effect free execution model, [Pants](https://www.pantsbuild.org/) is able to further reduce re-build latency by speculatively re-executing work!\\n\\n## Cleaning and Early Cutoff\\n\\nIn many cases while building your code, files will change in ways that don\'t actually affect the outcome of the build. Common examples are cases like changing comments in compiled or code-generated languages (Java and Protobuf, for example), or touching files on disk without actually editing their contents. In these cases, avoiding running the dependent compiles or other logic is a significant benefit.\\n\\nPants uses SHA256 hashing and deep equality to determine whether `@rules` (used to write [build logic in Pants](https://www.pantsbuild.org/docs/rules-api-concepts)) and processes need to re-run, but because build processes should always be deterministic, we can more quickly provide incremental results in these cases. To do so, Pants supports what the [Build Systems \xe0 la Carte](https://www.microsoft.com/en-us/research/uploads/prod/2018/03/build-systems.pdf) paper calls \\"early cutoff\\".\\n\\nEarly cutoff (also known as \\"cleaning\\") is implemented in Pants by deciding whether to re-run an `@rule` (after a file that it depends on -- likely indirectly -- has changed on disk) by comparing a record of previous \\"generation\\" values for each dependency `@rule` to up-to-date generation values. This generation value is incremented each time the previous output value of a `@rule` is not identical to its new output value: it acts as a very memory efficient record of which versions of its dependencies an `@rule` used. When the generation values of all of an `@rule`s dependencies are equal to those from its previous run, we know that it does not need to re-run, and that its previous output value is still valid. When `@rule`s are cleaned this way, it\'s very likely that their dependents in the graph will be cleaned as well, which \\"cuts off\\" the need to run any `@rule` logic, dramatically reducing runtime.\\n\\nPants\' dependency inference (for Python; elsewhere soon!) also presents a really useful case for early cutoff. Dependency inference extracts import statements from the content of individual files, but while editing your code, the vast majority of your edits to files will be to non-import statements. This means that the dependency inference `@rule`s will very frequently trigger early cutoff!\\n\\n## Data Dependencies\\n\\nBut the combination of dependency inference and cleaning is interesting for another reason: because the dependencies of your code fundamentally drive \\"which\\" `@rule` logic needs to run (\\"what do I need to compile before compiling this module?\\", \\"which files need to be in the sandbox for this test?\\", etc), the output of the dependency inference `@rule`s will very frequently be a [data dependency](https://en.wikipedia.org/wiki/Data_dependency) of other `@rule` logic \u2026 and dependency inference represents a very fundamental data dependency!\\n\\nNeil Mitchell\'s [excellent blog post on the topic of dependencies in build systems](https://neilmitchell.blogspot.com/2020/11/data-types-for-build-system-dependencies.html) introduces a particularly costly example of ignoring a data dependency: a computed \\"is_optimized\\" flag might fundamentally affect which (and how much!) work needs to be done in a build. If between two builds, the computed value of `is_optimized` changes from `True` to `False` (potentially representing an order of magnitude difference in runtime), it\'s particularly critical that a user does not need to wait for the stale result before the updated result is computed.\\n\\nPants\' monadic plugin API allows `@rule` authors to write natural, seemingly imperative code. But as described in Mitchell\'s post, the existence of data dependencies between `@rule` outputs in a monadic build system would suggest that Pants needs to be careful to clean a graph of `@rule`s in the order that dependencies were originally requested in. And dependency inference is no exception: in the build after an import statement has been removed from your code, Pants must not force you to wait for that removed dependency to be rebuilt!\\n\\nBut this is potentially problematic: data dependencies are costly because they force ordering. Dependency inference requires parsing the AST of your code to extract import statements: a data dependency between extracting the imports of a file and running a test in that file (for example), implies that while cleaning the `@rule` graph after that file has changed, we should not start running the test until after we\'ve finished extracting imports. And as mentioned before, the imports of your test file are much less likely to have changed than its other content, meaning that an infrequently changing output blocks computing the key result of your build: whether your test passed!\\n\\nThis represents an interesting challenge: is it possible for Pants to preserve the excellent usability properties of dependency inference (avoiding needing to maintain redundant, potentially-stale copies of your import statements in both your code and in `BUILD` files), without forcing the running of a test to wait for import parsing? Yes, we can: via speculative execution!\\n\\n<Chart\\n  chartType=\\"Gantt\\"\\n  data={[chartColumns, ...withoutSpeculativeExecution]}\\n  options={chartOptions}\\n/>\\n\\n## Speculative Execution\\n\\n[Speculative execution](https://en.wikipedia.org/wiki/Speculative_execution) (aka \\"speculation\\") is a technique used (somewhat infamously: more on that later) in CPUs, but which is also employed when sending RPCs in distributed systems (where it might be referred to as using [hedged requests](https://blog.acolyer.org/2015/01/15/the-tail-at-scale/)).\\n\\nApplying speculative execution to reducing the cost of data dependencies means applying prior knowledge about the likelihood that a data-dependency will have a particular output value to decide to eagerly launch a data-dependent task with the predicted input _before_ its data-dependency has completed. Concretely: it means being able to launch the extraction of imports _and_ the running of the test _in parallel_!\\n\\nAnd so: Pants uses its record of the generation values of the previous build to [clean the `@rule` graph speculatively](https://github.com/pantsbuild/pants/pull/11308), sidestepping the data dependency in incremental rebuilds!\\n\\n<Chart\\n  chartType=\\"Gantt\\"\\n  data={[chartColumns, ...withSpeculativeExecution]}\\n  options={chartOptions}\\n/>\\n\\n## Prerequisites for Speculation\\n\\nTo ensure correctness, safe speculation requires that speculated work never has side-effects (which is where speculation in CPUs [went astray](https://en.wikipedia.org/wiki/Speculative_execution#Security_vulnerabilities)). And reducing speculation\'s costs requires the ability to quickly and cleanly cancel speculated work when you determine that your guesses were incorrect.\\n\\nFortunately, both purity (the absence of side-effects) and interruptibility are already fundamental to the architecture of Pants 2.0!\\n\\n### Pure\\n\\nPants\' `@rule` API was designed from the ground up to be side-effect free. With the exception of specially classified \\"Goal\\" rules (which \\"finalize\\" the run from an end user\'s perspective), `@rule`s are intended to be [pure](https://en.wikipedia.org/wiki/Pure_function) coroutines.\\n\\n`@rule`s consume specialized APIs that present [an atomic, read-only view of the filesystem](https://www.pantsbuild.org/v2.2/docs/rules-api-file-system), and precise tracking of `@rule` dependencies (down to the level of syscalls to expand symlinks, etc) ensures that -- although the filesystem might look like a global static -- the relevant `@rule`s can be restarted in cases where files change during a run to preserve atomicity guarantees.\\n\\nBuild tools [\\"excel\\"](https://www.microsoft.com/en-us/research/uploads/prod/2018/03/build-systems.pdf) at running processes: your typechecker, compiler, code generator, test, etc. But most processes that run during your build produce outputs, and ensuring that these outputs are not observable side-effects is an interesting challenge! To isolate processes, Pants fundamentally operates on content-addressable collections of files (known as `Snapshots`, and implemented using the Bazel [Remote APIs](https://github.com/bazelbuild/remote-apis/blob/9e72daff42c941baaf43a4c370e2607a984c58a7/build/bazel/remote/execution/v2/remote_execution.proto#L819-L857)) rather than on filesystem state. This means that process inputs and outputs are always immutable values, and never references into a mutable store like the filesystem.\\n\\nRather than writing out the results of processes into a shared mutable working directory as is common in many build tools, Pants stores all process inputs and outputs in a database (backed locally by [LMDB](https://symas.com/lmdb/), and remotely by a Remote API [CAS](https://github.com/bazelbuild/remote-apis/blob/9e72daff42c941baaf43a4c370e2607a984c58a7/build/bazel/remote/execution/v2/remote_execution.proto#L185-L257) instance), and executes processes inside of chroots. Only the final results that a user directly requested via a high level \\"goal\\" (`fmt`, `test`, `package`, etc) are actually materialized as a visible side-effect in their workspace.\\n\\nThis fundamental isolation is critical to speculation, because it means that Pants can always spawn multiple copies of processes, without worrying that they will collide or otherwise observe one-another\'s results!\\n\\n### Interruptible\\n\\nBeing free of side-effects eliminates one common challenge of providing interruptibility: there is no need to \\"clean up\\" after canceled processes, because their execution could not affect any mutable resources in ways that might need to be reverted. But the other requirement is ensuring that you don\'t waste CPU time on those trees as they fall in that unobserved forest: and cancelling work once you\'ve launched it can be, in-and-of-itself, tricky.\\n\\nNative threads in all common operating systems are eager: once you\'ve launched them they run to completion, killing them without their cooperation is a [risky proposition](https://unix.stackexchange.com/questions/403988/how-to-kill-an-individual-thread-under-a-process-in-linux), and getting their cooperation at a fine-grained level would require peppering your code with \\"`is_it_time_to_give_up()`?\\" checks.\\n\\nLuckily, the core of Pants is written in Rust, and -- rather than using native threads -- uses [tokio](https://tokio.rs/) to support running thousands of lightweight user-space tasks. Due to their [pull-based/lazy](https://rust-lang.github.io/async-book/02_execution/02_future.html) design, Rust Futures (which back its excellent `async/await` feature) are inherently cancellable: with [rare](https://docs.rs/tokio/1.0.1/tokio/fn.spawn.html) and [well-noted](https://docs.rs/tokio/1.0.1/tokio/process/index.html#droppingcancellation) exceptions, dropping a `Future` value recursively cancels all associated work at its next `await`.\\n\\nAnd because we use tokio to spawn processes, receive UNIX signals, interact with the filesystem, communicate with remote servers, etc, this deep support for cancellation pervades Pants\' APIs, and continuously minimizes the overhead of speculation.\\n\\nAnother very visible feature enabled by inherent support for cancellation is getting the expected behavior when a user running Pants cancels a run using Ctrl+C: in `2.2.x`, Pants is able to immediately interrupt ongoing work without killing the `pantsd` server, and can resume the next run incrementally using any work that had already completed. A video is worth a thousand words:\\n\\n<iframe\\n  width=\\"100%\\"\\n  height=\\"500\\"\\n  src=\\"https://www.youtube.com/embed/OqPztfXlv2s?si=U2-wBfKqwEI82SDR\\"\\n  title=\\"YouTube video player\\"\\n  frameborder=\\"0\\"\\n  allow=\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\\"\\n  allowfullscreen\\n></iframe>\\n\\n## Future Work\\n\\nAll of the recent stable `2.y.x` releases of Pants speculatively clean the `@rule` graph to deliver this extra low latency experience for the most common cases. But there is some interesting future work that will help to reduce the chances of speculation ever being a pessimization.\\n\\nFor example, because Pants constrains the number of processes that can run in parallel, [process prioritization](https://github.com/pantsbuild/pants/issues/11303) will help to avoid priority inversions where a cheap process (like a dependency extraction `@rule`) ends up waiting on a more expensive process (like a test run) to complete, delaying the time before we determine that we\'ve speculated incorrectly. And as a more advanced feature of prioritization, process [preemption](<https://en.wikipedia.org/wiki/Preemption_(computing)>) would allow taking advantage of cancellation to fix inversions by cancelling the lower priority work to finish the highest priority work. We\'d love to collaborate with the Rust community on generic solutions to this problem ([such as](https://github.com/tokio-rs/tokio/issues/3242))!\\n\\n## Closing\\n\\nIf you\'d like to [try out Pants](https://www.pantsbuild.org/docs/welcome-to-pants) with your Python project, [we\'re happy to help](https://www.pantsbuild.org/docs/community)! Pants is an open source project that welcomes new contributors: if you\'re interested in working to push the state of the art in build systems, [we\'d love to work with you](https://www.pantsbuild.org/docs/committers) (and contributing companies, including my employer [are hiring](https://toolchain.com/jobs))!\\n\\n## Thanks!\\n\\n- To the [Build Systems \xe0 la Carte](https://www.microsoft.com/en-us/research/uploads/prod/2018/03/build-systems.pdf) authors, for covering an \\"awesome, terrifying, and unloved\\" subject, and especially Neil Mitchell for his [followup post](https://neilmitchell.blogspot.com/2020/11/data-types-for-build-system-dependencies.html).\\n- To the Rust community for the truly fantastic implementation of async/await.\\n- To the [tokio](https://tokio.rs/) community, for a library that\'s been central to Pants\' engine for about four years now.\\n- To the Python community for Python 3, which has been a huge leap forward for Pants.\\n- To all of Pants\' contributors and users!"},{"id":"/2020/11/25/talking-pants","metadata":{"permalink":"/blog/2020/11/25/talking-pants","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2020-11-25-talking-pants/index.mdx","source":"@site/blog/2020-11-25-talking-pants/index.mdx","title":"Talking Pants","description":"Photo by [Jonathan","date":"2020-11-25T00:00:00.000Z","tags":[{"inline":true,"label":"community","permalink":"/blog/tags/community"}],"readingTime":0.89,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["community"]},"unlisted":false,"prevItem":{"title":"fast-incremental-builds-speculation-cancellation","permalink":"/blog/2021/02/01/fast-incremental-builds-speculation-cancellation"},"nextItem":{"title":"Unlocking incremental Python 3 migrations with Pants","permalink":"/blog/2020/11/17/python-3-migrations"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Jonathan\\n  Farber](https://unsplash.com/@farber?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\n{/* truncate */}\\n\\nPants contributors [Eric Arellano](https://github.com/Eric-Arellano) and [Stu Hood](https://github.com/stuhood) sat down recently with Tobias Macey, host of the popular `Podcast.__init__`, to talk about Python monorepos and how Pants supports them.\\n\\nListen in to learn about the history of Pants (including the origin of the name!), the advantages of a single unified codebase, how Pants supports effective workflows in a growing repo, and the joys of using Turtle graphics to teach programming to kids...\\n\\n<iframe\\n  src=\\"https://player.fireside.fm/v2/82qp1QFd+pCaGVloR?theme=dark\\"\\n  width=\\"100%\\"\\n  height=\\"200\\"\\n  frameborder=\\"0\\"\\n  scrolling=\\"no\\"\\n></iframe>\\n\\nOur thanks to Tobias for giving us an opportunity to introduce Pants to the podcast audience. If you enjoyed this episode, I recommend checking out the many other fascinating ones. I\'ve been looking for some new podcasts to listen to while running, and `Podcast.__init__` is in the rotation now!"},{"id":"/2020/11/17/python-3-migrations","metadata":{"permalink":"/blog/2020/11/17/python-3-migrations","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2020-11-17-python-3-migrations/index.mdx","source":"@site/blog/2020-11-17-python-3-migrations/index.mdx","title":"Unlocking incremental Python 3 migrations with Pants","description":"Photo by [Volodymyr","date":"2020-11-17T00:00:00.000Z","tags":[{"inline":true,"label":"getting-started","permalink":"/blog/tags/getting-started"}],"readingTime":5.13,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["getting-started"]},"unlisted":false,"prevItem":{"title":"Talking Pants","permalink":"/blog/2020/11/25/talking-pants"},"nextItem":{"title":"Dependency inference: Precise caching and concurrency, without the boilerplate","permalink":"/blog/2020/10/29/dependency-inference"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Volodymyr\\n  Hryshchenko](https://unsplash.com/@lunarts?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nHow the Pants build tool empowers incremental migrations by:\\n\\n1. giving fine-grained insights into your migration with minimal boilerplate, and\\n2. running all your tests and linters, in parallel, with the correct interpreter for each part of your code.\\n\\n{/* truncate */}\\n\\n---\\n\\nFrom [Dropbox](https://dropbox.tech/application/how-we-rolled-out-one-of-the-largest-python-3-migrations-ever) to [Facebook](https://lwn.net/Articles/758159/) to [Pants\'s own migration](https://enterprise.foursquare.com/intersections/article/how-our-intern-led-pants-migration-to-python-3/), organizations that have completed Python 3 migrations repeat one theme: incremental migrations are essential to reduce risk.\\n\\nThis blog dives into how the [Pants build tool](../2020-10-27-introducing-pants-v2/index.mdx) empowers incremental migrations by:\\n\\n1.  giving fine-grained insights into your migration with minimal boilerplate, and\\n2.  running all your tests and linters, in parallel, with the correct interpreter for each part of your code.\\n\\n---\\n\\n## WTF is Pants?\\n\\nPants is a build tool, meaning that it orchestrates the workflows and tools you use in a modern Python repository, like Black, Pytest, Protoc (Protobufs), and setuptools. Pants will run these and many other tools concurrently, and brings fine-grained caching with minimal boilerplate, including as your codebase scales up in size.\\n\\nSee [our blog post introducting Pants v2/](../2020-10-27-introducing-pants-v2/index.mdx).\\n\\n---\\n\\n## Precise modeling of your migration\\n\\nA key ingredient to a large-scale, incremental migration is maintaining a real-time status of your project. Ideally, this information would be:\\n\\n- decentralized to change, so that teams can work independently\\n- readable through a centralized view, so that migration leaders can track progress\\n- aware of how dependencies impact compatibility\\n- used at runtime to avoid becoming stale\\n- as precise as a file, which lowers the activation energy needed to port code\\n\\nThis is challenging to achieve through distinct `setup.py` projects, where each project has its own constraints. The lack of granularity makes porting more challenging, as you must atomically update the entire `setup.py` project\'s constraints at once, rather than being able to make small changes within the project.\\n\\nInstead, Pants tracks your project\'s interpreter constraints with file-level precision and uses this to determine which interpreter(s) to use for tests, linters, MyPy, and packaging code. You can set a global default in `pants.toml`, and override the constraints for specific files through BUILD files.\\n\\n<div>\\n\\n```toml\\n[python-setup]\\ninterpreter_constraints = [\\"==2.7.*\\", \\">=3.5\\"]\\n```\\n\\n<figcaption>\\n  We set the repo\'s default to 2.7 or 3.5+ in `pants.toml`.\\n</figcaption>\\n\\n</div>\\n\\n<div>\\n\\n```python\\npython_library(\\n    sources=[\\"*.py\\"],\\n    interpreter_constraints=[\\">=3.5\\"],\\n)\\n```\\n\\n<figcaption>\\n  Example BUILD file. We set the whole folder\'s constraints to 3.5+, but we\\n  could use a looser or coarser `sources` field.\\n</figcaption>\\n\\n</div>\\n\\nThe `interpreter_constraints` field only tracks what those specific files are compatible with; Pants will then merge all of the code\'s transitive dependencies into a final interpreter constraint. For example, if the folder `util/` is compatible with Python 2.7 or 3.5+, and we\'re building a binary which depends on `util/` but whose own code is Python 3-only, Pants will use 3.5+ for the final result.\\n\\n```shell-session\\n$ ./pants py-constraints helloworld/main.py\\nFinal merged constraints: CPython==2.7.*,>=3.5 OR CPython>=3.5\\n\\nCPython>=3.5\\n    helloworld/main.py\\n\\nCPython==2.7.* OR CPython>=3.5\\n    helloworld/util/__init__.py\\n    helloworld/util/config_loader.py\\n    helloworld/util/lang.py\\n    helloworld/util/proto/__init__.py:init\\n    helloworld/util/proto/config.proto\\n```\\n\\nThanks to [dependency inference](../2020-10-29-dependency-inference/index.mdx)\u2014where Pants identifies your code\'s dependencies by reading its import statements\u2014you get this fine-grained understanding of your code\'s dependencies automatically: if you want to create lots of targets for more precise tracking of interpreter constraints, you don\'t need to repeat metadata like you do with other build tools.\\n\\nEven though setting interpreter constraints is decentralized (a good thing), Pants can still generate a centralized view of your migration\'s status. Pants will even show how many dependencies each file has (how easy it is to port) and how many dependees a file has (how impactful it is to port).\\n\\n## Running Python 2 and Python 3 in parallel\\n\\nConventionally, you must be careful to run tools like Flake8, MyPy, and Pytest with the correct interpreter for that code. If part of your codebase is Python 2-only and part Python 3-only, then you must manually partition your files and invoke the tools multiple times with the appropriate partitions.\\n\\nInstead, Pants will automate this partitioning for you. Pants will look at your code\'s `interpreter_constraints` and partition based on the tool\'s behavior; for example, Flake8 only cares about the file\'s constraints, whereas MyPy and Pytest need to consider the constraints of transitive dependencies.\\n\\n```shell-session\\n$ ./pants typecheck ::\\n10:22:54.20 [INFO] Completed: Typecheck using MyPy - succeeded.\\nPartition #1 - [\'CPython==2.7.*\']:\\nSuccess: no issues found in 4 source files\\n\\nPartition #2 - [\'CPython>=3.7\']:\\nSuccess: no issues found in 14 source files\\n\\n\u2713 MyPy succeeded.\\n```\\n\\nAll of the partitions of your tests and linters will run in parallel, unlike manually invoking the tools sequentially.\\n\\nThis partitioning means that it\'s seamless for some parts of your codebase to switch to exclusively Python 3, while still running your linters and tests in a single command.\\n\\nYou can also tell Pants to run tests with both Python 2 and Python 3 on the same code, ensuring your core library code works with both interpreters. As always, these will run in parallel and be cached.\\n\\n```python\\n# You can use a macro in BUILD files to reduce this\\n# boilerplate. See www.pantsbuild.org/docs/macros.\\n\\npython_tests(\\n    name=\\"tests_py2\\",\\n    interpreter_constraints=[\\"==2.7.*\\"],\\n)\\n\\npython_tests(\\n    name=\\"tests_py3\\",\\n    interpreter_constraints=[\\">=3.5\\"],\\n)\\n```\\n\\n## Trying out Pants\\n\\nWe optimized Pants to be easy to [add incrementally](https://www.pantsbuild.org/docs/existing-repositories) to existing repositories. Thanks to dependency inference, there\'s little boilerplate to get started. You can start by only using Pants to run your linters or tests, and integrate it into the rest of your workflow incrementally.\\n\\nThe [Pants community](https://www.pantsbuild.org/docs/community) would love to help get started! [www.pantsbuild.org/docs](https://www.pantsbuild.org/v2.1/docs)\\n\\n\\\\*The `py-constraints` goal requires Pants 2.1.0 or newer to run."},{"id":"/2020/10/29/dependency-inference","metadata":{"permalink":"/blog/2020/10/29/dependency-inference","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2020-10-29-dependency-inference/index.mdx","source":"@site/blog/2020-10-29-dependency-inference/index.mdx","title":"Dependency inference: Precise caching and concurrency, without the boilerplate","description":"Photo by [Martin","date":"2020-10-29T00:00:00.000Z","tags":[{"inline":true,"label":"under-the-hood","permalink":"/blog/tags/under-the-hood"}],"readingTime":6.99,"hasTruncateMarker":true,"authors":[{"name":"Stu Hood","title":"Pants Maintainer","url":"https://github.com/stuhood","imageURL":"https://github.com/stuhood.png","key":"stu","page":null}],"frontMatter":{"authors":["stu"],"tags":["under-the-hood"]},"unlisted":false,"prevItem":{"title":"Unlocking incremental Python 3 migrations with Pants","permalink":"/blog/2020/11/17/python-3-migrations"},"nextItem":{"title":"Introducing Pants v2","permalink":"/blog/2020/10/27/introducing-pants-v2"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Martin\\n  Sanchez](https://unsplash.com/@martinsanchez?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nScalable build tools have historically meant a significant boilerplate burden.\\n\\nBut it doesn\'t have to be that way! Pants v2 supports all of the caching, concurrency, and introspection you need to scale your repository, with significantly less boilerplate, thanks to\u2026 Dependency inference!\\n\\n{/* truncate */}\\n\\n---\\n\\nAs discussed [in our post announcing Pants v2](../2020-10-27-introducing-pants-v2/index.mdx), it\'s clear that Python has \\"grown up\\" by gaining facilities to help it to scale to larger projects. But as codebases grow and tool counts increase, more Python codebases need build tools. While you could write bespoke scripts to coordinate each of your tools, using Pants brings benefits like caching, concurrency, introspection, a simple and uniform user experience, and more!\\n\\nUnfortunately, scalable build tools have historically meant a significant boilerplate burden: scattering `BUILD` files throughout your repository and then needing to edit both your code and the redundant dependency information in build definitions.\\n\\nBut it doesn\'t have to be that way! Pants v2 supports the precise caching, concurrency, and introspection that you need to scale your repository, with up to **90%** less `BUILD` boilerplate, thanks to\u2026 Dependency inference!\\n\\n## Scaling up\\n\\nPants supports repos of all sizes with minimal boilerplate, but it is particularly helpful in repositories containing multiple deployable or publishable projects, each with potentially different requirements or interpreters: aka, monorepos.\\n\\nMonorepos have lots of benefits (no dependency conflicts, atomic cross-project commits, easy top-to-bottom continuous integration, linear change history), but essential to making them scale are the abilities to:\\n\\n1.  test, check, and deploy precisely the portion of the repository that is relevant to you\\n2.  cache builds and tests to avoid re-building when unrelated code has changed\\n3.  manage and configure the variety of tooling that users of the repository will want to use\\n\\nIt\'s critical in a monorepo to be able to test, check, and deploy exactly the relevant portion of your code, ideally with zero impact from changes in unrelated parts of the codebase. For example: if you have three libraries `A`, `B`, and `C`, which depend on one another in a chain like `A -> B -> C`, a monorepo that builds from source using Pants allows you to completely ignore versioning (and `setup.py` files, per-project `requirements.txt`, etc) while you edit library `C`, even if you are running the tests for library `A`. If you have ten other projects (or one thousand!) in your repository and only a few of them depend on `C`, you\'d like to avoid ever running tests or mypy for the unrelated libraries while editing `C`.\\n\\nAnd in those cases when you _do_ want to take advantage of a monorepo\'s top-to-bottom integration testing by running \\"all of your dependent\'s tests\\" (or maybe just typecheck them with Mypy!), you\'d like to do that as quickly as possible by taking advantage of caching, concurrency, or transparently executing them on a cluster of machines using remote execution.\\n\\nTo enable this scalability, monorepo build tools like Pants v1 and Bazel required that the dependencies between libraries and files were declared in `BUILD` files. These dependencies were then used to determine which portions of the repository needed to be built, and which files needed to be included in cache keys.\\n\\n\\"But wait\\", you say! \\"Doesn\'t that mean we\'ve traded editing `setup.py` and `requirements.txt` files for every library for editing `BUILD` files for every library?\\" In most tools, that would be the case: but not in Pants v2! Pants v2 is different.\\n\\n## Dependency inference\\n\\nPants 2.0.0 almost entirely eliminates the boilerplate of declaring dependencies between libraries thanks to \\"Dependency inference\\". Dependency inference is roughly what it sounds like: Pants supports discovering the dependencies between Python libraries by parsing `import` statements (and you can [use our powerful plugin API](https://www.pantsbuild.org/docs/plugins-overview) to infer other dependencies, such as by parsing a Django settings file, YAML config, etc).\\n\\nRather than adding an `import` statement to your code resulting in your tests failing because you forgot to _also_ update a `BUILD` file, Pants will use your newly added `import` statement to infer that that file now has a dependency within the repository (or outside it via your `requirements.txt`). When designing inference, we strove to remove boilerplate without introducing magic, so `BUILD` files are still used to declare any metadata your library might have (the version of the Python interpreter to use, etc), and can be used to [override or extend](https://www.pantsbuild.org/docs/targets#dependencies-and-dependency-inference) the inferred dependencies.\\n\\nEven better, Pants infers these dependencies _at the file level_. Rather than adding a dependency from \\"the library named `A`\\" to \\"the library named `B`\\" (or \\"target\\" in monorepo parlance), Pants tracks that \\"file `a.py` depends on file \\"`b.py`\\". Rather than staring at the content of your `BUILD` files to (attempt to?) understand your dependencies, you can use Pants\' dependency introspection tools to easily explore them at the file level: `./pants dependencies $file`.\\n\\nIn practice, we\'ve found that inferred file-level dependencies can reduce the total per-file dependency count by an average of **30%** (improving cache hit rates), and reduce the size of `BUILD` files by up to **90%** (reducing boilerplate)! See our docs for [a real world example](https://www.pantsbuild.org/docs/how-does-pants-work#dependency-inference).\\n\\nAnd critically (as we\'ll discuss in further posts!), dependency inference is both 1) very safe, and 2) very fast. Because Pants invokes processes hermetically using SHA256 fingerprinting and strong sandboxes (your test frameworks, your linters, mypy, everything), failing to infer a dependency can never cause the wrong things to be cached. And because the core of Pants is implemented in Rust \u2014 and uses a daemon, parallelism, and very-fine-grained memoization \u2014 inference won\'t slow you down!\\n\\n## Demonstration\\n\\nTo show what it\'s like to use dependency inference, we\'ll quickly add a feature with assistance from some new first and third party dependencies (from sources and PyPI, respectively).\\n\\nWe\'ll start with a broken test that expects TOML files to be supported by a library in a different directory:\\n\\n![](./1.gif)\\n\\nBecause we\'re curious, we\'ll start by asking Pants whether the library already (directly) depends on TOML:\\n\\n![](./2.gif)\\n\\nNope. Only YAML. But let\'s add the `import` statement and see what happens\u2026\\n\\n![](./3.gif)\\n\\nVoila! This file now declares a dependency on TOML via the `import` statement, without any modifications to `BUILD` files. But we\'re not finished: neither the flake8 linter nor the customer will be satisfied with an unused `import`! Let\'s finish adding the feature, and then re-run the test.\\n\\n![](./4.gif)\\n\\nOk, TOML is clearly being used: but this time our test needs tweaking. To fix it we can import a `TomlSerializer` helper class from a second library (another new dependency!). We already know that we don\'t need to check the `BUILD` file to see whether this test declares a dependency on the library, so we can just focus on our code!:\\n\\n![](./5.gif)\\n\\nGreat: our test is now passing! To fix it, we edited two files and introduced two new dependencies -- but we didn\'t need to edit any `BUILD` files, despite these files living in different targets!\\n\\nFinally, let\'s confirm the critical monorepo scalability property that edits to unrelated files don\'t invalidate the caching of our new test. Although this test is quick, there are a few hundred files in this repository, and plenty of other tests that could take long enough to result in coffee breaks!:\\n\\n![](./6.gif)\\n\\nExcellent! Thanks to dependency inference\'s file level precision, our test is still quickly and correctly cached, even after editing neighboring files in the target! Productivity preserved; mission accomplished.\\n\\n## Conclusion\\n\\nThe precise, always-accurate dependencies in Pants have a lot of benefits:\\n\\n1.  teams can quickly get started using Pants\\n2.  `BUILD` files (or `requirements.txt`/`setup.py` files) can\'t go out of sync with the code, because you don\'t need to repeat all of your `import` statements there\\n3.  the cache keys for processes (and thus the number of cache hits and amount of rebuilding) are more accurate and much more fine-grained than you would ever write by hand\\n\\nIf you\'re interested in speeding-up and scaling-up your builds without the boilerplate, the [Pants community would love to help](https://www.pantsbuild.org/docs/community)!"},{"id":"/2020/10/27/introducing-pants-v2","metadata":{"permalink":"/blog/2020/10/27/introducing-pants-v2","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2020-10-27-introducing-pants-v2/index.mdx","source":"@site/blog/2020-10-27-introducing-pants-v2/index.mdx","title":"Introducing Pants v2","description":"Photo by [Jess","date":"2020-10-27T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":9.26,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["announcement","python"]},"unlisted":false,"prevItem":{"title":"Dependency inference: Precise caching and concurrency, without the boilerplate","permalink":"/blog/2020/10/29/dependency-inference"}},"content":"<CaptionedImg src={require(\\"./splash.jpg\\").default}>\\n  Photo by [Jess\\n  Bailey](https://unsplash.com/es/@jessbaileydesigns?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n  /\\n  [Unsplash](https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit)\\n</CaptionedImg>\\n\\nThere are so many tools in the Python development ecosystem. Installing, configuring and orchestrating them\u2014all while not re-executing work unnecessarily\u2014is a hard problem, especially as your codebase grows.\\n\\nFortunately, there is now a tailor-made (pun intended) solution: Pants v2!\\n\\n{/* truncate */}\\n\\n### Pants 2.0.0, the first stable release of the Pants v2 open-source build system, is out now!\\n\\nThere are so many tools in the Python development ecosystem. You might use [pip](https://pip.pypa.io/en/stable/) to resolve dependencies, [pytest](https://docs.pytest.org/en/stable/) to run tests, [flake8](https://flake8.pycqa.org/en/latest/) and [pylint](https://www.pylint.org/) for lint checks, [black](https://black.readthedocs.io/en/stable/) and [isort](https://pycqa.github.io/isort/) for auto-formatting, [mypy](http://mypy-lang.org/) for type checking, [IPython](https://ipython.org/) or [Jupyter](https://jupyter.org/) for interactive sessions, [setuptools](https://setuptools.readthedocs.io/en/latest/), [pex](https://pex.readthedocs.io/en/latest/) or [docker](https://www.docker.com/) for packaging, [protocol buffers](https://developers.google.com/protocol-buffers) for code generation, and many more. Not to mention any custom tooling you\'ve built for your repo.\\n\\nInstalling, configuring and orchestrating the invocation of these tools\u2014**all while not re-executing work unnecessarily**\u2014is a hard problem, especially as your codebase grows. The lack of a robust, scalable build system for Python has been a problem for a long time, and this has become even more acute in recent years, with Python codebases increasing in size and complexity.\\n\\nFortunately, there is now a tailor-made (pun intended) solution: **Pants v2**!\\n\\n[Pants v2](https://www.pantsbuild.org/) is designed from the ground-up for fast, consistent builds. Some noteworthy features include:\\n\\n- Minimal metadata and boilerplate\\n- Fine-grained workflow\\n- Shared result caching\\n- Concurrent execution\\n- A responsive, scalable UI\\n- Unified interface for multiple tools and languages\\n- Extensibility and customizability via a plugin API\\n\\n<CaptionedImg src={require(\\"./pants-concurrency.gif\\").default}>\\n  Pants running multiple linters in parallel\\n</CaptionedImg>\\n\\nRead on to learn more about Pants v2, and what it means for your Python codebase.\\n\\n---\\n\\n## A little history\\n\\nWe started the original open-source Pants project back in 2011. At the time, we were frustrated by slow, flaky Scala builds. The leading strategy for scaling was to hand each developer a RAM stick and a screwdriver... Surely this was a problem we could tackle with software! Thus Pants v1 was born.\\n\\nPants v1 was quite successful, and was adopted at cutting-edge tech companies such as Twitter, Foursquare, Square and others. But we still weren\'t satisfied: The APIs were clunkier than we would have liked, the UI was overly chatty, caching was hard to get right, and concurrent execution had to be special-cased. We knew there were plenty of performance and stability improvements to be had, if we could only unlock them.\\n\\nWe learned a lot from our years of work on Pants v1, and knew that we could design something new and better, leaning on our experience with v1 while addressing the drawbacks of that system. Luckily, at the same time as we began thinking about this hypothetical next system, a new motivating problem emerged: Python builds.\\n\\n## Python builds today\\n\\nAs you probably know, Python has skyrocketed in popularity in recent years. Not only is it used to build a wide variety of server applications, via frameworks such as [Django](https://www.djangoproject.com/) and [Flask](https://flask.palletsprojects.com/en/1.1.x/), but it\'s also the language of choice for data scientists, thanks to powerful libraries and tools such as [NumPy](https://numpy.org/), [SciPy](https://www.scipy.org/), [Pandas](https://pandas.pydata.org/) and [Jupyter](https://jupyter.org/).\\n\\nPython hits a sweet spot of simplicity and power, but there is a big problem - there is no truly great scalable build tool for Python, and this is becoming a real pain point as Python repos grow like never before.\\n\\nPython builds today involve manually invoking a wide variety of tools. Each tool has to be installed, configured and invoked in just the right way, often while sequencing the output of one tool into input of another. Knowing how to use each tool in a given scenario is complicated and burdensome.\\n\\nSure, you can hack around the problem for a while with some combination of shell scripts, [Makefiles](https://www.gnu.org/software/make/manual/make.html), [tox](https://tox.readthedocs.io/en/latest/), and [poetry](https://python-poetry.org/). But even a small code change might require you to run a huge amount of sequential build work. Re-executing the same processes with the same inputs over and over again is a frustrating waste of time and resources. \xa0And these solutions start to break down as your codebase grows.\\n\\nPerhaps you experimented with more complex build systems, such as [Bazel](https://bazel.build/) or [Pants v1](https://v1.pantsbuild.org/). \xa0But it\'s laborious to maintain all that BUILD metadata, all for a sub-par experience not optimized for Python. Not to mention the difficulty of implementing your own custom build logic.\\n\\nAlternatively, maybe you\'ve been tempted to split up your codebase into multiple interdependent repos, each with their own \\"smaller\\" builds. But that creates an even thornier problem, namely how to manage those interdependencies. Having to propagate changes across codebase boundaries can slow development down to a crawl, and leave you with the worst of both worlds - slower processes and a fragmented, unmanageable codebase.\\n\\nA great build system for repos - of all sizes - that include Python code would support fine-grained invalidation and caching, so that it only executes the build work actually affected by a change. It would support concurrent local and even remote execution, to greatly speed up work by using all available CPU. It would be easy to adopt in a small repo, but would scale up as your codebase grows. It wouldn\'t require huge amounts of boilerplate metadata, and it would be easy to extend with custom build logic.\\n\\nWell, Pants v2 is that system!\\n\\n## Introducing Pants v2\\n\\n[Pants v2](https://www.pantsbuild.org/) is a completely new open-source build system, inspired by our work on Pants v1. \xa0We\'ve been developing and testing it for the last couple of years, and it\'s finally ready for prime time!\\n\\nA key factor in the design of Pants v2 was a set of lessons we learned from Pants v1 and other existing systems, such as Bazel. Among them: that ease of use and performance matter, boilerplate is annoying, concurrency and caching require hard design work, and most people will need custom logic at some point.\\n\\n### Lesson #1: Ease of use and performance both matter\\n\\nWhen designing software you often find yourself making tradeoffs between ease of use and performance. But in a build system, both are vital. The Pants v2 execution engine - which is the performance-critical heart of the system - is written in [Rust](https://www.rust-lang.org/), for raw speed. And the domain-specific build logic is written in familiar, easy to work with, type-annotated Python 3. This helps make Pants v2 easy to extend, without compromising performance.\\n\\nPants v2 also runs a daemon that memoizes fine-grained build state in memory, for even faster performance. This daemon watches for changes to your source files and precisely invalidates its state on the fly to ensure that the minimum amount of work happens the next time you build.\\n\\n### Lesson #2: Writing build metadata is a real drag\\n\\nSome build tools are slow because they don\'t have enough information about the structure of your code to intelligently perform incremental work. Others have gone too far in the other direction, requiring a huge amount of metadata and boilerplate in BUILD files, especially relating to your code\'s dependencies.\\n\\nPants v2 offers the best of both worlds - intelligent, fine-grained incremental work, without the boilerplate. It does so by assuming sensible, magic-free defaults, inferring dependencies from the import statements in your code, and supporting plugins for custom inference logic. Stay tuned for an upcoming post on exactly how Pants achieves this!\\n\\n### Lesson #3: Design for caching, concurrency and remoting\\n\\nWriting build logic that can be cached and executed concurrently and remotely is very hard. You have to be very careful about not producing or consuming side-effects, and it\'s extremely difficult to tack that on later. And unless you design your APIs with care, supporting these kinds of features often places severe restrictions on what your build logic may safely do.\\n\\nIn Pants v2, build logic is composed of [pure](https://en.wikipedia.org/wiki/Pure_function) Python 3 [async coroutines](https://docs.python.org/3/library/asyncio-task.html). So a build rule can depend not only on its inputs, but can also await on new data at runtime - all of which is precisely tracked for invalidation and caching. This gives us the best of both worlds: logic that is properly isolated from side-effects, and is therefore amenable to caching, concurrent execution and remoting, while still allowing the use of natural control flow.\\n\\n<CaptionedImg src={require(\\"./pants-caching.gif\\").default}>\\n  We run both tests, then add a syntax error to one test and rerun; the\\n  unmodified test uses the cache and is isolated from the syntax error.\\n</CaptionedImg>\\n\\n### Lesson #4: Almost everyone needs to customize their builds\\n\\nMost teams have custom build steps, so extensibility is a key feature in any build system. Pants v2 is built around a [plugin architecture](https://www.pantsbuild.org/docs/plugins-overview). You can write your own rules using the same API as the built-in functionality. So your custom build logic will enjoy the same fine-grained invalidation, caching, concurrency and remote execution abilities as the core Pants code.\\n\\n## Pants 2.0.0 is out now!\\n\\nAll this leads me to the happy announcement that [Pants 2.0.0](https://pypi.org/project/pantsbuild.pants/2.0.0/), the first stable release of Pants v2, is out now! 2.0.0 is the culmination of years of design and development work, and many months of beta testing at several organizations. So we\'re really happy, proud (and relieved\u2026) to finally have it ready for general use.\\n\\nYou can see what Python tools Pants currently supports [here](https://www.pantsbuild.org/docs/python). There are also commands for querying and understanding your dependency graph, and a robust help system. \xa0We\'re adding support for additional tools and features all the time, and it\'s straightforward to implement your own. Beta users have already written their own logic for Cython and docker, for example.\\n\\nNow is a great time to adopt Pants 2.0.0! The team that developed Pants v2 is [ready to help you](https://www.pantsbuild.org/docs/community) onboard, answer any questions, and even pair with you to help you write any custom build logic. We\'re also eager to get feedback, bug reports and suggestions for what features we should focus on in the next weeks and months of development.\\n\\nPants v2 is developed by a helpful open source community, is funded by a 501(c)6 non-profit, and has excellent support available. If you have a growing Python codebase, and want to take Pants 2.0.0 for a spin, [let us know](https://www.pantsbuild.org/docs/community). We\'d love to fit you with some new Pants today!"}]}}')}}]);