"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["585702"],{648164(e,t,n){n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});var s=n(796019),i=n(886070),r=n(848193);let o={title:"Troubleshooting / common issues",sidebar_position:2},l,c={},a=[{value:"Debug tip: enable stack traces and increase logging",id:"debug-tip-enable-stack-traces-and-increase-logging",level:2},{value:"&quot;Out of space&quot; error: set an alternative tmpdir",id:"out-of-space-error-set-an-alternative-tmpdir",level:2},{value:"&quot;No space left on device&quot; error while watching files",id:"no-space-left-on-device-error-while-watching-files",level:2},{value:"How to change your cache directory",id:"how-to-change-your-cache-directory",level:2},{value:"&quot;Double requirement given&quot; error when resolving requirements",id:"double-requirement-given-error-when-resolving-requirements",level:2},{value:"Pants cannot find a file in your project",id:"pants-cannot-find-a-file-in-your-project",level:2},{value:"macOS users: issues with system Python interpreters",id:"macos-users-issues-with-system-python-interpreters",level:2},{value:"&quot;Too many open files&quot; error",id:"too-many-open-files-error",level:2}];function d(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Common issues you may encounter."}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsxs)(t.admonition,{title:"Asking for help",type:"tip",children:[(0,i.jsxs)(t.p,{children:["See ",(0,i.jsx)(t.a,{href:"/community/members",children:"Getting Help"}),". We would love to help!"]}),(0,i.jsx)(t.p,{children:"If you are confused by something, likely someone else will run into the same issue. It is helpful for us to know what is going wrong so that we can improve Pants and improve this documentation."})]}),"\n",(0,i.jsx)(t.h2,{id:"debug-tip-enable-stack-traces-and-increase-logging",children:"Debug tip: enable stack traces and increase logging"}),"\n",(0,i.jsx)(t.p,{children:"Pants defaults to not displaying the full stack trace when it encounters an error. Pants also defaults to logging at the info level."}),"\n",(0,i.jsxs)(t.p,{children:["When you encounter an exception, it can help to use the global options ",(0,i.jsx)(t.code,{children:"--print-stacktrace"})," and ",(0,i.jsx)(t.code,{children:"-ldebug"}),", like this:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"<<pantscmd>> --print-stacktrace -ldebug\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Once you have this stack trace, we recommend copying it into Pastebin or a GitHub Gist, then opening a GitHub issue or posting on Slack. Someone from the Pants team would be happy to help. See ",(0,i.jsx)(t.a,{href:"/community/members",children:"Getting Help"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"out-of-space-error-set-an-alternative-tmpdir",children:'"Out of space" error: set an alternative tmpdir'}),"\n",(0,i.jsx)(t.p,{children:"It may be necessary to explicitly set the directory Pants uses as a temporary directory. For example, if the system default temporary directory is a small partition, you may exhaust that temp space."}),"\n",(0,i.jsxs)(t.p,{children:["Use the global option ",(0,i.jsx)(t.code,{children:"local_execution_root_dir"})," to change the tmpdir used by Pants."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nlocal_execution_root_dir = "/mnt/large-partition/tmpdir"\n'})}),"\n",(0,i.jsx)(t.h2,{id:"no-space-left-on-device-error-while-watching-files",children:'"No space left on device" error while watching files'}),"\n",(0,i.jsxs)(t.p,{children:["On Linux, Pants uses ",(0,i.jsx)(t.code,{children:"inotify"})," to watch all files and directories related to any particular build. Some systems have limits configured for the maximum number of files watched. To adjust the limit on file watches, you can run:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",metastring:'title="shell"',children:"echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p\n"})}),"\n",(0,i.jsx)(t.h2,{id:"how-to-change-your-cache-directory",children:"How to change your cache directory"}),"\n",(0,i.jsxs)(t.p,{children:["You may change any of these options in the ",(0,i.jsx)(t.code,{children:"[GLOBAL]"})," section of your ",(0,i.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Option"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"What it does"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Default"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"local_store_dir"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Stores the results of running subprocesses and of some file operations."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"~/.cache/pants/lmdb_store"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"named_caches_dir"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Stores the caches for certain tools used by Pants, like PEX's cache for resolving Python requirements."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"~/.cache/pants/named_caches"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"pants_workdir"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["Stores some project-specific logs; used as a temporary directory when running ",(0,i.jsx)(t.code,{children:"./pants repl"})," and ",(0,i.jsx)(t.code,{children:"./pants run"}),".",(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"This is not used for caching.",(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"This must be relative to the build root."]}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"<build_root>/.pants.d/"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"pants_distdir"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["Where Pants writes artifacts to, such as the result of ",(0,i.jsx)(t.code,{children:"./pants package"}),".",(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"This is not used for caching; you can delete this folder and still leverage the cache from ",(0,i.jsx)(t.code,{children:"local_store_dir"}),".",(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"This must be relative to the build root."]}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"<build_root>/dist/"})})]})]})]}),"\n",(0,i.jsxs)(t.p,{children:["For ",(0,i.jsx)(t.code,{children:"local_store_dir"})," and ",(0,i.jsx)(t.code,{children:"named_caches_dir"}),", you may either specify an absolute path or a relative path, which will be relative to the build root. You may use the special string ",(0,i.jsx)(t.code,{children:"%(homedir)s"})," to get the value of ",(0,i.jsx)(t.code,{children:"~"}),", e.g. ",(0,i.jsx)(t.code,{children:'local_store_dir = "%(homedir)s/.custom_cache/pants/lmdb_store"'}),"."]}),"\n",(0,i.jsx)(t.p,{children:"It is safe to delete these folders to free up space."}),"\n",(0,i.jsxs)(t.p,{children:["You can also change the cache used by the ",(0,i.jsx)(t.code,{children:"./pants"})," script described in ",(0,i.jsx)(t.a,{href:"/2.0/docs/introduction/getting-started/installing-pants",children:"Installing Pants"}),", which defaults to ",(0,i.jsx)(t.code,{children:"~/.pants/cache/setup"}),". Either set the environment variable ",(0,i.jsx)(t.code,{children:"PANTS_SETUP_CACHE"})," or change the Bash script directly where it defines ",(0,i.jsx)(t.code,{children:"PANTS_SETUP_CACHE"}),". You may use an absolute path or a path relative to the build root."]}),"\n",(0,i.jsx)(t.h2,{id:"double-requirement-given-error-when-resolving-requirements",children:'"Double requirement given" error when resolving requirements'}),"\n",(0,i.jsxs)(t.p,{children:["This is an error from ",(0,i.jsx)(t.code,{children:"pip"}),", and it means that the same 3rd-party Python requirement\u2014with different version constraints\u2014appears in your dependencies."]}),"\n",(0,i.jsx)(t.p,{children:"You can use Pants to help identify why the same requirement is being used more than once:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",metastring:'title="Shell"',children:"# List all requirement strings used in your project. Once you\n# find the problematic requirement strings, try grepping\n# for them to see where the targets are defined.\n./pants dependencies --transitive --type=3rdparty ::\n\n# You can also try making your query more precise.\n./pants dependencies --type=3rdparty project1::\n"})}),"\n",(0,i.jsx)(t.h2,{id:"pants-cannot-find-a-file-in-your-project",children:"Pants cannot find a file in your project"}),"\n",(0,i.jsx)(t.p,{children:"Pants may complain that it cannot find a file or directory, even though the file does indeed exist."}),"\n",(0,i.jsxs)(t.p,{children:["Almost always, this error happens because of the option ",(0,i.jsx)(t.code,{children:"pants_ignore"})," in the ",(0,i.jsx)(t.code,{children:"[GLOBAL]"})," scope. By default, Pants will read your top-level ",(0,i.jsx)(t.code,{children:".gitignore"})," file to populate ",(0,i.jsx)(t.code,{children:"pants_ignore"}),", along with ignoring ",(0,i.jsx)(t.code,{children:"dist/"})," and any top-level files/directories starting with ",(0,i.jsx)(t.code,{children:"."}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["To override something included in your ",(0,i.jsx)(t.code,{children:".gitignore"}),", add a new value to ",(0,i.jsx)(t.code,{children:"pants_ignore"})," and prefix it with ",(0,i.jsx)(t.code,{children:"!"}),", like the below. ",(0,i.jsx)(t.code,{children:"pants_ignore"})," uses the ",(0,i.jsx)(t.a,{href:"https://git-scm.com/docs/gitignore",children:"same syntax as gitignore"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\npants_ignore.add = ["!folder/"]\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Alternatively, you can stop populating ",(0,i.jsx)(t.code,{children:"pants_ignore"})," from your ",(0,i.jsx)(t.code,{children:".gitignore"})," by setting ",(0,i.jsx)(t.code,{children:"pants_ignore_use_gitignore = false"})," in the ",(0,i.jsx)(t.code,{children:"[GLOBAL]"})," scope."]}),"\n",(0,i.jsx)(t.h2,{id:"macos-users-issues-with-system-python-interpreters",children:"macOS users: issues with system Python interpreters"}),"\n",(0,i.jsx)(t.p,{children:"The macOS system Python interpreters are broken in several ways, such as sometimes resulting in:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"ERROR: Could not install packages due to an EnvironmentError: [Errno 13] Permission denied: '/Library/Python/3.7'\n"})}),"\n",(0,i.jsxs)(t.p,{children:["You can set the option ",(0,i.jsx)(t.code,{children:"interpreter_search_paths"})," in the ",(0,i.jsx)(t.code,{children:"[python-setup]"})," scope to teach Pants to ignore the interpreters in ",(0,i.jsx)(t.code,{children:"/usr/bin"}),". See ",(0,i.jsx)(t.a,{href:"/2.0/docs/python/overview/interpreter-compatibility#changing-the-interpreter-search-path",children:"here"})," for more information."]}),"\n",(0,i.jsx)(t.h2,{id:"too-many-open-files-error",children:'"Too many open files" error'}),"\n",(0,i.jsx)(t.p,{children:"You may encounter this error when running Pants:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'./pants count-loc helloworld/greet\n\nERROR: Could not initialize store for process cache: "Error making env for store at \\"/Users/pantsbuild/.cache/pants/lmdb_store/processes/2\\": Too many open files"\n\n(Use --print-exception-stacktrace to see more error details.)\n'})}),"\n",(0,i.jsxs)(t.p,{children:["This sometimes happens because Pants uses lots of file handles to read and write to its cache at ",(0,i.jsx)(t.code,{children:"~/.cache/pants/lmdb_store"}),"; often, this is more than your system's default."]}),"\n",(0,i.jsxs)(t.p,{children:["This can be fixed by setting ",(0,i.jsx)(t.code,{children:"ulimit -n 10000"}),". (10,000 should work in all cases, but feel free to lower or increase this number as desired.)"]}),"\n",(0,i.jsxs)(t.admonition,{type:"note",children:[(0,i.jsxs)(t.mdxAdmonitionTitle,{children:["Tip: permanently configuring ",(0,i.jsx)(t.code,{children:"ulimit -n"})]}),(0,i.jsx)(t.p,{children:"We recommend permanently setting this by either:"}),(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Adding ",(0,i.jsx)(t.code,{children:"ulimit -n 10000"})," to your ",(0,i.jsx)(t.code,{children:"./pants"})," script."]}),"\n",(0,i.jsxs)(t.li,{children:["Using a tool like ",(0,i.jsx)(t.a,{href:"https://direnv.net",children:"Direnv"})," to run ",(0,i.jsx)(t.code,{children:"ulimit -n 10000"})," everytime the project is loaded."]}),"\n",(0,i.jsxs)(t.li,{children:["Adding ",(0,i.jsx)(t.code,{children:"ulimit -n 10000"})," to your global ",(0,i.jsx)(t.code,{children:".bashrc"})," or equivalent."]}),"\n"]}),(0,i.jsx)(t.p,{children:"The first two approaches have the benefit that they will be checked into version control, so every developer at your organization can use the same setting."})]}),"\n",(0,i.jsxs)(t.admonition,{type:"caution",children:[(0,i.jsxs)(t.mdxAdmonitionTitle,{children:["macOS users: avoid ",(0,i.jsx)(t.code,{children:"ulimit unlimited"})]}),(0,i.jsxs)(t.p,{children:["Contrary to the name, this will not fix the issue. You must use ",(0,i.jsx)(t.code,{children:"ulimit -n"})," instead."]})]})]})}function h(e={}){let{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},848193(e,t,n){n.d(t,{R:()=>o,x:()=>l});var s=n(830758);let i={},r=s.createContext(i);function o(e){let t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:t},e.children)}},796019(e){e.exports=JSON.parse('{"id":"docs/using-pants/troubleshooting-common-issues/index","title":"Troubleshooting / common issues","description":"Common issues you may encounter.","source":"@site/versioned_docs/version-2.0/docs/using-pants/troubleshooting-common-issues/index.mdx","sourceDirName":"docs/using-pants/troubleshooting-common-issues","slug":"/docs/using-pants/troubleshooting-common-issues/","permalink":"/2.0/docs/using-pants/troubleshooting-common-issues/","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/using-pants/troubleshooting-common-issues/index.mdx","tags":[],"version":"2.0","sidebarPosition":2,"frontMatter":{"title":"Troubleshooting / common issues","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Advanced target selection","permalink":"/2.0/docs/using-pants/advanced-target-selection"},"next":{"title":"Proxies","permalink":"/2.0/docs/using-pants/troubleshooting-common-issues/proxies"}}')}}]);