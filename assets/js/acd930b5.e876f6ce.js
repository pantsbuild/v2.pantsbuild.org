"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["412225"],{237131(e,t,n){n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>g,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var i=n(357673),r=n(886070),s=n(848193);let a={title:"Creating new targets",sidebar_position:2},o,l={},d=[{value:"When to create a new target type?",id:"when-to-create-a-new-target-type",level:2},{value:"Step 1: Define the target type",id:"step-1-define-the-target-type",level:2},{value:"Step 2: Register the target type in <code>register.py</code>",id:"step-2-register-the-target-type-in-registerpy",level:2}];function c(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"How to add a custom target type."}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"when-to-create-a-new-target-type",children:"When to create a new target type?"}),"\n",(0,r.jsx)(t.p,{children:"Adding new target types is most helpful when you are adding support for a new language."}),"\n",(0,r.jsxs)(t.p,{children:["If you instead want to reduce boilerplate in BUILD files, such as changing default values, use ",(0,r.jsx)(t.a,{href:"/2.18/docs/writing-plugins/macros",children:"macros"})," ."]}),"\n",(0,r.jsxs)(t.p,{children:["If you are already using a target type, but need to store additional metadata for your plugin, ",(0,r.jsx)(t.a,{href:"/2.18/docs/writing-plugins/the-target-api/extending-existing-targets",children:"add a new field to the target type"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"step-1-define-the-target-type",children:"Step 1: Define the target type"}),"\n",(0,r.jsx)(t.p,{children:"To define a new target:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Subclass ",(0,r.jsx)(t.code,{children:"pants.engine.target.Target"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["Define the class property ",(0,r.jsx)(t.code,{children:"alias"}),". This is the symbol that people use in BUILD files."]}),"\n",(0,r.jsxs)(t.li,{children:["Define the class property ",(0,r.jsx)(t.code,{children:"core_fields"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["Define the class property ",(0,r.jsx)(t.code,{children:"help"}),". This is used by ",(0,r.jsx)(t.code,{children:"pants help"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["For ",(0,r.jsx)(t.code,{children:"core_fields"}),", we recommend including ",(0,r.jsx)(t.code,{children:"COMMON_TARGET_FIELDS"})," to add the useful ",(0,r.jsx)(t.code,{children:"tags"})," and ",(0,r.jsx)(t.code,{children:"description"})," fields. You will also often want to add ",(0,r.jsx)(t.code,{children:"Dependencies"}),", and either ",(0,r.jsx)(t.code,{children:"SingleSourceField"})," or ",(0,r.jsx)(t.code,{children:"MultipleSourcesField"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",metastring:'title="plugins/target_types.py"',children:'from pants.engine.target import (\n    COMMON_TARGET_FIELDS,\n    Dependencies,\n    SingleSourceField,\n    StringField,\n    Target,\n)\n\n\nclass CustomField(StringField):\n    alias = "custom_field"\n    help = "A custom field."\n\n\nclass CustomTarget(Target):\n    alias = "custom_target"\n    core_fields = (*COMMON_TARGET_FIELDS, Dependencies, SingleSourceField, CustomField)\n    help = (\n      "A custom target to demo the Target API.\\n\\n"\n      "This docstring will be used in the output of "\n      "`pants help $target_type`."\n    )\n'})}),"\n",(0,r.jsxs)(t.admonition,{type:"note",children:[(0,r.jsxs)(t.mdxAdmonitionTitle,{children:["Tip: subclass ",(0,r.jsx)(t.code,{children:"SingleSourceField"})," or ",(0,r.jsx)(t.code,{children:"MultipleSourcesField"})]}),(0,r.jsxs)(t.p,{children:["Use ",(0,r.jsx)(t.code,{children:"SingleSourceField"})," for ",(0,r.jsx)(t.code,{children:"source: str"})," and ",(0,r.jsx)(t.code,{children:"MultipleSourcesField"})," for ",(0,r.jsx)(t.code,{children:"sources: Iterable[str]"}),"."]}),(0,r.jsx)(t.p,{children:"You will often want to subclass either of these fields to give custom functionality:"}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["set the ",(0,r.jsx)(t.code,{children:"default"})]}),"\n",(0,r.jsxs)(t.li,{children:["set ",(0,r.jsx)(t.code,{children:"expected_file_extensions"}),", e.g. to ",(0,r.jsx)(t.code,{children:'(".json", ".txt")'})]}),"\n",(0,r.jsxs)(t.li,{children:["set ",(0,r.jsx)(t.code,{children:"expected_num_files"}),", e.g. to ",(0,r.jsx)(t.code,{children:"1"})," or ",(0,r.jsx)(t.code,{children:"range(0, 5)"})," (i.e. 0 to 4 files)"]}),"\n"]})]}),"\n",(0,r.jsxs)(t.admonition,{title:"Using the fields of an existing target type",type:"note",children:[(0,r.jsx)(t.p,{children:"Sometimes, you may want to create a new target type that behaves similarly to one that already exists, except for some small changes."}),(0,r.jsxs)(t.p,{children:["For example, you might like how ",(0,r.jsx)(t.code,{children:"pex_binary"})," behaves in general, but you have a Django application and keep writing ",(0,r.jsx)(t.code,{children:'entry_point="manage.py"'}),". Normally, you should write a ",(0,r.jsx)(t.a,{href:"/2.18/docs/writing-plugins/macros",children:"macro"})," to set this default value; but, here, you also want to add new Django-specific fields, so you decide to create a new target type."]}),(0,r.jsx)(t.p,{children:"Rather than subclassing the original target type, use this pattern:"}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'from pants.backend.python.target_types import PexBinaryTarget, PexEntryPointField\nfrom pants.engine.target import Target\nfrom pants.util.ordered_set import FrozenOrderedSet\n\nclass DjangoEntryPointField(PexEntryPointField):\n   default = "manage.py"\n\n\nclass DjangoManagePyTarget(Target):\n   alias = "django_manage_py"\n   core_fields = (\n       *(FrozenOrderedSet(PexBinaryTarget.core_fields) - {PexEntryPoint}),\n       DjangoEntryPointField,\n   )\n'})}),(0,r.jsxs)(t.p,{children:["In this example, we register all of the fields of ",(0,r.jsx)(t.code,{children:"PexBinaryTarget"}),", except for the field ",(0,r.jsx)(t.code,{children:"PexEntryPoint "}),". We instead register our custom field ",(0,r.jsx)(t.code,{children:"DjangoEntryPointField "}),"."]})]}),"\n",(0,r.jsxs)(t.h2,{id:"step-2-register-the-target-type-in-registerpy",children:["Step 2: Register the target type in ",(0,r.jsx)(t.code,{children:"register.py"})]}),"\n",(0,r.jsxs)(t.p,{children:["Now, in your ",(0,r.jsx)(t.a,{href:"/2.18/docs/writing-plugins/overview",children:(0,r.jsx)(t.code,{children:"register.py"})}),", add the target type to the ",(0,r.jsx)(t.code,{children:"def target_types()"})," entry point."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",metastring:'title="plugins/register.py"',children:"from plugins.target_types import CustomTarget\n\ndef target_types():\n    return [CustomTarget]\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You can confirm this works by running ",(0,r.jsx)(t.code,{children:"pants help custom_target"}),"."]})]})}function g(e={}){let{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},848193(e,t,n){n.d(t,{R:()=>a,x:()=>o});var i=n(830758);let r={},s=i.createContext(r);function a(e){let t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:t},e.children)}},357673(e){e.exports=JSON.parse('{"id":"docs/writing-plugins/the-target-api/creating-new-targets","title":"Creating new targets","description":"How to add a custom target type.","source":"@site/versioned_docs/version-2.18/docs/writing-plugins/the-target-api/creating-new-targets.mdx","sourceDirName":"docs/writing-plugins/the-target-api","slug":"/docs/writing-plugins/the-target-api/creating-new-targets","permalink":"/2.18/docs/writing-plugins/the-target-api/creating-new-targets","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/writing-plugins/the-target-api/creating-new-targets.mdx","tags":[],"version":"2.18","sidebarPosition":2,"frontMatter":{"title":"Creating new targets","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Creating new fields","permalink":"/2.18/docs/writing-plugins/the-target-api/creating-new-fields"},"next":{"title":"Extending existing targets","permalink":"/2.18/docs/writing-plugins/the-target-api/extending-existing-targets"}}')}}]);