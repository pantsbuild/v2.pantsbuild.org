"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["409516"],{222443(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var a=t(817755),r=t(886070),i=t(848193);let s={authors:["benjy"],tags:["announcement"]},o="Tailoring Pants to your codebase",c={authorsImageUrls:[void 0]},l=[{value:"Reducing the BUILD maintenance burden",id:"reducing-the-build-maintenance-burden",level:2},{value:"How it works",id:"how-it-works",level:2}];function d(e){let n={a:"a",code:"code",em:"em",figcaption:"figcaption",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components},{CaptionedImg:a}=n;return a||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CaptionedImg",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a,{src:t(385861).A,children:(0,r.jsxs)(n.p,{children:["Photo by ",(0,r.jsx)(n.a,{href:"https://unsplash.com/@yasamine?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Yasamine\nJune"}),"\n/\n",(0,r.jsx)(n.a,{href:"https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Unsplash"})]})}),"\n","\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["TL;DR The ",(0,r.jsx)(n.code,{children:"tailor"})," goal, newly available in Pants 2.3.0, generates BUILD file boilerplate for you, making adopting Pants easier than ever!"]})}),"\n",(0,r.jsx)(n.p,{children:"Pants is a powerful system that brings speed and stability to your builds thanks to features such as fine-grained invalidation, caching, and concurrent execution."}),"\n",(0,r.jsxs)(n.p,{children:["These features rely on metadata that describes your code and its dependencies. So, as with other build systems, the price you pay for scalability and performance is having to maintain metadata about your code, in the form of ",(0,r.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/targets",children:"BUILD files"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Creating and updating BUILD files can be quite a chore, especially when first integrating Pants into an existing repo. And a key goal of the Pants Build project is to make users' lives easier, not harder! \xa0To achieve this goal we've made several ongoing efforts to minimize the burden of creating and maintaining this metadata."}),"\n",(0,r.jsx)(n.h2,{id:"reducing-the-build-maintenance-burden",children:"Reducing the BUILD maintenance burden"}),"\n",(0,r.jsx)(n.p,{children:"One way we cut down on BUILD boilerplate is by giving fields in target definitions sensible default values where possible."}),"\n",(0,r.jsx)(n.p,{children:"So, for example, consider this target:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'caption="src/python/rentacar/models/BUILD - very verbose"',children:'python_library(\n  name = "models",\n  sources = ["car.py", "driver.py", "agreement.py", "insurance.py"],\n  dependencies = [\n    "src/python/rentacar/base",\n    "src/python/rentacar/util",\n  ]\n)\n'})}),"\n",(0,r.jsx)(n.figcaption,{"data-remark-code-caption":!0,children:"src/python/rentacar/models/BUILD - very verbose"}),"\n",(0,r.jsx)(n.p,{children:"It can actually be written more succinctly as:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'caption="src/python/rentacar/models/BUILD - more succinct"',children:'python_library(\n  dependencies = [\n    "src/python/rentacar/base",\n    "src/python/rentacar/util",\n  ]\n)\n'})}),"\n",(0,r.jsx)(n.figcaption,{"data-remark-code-caption":!0,children:"src/python/rentacar/models/BUILD - more succinct"}),"\n",(0,r.jsxs)(n.p,{children:["because the ",(0,r.jsx)(n.code,{children:"name"})," field defaults to the directory name, and the ",(0,r.jsx)(n.code,{children:"sources"})," field for a ",(0,r.jsx)(n.code,{children:"python_library"})," defaults to ",(0,r.jsx)(n.code,{children:"*.py"})," (minus test files such as ",(0,r.jsx)(n.code,{children:"*_test.py"}),")",(0,r.jsx)(n.em,{children:"."})," These defaults have been available all the way back to early versions of Pants 1.x."]}),"\n",(0,r.jsxs)(n.p,{children:["But in Pants 2.x that same target can be written ",(0,r.jsx)(n.em,{children:"even more"})," succinctly as:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'caption="src/python/rentacar/models/BUILD - very succinct"',children:"python_library()\n"})}),"\n",(0,r.jsx)(n.figcaption,{"data-remark-code-caption":!0,children:"src/python/rentacar/models/BUILD - very succinct"}),"\n",(0,r.jsxs)(n.p,{children:["thanks to ",(0,r.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/targets#dependencies-and-dependency-inference",children:"dependency inference"}),", which infers the dependencies at runtime based on ",(0,r.jsx)(n.code,{children:"import"})," statements in the source files. Sometimes you do have to manually add dependencies that can't be inferred, but those are usually the exception."]}),"\n",(0,r.jsx)(n.p,{children:"So Pants 2.x BUILD files can be very concise, but you do still need to provide at least those trivial target definitions. \xa0And that can be a bit of a hassle."}),"\n",(0,r.jsxs)(n.p,{children:["Well now, in Pants 2.3.0, you can use the aptly-named ",(0,r.jsx)(n.code,{children:"tailor"})," goal to generate that remaining BUILD file boilerplate, hassle-free!"]}),"\n",(0,r.jsx)(n.p,{children:"Because, you know, a tailor makes your pants fit? I'll show myself out..."}),"\n",(0,r.jsx)(n.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,r.jsx)(n.p,{children:"You run"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"./pants tailor\n"})}),"\n",(0,r.jsx)(n.p,{children:"That's it. It's that simple!"}),"\n",(0,r.jsxs)(n.p,{children:["When you run the ",(0,r.jsx)(n.code,{children:"tailor"})," goal, Pants will scan your repo for file types it recognizes that don't belong to existing targets, and create new targets for them, either appending to existing BUILD files or creating new ones as needed."]}),"\n",(0,r.jsx)(n.p,{children:"For example, if Pants sees the following files in a directory with no BUILD file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'caption="src/python/rentacar/models"',children:"agreement.py\nagreement_test.py\ncar.py\ndriver.py\ndriver_test.py\ninsurance.py\nmodels.proto\nbase.proto\n"})}),"\n",(0,r.jsx)(n.figcaption,{"data-remark-code-caption":!0,children:"src/python/rentacar/models"}),"\n",(0,r.jsx)(n.p,{children:"then it'll generate the following BUILD file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'caption="src/python/rentacar/models/BUILD - generated"',children:'python_library()\n\npython_tests(name="tests")\n\nprotobuf_library()\n\n'})}),"\n",(0,r.jsx)(n.figcaption,{"data-remark-code-caption":!0,children:"src/python/rentacar/models/BUILD - generated"}),"\n",(0,r.jsxs)(n.p,{children:["If there was an existing BUILD file in the directory, and some of the files were already owned by targets in that BUILD file, then ",(0,r.jsx)(n.code,{children:"tailor"})," will append targets that cover just the unowned files."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"tailor"})," goal tries to generate targets that rely on default values when it can, but it has mechanisms to prevent naming collisions or sources overlapping across multiple targets. So it will give a target an explicit name, or enumerate its sources, if it must."]}),"\n",(0,r.jsxs)(n.p,{children:["Importantly, ",(0,r.jsx)(n.code,{children:"tailor"})," ",(0,r.jsx)(n.em,{children:"never"})," modifies existing targets, so you can run it safely without impacting existing metadata."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"tailor"})," works hand-in-hand with dependency inference - generated targets would be of very limited use use if you then had to manually stitch them together by adding dependencies everywhere."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"tailor"})," may not do the right thing in ",(0,r.jsx)(n.em,{children:"every"})," case, but that's OK - you can tweak the generated metadata manually before checking it into the repo."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"tailor"})," goal is exceptionally useful for new repos integrating Pants: you can generate the BUILD file scaffolding and get started in minutes. But you can also run ",(0,r.jsx)(n.code,{children:"tailor"})," in an ongoing way: as your repo grows and changes, re-run ",(0,r.jsx)(n.code,{children:"./pants tailor"})," to ensure that your BUILD files keep up."]}),"\n",(0,r.jsxs)(n.p,{children:["So give Pants 2.3.0 and ",(0,r.jsx)(n.code,{children:"tailor"})," a whirl - you may find that it's a perfect fit for your repo!"]})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},385861(e,n,t){t.d(n,{A:()=>a});let a=t.p+"assets/images/splash-0ac8458a98b4755d20daa2d77f6bf9b9.jpg"},848193(e,n,t){t.d(n,{R:()=>s,x:()=>o});var a=t(830758);let r={},i=a.createContext(r);function s(e){let n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(i.Provider,{value:n},e.children)}},817755(e){e.exports=JSON.parse('{"permalink":"/blog/2021/03/19/tailoring-pants-to-your-codebase","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-03-19-tailoring-pants-to-your-codebase/index.mdx","source":"@site/blog/2021-03-19-tailoring-pants-to-your-codebase/index.mdx","title":"Tailoring Pants to your codebase","description":"Photo by [Yasamine","date":"2021-03-19T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"}],"readingTime":3.81,"hasTruncateMarker":true,"authors":[{"name":"Benjy Weinberger","title":"Pants Co-creator and Maintainer","url":"https://github.com/benjyw","imageURL":"https://github.com/benjyw.png","key":"benjy","page":null}],"frontMatter":{"authors":["benjy"],"tags":["announcement"]},"unlisted":false,"prevItem":{"title":"Introducing Pants Build 2.3.0","permalink":"/blog/2021/03/22/introducing-pants-2-3-0"},"nextItem":{"title":"Pants 2.2 adds dependency inference for Protobuf","permalink":"/blog/2021/02/22/pants-2-2-adds-dependency-inference-for-protobuf"}}')}}]);