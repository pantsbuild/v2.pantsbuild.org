"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["42411"],{585362(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});var i=t(236228),r=t(886070),s=t(848193);let o={title:"1.30.x",sidebar_position:5},d,l={},a=[{value:"Experimental dependency inference feature",id:"experimental-dependency-inference-feature",level:2},{value:"How to activate",id:"how-to-activate",level:3},{value:"Teach Pants about your third party dependencies (recommended)",id:"teach-pants-about-your-third-party-dependencies-recommended",level:3},{value:"Known limitations",id:"known-limitations",level:3},{value:"Does not work with the v1 engine",id:"does-not-work-with-the-v1-engine",level:4},{value:"Performance tuning",id:"performance-tuning",level:4},{value:"May find cycles in your code",id:"may-find-cycles-in-your-code",level:4},{value:"No way to exclude inferred dependencies",id:"no-way-to-exclude-inferred-dependencies",level:4}];function c(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"Some highlights:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The Pants daemon (pantsd) is now enabled by default for improved performance."}),"\n",(0,r.jsx)(n.li,{children:"Added experimental support for Python dependency inference. See below."}),"\n",(0,r.jsxs)(n.li,{children:["Pants now logs when certain steps of your build are done. This improves, in particular, the experience when you have ",(0,r.jsx)(n.code,{children:"--no-dynamic-ui"})," enabled, such as in CI."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/blob/master/src/python/pants/notes/1.30.x.rst",children:"here"})," for a detailed change log."]}),"\n",(0,r.jsx)(n.h2,{id:"experimental-dependency-inference-feature",children:"Experimental dependency inference feature"}),"\n",(0,r.jsxs)(n.p,{children:["Pants can now read your Python source files to infer the ",(0,r.jsx)(n.code,{children:"dependencies"})," field for your Python targets, meaning that you can now leave off the ",(0,r.jsx)(n.code,{children:"dependencies"})," field for most of your BUILD files."]}),"\n",(0,r.jsx)(n.h3,{id:"how-to-activate",children:"How to activate"}),"\n",(0,r.jsxs)(n.p,{children:["Add ",(0,r.jsx)(n.code,{children:"dependency_inference = true"})," to your ",(0,r.jsx)(n.code,{children:"pants.toml"}),", like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:"[GLOBAL]\ndependency_inference = true\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To test that it is working, find a sample target, then delete the ",(0,r.jsx)(n.code,{children:"dependencies"})," field from its BUILD file and run ",(0,r.jsx)(n.code,{children:"./pants dependencies path/to:target"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"teach-pants-about-your-third-party-dependencies-recommended",children:"Teach Pants about your third party dependencies (recommended)"}),"\n",(0,r.jsxs)(n.p,{children:["Pants will assume that each of your dependencies exposes a module with the same name; for example, the requirement ",(0,r.jsx)(n.code,{children:"Django>=2.0"})," would expose the module ",(0,r.jsx)(n.code,{children:'"django"'}),". However, sometimes the module is different, like ",(0,r.jsx)(n.code,{children:"setuptools"})," exposing ",(0,r.jsx)(n.code,{children:"pkg_resources"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["If you are using a ",(0,r.jsx)(n.code,{children:"requirements.txt"})," and ",(0,r.jsx)(n.code,{children:"python_requirements()"})," target, teach Pants about any unusual modules like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="3rdparty/BUILD"',children:'python_library(\n  module_mapping={\n    "ansicolors": ["colors"],\n    "beautifulsoup4": ["bs4"],\n    "setuptools": ["pkg_resources"],\n  },\n)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["For inline ",(0,r.jsx)(n.code,{children:"python_requirement_library"})," targets, configure like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="3rdparty/BUILD"',children:"python_requirement_library(\n  name='setuptools',\n  requirements=[\n    python_requirement('setuptools', modules=['pkg_resources']),\n  ],\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"known-limitations",children:"Known limitations"}),"\n",(0,r.jsx)(n.h4,{id:"does-not-work-with-the-v1-engine",children:"Does not work with the v1 engine"}),"\n",(0,r.jsx)(n.p,{children:"You must be solely using the v2 engine for dependency inference to work. Otherwise, when you run v1 tasks, Pants will not know what your dependencies are."}),"\n",(0,r.jsx)(n.h4,{id:"performance-tuning",children:"Performance tuning"}),"\n",(0,r.jsx)(n.p,{children:"We have not yet closely tuned the performance. The performance should be acceptable\u2014and the results will be cached through the Pants daemon (pantsd)\u2014but dependency inference will result in a slowdown compared to explicit targets."}),"\n",(0,r.jsx)(n.h4,{id:"may-find-cycles-in-your-code",children:"May find cycles in your code"}),"\n",(0,r.jsxs)(n.p,{children:["Dependency inference sometimes reveals cycles between your targets that you did not know about. Run ",(0,r.jsx)(n.code,{children:"./pants dependencies --transitive ::"})," to see if you have any."]}),"\n",(0,r.jsx)(n.p,{children:"If you have cycles, you will need to manually fix these cycles by either creating new targets or moving around code"}),"\n",(0,r.jsx)(n.h4,{id:"no-way-to-exclude-inferred-dependencies",children:"No way to exclude inferred dependencies"}),"\n",(0,r.jsx)(n.p,{children:"Sometimes, dependency inference may infer something that you do not like. Currently, there is not a way to ignore the inference."}),"\n",(0,r.jsxs)(n.p,{children:["We are working on a feature to ignore a dependency by prefixing the value with ",(0,r.jsx)(n.code,{children:"!"}),", like ",(0,r.jsx)(n.code,{children:"!helloworld/project:util"}),"."]})]})}function h(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},848193(e,n,t){t.d(n,{R:()=>o,x:()=>d});var i=t(830758);let r={},s=i.createContext(r);function o(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}},236228(e){e.exports=JSON.parse('{"id":"docs/release-notes/versions/1.30.x","title":"1.30.x","description":"---","source":"@site/versioned_docs/version-2.4/docs/release-notes/versions/1.30.x.mdx","sourceDirName":"docs/release-notes/versions","slug":"/docs/release-notes/versions/1.30.x","permalink":"/2.4/docs/release-notes/versions/1.30.x","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/release-notes/versions/1.30.x.mdx","tags":[],"version":"2.4","sidebarPosition":5,"frontMatter":{"title":"1.30.x","sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"2.0.x","permalink":"/2.4/docs/release-notes/versions/2.0.x"},"next":{"title":"1.29.x","permalink":"/2.4/docs/release-notes/versions/1.29.x"}}')}}]);