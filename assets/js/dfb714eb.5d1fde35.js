"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["936559"],{491789(e,s,t){t.r(s),t.d(s,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>n,toc:()=>h});var n=t(46754),l=t(886070),i=t(848193),r=t(685008),o=t(637180);let c={title:"Options and subsystems",sidebar_position:2},a,d={},h=[{value:"Defining options",id:"defining-options",level:2},{value:"Option types",id:"option-types",level:3},{value:"Using options in rules",id:"using-options-in-rules",level:2}];function u(e){let s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.p,{children:"How to add options to your plugin."}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"defining-options",children:"Defining options"}),"\n",(0,l.jsxs)(s.p,{children:["As explained in ",(0,l.jsx)(s.a,{href:"/2.19/docs/using-pants/key-concepts/options",children:"Options"}),", options are partitioned into named scopes, like ",(0,l.jsx)(s.code,{children:"[test]"})," and ",(0,l.jsx)(s.code,{children:"[isort]"}),". Each of these scopes corresponds to a ",(0,l.jsx)(s.em,{children:"subsystem"}),"."]}),"\n",(0,l.jsx)(s.p,{children:"To add new options:"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["Define a subclass of ",(0,l.jsx)(s.code,{children:"Subsystem"})," from ",(0,l.jsx)(s.code,{children:"pants.subsystem.subsystem"}),".","\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["Set the class property ",(0,l.jsx)(s.code,{children:"options_scope"})," with the name of the subsystem.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["This value will be prepended to all options in the subsystem, e.g. ",(0,l.jsx)(s.code,{children:"--skip"})," will become ",(0,l.jsx)(s.code,{children:"--shellcheck-skip"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Set the class property ",(0,l.jsx)(s.code,{children:"help"}),", which is used by ",(0,l.jsx)(s.code,{children:"pants help"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Add new options through ",(0,l.jsx)(s.code,{children:"pants.options.option_types"})," class attributes."]}),"\n",(0,l.jsxs)(s.li,{children:["Register the ",(0,l.jsx)(s.code,{children:"Subsystem"})," with ",(0,l.jsx)(s.code,{children:"Subsystem.rules()"})," and ",(0,l.jsx)(s.code,{children:"register.py"}),".","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["You don't need ",(0,l.jsx)(s.code,{children:"Subsystem.rules()"})," if the ",(0,l.jsx)(s.code,{children:"Subsystem"})," is used in an ",(0,l.jsx)(s.code,{children:"@rule"})," because ",(0,l.jsx)(s.code,{children:"collect_rules()"})," will recognize it. It doesn't hurt to keep this around, though."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.A,{groupId:"code-examples",children:[(0,l.jsx)(o.A,{value:"pants-plugins/example/shellcheck.py",label:"pants-plugins/example/shellcheck.py",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",metastring:'tab={"label":"pants-plugins/example/shellcheck.py"}',children:'from pants.option.option_types import BoolOption\nfrom pants.option.subsystem import Subsystem\n\n\nclass ShellcheckSubsystem(Subsystem):\n    options_scope = "shellcheck"\n    help = "The Shellcheck linter."\n\n    config_discovery = BoolOption(\n        default=True,\n        advanced=True,\n        help="Whether Pants should...",\n    )\n\n\ndef rules():\n    return [*ShellcheckSubsystem.rules()]\n'})})}),(0,l.jsx)(o.A,{value:"pants-plugins/example/register.py",label:"pants-plugins/example/register.py",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",metastring:'tab={"label":"pants-plugins/example/register.py"}',children:"from example import shellcheck\n\ndef rules():\n    return [*shellcheck.rules()]\n"})})})]}),"\n",(0,l.jsxs)(s.p,{children:["The subsystem should now show up when you run ",(0,l.jsx)(s.code,{children:"pants help shellcheck"}),"."]}),"\n",(0,l.jsxs)(s.admonition,{type:"note",children:[(0,l.jsx)(s.mdxAdmonitionTitle,{children:(0,l.jsx)(s.code,{children:"GoalSubsystem"})}),(0,l.jsxs)(s.p,{children:["As explained in ",(0,l.jsx)(s.a,{href:"/2.19/docs/writing-plugins/the-rules-api/goal-rules",children:"Goal rules"}),", goals use a subclass of ",(0,l.jsx)(s.code,{children:"Subsystem"}),": ",(0,l.jsx)(s.code,{children:"GoalSubsystem"})," from ",(0,l.jsx)(s.code,{children:"pants.engine.goal"}),"."]}),(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"GoalSubsystem"})," behaves the same way as a normal subsystem, except that you set the class property ",(0,l.jsx)(s.code,{children:"name"})," rather than ",(0,l.jsx)(s.code,{children:"options_scope"}),". The ",(0,l.jsx)(s.code,{children:"name"})," will auto-populate the ",(0,l.jsx)(s.code,{children:"options_scope"}),"."]})]}),"\n",(0,l.jsx)(s.h3,{id:"option-types",children:"Option types"}),"\n",(0,l.jsxs)(s.p,{children:["These classes correspond to the option types at ",(0,l.jsx)(s.a,{href:"/2.19/docs/using-pants/key-concepts/options",children:"Options"}),"."]}),"\n",(0,l.jsxs)(s.p,{children:["Every option type requires that you set the keyword argument ",(0,l.jsx)(s.code,{children:"help"}),"."]}),"\n",(0,l.jsxs)(s.p,{children:["Most types require that you set ",(0,l.jsx)(s.code,{children:"default"}),". You can optionally set ",(0,l.jsx)(s.code,{children:"advanced=True"})," with every option\nfor it to only show up with ",(0,l.jsx)(s.code,{children:"help-advanced"}),"."]}),"\n",(0,l.jsxs)(s.p,{children:["The option name will default to the class attribute name, e.g. ",(0,l.jsx)(s.code,{children:"my_opt = StrOption()"})," will default to ",(0,l.jsx)(s.code,{children:"--my-opt"}),".\nYou can instead pass a string positional argument, e.g. ",(0,l.jsx)(s.code,{children:'my_opt = StrOption("--different-name")'}),"."]}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{style:{textAlign:"left"},children:"Class name"}),(0,l.jsx)(s.th,{style:{textAlign:"left"},children:"Notes"})]})}),(0,l.jsxs)(s.tbody,{children:[(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{style:{textAlign:"left"},children:(0,l.jsx)(s.code,{children:"StrOption"})}),(0,l.jsxs)(s.td,{style:{textAlign:"left"},children:["Must set ",(0,l.jsx)(s.code,{children:"default"})," to a ",(0,l.jsx)(s.code,{children:"str"})," or ",(0,l.jsx)(s.code,{children:"None"}),"."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{style:{textAlign:"left"},children:(0,l.jsx)(s.code,{children:"BoolOption"})}),(0,l.jsxs)(s.td,{style:{textAlign:"left"},children:["Must set ",(0,l.jsx)(s.code,{children:"default"})," to a ",(0,l.jsx)(s.code,{children:"bool"})," or ",(0,l.jsx)(s.code,{children:"None"}),". TODO ",(0,l.jsx)("br",{})," ",(0,l.jsx)("br",{}),"Reminder when choosing a flag name: Pants will recognize the command line argument ",(0,l.jsx)(s.code,{children:"--no-my-flag-name"})," as equivalent to ",(0,l.jsx)(s.code,{children:"--my-flag-name=false"}),"."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{style:{textAlign:"left"},children:(0,l.jsx)(s.code,{children:"IntOption"})}),(0,l.jsxs)(s.td,{style:{textAlign:"left"},children:["Must set ",(0,l.jsx)(s.code,{children:"default"})," to an ",(0,l.jsx)(s.code,{children:"int"})," or ",(0,l.jsx)(s.code,{children:"None"}),"."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{style:{textAlign:"left"},children:(0,l.jsx)(s.code,{children:"FloatOption"})}),(0,l.jsxs)(s.td,{style:{textAlign:"left"},children:["Must set ",(0,l.jsx)(s.code,{children:"default"})," to a ",(0,l.jsx)(s.code,{children:"float"})," or ",(0,l.jsx)(s.code,{children:"None"}),"."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{style:{textAlign:"left"},children:(0,l.jsx)(s.code,{children:"EnumOption"})}),(0,l.jsxs)(s.td,{style:{textAlign:"left"},children:["This is like ",(0,l.jsx)(s.code,{children:"StrOption"}),", but with the valid choices constrained to your enum. ",(0,l.jsx)("br",{})," ",(0,l.jsx)("br",{}),"To use, define an ",(0,l.jsx)(s.code,{children:"enum.Enum"}),". The values of your enum will be what users can type, e.g. ",(0,l.jsx)(s.code,{children:"'kale'"})," and ",(0,l.jsx)(s.code,{children:"'spinach'"})," below: ",(0,l.jsx)("br",{})," ",(0,l.jsx)("br",{}),(0,l.jsx)(s.code,{children:'python<br/>class LeafyGreens(Enum):<br/>    KALE = "kale"<br/>    SPINACH = "spinach"<br/>'}),"You must either set ",(0,l.jsx)(s.code,{children:"default"})," to a value from your enum or ",(0,l.jsx)(s.code,{children:"None"}),". If you set ",(0,l.jsx)(s.code,{children:"default=None"}),", you must set ",(0,l.jsx)(s.code,{children:"enum_type"}),"."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsxs)(s.td,{style:{textAlign:"left"},children:["List options: ",(0,l.jsx)("br",{})," ",(0,l.jsx)("br",{}),"- ",(0,l.jsx)(s.code,{children:"StrListOption"}),(0,l.jsx)("br",{}),"- ",(0,l.jsx)(s.code,{children:"BoolListOption"}),(0,l.jsx)("br",{}),"- ",(0,l.jsx)(s.code,{children:"IntListOption"}),(0,l.jsx)("br",{}),"- ",(0,l.jsx)(s.code,{children:"FloatListOption"}),(0,l.jsx)("br",{}),"- ",(0,l.jsx)(s.code,{children:"EnumListOption"})]}),(0,l.jsxs)(s.td,{style:{textAlign:"left"},children:["Default is ",(0,l.jsx)(s.code,{children:"[]"})," if ",(0,l.jsx)(s.code,{children:"default"})," is not set. ",(0,l.jsx)("br",{})," ",(0,l.jsx)("br",{}),"For ",(0,l.jsx)(s.code,{children:"EnumListOption"}),", you must set the keyword argument ",(0,l.jsx)(s.code,{children:"enum_type"}),"."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{style:{textAlign:"left"},children:(0,l.jsx)(s.code,{children:"DictOption"})}),(0,l.jsxs)(s.td,{style:{textAlign:"left"},children:["Default is ",(0,l.jsx)(s.code,{children:"{}"})," if ",(0,l.jsx)(s.code,{children:"default"})," is not set. ",(0,l.jsx)("br",{})," ",(0,l.jsx)("br",{}),"Currently, Pants does not offer any validation of the dictionary entries, e.g. ",(0,l.jsx)(s.code,{children:"dict[str, str]"})," vs ",(0,l.jsx)(s.code,{children:"dict[str, list[str]]"}),". (Although per TOML specs, the key should always be ",(0,l.jsx)(s.code,{children:"str"}),".) You may want to add eager validation that users are inputting options the correct way."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{style:{textAlign:"left"},children:(0,l.jsx)(s.code,{children:"ArgsListOption"})}),(0,l.jsxs)(s.td,{style:{textAlign:"left"},children:["Adds an ",(0,l.jsx)(s.code,{children:"--args"})," option, e.g. ",(0,l.jsx)(s.code,{children:"--isort-args"}),". This type is extra useful because it uses a special ",(0,l.jsx)(s.code,{children:"shell_str"})," that lets users type the arguments as a single string with spaces, which Pants will ",(0,l.jsx)(s.em,{children:"shlex"})," for them. That is, ",(0,l.jsx)(s.code,{children:"--args='arg1 arg2'"})," gets converted to ",(0,l.jsx)(s.code,{children:"['arg1', 'arg2']"}),". ",(0,l.jsx)("br",{})," ",(0,l.jsx)("br",{}),"You must set the keyword argument ",(0,l.jsx)(s.code,{children:"example"}),", e.g. ",(0,l.jsx)(s.code,{children:"'--arg1 arg2'"}),". You must also set ",(0,l.jsx)(s.code,{children:"tool_name: str"}),", e.g. ",(0,l.jsx)(s.code,{children:"'Black'"}),". ",(0,l.jsx)("br",{})," ",(0,l.jsx)("br",{}),"You can optionally set ",(0,l.jsx)(s.code,{children:"passthrough=True"})," if the user should be able to use the style ",(0,l.jsx)(s.code,{children:"pants my-goal :: -- --arg1"}),", i.e. arguments after ",(0,l.jsx)(s.code,{children:"--"}),"."]})]})]})]}),"\n",(0,l.jsx)(s.h2,{id:"using-options-in-rules",children:"Using options in rules"}),"\n",(0,l.jsxs)(s.p,{children:["To use a ",(0,l.jsx)(s.code,{children:"Subsystem"})," or ",(0,l.jsx)(s.code,{children:"GoalSubsystem"})," in your rule, request it as a parameter. Then, use the class attributes to access the option value."]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:"from pants.engine.rules import rule\n...\n\n@rule\nasync def demo(shellcheck: Shellcheck) -> LintResults:\n    if shellcheck.skip:\n        return LintResults()\n    config_discovery = shellcheck.config_discovery\n    ...\n"})}),"\n",(0,l.jsx)(s.admonition,{title:"Name clashing",type:"note",children:(0,l.jsxs)(s.p,{children:["When adding custom options, make sure their name does not start with an existing goal name. For instance, passing a boolean option named ",(0,l.jsx)(s.code,{children:"check_foobar"})," as ",(0,l.jsx)(s.code,{children:"--check-foobar"})," in the command line would fail since Pants would think you are trying to pass the ",(0,l.jsx)(s.code,{children:"--foobar"})," flag in the built-in ",(0,l.jsx)(s.code,{children:"check"})," goal scope."]})})]})}function p(e={}){let{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(u,{...e})}):u(e)}},753348(e,s,t){t.d(s,{A:()=>n});let n={tabItem:"tabItem_mHvh"}},618264(e,s,t){t.d(s,{A:()=>n});let n={tabList:"tabList_sFbf",tabItem:"tabItem_UVfV"}},637180(e,s,t){t.d(s,{A:()=>r});var n=t(886070);t(830758);var l=t(313526),i=t(753348);function r({children:e,hidden:s,className:t}){return(0,n.jsx)("div",{role:"tabpanel",className:(0,l.A)(i.A.tabItem,t),hidden:s,children:e})}},685008(e,s,t){t.d(s,{A:()=>x});var n=t(886070),l=t(830758),i=t(313526),r=t(911212),o=t(274875),c=t(106632),a=t(189223),d=t(618264);function h({className:e,block:s,selectedValue:t,selectValue:l,tabValues:r}){let c=[],{blockElementScrollPositionUntilNextRender:a}=(0,o.a_)(),h=e=>{let s=e.currentTarget,n=r[c.indexOf(s)].value;n!==t&&(a(s),l(n))},u=e=>{let s=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{let t=c.indexOf(e.currentTarget)+1;s=c[t]??c[0];break}case"ArrowLeft":{let t=c.indexOf(e.currentTarget)-1;s=c[t]??c[c.length-1]}}s?.focus()};return(0,n.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":s},e),children:r.map(({value:e,label:s,attributes:l})=>(0,n.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{c.push(e)},onKeyDown:u,onClick:h,...l,className:(0,i.A)("tabs__item",d.A.tabItem,l?.className,{"tabs__item--active":t===e}),children:s??e},e))})}function u({lazy:e,children:s,selectedValue:t}){let r=(Array.isArray(s)?s:[s]).filter(Boolean);if(e){let e=r.find(e=>e.props.value===t);return e?(0,l.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,n.jsx)("div",{className:"margin-top--md",children:r.map((e,s)=>(0,l.cloneElement)(e,{key:s,hidden:e.props.value!==t}))})}function p(e){let s=(0,c.u)(e);return(0,n.jsxs)("div",{className:(0,i.A)(r.G.tabs.container,"tabs-container",d.A.tabList),children:[(0,n.jsx)(h,{...s,...e}),(0,n.jsx)(u,{...s,...e})]})}function x(e){let s=(0,a.A)();return(0,n.jsx)(p,{...e,children:(0,c.v)(e.children)},String(s))}},106632(e,s,t){t.d(s,{u:()=>h,v:()=>a});var n=t(830758),l=t(325557),i=t(363717),r=t(125740),o=t(574229),c=t(270367);function a(e){return n.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,n.isValidElement)(e)&&function(e){let{props:s}=e;return!!s&&"object"==typeof s&&"value"in s}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function d({value:e,tabValues:s}){return s.some(s=>s.value===e)}function h(e){let s,{defaultValue:t,queryString:h=!1,groupId:u}=e,p=function(e){let{values:s,children:t}=e;return(0,n.useMemo)(()=>{let e=s??a(t).map(({props:{value:e,label:s,attributes:t,default:n}})=>({value:e,label:s,attributes:t,default:n})),n=(0,o.XI)(e,(e,s)=>e.value===s.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[s,t])}(e),[x,j]=(0,n.useState)(()=>(function({defaultValue:e,tabValues:s}){if(0===s.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!d({value:e,tabValues:s}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${s.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let t=s.find(e=>e.default)??s[0];if(!t)throw Error("Unexpected error: 0 tabValues");return t.value})({defaultValue:t,tabValues:p})),[m,f]=function({queryString:e=!1,groupId:s}){let t=(0,l.W6)(),i=function({queryString:e=!1,groupId:s}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!s)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:e,groupId:s});return[(0,r.aZ)(i),(0,n.useCallback)(e=>{if(!i)return;let s=new URLSearchParams(t.location.search);s.set(i,e),t.replace({...t.location,search:s.toString()})},[i,t])]}({queryString:h,groupId:u}),[g,y]=function({groupId:e}){let s=e?`docusaurus.tab.${e}`:null,[t,l]=(0,c.Dv)(s);return[t,(0,n.useCallback)(e=>{s&&l.set(e)},[s,l])]}({groupId:u}),b=d({value:s=m??g,tabValues:p})?s:null;return(0,i.A)(()=>{b&&j(b)},[b]),{selectedValue:x,selectValue:(0,n.useCallback)(e=>{if(!d({value:e,tabValues:p}))throw Error(`Can't select invalid tab value=${e}`);j(e),f(e),y(e)},[f,y,p]),tabValues:p}}},848193(e,s,t){t.d(s,{R:()=>r,x:()=>o});var n=t(830758);let l={},i=n.createContext(l);function r(e){let s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),n.createElement(i.Provider,{value:s},e.children)}},46754(e){e.exports=JSON.parse('{"id":"docs/writing-plugins/the-rules-api/options-and-subsystems","title":"Options and subsystems","description":"How to add options to your plugin.","source":"@site/versioned_docs/version-2.19/docs/writing-plugins/the-rules-api/options-and-subsystems.mdx","sourceDirName":"docs/writing-plugins/the-rules-api","slug":"/docs/writing-plugins/the-rules-api/options-and-subsystems","permalink":"/2.19/docs/writing-plugins/the-rules-api/options-and-subsystems","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/writing-plugins/the-rules-api/options-and-subsystems.mdx","tags":[],"version":"2.19","sidebarPosition":2,"frontMatter":{"title":"Options and subsystems","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Goal rules","permalink":"/2.19/docs/writing-plugins/the-rules-api/goal-rules"},"next":{"title":"File system","permalink":"/2.19/docs/writing-plugins/the-rules-api/file-system"}}')}}]);