"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["285511"],{501466(e,s,t){t.r(s),t.d(s,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>n,toc:()=>c});var n=t(415366),i=t(886070),d=t(848193);let r={title:"Plugin upgrade guide",sidebar_position:9},a,o={},c=[{value:"2.0.0",id:"200",level:2},{value:"Use <code>TransitiveTargetsRequest</code> as input for resolving <code>TransitiveTargets</code> (2.0.0rc0)",id:"use-transitivetargetsrequest-as-input-for-resolving-transitivetargets-200rc0",level:3},{value:"Codegen implementations: use <code>DependenciesRequestLite</code> and <code>TransitiveTargetsLite</code> (2.0.0rc0)",id:"codegen-implementations-use-dependenciesrequestlite-and-transitivetargetslite-200rc0",level:3},{value:"Dependencies-like fields have more robust support (2.0.0rc0)",id:"dependencies-like-fields-have-more-robust-support-200rc0",level:3},{value:"<code>package</code> implementations may want to add the field <code>output_path</code> (2.0.0rc0)",id:"package-implementations-may-want-to-add-the-field-output_path-200rc0",level:3}];function l(e){let s={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.p,{children:"How to adjust for changes made to the Plugin API."}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"200",children:"2.0.0"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/master/src/python/pants/notes/2.0.x.rst",children:"https://github.com/pantsbuild/pants/blob/master/src/python/pants/notes/2.0.x.rst"})," for the changelog."]}),"\n",(0,i.jsxs)(s.h3,{id:"use-transitivetargetsrequest-as-input-for-resolving-transitivetargets-200rc0",children:["Use ",(0,i.jsx)(s.code,{children:"TransitiveTargetsRequest"})," as input for resolving ",(0,i.jsx)(s.code,{children:"TransitiveTargets"})," (2.0.0rc0)"]}),"\n",(0,i.jsxs)(s.p,{children:["Rather than ",(0,i.jsx)(s.code,{children:"await Get(TransitiveTargets, Addresses([addr1]))"}),", use ",(0,i.jsx)(s.code,{children:"await Get(TransitiveTargets, TransitiveTargetsRequest([addr1]))"}),", from ",(0,i.jsx)(s.code,{children:"pants.engine.target"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["It's no longer possible to include ",(0,i.jsx)(s.code,{children:"TransitiveTargets"})," in your ",(0,i.jsx)(s.code,{children:"@rule"})," signature in order to get the transitive closure of what the user specified on the command. Instead, put ",(0,i.jsx)(s.code,{children:"Addresses"})," in your rule's signature, and use ",(0,i.jsx)(s.code,{children:"await Get(TransitiveTargets, TransitiveTargetsRequest(addresses))"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"codegen-implementations-use-dependenciesrequestlite-and-transitivetargetslite-200rc0",children:["Codegen implementations: use ",(0,i.jsx)(s.code,{children:"DependenciesRequestLite"})," and ",(0,i.jsx)(s.code,{children:"TransitiveTargetsLite"})," (2.0.0rc0)"]}),"\n",(0,i.jsxs)(s.p,{children:["Due to a new cycle in the rule graph, for any codegen implementations, you must use ",(0,i.jsx)(s.code,{children:"DependenciesRequestLite"})," instead of ",(0,i.jsx)(s.code,{children:"DependenciesRequest"}),", and ",(0,i.jsx)(s.code,{children:"TransitiveTargetsLite"})," instead of ",(0,i.jsx)(s.code,{children:"TransitiveTargetsRequest"}),". Both imports are still from ",(0,i.jsx)(s.code,{children:"pants.engine.target"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["These behave identically, except that they do not include dependency inference in the results. Unless you are generating for ",(0,i.jsx)(s.code,{children:"input = PythonSources"}),", this should be fine, as dependency inference is currently only used with Python."]}),"\n",(0,i.jsxs)(s.p,{children:["This is tracked by ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/issues/10917",children:"https://github.com/pantsbuild/pants/issues/10917"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"dependencies-like-fields-have-more-robust-support-200rc0",children:"Dependencies-like fields have more robust support (2.0.0rc0)"}),"\n",(0,i.jsxs)(s.p,{children:["If you have any custom fields that act like the dependencies field, but do not subclass ",(0,i.jsx)(s.code,{children:"Dependencies"}),", there are two new mechanisms for better support."]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Instead of subclassing ",(0,i.jsx)(s.code,{children:"StringSequenceField"}),", subclass ",(0,i.jsx)(s.code,{children:"SpecialCasedDependencies"})," from ",(0,i.jsx)(s.code,{children:"pants.engine.target"}),". This will ensure that the dependencies show up with ",(0,i.jsx)(s.code,{children:"./pants dependencies"})," and ",(0,i.jsx)(s.code,{children:"./pants dependees"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["You can use ",(0,i.jsx)(s.code,{children:"UnparsedAddressInputs"})," from ",(0,i.jsx)(s.code,{children:"pants.engine.addresses"})," to resolve the addresses:"]}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from pants.engine.addresses import Address, Addresses, UnparsedAddressedInputs\nfrom pants.engine.target import Targets\n\n...\n\naddresses = await Get(Addresses, UnparsedAddressedInputs(["//:addr1", "project/addr2"], owning_address=None)\n\n# Or, use this.\ntargets = await Get(\n    Targets,\n    UnparsedAddressedInputs(["//:addr1", "project/addr2"], owning_address=Address("project", target_name="original")\n)\n'})}),"\n",(0,i.jsxs)(s.p,{children:["If you defined a subclass of ",(0,i.jsx)(s.code,{children:"SpecialCasedDependencies"}),", you can use ",(0,i.jsx)(s.code,{children:"await Get(Addresses | Targets, UnparsedAddressInputs, my_tgt[MyField].to_unparsed_address_inputs())"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["(Why would you ever do this? If you have dependencies that you don't treat like normal\u2014e.g. that you will call the equivalent of ",(0,i.jsx)(s.code,{children:"./pants package"})," on those deps\u2014it's often helpful to call out this magic through a dedicated field. For example, Pants's ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/969c8dcba6eda0c939918b3bc5157ca45099b4d1/src/python/pants/core/target_types.py#L231-L257",children:"archive"})," target type has the fields ",(0,i.jsx)(s.code,{children:"files"})," and ",(0,i.jsx)(s.code,{children:"packages"}),", rather than ",(0,i.jsx)(s.code,{children:"dependencies"}),".)"]}),"\n",(0,i.jsxs)(s.h3,{id:"package-implementations-may-want-to-add-the-field-output_path-200rc0",children:[(0,i.jsx)(s.code,{children:"package"})," implementations may want to add the field ",(0,i.jsx)(s.code,{children:"output_path"})," (2.0.0rc0)"]}),"\n",(0,i.jsxs)(s.p,{children:["All of Pants's target types that can be built via ",(0,i.jsx)(s.code,{children:"./pants package"})," now have an ",(0,i.jsx)(s.code,{children:"output_path"})," field, which allows the user to override the path used for the created asset."]}),"\n",(0,i.jsxs)(s.p,{children:["You optionally may want to add this ",(0,i.jsx)(s.code,{children:"output_path"})," field to your custom target type for consistency:"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Include ",(0,i.jsx)(s.code,{children:"OutputPathField"})," from ",(0,i.jsx)(s.code,{children:"pants.core.goals.package"})," in your target's ",(0,i.jsx)(s.code,{children:"core_fields"})," class property."]}),"\n",(0,i.jsxs)(s.li,{children:["In your ",(0,i.jsx)(s.code,{children:"PackageFieldSet"})," subclass, include ",(0,i.jsx)(s.code,{children:"output_path: OutputPathField"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["When computing the filename in your rule, use ",(0,i.jsx)(s.code,{children:'my_package_field_set.output_path.value_or_default(field_set.address, file_ending="my_ext")'}),"."]}),"\n"]})]})}function p(e={}){let{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},848193(e,s,t){t.d(s,{R:()=>r,x:()=>a});var n=t(830758);let i={},d=n.createContext(i);function r(e){let s=n.useContext(d);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(d.Provider,{value:s},e.children)}},415366(e){e.exports=JSON.parse('{"id":"docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide","title":"Plugin upgrade guide","description":"How to adjust for changes made to the Plugin API.","source":"@site/versioned_docs/version-2.0/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide.mdx","sourceDirName":"docs/writing-plugins/common-plugin-tasks","slug":"/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide","permalink":"/2.0/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide.mdx","tags":[],"version":"2.0","sidebarPosition":9,"frontMatter":{"title":"Plugin upgrade guide","sidebar_position":9},"sidebar":"docsSidebar","previous":{"title":"Custom `setup_py()` kwargs","permalink":"/2.0/docs/writing-plugins/common-plugin-tasks/custom-setup-py-kwargs"},"next":{"title":"Deprecation policy","permalink":"/2.0/docs/release-notes/deprecation-policy"}}')}}]);