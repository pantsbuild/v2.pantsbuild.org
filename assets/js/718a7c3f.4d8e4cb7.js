"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["314680"],{136401(e,t,s){s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>c});var n=s(715853),o=s(886070),r=s(848193);let i={title:"Restricted Internet access",sidebar_position:12},a,l={},c=[{value:"Installing Pants",id:"installing-pants",level:2},{value:"Setting up a Certificate Authority",id:"setting-up-a-certificate-authority",level:2},{value:"Setting <code>HTTP_PROXY</code> and <code>HTTPS_PROXY</code>",id:"setting-http_proxy-and-https_proxy",level:2},{value:"Customizing tool download locations",id:"customizing-tool-download-locations",level:2},{value:"Python tools",id:"python-tools",level:3},{value:"JVM tools",id:"jvm-tools",level:3},{value:"Binary tools",id:"binary-tools",level:3}];function d(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"How to use Pants when you have restricted access to the Internet"}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.p,{children:"Some organizations place restrictions on their users' Internet access, for security or compliance reasons. Such restrictions may prevent Pants from downloading various underlying tools it uses, and it may interfere with bootstrapping Pants itself."}),"\n",(0,o.jsx)(t.p,{children:"In such cases, users are typically still able to access internal proxies and servers. This page shows how to configure Pants to work smoothly in these circumstances."}),"\n",(0,o.jsx)(t.h2,{id:"installing-pants",children:"Installing Pants"}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"pants"})," script from ",(0,o.jsx)(t.a,{href:"/2.16/docs/getting-started/installing-pants",children:"Installing Pants"})," uses PyPI to download and install the wheel ",(0,o.jsx)(t.code,{children:"pantsbuild.pants"})," and all of Pants's dependencies."]}),"\n",(0,o.jsxs)(t.p,{children:["If you cannot access PyPI directly, you may have an internal mirror or custom Python package repository. If so, you can ensure that ",(0,o.jsx)(t.code,{children:"pantsbuild.pants"})," and all of its dependencies are available in that repository, and modify your ",(0,o.jsx)(t.code,{children:"pants"})," script to bootstrap from it."]}),"\n",(0,o.jsxs)(t.p,{children:["Otherwise, you may instead download Pants as a PEX binary from ",(0,o.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/releases",children:"https://github.com/pantsbuild/pants/releases"}),". After downloading the PEX artifact, you can rename the file to ",(0,o.jsx)(t.code,{children:"pants"}),", run ",(0,o.jsx)(t.code,{children:"chmod +x pants"}),", then run ",(0,o.jsx)(t.code,{children:"pants --version"})," like you normally would."]}),"\n",(0,o.jsxs)(t.p,{children:["You may want to check the binary into version control so that everyone in your organization can use it. To upgrade to a new Pants release, update the ",(0,o.jsx)(t.code,{children:"pants_version"})," option in ",(0,o.jsx)(t.code,{children:"pants.toml"})," and download the newest release from ",(0,o.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/releases",children:"https://github.com/pantsbuild/pants/releases"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"setting-up-a-certificate-authority",children:"Setting up a Certificate Authority"}),"\n",(0,o.jsxs)(t.p,{children:["By default, Pants will respect and pass through the ",(0,o.jsx)(t.code,{children:"SSL_CERT_DIR"})," and ",(0,o.jsx)(t.code,{children:"SSL_CERT_FILE"})," environment variables."]}),"\n",(0,o.jsx)(t.p,{children:"If you need to override those values, you can configure Pants to use a custom Certificate Authority (CA) bundle:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nca_certs_path = "/path/to/certs/file"\n'})}),"\n",(0,o.jsxs)(t.h2,{id:"setting-http_proxy-and-https_proxy",children:["Setting ",(0,o.jsx)(t.code,{children:"HTTP_PROXY"})," and ",(0,o.jsx)(t.code,{children:"HTTPS_PROXY"})]}),"\n",(0,o.jsxs)(t.p,{children:["You may need to set standard proxy-related environment variables, such as ",(0,o.jsx)(t.code,{children:"http_proxy"}),", ",(0,o.jsx)(t.code,{children:"https_proxy"})," and ",(0,o.jsx)(t.code,{children:"all_proxy"}),", in executed subprocesses:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[subprocess-environment]\nenv_vars.add = ["http_proxy=http://myproxy", "https_proxy"]\n'})}),"\n",(0,o.jsx)(t.p,{children:"You may need to use lowercase or uppercase env var names, or both."}),"\n",(0,o.jsxs)(t.p,{children:["Note that if you leave of the env var's value, as for ",(0,o.jsx)(t.code,{children:"https_proxy"})," above, Pants will use the value of the same variable in the environment in which it is invoked."]}),"\n",(0,o.jsx)(t.h2,{id:"customizing-tool-download-locations",children:"Customizing tool download locations"}),"\n",(0,o.jsx)(t.p,{children:"There are three types of tools that Pants may need to download and invoke:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Python tools"}),": these are resolved from a package repository (PyPI by default) via requirement strings such as ",(0,o.jsx)(t.code,{children:"mypy==0.910"}),"."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"JVM tools"}),": these are resolved from a package repository (Maven Central by default) via coordinates such as ",(0,o.jsx)(t.code,{children:"org.scalatest:scalatest_2.13:3.2.10"}),"."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Standalone binaries"}),": these are downloaded from a configured URL and verified against a SHA256 hash."]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"If you cannot access these resources from their default locations, you can customize those locations."}),"\n",(0,o.jsxs)(t.p,{children:["You can get a list of the tools Pants uses, in all three categories, with ",(0,o.jsx)(t.code,{children:"pants help tools"}),"."]}),"\n",(0,o.jsx)(t.h3,{id:"python-tools",children:"Python tools"}),"\n",(0,o.jsxs)(t.p,{children:["Pants downloads the various Python-related tools it uses from ",(0,o.jsx)(t.a,{href:"https://pypi.org/",children:"PyPI"}),", just as it does for your Python code's dependencies."]}),"\n",(0,o.jsx)(t.p,{children:"If you use Python but cannot access PyPI directly, then you probably have an internal mirror or a custom Python package repository. So all you have to do is configure Pants to access this custom repository, and ensure that the tools it needs are available there."}),"\n",(0,o.jsxs)(t.p,{children:["See ",(0,o.jsx)(t.a,{href:"/2.16/docs/python/overview/third-party-dependencies#custom-repositories",children:"Python third-party dependencies"})," for instructions on how to set up Pants to access a custom Python package repository."]}),"\n",(0,o.jsx)(t.h3,{id:"jvm-tools",children:"JVM tools"}),"\n",(0,o.jsxs)(t.p,{children:["Pants downloads the various JVM-related tools it uses from ",(0,o.jsx)(t.a,{href:"https://search.maven.org/",children:"Maven Central"}),", just as it does for your JVM code's dependencies."]}),"\n",(0,o.jsx)(t.p,{children:"If you use JVM code but cannot access Maven Central directly, then you probably have an internal mirror or a custom JVM package repository. So all you have to do is configure Pants to access this custom repository, and ensure that the tools it needs are available there."}),"\n",(0,o.jsxs)(t.p,{children:["To do so, set the ",(0,o.jsx)(t.a,{href:"/2.16/reference/subsystems/coursier#section-repos",children:(0,o.jsx)(t.code,{children:"repos"})})," option on the ",(0,o.jsx)(t.code,{children:"[coursier]"})," scope. E.g.,"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-text",metastring:'title="pants.toml"',children:'[coursier]\nrepos = ["https://my.custom.repo/maven2"]\n'})}),"\n",(0,o.jsx)(t.h3,{id:"binary-tools",children:"Binary tools"}),"\n",(0,o.jsx)(t.p,{children:"Pants downloads various binary tools from preset locations, and verifies them against a SHA. If you are not able to allowlist these locations, you can host the binaries yourself and instruct Pants to use the custom locations."}),"\n",(0,o.jsxs)(t.p,{children:["You set these custom locations by setting the ",(0,o.jsx)(t.code,{children:"url_template"})," option for the tool. In this URL template, Pants will replace ",(0,o.jsx)(t.code,{children:"{version}"})," with the requested version of the tool and ",(0,o.jsx)(t.code,{children:"{platform}"}),", with the platform name (e.g., ",(0,o.jsx)(t.code,{children:"linux.x86_64"}),")."]}),"\n",(0,o.jsxs)(t.p,{children:["The platform name used to replace the ",(0,o.jsx)(t.code,{children:"{platform}"})," placeholder can be modified using the ",(0,o.jsx)(t.code,{children:"url_platform_mapping"})," option for the tool. This option maps a canonical platform name (",(0,o.jsx)(t.code,{children:"linux_arm64"}),", ",(0,o.jsx)(t.code,{children:"linux_x86_64"}),", ",(0,o.jsx)(t.code,{children:"macos_arm64"}),", ",(0,o.jsx)(t.code,{children:"macos_x86_64"}),") to the name that should be substituted into the template."]}),"\n",(0,o.jsx)(t.p,{children:"This is best understood by looking at an example:"}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"pants help-advanced protoc"})," (or its ",(0,o.jsx)(t.a,{href:"/2.16/reference/subsystems/protoc#advanced-options",children:"online equivalent"}),") shows that the default URL template is ",(0,o.jsx)(t.code,{children:"https://github.com/protocolbuffers/protobuf/releases/download/v{version}/protoc-{version}-{platform}.zip"}),"."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["We see the ",(0,o.jsx)(t.code,{children:"version"})," option is set to ",(0,o.jsx)(t.code,{children:"3.11.4"}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["We are running on macOS ARM, so look up ",(0,o.jsx)(t.code,{children:"macos_arm64"})," in the ",(0,o.jsx)(t.code,{children:"url_platform_mapping"})," option and find the string ",(0,o.jsx)(t.code,{children:"osx-x86_64"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Thus, the final URL is:\n",(0,o.jsx)(t.code,{children:"https://github.com/protocolbuffers/protobuf/releases/download/v3.11.4/protoc-3.11.4-osx-x86_64.zip"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"It should be clear from this example how to modify the URL template to point to your own hosted binaries:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",metastring:'title="pants.toml"',children:'[protoc]\nurl_template = "https://my.custom.host/bin/protoc/{version}/{platform}/protoc.zip"\n'})}),"\n",(0,o.jsxs)(t.p,{children:["For simplicity, we used the original value for ",(0,o.jsx)(t.code,{children:"url_platform_mapping"}),", meaning that we set up our hosted URL to store the macOS x86 binary at ",(0,o.jsx)(t.code,{children:".../osx-x86_64/protoc.zip"}),", for example. You can override the option ",(0,o.jsx)(t.code,{children:"url_platform_mapping"})," if you want to use different values."]}),"\n",(0,o.jsxs)(t.p,{children:['Occasionally, new Pants releases will upgrade to new versions of these binaries, which will be mentioned in the "User API Changes" part of the changelog ',(0,o.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/tree/master/src/python/pants/notes",children:"https://github.com/pantsbuild/pants/tree/master/src/python/pants/notes"}),". When upgrading to these new Pants releases, you should download the new artifact and upload a copy to your host."]}),"\n",(0,o.jsxs)(t.admonition,{title:"Asking for help",type:"note",children:[(0,o.jsx)(t.p,{children:"It's possible that Pants does not yet have all the mechanisms it'll need to work with your organization's specific networking setup, which we'd love to fix."}),(0,o.jsxs)(t.p,{children:["Please reach out on ",(0,o.jsx)(t.a,{href:"/community/members",children:"Slack"})," or open a ",(0,o.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/issues",children:"GitHub issue"})," for any help."]})]})]})}function h(e={}){let{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},848193(e,t,s){s.d(t,{R:()=>i,x:()=>a});var n=s(830758);let o={},r=n.createContext(o);function i(e){let t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(r.Provider,{value:t},e.children)}},715853(e){e.exports=JSON.parse('{"id":"docs/using-pants/restricted-internet-access","title":"Restricted Internet access","description":"How to use Pants when you have restricted access to the Internet","source":"@site/versioned_docs/version-2.16/docs/using-pants/restricted-internet-access.mdx","sourceDirName":"docs/using-pants","slug":"/docs/using-pants/restricted-internet-access","permalink":"/2.16/docs/using-pants/restricted-internet-access","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/using-pants/restricted-internet-access.mdx","tags":[],"version":"2.16","sidebarPosition":12,"frontMatter":{"title":"Restricted Internet access","sidebar_position":12},"sidebar":"docsSidebar","previous":{"title":"Anonymous telemetry","permalink":"/2.16/docs/using-pants/anonymous-telemetry"},"next":{"title":"Validating dependencies","permalink":"/2.16/docs/using-pants/validating-dependencies"}}')}}]);