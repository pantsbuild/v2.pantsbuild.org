"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["548574"],{822629(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>c});var o=t(599249),r=t(886070),s=t(848193);let a={authors:["stu"],tags:["jvm","golang-2","docker","deployment"]},i="Pants 2.9: Alpha support for Java and Scala, improvements for Docker and Go, and more",l={authorsImageUrls:[void 0]},c=[{value:"Alpha Support for Java and Scala",id:"alpha-support-for-java-and-scala",level:2},{value:"Improvements over Pants 1.x",id:"improvements-over-pants-1x",level:3},{value:"Dependency inference and per-file compilation",id:"dependency-inference-and-per-file-compilation",level:4},{value:"Multiple resolves of third party dependencies",id:"multiple-resolves-of-third-party-dependencies",level:4},{value:"Trying out Java or Scala",id:"trying-out-java-or-scala",level:3},{value:"Better visibility into runtime and caching for tests",id:"better-visibility-into-runtime-and-caching-for-tests",level:2},{value:"Improvements to Docker support",id:"improvements-to-docker-support",level:2},{value:"Support for running <code>tailor</code> continuously",id:"support-for-running-tailor-continuously",level:2},{value:"Changes to Go project layouts",id:"changes-to-go-project-layouts",level:2},{value:"New Go features",id:"new-go-features",level:3},{value:"Updating for Go",id:"updating-for-go",level:3},{value:"Thanks!",id:"thanks",level:2}];function d(e){let n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{CaptionedImg:o}=n;return o||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CaptionedImg",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o,{src:t(712773).A}),"\n",(0,r.jsxs)(n.p,{children:["We're pleased to announce ",(0,r.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.9/docs",children:"Pants 2.9.0"}),", the latest release of Pants: the scalable and ergonomic build system!"]}),"\n","\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:["To update, set ",(0,r.jsx)(n.code,{children:'pants_version = "2.9.0"'})," in your ",(0,r.jsx)(n.code,{children:"pants.toml"}),". See ",(0,r.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/upgrade-tips",children:"upgrade tips"})," for more information."]}),"\n",(0,r.jsx)(n.h2,{id:"alpha-support-for-java-and-scala",children:"Alpha Support for Java and Scala"}),"\n",(0,r.jsxs)(n.p,{children:["We're very happy to announce that support for Java and Scala has reached alpha quality in the ",(0,r.jsx)(n.code,{children:"2.9.0"})," release!"]}),"\n",(0,r.jsxs)(n.p,{children:["Pants 1.x had a long history of support for Java and Scala, going back to when it was first created at Twitter. In fact: they were the first supported languages! Consequently, (re-)adding support for these popular JVM languages has been high on our list ever since ",(0,r.jsx)(n.a,{href:"/blog/2020/10/27/introducing-pants-v2",children:"the 2.x release"})," in late 2020."]}),"\n",(0,r.jsx)(n.h3,{id:"improvements-over-pants-1x",children:"Improvements over Pants 1.x"}),"\n",(0,r.jsx)(n.p,{children:"In the last few years, we've learned a lot about how best to deal with more-slowly-compiling, high level languages like Scala."}),"\n",(0,r.jsx)(n.h4,{id:"dependency-inference-and-per-file-compilation",children:"Dependency inference and per-file compilation"}),"\n",(0,r.jsxs)(n.p,{children:["As described in our recent blog post, ",(0,r.jsx)(n.a,{href:"/blog/2021/11/22/automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference",children:"dependency inference for Java and Scala"})," removes a ton of boilerplate."]}),"\n",(0,r.jsxs)(n.p,{children:["But very fine-grained, always-accurate dependencies also enable per-file compilation, reducing the number of files that Pants needs to feed to ",(0,r.jsx)(n.code,{children:"scalac"}),", and allowing for automatic file-level parallelization and the most accurate cache keys possible. From a correctness perspective, that means that unlike tools which use compilation libraries like ",(0,r.jsx)(n.a,{href:"https://github.com/sbt/zinc",children:"Zinc"})," (SBT, Bloop, Mill, optionally Bazel, and others) Pants ",(0,r.jsx)(n.code,{children:"2.9.0"})," supports sandboxed, minimal incremental Java and Scala compilation, while preventing the under-compilation bugs that have historically troubled Scala developers."]}),"\n",(0,r.jsxs)(n.p,{children:["For more information on how dependency inference works for the JVM, ",(0,r.jsx)(n.a,{href:"/blog/2021/11/22/automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference",children:"check out that post"}),"!"]}),"\n",(0,r.jsx)(n.h4,{id:"multiple-resolves-of-third-party-dependencies",children:"Multiple resolves of third party dependencies"}),"\n",(0,r.jsxs)(n.p,{children:["Another significant improvement for the JVM over 1.x is that Pants ",(0,r.jsx)(n.code,{children:"2.9"})," implements a monorepo-friendly multiple-resolve/lockfile strategy for third party dependencies, allowing for correctness, flexibility, ",(0,r.jsx)(n.em,{children:"and"})," performance."]}),"\n",(0,r.jsx)(n.p,{children:"Build tools for the JVM tend to either resolve dependencies globally (for an entire repository), or locally (on a project-by-project basis). Global resolves (as in Bazel) remove flexibility, because teams working within a repository cannot diverge from the single blessed versions of any library: if they try, they are nearly guaranteed to encounter classpath incompatibilities. On the other hand, local/per-project resolves (as in SBT, Gradle, Maven) within a monorepo allow for local flexibility, but reduce the performance and compatibility of any particular build by executing one unique resolve per project."}),"\n",(0,r.jsxs)(n.p,{children:["Rather than forcing global or per-project resolves, Pants ",(0,r.jsx)(n.code,{children:"2.9"})," supports a unique hybrid approach: third party resolves are named and first-class, and can be used on a target by target basis. This allows a monorepo to operate with the minimum number of resolves required to support their conflicting library versions, without necessarily going to the costly extreme of per-project resolves."]}),"\n",(0,r.jsx)(n.p,{children:"Having the minimum number of resolves improves performance, but it doesn't come with a correctness cost! To ensure reproducible builds, Pants generates a lockfile per resolve, which is then efficiently consumed to fetch the precise, fingerprinted dependencies of any particular file."}),"\n",(0,r.jsx)(n.h3,{id:"trying-out-java-or-scala",children:"Trying out Java or Scala"}),"\n",(0,r.jsx)(n.p,{children:"Although this is an alpha release, the features that are implemented so far are expected to give teams enough to work with to validate using Pants with a JVM codebase:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use of ",(0,r.jsx)(n.a,{href:"http://martiansoftware.com/nailgun/",children:"nailgun"})," to keep warm JVMs for compilers and tools"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.scalatest.org/",children:"ScalaTest"})," support for Scala, and ",(0,r.jsx)(n.a,{href:"https://junit.org/junit5/",children:"JUnit"})," support for both Java and Scala"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://scalameta.org/scalafmt/",children:"Scalafmt"})," and ",(0,r.jsx)(n.a,{href:"https://github.com/google/google-java-format",children:"Google Java Format"})]}),"\n",(0,r.jsx)(n.li,{children:"Scala Repl support"}),"\n",(0,r.jsxs)(n.li,{children:["Protobuf code generation with ",(0,r.jsx)(n.a,{href:"https://scalapb.github.io/",children:"ScalaPB"})]}),"\n",(0,r.jsxs)(n.li,{children:["Debugging support via ",(0,r.jsx)(n.code,{children:"./pants test --debug $file"})]}),"\n",(0,r.jsx)(n.li,{children:"Scala compiler plugins"}),"\n",(0,r.jsx)(n.li,{children:"Support for compiling cycles between Java and Scala code"}),"\n",(0,r.jsxs)(n.li,{children:["Bootstrapping a consistent JVM using ",(0,r.jsx)(n.a,{href:"https://get-coursier.io/",children:"coursier"})]}),"\n",(0,r.jsxs)(n.li,{children:["Multiple first class thirdparty resolves (",(0,r.jsx)(n.a,{href:"https://get-coursier.io/",children:"coursier"})," again!) with independent lockfiles"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["We'd love to help you try out Pants with your JVM codebase: you can start by checking out the ",(0,r.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.9/docs/jvm-overview",children:"initial documentation"})," and ",(0,r.jsx)(n.a,{href:"https://github.com/pantsbuild/example-jvm",children:"example JVM repository"}),". If you see anything missing that prevents you from evaluating Pants for Java and Scala, please let us know by ",(0,r.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/issues/new/choose",children:"opening a Github issue"}),", or ",(0,r.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.9/docs/community",children:"visiting Slack"}),"!"]}),"\n",(0,r.jsx)(n.h2,{id:"better-visibility-into-runtime-and-caching-for-tests",children:"Better visibility into runtime and caching for tests"}),"\n",(0,r.jsxs)(n.p,{children:["Thanks to a great change from a new contributor, Pants ",(0,r.jsx)(n.code,{children:"2.9"})," now renders test runtime and cache status (whether a process ran, hit a cache, or was memoized in memory by ",(0,r.jsx)(n.code,{children:"pantsd"}),") in the test summary for all supported languages!"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell-session",children:"$ ./pants test src/python/pants/util:\n...\n\u2713 src/python/pants/util/dirutil_test.py:tests succeeded in 1.21s (cached locally).\n\u2713 src/python/pants/util/osutil_test.py:tests succeeded in 0.72s (memoized).\n\u2713 src/python/pants/util/strutil_test.py:tests succeeded in 0.98s (cached remotely).\n"})}),"\n",(0,r.jsx)(n.p,{children:'No more thinking to yourself: "Gee, that was even faster than usual! I wonder why?"'}),"\n",(0,r.jsx)(n.h2,{id:"improvements-to-docker-support",children:"Improvements to Docker support"}),"\n",(0,r.jsx)(n.p,{children:"Among a number of bug fixes and documentation enhancements, there were a few noteworthy improvements to the Docker backend:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Introduce a new ",(0,r.jsx)(n.code,{children:"target_stage"})," field for the ",(0,r.jsxs)(n.a,{href:"https://www.pantsbuild.org/v2.9/docs/reference-docker_image",children:[(0,r.jsx)(n.code,{children:"docker_image"})," target"]})," as well as the ",(0,r.jsx)(n.code,{children:"[docker].build_target_stage"})," option."]}),"\n",(0,r.jsxs)(n.li,{children:["Add ",(0,r.jsxs)(n.a,{href:"https://www.pantsbuild.org/v2.9/docs/reference-docker_image#codeinstructionscode",children:[(0,r.jsx)(n.code,{children:"instructions"})," field"]})," to ",(0,r.jsx)(n.code,{children:"docker_image"})," to support generating an anonymous Dockerfile from scratch."]}),"\n",(0,r.jsx)(n.li,{children:"Log suggestions of how to fix the docker build context when a docker build fails."}),"\n",(0,r.jsxs)(n.li,{children:["New option for the ",(0,r.jsx)(n.code,{children:"[docker]"})," scope, which allows passing additional options when executing ",(0,r.jsx)(n.code,{children:"docker run [OPTIONS] <image>"}),", in addition to the ",(0,r.jsx)(n.code,{children:"--run-args"})," which are passed to the image entrypoint.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["For example: ",(0,r.jsx)(n.code,{children:'./pants run --docker-run-args="-p 8080/tcp" src/docker:example -- --arg-for-the-image-entrypoint'})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Add new ",(0,r.jsxs)(n.a,{href:"https://www.pantsbuild.org/v2.9/docs/reference-docker_image#codesecretscode",children:[(0,r.jsx)(n.code,{children:"secrets"})," field"]})," to ",(0,r.jsx)(n.code,{children:"docker_image"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Include ",(0,r.jsx)(n.code,{children:"shell_source(s)"})," in ",(0,r.jsx)(n.code,{children:"docker_image"})," build context."]}),"\n",(0,r.jsxs)(n.li,{children:["Support interpolating Docker build args into the ",(0,r.jsx)(n.code,{children:"repository"})," field of ",(0,r.jsx)(n.code,{children:"docker_image"})," targets."]}),"\n",(0,r.jsxs)(n.li,{children:["Allow tailor to create ",(0,r.jsx)(n.code,{children:"docker_image"}),' targets for any files with "Dockerfile" in the file name.']}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Check out the updated ",(0,r.jsxs)(n.a,{href:"https://www.pantsbuild.org/v2.9/docs/docker",children:[(0,r.jsx)(n.code,{children:"docker"})," documentation"]})," for more information!"]}),"\n",(0,r.jsxs)(n.h2,{id:"support-for-running-tailor-continuously",children:["Support for running ",(0,r.jsx)(n.code,{children:"tailor"})," continuously"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"./pants tailor"})," goal automatically updates ",(0,r.jsx)(n.code,{children:"BUILD"})," files to add targets for recognized file types, which makes it great for onboarding a new repository to Pants."]}),"\n",(0,r.jsxs)(n.p,{children:["Pants ",(0,r.jsx)(n.code,{children:"2.9"})," expands ",(0,r.jsx)(n.code,{children:"tailor"}),"'s options to allow it to be run on an ongoing basis in your repository, to ensure that your ",(0,r.jsx)(n.code,{children:"BUILD"})," metadata stays up to date as files are added."]}),"\n",(0,r.jsxs)(n.p,{children:["To do this, ",(0,r.jsx)(n.code,{children:"tailor"})," gained a ",(0,r.jsx)(n.code,{children:"--check"})," mode, and now supports ",(0,r.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.9/docs/reference-tailor#section-ignore-paths",children:"ignoring files"})," which should be visible to Pants (i.e., not in ",(0,r.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.9/docs/gitignore",children:"pants_ignore"}),"), but not have ",(0,r.jsx)(n.code,{children:"BUILD"})," targets generated for them."]}),"\n",(0,r.jsx)(n.h2,{id:"changes-to-go-project-layouts",children:"Changes to Go project layouts"}),"\n",(0,r.jsxs)(n.p,{children:["After ",(0,r.jsx)(n.a,{href:"/blog/2021/11/10/golang-support-pants-28",children:"adding experimental support for Go"})," in Pants ",(0,r.jsx)(n.code,{children:"2.8"}),", we decided that a few changes to how Go targets are laid out in BUILD files would help to future proof the support."]}),"\n",(0,r.jsxs)(n.p,{children:["To that end, in Pants ",(0,r.jsx)(n.code,{children:"2.9"}),", each Go package now needs its own ",(0,r.jsx)(n.code,{children:"go_package"})," declaration in a ",(0,r.jsx)(n.code,{children:"BUILD"})," file. Thanks to dependency inference and ",(0,r.jsx)(n.code,{children:"./pants tailor"}),", these BUILD files are very simple, can be created automatically, and rarely require adjustments. But when you do need to add metadata, the new layout ",(0,r.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/issues/13488",children:"follows the 1:1:1 principle"}),": metadata about your code should live near the code itself."]}),"\n",(0,r.jsx)(n.h3,{id:"new-go-features",children:"New Go features"}),"\n",(0,r.jsxs)(n.p,{children:["In particular, the changes to target layouts make it easier to use the new Go features in ",(0,r.jsx)(n.code,{children:"2.9"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"go_package"})," targets now support:"]}),"\n",(0,r.jsxs)(n.p,{children:["1. Setting a ",(0,r.jsx)(n.code,{children:"test_timeout"})," for the package (in seconds), which is propagated down to the Go test runner:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"go_package(\n    test_timeout=120,\n)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["2. Embedding ",(0,r.jsx)(n.code,{children:"resource"})," files in a binary for use at runtime:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'go_package(dependencies=[":resources"])\nresources(\n    name="resources",\n    sources=["*.txt"],\n)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["3. Adding ",(0,r.jsx)(n.code,{children:"files"})," to the working directory of your tests (i.e. ",(0,r.jsx)(n.code,{children:"testdata"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'go_package(dependencies=[":testdata"])\nfile(\n    name="testdata",\n    source="testdata/f.txt"\n)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"updating-for-go",children:"Updating for Go"}),"\n",(0,r.jsxs)(n.p,{children:["To update your ",(0,r.jsx)(n.code,{children:"BUILD"})," files for the new layout in ",(0,r.jsx)(n.code,{children:"2.9"}),", all you need to do is run ",(0,r.jsx)(n.code,{children:"./pants tailor"}),". Thanks for your patience, and for all of your feedback on the new Go support! Please continue to let us know how it can be most useful to you."]}),"\n",(0,r.jsx)(n.h2,{id:"thanks",children:"Thanks!"}),"\n",(0,r.jsxs)(n.p,{children:["Thanks to all the contributors to ",(0,r.jsx)(n.code,{children:"2.9"}),", including everyone who shared feedback on changes and who tested release candidates!"]})]})}function h(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},712773(e,n,t){t.d(n,{A:()=>o});let o=t.p+"assets/images/splash-1380aca5d7e49a3d7b48f29ab738f608.png"},848193(e,n,t){t.d(n,{R:()=>a,x:()=>i});var o=t(830758);let r={},s=o.createContext(r);function a(e){let n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(s.Provider,{value:n},e.children)}},599249(e){e.exports=JSON.parse('{"permalink":"/blog/2022/01/12/pants-2-9","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-01-12-pants-2-9/index.mdx","source":"@site/blog/2022-01-12-pants-2-9/index.mdx","title":"Pants 2.9: Alpha support for Java and Scala, improvements for Docker and Go, and more","description":"We\'re pleased to announce Pants 2.9.0, the latest release of Pants: the scalable and ergonomic build system!","date":"2022-01-12T00:00:00.000Z","tags":[{"inline":true,"label":"jvm","permalink":"/blog/tags/jvm"},{"inline":true,"label":"golang-2","permalink":"/blog/tags/golang-2"},{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"}],"readingTime":7.2,"hasTruncateMarker":true,"authors":[{"name":"Stu Hood","title":"Pants Maintainer","url":"https://github.com/stuhood","imageURL":"https://github.com/stuhood.png","key":"stu","page":null}],"frontMatter":{"authors":["stu"],"tags":["jvm","golang-2","docker","deployment"]},"unlisted":false,"prevItem":{"title":"Meet our newest Maintainer: Joshua Cannon","permalink":"/blog/2022/02/15/new-maintainer-joshua-cannon"},"nextItem":{"title":"You can call us Pantsbuild (or Pants, whichever you prefer)","permalink":"/blog/2022/01/12/you-can-call-us-pantsbuild-or-pants-whichever-you-prefer"}}')}}]);