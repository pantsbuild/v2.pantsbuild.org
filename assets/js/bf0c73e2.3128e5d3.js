"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["566556"],{171301(e,t,s){s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>c});var n=s(664191),o=s(886070),i=s(848193);let r={title:"Proxies",sidebar_position:0},l,a={},c=[{value:"Installing Pants",id:"installing-pants",level:2},{value:"Setting up a Certificate Authority",id:"setting-up-a-certificate-authority",level:2},{value:"Setting <code>HTTP_PROXY</code> and <code>HTTPS_PROXY</code>",id:"setting-http_proxy-and-https_proxy",level:2},{value:"Using a custom &quot;cheeseshop&quot;/PyPI",id:"using-a-custom-cheeseshoppypi",level:2},{value:"Hosting binaries",id:"hosting-binaries",level:2}];function d(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"How to configure Pants to work with proxies."}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsxs)(t.admonition,{title:"Asking for help",type:"note",children:[(0,o.jsx)(t.p,{children:"It can be tricky to get a proxy working. It's also possible that Pants does not yet have all the mechanisms it'll need to work with your organization's specific setup, which we'd love to fix."}),(0,o.jsxs)(t.p,{children:["Please reach out on ",(0,o.jsx)(t.a,{href:"/community/members",children:"Slack"})," or open a ",(0,o.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/issues",children:"GitHub issue"})," for any help."]})]}),"\n",(0,o.jsx)(t.h2,{id:"installing-pants",children:"Installing Pants"}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"./pants"})," script from ",(0,o.jsx)(t.a,{href:"/2.3/docs/introduction/getting-started/installing-pants",children:"Installing Pants"})," uses PyPI to download and install the wheel ",(0,o.jsx)(t.code,{children:"pantsbuild.pants"})," and all of Pants's dependencies."]}),"\n",(0,o.jsxs)(t.p,{children:["If you cannot access PyPI, you may instead download Pants as a PEX binary from ",(0,o.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/releases",children:"https://github.com/pantsbuild/pants/releases"}),". After downloading the PEX artifact, you can rename the file to ",(0,o.jsx)(t.code,{children:"./pants"}),", run ",(0,o.jsx)(t.code,{children:"chmod +x ./pants"}),", then run ",(0,o.jsx)(t.code,{children:"./pants --version"})," like you normally would."]}),"\n",(0,o.jsxs)(t.p,{children:["You may want to check the binary into version control so that everyone in your organization can use it. To upgrade to a new Pants release, update the ",(0,o.jsx)(t.code,{children:"pants_version"})," option in ",(0,o.jsx)(t.code,{children:"pants.toml"})," and download the newest release from ",(0,o.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/releases",children:"https://github.com/pantsbuild/pants/releases"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"setting-up-a-certificate-authority",children:"Setting up a Certificate Authority"}),"\n",(0,o.jsx)(t.p,{children:"You may need to configure Pants to use a custom Certificate Authority (CA) bundle:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nca_certs_path = "/path/to/certs/file"\n'})}),"\n",(0,o.jsxs)(t.h2,{id:"setting-http_proxy-and-https_proxy",children:["Setting ",(0,o.jsx)(t.code,{children:"HTTP_PROXY"})," and ",(0,o.jsx)(t.code,{children:"HTTPS_PROXY"})]}),"\n",(0,o.jsxs)(t.p,{children:["You may need to set standard proxy-related environment variables, such as ",(0,o.jsx)(t.code,{children:"http_proxy"}),", ",(0,o.jsx)(t.code,{children:"https_proxy"})," and ",(0,o.jsx)(t.code,{children:"all_proxy"}),", in executed subprocesses:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[subprocess-environment]\nenv_vars.add = ["http_proxy=http://myproxy", "https_proxy"]\n'})}),"\n",(0,o.jsx)(t.p,{children:"You can use lowercase or all-caps env var names."}),"\n",(0,o.jsxs)(t.p,{children:["Note that if you leave of the env var's value, as for ",(0,o.jsx)(t.code,{children:"https_proxy"})," above, Pants will use the value of the same variable in the environment in which it is invoked."]}),"\n",(0,o.jsx)(t.h2,{id:"using-a-custom-cheeseshoppypi",children:'Using a custom "cheeseshop"/PyPI'}),"\n",(0,o.jsxs)(t.p,{children:["See ",(0,o.jsx)(t.a,{href:"/2.3/docs/python/overview/third-party-dependencies#using-custom-repositories",children:"Third-party dependencies"})," for instructions."]}),"\n",(0,o.jsx)(t.h2,{id:"hosting-binaries",children:"Hosting binaries"}),"\n",(0,o.jsx)(t.p,{children:"Pants downloads some binaries in order to run certain functionality, including:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["PEX, from ",(0,o.jsx)(t.a,{href:"https://github.com/pantsbuild/pex/releases",children:"https://github.com/pantsbuild/pex/releases"})]}),"\n",(0,o.jsxs)(t.li,{children:["Protoc, from ",(0,o.jsx)(t.a,{href:"https://github.com/protocolbuffers/protobuf/releases",children:"https://github.com/protocolbuffers/protobuf/releases"})]}),"\n",(0,o.jsxs)(t.li,{children:["gRPC Python, from ",(0,o.jsx)(t.a,{href:"https://binaries.pantsbuild.org/bin/grpc_python_plugin",children:"https://binaries.pantsbuild.org/bin/grpc_python_plugin"})," (i.e., the Pantsbuild organization builds the binary and hosts it)"]}),"\n",(0,o.jsxs)(t.li,{children:["SCC (Succint Code-Counter), from ",(0,o.jsx)(t.a,{href:"https://github.com/boyter/scc/releases",children:"https://github.com/boyter/scc/releases"})]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Some proxies restrict access to these URLs. If you are not able to allowlist them, you can host the binaries yourself and instruct Pants to use your custom URL."}),"\n",(0,o.jsxs)(t.p,{children:["We recommend hosting the same binary Pants normally uses, as Pants uses a checksum to ensure the download is valid. You can run ",(0,o.jsx)(t.code,{children:"./pants help-advanced $options_scope"})," to determine the full URL with the ",(0,o.jsx)(t.code,{children:"url_template"})," option."]}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{style:{textAlign:"left"},children:"Tool"}),(0,o.jsx)(t.th,{style:{textAlign:"left"},children:"Options scope"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"PEX"}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.code,{children:"[download-pex-bin]"})})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"Protoc"}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.code,{children:"[protoc]"})})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"gRPC Python"}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.code,{children:"[grpc_python_plugin]"})})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"SCC"}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.code,{children:"[scc]"})})]})]})]}),"\n",(0,o.jsxs)(t.p,{children:["Note that this URL is only a template. Anywhere you see ",(0,o.jsx)(t.code,{children:"{version}"}),", Pants will substitute in the current value for the ",(0,o.jsx)(t.code,{children:"version"})," option. Anywhere you see ",(0,o.jsx)(t.code,{children:"{platform}"}),", Pants will look up if you're on macOS or Linux, then look up the dictionary in ",(0,o.jsx)(t.code,{children:"url_platform_mapping"})," and substitute in the respective value."]}),"\n",(0,o.jsxs)(t.p,{children:["For example, ",(0,o.jsx)(t.code,{children:"./pants help-advanced protoc"})," gives us the template ",(0,o.jsx)(t.code,{children:"https://github.com/protocolbuffers/protobuf/releases/download/v{version}/protoc-{version}-{platform}-x86_64.zip"}),". We see the ",(0,o.jsx)(t.code,{children:"version"})," option is set to ",(0,o.jsx)(t.code,{children:"3.11.4"}),". We are running on macOS, so look up ",(0,o.jsx)(t.code,{children:"darwin"})," in the ",(0,o.jsx)(t.code,{children:"url_platform_mapping"})," option and find the string ",(0,o.jsx)(t.code,{children:"osx"}),". Thus, the final URL is ",(0,o.jsx)(t.code,{children:"https://github.com/protocolbuffers/protobuf/releases/download/v3.11.4/protoc-3.11.4-osx-x86_64.zip"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["Once you determine the full URL, you can download the original binary and host it yourself. Then, you can update the ",(0,o.jsx)(t.code,{children:"url_template"})," option to point to your host:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",metastring:'title="pants.toml"',children:'[protoc]\nurl_template = "https://binaries.pantsbuild.org/bin/protoc/{version}/{platform}/protoc.zip"\n'})}),"\n",(0,o.jsxs)(t.p,{children:["For simplicity, we used the original value for ",(0,o.jsx)(t.code,{children:"url_platform_mapping"}),", meaning that we set up our hosted URL to store the ",(0,o.jsx)(t.code,{children:"darwin"})," binary at ",(0,o.jsx)(t.code,{children:".../osx/protoc.zip"})," and the ",(0,o.jsx)(t.code,{children:"linux"})," binary at ",(0,o.jsx)(t.code,{children:".../linux/protoc.zip"}),". You can override the option ",(0,o.jsx)(t.code,{children:"url_platform_mapping"})," if you want to use different values."]}),"\n",(0,o.jsxs)(t.p,{children:['Occasionally, new Pants releases will upgrade to new versions of these binaries, which will be mentioned in the "User API Changes" part of the changelog ',(0,o.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/tree/master/src/python/pants/notes",children:"https://github.com/pantsbuild/pants/tree/master/src/python/pants/notes"}),". When upgrading to these new Pants releases, you should download the new artifact and upload a copy to your host."]})]})}function h(e={}){let{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},848193(e,t,s){s.d(t,{R:()=>r,x:()=>l});var n=s(830758);let o={},i=n.createContext(o);function r(e){let t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),n.createElement(i.Provider,{value:t},e.children)}},664191(e){e.exports=JSON.parse('{"id":"docs/using-pants/troubleshooting-common-issues/proxies","title":"Proxies","description":"How to configure Pants to work with proxies.","source":"@site/versioned_docs/version-2.3/docs/using-pants/troubleshooting-common-issues/proxies.mdx","sourceDirName":"docs/using-pants/troubleshooting-common-issues","slug":"/docs/using-pants/troubleshooting-common-issues/proxies","permalink":"/2.3/docs/using-pants/troubleshooting-common-issues/proxies","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/using-pants/troubleshooting-common-issues/proxies.mdx","tags":[],"version":"2.3","sidebarPosition":0,"frontMatter":{"title":"Proxies","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Troubleshooting / common issues","permalink":"/2.3/docs/using-pants/troubleshooting-common-issues/"},"next":{"title":"Project introspection","permalink":"/2.3/docs/using-pants/project-introspection"}}')}}]);