"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["727406"],{611410(e,s,n){n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>a});var t=n(839792),i=n(886070),d=n(848193);let r={title:"Plugin upgrade guide",sidebar_position:9},o,l={},a=[{value:"2.13",id:"213",level:2},{value:"<code>AddressInput</code> and <code>UnparsedAddressInputs</code> require <code>description_of_origin</code>",id:"addressinput-and-unparsedaddressinputs-require-description_of_origin",level:3},{value:"<code>WrappedTarget</code> requires <code>WrappedTargetRequest</code>",id:"wrappedtarget-requires-wrappedtargetrequest",level:3},{value:"Redesign of <code>Specs</code>",id:"redesign-of-specs",level:3},{value:"<code>SpecsSnapshot</code> is now <code>SpecsPaths</code>",id:"specssnapshot-is-now-specspaths",level:3},{value:"Removed <code>PutativeTargetsSearchPaths</code> for <code>tailor</code> plugins",id:"removed-putativetargetssearchpaths-for-tailor-plugins",level:3},{value:"Banned short option names like <code>-x</code>",id:"banned-short-option-names-like--x",level:3},{value:"2.12",id:"212",level:2},{value:"Unified formatters",id:"unified-formatters",level:3},{value:"2.11",id:"211",level:2},{value:"Deprecated <code>Subsystem.register_options()</code>",id:"deprecated-subsystemregister_options",level:3},{value:"Moved <code>BinaryPathRequest</code> to <code>pants.core.util_rules.system_binaries</code>",id:"moved-binarypathrequest-to-pantscoreutil_rulessystem_binaries",level:3},{value:"Deprecated not implementing <code>TargetGenerator</code> in <code>GenerateTargetsRequest</code> implementors",id:"deprecated-not-implementing-targetgenerator-in-generatetargetsrequest-implementors",level:3},{value:"Replaced <code>GoalSubsystem.required_union_implementations</code> with <code>GoalSubsystem.activated()</code>",id:"replaced-goalsubsystemrequired_union_implementations-with-goalsubsystemactivated",level:3},{value:"2.10",id:"210",level:2},{value:"Rename <code>LintRequest</code> to <code>LintTargetsRequest</code>",id:"rename-lintrequest-to-linttargetsrequest",level:3},{value:"<code>FmtRequest</code>, <code>CheckRequest</code>, and <code>LintTargetsRequest</code> must set <code>name</code>",id:"fmtrequest-checkrequest-and-linttargetsrequest-must-set-name",level:3},{value:"Removed <code>LanguageFmtTargets</code> for <code>fmt</code>",id:"removed-languagefmttargets-for-fmt",level:3},{value:"<code>ReplImplementation</code> now passes root targets, not transitive closure",id:"replimplementation-now-passes-root-targets-not-transitive-closure",level:3},{value:"Removed <code>PexFromTargetsRequest.additional_requirements</code>",id:"removed-pexfromtargetsrequestadditional_requirements",level:3},{value:"Removed <code>PexFromTargetsRequest(direct_deps_only: bool)</code>",id:"removed-pexfromtargetsrequestdirect_deps_only-bool",level:3},{value:"Renamed <code>GenerateToolLockfileSentinel.options_scope</code> to <code>resolve_name</code>",id:"renamed-generatetoollockfilesentineloptions_scope-to-resolve_name",level:3},{value:"Renamed <code>PythonModule</code> to <code>PythonModuleOwnersRequest</code>",id:"renamed-pythonmodule-to-pythonmoduleownersrequest",level:3},{value:"2.9",id:"29",level:2},{value:"Deprecated <code>RuleRunner.create_files()</code>, <code>.create_file()</code> and <code>.add_to_build_file()</code>",id:"deprecated-rulerunnercreate_files-create_file-and-add_to_build_file",level:3},{value:"2.8",id:"28",level:2},{value:"Target modeling changes",id:"target-modeling-changes",level:3},{value:"<code>SourcesField</code>",id:"sourcesfield",level:4},{value:"Renames of some <code>Sources</code> subclasses",id:"renames-of-some-sources-subclasses",level:4},{value:"<code>OutputPathField.value_or_default()</code>",id:"outputpathfieldvalue_or_default",level:3},{value:"2.7",id:"27",level:2},{value:"Type hints work properly",id:"type-hints-work-properly",level:3},{value:"Options scopes should not have <code>_</code>",id:"options-scopes-should-not-have-_",level:3},{value:"2.6",id:"26",level:2},{value:"<code>ProcessCacheScope</code>",id:"processcachescope",level:3},{value:"<code>PexInterpreterConstraints</code>",id:"pexinterpreterconstraints",level:3},{value:"2.5",id:"25",level:2},{value:"<code>TriBoolField</code>",id:"triboolfield",level:3},{value:"Added <code>RuleRunner.write_files()</code>",id:"added-rulerunnerwrite_files",level:3},{value:"2.4",id:"24",level:2},{value:"<code>PexRequest</code> changes how entry point is set",id:"pexrequest-changes-how-entry-point-is-set",level:3},{value:"Must use <code>EnvironmentRequest</code> for accessing environment variables",id:"must-use-environmentrequest-for-accessing-environment-variables",level:3},{value:"2.3",id:"23",level:2},{value:"2.2",id:"22",level:2},{value:"<code>PrimitiveField</code> and <code>AsyncField</code> are removed (2.2.0.dev0)",id:"primitivefield-and-asyncfield-are-removed-220dev0",level:3},{value:"Set the property <code>help</code> with Subsystems, Targets, and Fields (2.2.0.dev3)",id:"set-the-property-help-with-subsystems-targets-and-fields-220dev3",level:3},{value:"2.1",id:"21",level:2},{value:"<code>SourcesSnapshot</code> is now <code>SpecsSnapshot</code> (2.1.0rc0)",id:"sourcessnapshot-is-now-specssnapshot-210rc0",level:3},{value:"2.0",id:"20",level:2},{value:"Use <code>TransitiveTargetsRequest</code> as input for resolving <code>TransitiveTargets</code> (2.0.0rc0)",id:"use-transitivetargetsrequest-as-input-for-resolving-transitivetargets-200rc0",level:3},{value:"Codegen implementations: use <code>DependenciesRequestLite</code> and <code>TransitiveTargetsLite</code> (2.0.0rc0)",id:"codegen-implementations-use-dependenciesrequestlite-and-transitivetargetslite-200rc0",level:3},{value:"Dependencies-like fields have more robust support (2.0.0rc0)",id:"dependencies-like-fields-have-more-robust-support-200rc0",level:3},{value:"<code>package</code> implementations may want to add the field <code>output_path</code> (2.0.0rc0)",id:"package-implementations-may-want-to-add-the-field-output_path-200rc0",level:3}];function c(e){let s={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.p,{children:"How to adjust for changes made to the Plugin API."}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"213",children:"2.13"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.13.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.13.x.md"})," for the changelog."]}),"\n",(0,i.jsxs)(s.h3,{id:"addressinput-and-unparsedaddressinputs-require-description_of_origin",children:[(0,i.jsx)(s.code,{children:"AddressInput"})," and ",(0,i.jsx)(s.code,{children:"UnparsedAddressInputs"})," require ",(0,i.jsx)(s.code,{children:"description_of_origin"})]}),"\n",(0,i.jsxs)(s.p,{children:["Both types now require the keyword argument ",(0,i.jsx)(s.code,{children:"description_of_origin: str"}),", which is used to make better error messages when the address cannot be found."]}),"\n",(0,i.jsxs)(s.p,{children:["If the address is hardcoded in your rules, then use a description like ",(0,i.jsx)(s.code,{children:'"the rule find_my_binary"'}),". If the address comes from user inputs, it is helpful to mention where the user defines the value, for example ",(0,i.jsx)(s.code,{children:'f"the dependencies field from the target {my_tgt.address}"'}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["You can now also set ",(0,i.jsx)(s.code,{children:"UnparsedAddressInputs(skip_invalid_addresses=True, ...)"}),", which will not error when addresses are invalid."]}),"\n",(0,i.jsxs)(s.h3,{id:"wrappedtarget-requires-wrappedtargetrequest",children:[(0,i.jsx)(s.code,{children:"WrappedTarget"})," requires ",(0,i.jsx)(s.code,{children:"WrappedTargetRequest"})]}),"\n",(0,i.jsx)(s.p,{children:"Before:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"from pants.engine.addresses import Address\nfrom pants.engine.target import WrappedTarget\n\nawait Get(WrappedTarget, Address, my_address)\n"})}),"\n",(0,i.jsx)(s.p,{children:"After:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from pants.engine.target import WrappedTarget, WrappedTargetRequest\n\nawait Get(WrappedTarget, WrappedTargetRequest(my_address, description_of_origin="my rule"))\n'})}),"\n",(0,i.jsxs)(s.h3,{id:"redesign-of-specs",children:["Redesign of ",(0,i.jsx)(s.code,{children:"Specs"})]}),"\n",(0,i.jsx)(s.p,{children:"Specs, aka command line arguments, were redesigned in Pants 2.13:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["The globs ",(0,i.jsx)(s.code,{children:"::"})," and ",(0,i.jsx)(s.code,{children:":"})," now match all files, even if there are no owning targets."]}),"\n",(0,i.jsxs)(s.li,{children:["Directory args like ",(0,i.jsx)(s.code,{children:"my_dir/"})," can be set to match everything in the current directory, rather than the default target ",(0,i.jsx)(s.code,{children:"my_dir:my_dir"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Ignore globs were added with a ",(0,i.jsx)(s.code,{children:"-"})," prefix, like ",(0,i.jsx)(s.code,{children:":: -ignore_me::"})]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["To support these changes, we redesigned the class ",(0,i.jsx)(s.code,{children:"Specs"})," and its sibling classes like ",(0,i.jsx)(s.code,{children:"AddressSpecs"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["Renames for ",(0,i.jsx)(s.code,{children:"Spec"})," subclass:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"SiblingAddresses"})," -> ",(0,i.jsx)(s.code,{children:"DirGlobSpec"})," (vs. ",(0,i.jsx)(s.code,{children:"DirLiteralSpec"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"DescendantAddresses"})," -> ",(0,i.jsx)(s.code,{children:"RecursiveGlobSpec"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"AscendantAddresses"})," -> ",(0,i.jsx)(s.code,{children:"AncestorGlobSpec"})]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["Those classes now have a keyword arg ",(0,i.jsx)(s.code,{children:"error_if_no_target_matches"}),", rather than having a distinct class like ",(0,i.jsx)(s.code,{children:"MaybeDescendantAddresses"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"AddressSpecs"})," was renamed to ",(0,i.jsx)(s.code,{children:"SpecsWithoutFileOwners"}),", and ",(0,i.jsx)(s.code,{children:"FilesystemSpecs"})," to ",(0,i.jsx)(s.code,{children:"SpecsWithOnlyFileOwners"}),". But almost always, you should instead use the new ",(0,i.jsx)(s.code,{children:"RawSpecs"})," class because it is simpler. See ",(0,i.jsx)(s.a,{href:"/2.13/docs/writing-plugins/the-rules-api/rules-and-the-target-api#how-to-resolve-targets",children:"Rules API and Target API"})," for how to use ",(0,i.jsx)(s.code,{children:"Get(Targets, RawSpecs)"}),", including its keyword arguments."]}),"\n",(0,i.jsxs)(s.p,{children:["If you were directly creating ",(0,i.jsx)(s.code,{children:"Specs"})," objects before, you likely want to change to ",(0,i.jsx)(s.code,{children:"RawSpecs"}),". ",(0,i.jsx)(s.code,{children:"Specs"}),' allows us to handle "ignore specs" like ',(0,i.jsx)(s.code,{children:"-ignore_me/"}),", which is usually not necessary in rules. See the above paragraph for how to use ",(0,i.jsx)(s.code,{children:"RawSpecs"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"specssnapshot-is-now-specspaths",children:[(0,i.jsx)(s.code,{children:"SpecsSnapshot"})," is now ",(0,i.jsx)(s.code,{children:"SpecsPaths"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"SpecsSnapshot"})," was replaced with the more performant ",(0,i.jsx)(s.code,{children:"SpecsPaths"})," from ",(0,i.jsx)(s.code,{children:"pants.engine.fs"}),", which avoids digesting any files into the LMDB store."]}),"\n",(0,i.jsxs)(s.p,{children:["Instead of ",(0,i.jsx)(s.code,{children:"specs_snapshot.snapshot.files"}),", use ",(0,i.jsx)(s.code,{children:"specs_paths.files"})," to get a list of all matching files."]}),"\n",(0,i.jsxs)(s.p,{children:["If you still need the ",(0,i.jsx)(s.code,{children:"Digest"})," (",(0,i.jsx)(s.code,{children:"specs_snapshot.snapshot.digest"}),"), use ",(0,i.jsx)(s.code,{children:"await Get(Digest, PathGlobs(globs=specs_paths.files))"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"removed-putativetargetssearchpaths-for-tailor-plugins",children:["Removed ",(0,i.jsx)(s.code,{children:"PutativeTargetsSearchPaths"})," for ",(0,i.jsx)(s.code,{children:"tailor"})," plugins"]}),"\n",(0,i.jsx)(s.p,{children:"Before:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'all_proto_files = await Get(Paths, PathGlobs, req.search_paths.path_globs("*.proto"))\n'})}),"\n",(0,i.jsx)(s.p,{children:"After:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'all_proto_files = await Get(Paths, PathGlobs, req.path_globs("*.proto"))\n'})}),"\n",(0,i.jsxs)(s.p,{children:["You can also now specify multiple globs, e.g. ",(0,i.jsx)(s.code,{children:'req.path_globs("*.py", "*.pyi")'}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"banned-short-option-names-like--x",children:["Banned short option names like ",(0,i.jsx)(s.code,{children:"-x"})]}),"\n",(0,i.jsxs)(s.p,{children:["You must now use a long option name when ",(0,i.jsx)(s.a,{href:"/2.13/docs/writing-plugins/the-rules-api/options-and-subsystems",children:"defining options"}),". You can also now only specify a single option name per option."]}),"\n",(0,i.jsxs)(s.p,{children:["(These changes allowed us to introduce ignore specs, like ",(0,i.jsx)(s.code,{children:"./pants list :: -ignore_me::"}),".)"]}),"\n",(0,i.jsx)(s.h2,{id:"212",children:"2.12"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.12.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.12.x.md"})," for the changelog."]}),"\n",(0,i.jsx)(s.h3,{id:"unified-formatters",children:"Unified formatters"}),"\n",(0,i.jsxs)(s.p,{children:["Formatters no longer need to be installed in both the ",(0,i.jsx)(s.code,{children:"FmtRequest"})," and ",(0,i.jsx)(s.code,{children:"LintTargetsRequest"})," ",(0,i.jsx)(s.code,{children:"@unions"}),": instead, installing in the ",(0,i.jsx)(s.code,{children:"FmtRequest"})," union is sufficient to act as both a linter and formatter."]}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"/2.13/docs/writing-plugins/common-plugin-tasks/add-a-formatter",children:"Add a formatter"})," for more information."]}),"\n",(0,i.jsx)(s.h2,{id:"211",children:"2.11"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.11.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.11.x.md"})," for the changelog."]}),"\n",(0,i.jsxs)(s.h3,{id:"deprecated-subsystemregister_options",children:["Deprecated ",(0,i.jsx)(s.code,{children:"Subsystem.register_options()"})]}),"\n",(0,i.jsx)(s.p,{children:'Pants 2.11 added "concrete" option types which when used as class attributes of your subsystem. These are more declarative, simplify accessing options, and work with MyPy!'}),"\n",(0,i.jsx)(s.p,{children:"Before:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'class MySubsystem(Subsystem):\n    options_scope = "example"\n    help = "..."\n\n    @classmethod\n    def register_options(cls, register):\n        super().register_options(register)\n        register(\n            "--my-opt",\n            type=bool,\n            default=True,\n            help="...",\n        )\n'})}),"\n",(0,i.jsx)(s.p,{children:"Now:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'class MySubsystem(Subsystem):\n    options_scope = "example"\n    help = "..."\n\n    my_opt = BoolOption(\n        "--my-opt",\n        default=True,\n        help="...",\n    )\n'})}),"\n",(0,i.jsxs)(s.p,{children:["To access an option in rules, simply use ",(0,i.jsx)(s.code,{children:"my_subsystem.my_opt"})," rather than ",(0,i.jsx)(s.code,{children:"my_subsystem.options.my_opt"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"/2.13/docs/writing-plugins/the-rules-api/options-and-subsystems",children:"Options and subsystems"})," for more information, including the available types."]}),"\n",(0,i.jsxs)(s.h3,{id:"moved-binarypathrequest-to-pantscoreutil_rulessystem_binaries",children:["Moved ",(0,i.jsx)(s.code,{children:"BinaryPathRequest"})," to ",(0,i.jsx)(s.code,{children:"pants.core.util_rules.system_binaries"})]}),"\n",(0,i.jsxs)(s.p,{children:["The new module ",(0,i.jsx)(s.code,{children:"pants.core.util_rules.system_binaries"})," centralizes all discovery of existing binaries on a user's machines."]}),"\n",(0,i.jsxs)(s.p,{children:["The functionality is the same, you only need to change your imports for types like ",(0,i.jsx)(s.code,{children:"BinaryPathRequest"})," to ",(0,i.jsx)(s.code,{children:"pants.core.util_rules.system_binaries"})," rather than ",(0,i.jsx)(s.code,{children:"pants.engine.process"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"deprecated-not-implementing-targetgenerator-in-generatetargetsrequest-implementors",children:["Deprecated not implementing ",(0,i.jsx)(s.code,{children:"TargetGenerator"})," in ",(0,i.jsx)(s.code,{children:"GenerateTargetsRequest"})," implementors"]}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/14962",children:"https://github.com/pantsbuild/pants/pull/14962"})," for an explanation and some examples of how to fix."]}),"\n",(0,i.jsxs)(s.h3,{id:"replaced-goalsubsystemrequired_union_implementations-with-goalsubsystemactivated",children:["Replaced ",(0,i.jsx)(s.code,{children:"GoalSubsystem.required_union_implementations"})," with ",(0,i.jsx)(s.code,{children:"GoalSubsystem.activated()"})]}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/14313",children:"https://github.com/pantsbuild/pants/pull/14313"})," for an explanation and some examples of how to fix."]}),"\n",(0,i.jsx)(s.h2,{id:"210",children:"2.10"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.10.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.10.x.md"})," for the changelog."]}),"\n",(0,i.jsxs)(s.h3,{id:"rename-lintrequest-to-linttargetsrequest",children:["Rename ",(0,i.jsx)(s.code,{children:"LintRequest"})," to ",(0,i.jsx)(s.code,{children:"LintTargetsRequest"})]}),"\n",(0,i.jsxs)(s.p,{children:["Pants 2.10 added a new ",(0,i.jsx)(s.code,{children:"LintFilesRequest"}),", which allows you to run linters on code without any owning targets! ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/14102",children:"https://github.com/pantsbuild/pants/pull/14102"})]}),"\n",(0,i.jsxs)(s.p,{children:["To improve clarity, we renamed ",(0,i.jsx)(s.code,{children:"LintRequest"})," to ",(0,i.jsx)(s.code,{children:"LintTargetsRequest"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"fmtrequest-checkrequest-and-linttargetsrequest-must-set-name",children:[(0,i.jsx)(s.code,{children:"FmtRequest"}),", ",(0,i.jsx)(s.code,{children:"CheckRequest"}),", and ",(0,i.jsx)(s.code,{children:"LintTargetsRequest"})," must set ",(0,i.jsx)(s.code,{children:"name"})]}),"\n",(0,i.jsxs)(s.p,{children:["You must set the class property ",(0,i.jsx)(s.code,{children:"name"})," on these three types."]}),"\n",(0,i.jsx)(s.p,{children:"Before:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"class MyPyRequest(CheckRequest):\n    field_set_type = MyPyFieldSet\n"})}),"\n",(0,i.jsx)(s.p,{children:"After:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'class MyPyRequest(CheckRequest):\n    field_set_type = MyPyFieldSet\n    name = "mypy"\n'})}),"\n",(0,i.jsxs)(s.p,{children:["This change is what allowed us to add the ",(0,i.jsx)(s.code,{children:"lint --only=flake8"})," feature."]}),"\n",(0,i.jsxs)(s.p,{children:["For DRY, it is a good idea to change the ",(0,i.jsx)(s.code,{children:"formatter_name"}),", ",(0,i.jsx)(s.code,{children:"linter_name"}),", and ",(0,i.jsx)(s.code,{children:"checker_name"})," in ",(0,i.jsx)(s.code,{children:"FmtResult"}),", ",(0,i.jsx)(s.code,{children:"LintResults"}),", and ",(0,i.jsx)(s.code,{children:"CheckResults"}),", respectively, to use ",(0,i.jsx)(s.code,{children:"request.name"})," rather than hardcoding the string again. See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/14304",children:"https://github.com/pantsbuild/pants/pull/14304"})," for examples."]}),"\n",(0,i.jsxs)(s.h3,{id:"removed-languagefmttargets-for-fmt",children:["Removed ",(0,i.jsx)(s.code,{children:"LanguageFmtTargets"})," for ",(0,i.jsx)(s.code,{children:"fmt"})]}),"\n",(0,i.jsxs)(s.p,{children:["When setting up a new language to be formatted, you used to have to copy and paste a lot of boilerplate like ",(0,i.jsx)(s.code,{children:"ShellFmtTargets"}),". That's been fixed, thanks to ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/14166",children:"https://github.com/pantsbuild/pants/pull/14166"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"To fix your code:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["If you defined any new languages to be formatted, delete the copy-and-pasted ",(0,i.jsx)(s.code,{children:"LanguageFmtTargets"})," code."]}),"\n",(0,i.jsxs)(s.li,{children:["For every formatter, change the ",(0,i.jsx)(s.code,{children:"UnionRule"})," to be ",(0,i.jsx)(s.code,{children:"UnionRule(FmtRequest, BlackRequest)"}),", rather than ",(0,i.jsx)(s.code,{children:"UnionRule(PythonFmtRequest, BlackRequest)"}),", for example."]}),"\n"]}),"\n",(0,i.jsxs)(s.h3,{id:"replimplementation-now-passes-root-targets-not-transitive-closure",children:[(0,i.jsx)(s.code,{children:"ReplImplementation"})," now passes root targets, not transitive closure"]}),"\n",(0,i.jsxs)(s.p,{children:["We realized that it's useful to let REPL rules know what was specified vs. what is a transitive dependency: ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/14323",children:"https://github.com/pantsbuild/pants/pull/14323"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["To adapt to this, you will want to use ",(0,i.jsx)(s.code,{children:"transitive_targets = await Get(TransitiveTargets, TransitiveTargetsRequest(request.addresses)"}),", then operate on ",(0,i.jsx)(s.code,{children:"transitive_targets.closure"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"removed-pexfromtargetsrequestadditional_requirements",children:["Removed ",(0,i.jsx)(s.code,{children:"PexFromTargetsRequest.additional_requirements"})]}),"\n",(0,i.jsxs)(s.p,{children:["Let us know if you were using this, and we can figure out how to add it back: ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/14350",children:"https://github.com/pantsbuild/pants/pull/14350"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"removed-pexfromtargetsrequestdirect_deps_only-bool",children:["Removed ",(0,i.jsx)(s.code,{children:"PexFromTargetsRequest(direct_deps_only: bool)"})]}),"\n",(0,i.jsxs)(s.p,{children:["Let us know if you were using this, and we can figure out how to add it back: ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/14291",children:"https://github.com/pantsbuild/pants/pull/14291"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"renamed-generatetoollockfilesentineloptions_scope-to-resolve_name",children:["Renamed ",(0,i.jsx)(s.code,{children:"GenerateToolLockfileSentinel.options_scope"})," to ",(0,i.jsx)(s.code,{children:"resolve_name"})]}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/14231",children:"https://github.com/pantsbuild/pants/pull/14231"})," for more info."]}),"\n",(0,i.jsxs)(s.h3,{id:"renamed-pythonmodule-to-pythonmoduleownersrequest",children:["Renamed ",(0,i.jsx)(s.code,{children:"PythonModule"})," to ",(0,i.jsx)(s.code,{children:"PythonModuleOwnersRequest"})]}),"\n",(0,i.jsxs)(s.p,{children:["This type was used to determine the owners of a Python module. The new name makes that more clear. See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/14276",children:"https://github.com/pantsbuild/pants/pull/14276"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"29",children:"2.9"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.9.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.9.x.md"})," for the changelog."]}),"\n",(0,i.jsxs)(s.h3,{id:"deprecated-rulerunnercreate_files-create_file-and-add_to_build_file",children:["Deprecated ",(0,i.jsx)(s.code,{children:"RuleRunner.create_files()"}),", ",(0,i.jsx)(s.code,{children:".create_file()"})," and ",(0,i.jsx)(s.code,{children:".add_to_build_file()"})]}),"\n",(0,i.jsxs)(s.p,{children:["Instead, for your ",(0,i.jsx)(s.code,{children:"RuleRunner"})," tests, use ",(0,i.jsx)(s.code,{children:".write_files()"}),". See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/13817",children:"https://github.com/pantsbuild/pants/pull/13817"})," for some examples."]}),"\n",(0,i.jsx)(s.h2,{id:"28",children:"2.8"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.8.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.8.x.md"})," for the changelog."]}),"\n",(0,i.jsx)(s.h3,{id:"target-modeling-changes",children:"Target modeling changes"}),"\n",(0,i.jsxs)(s.p,{children:["Pants 2.8 cleaned up the modeling of targets. Now, there are targets that describe the atom of each language, like ",(0,i.jsx)(s.code,{children:"python_test"})," and ",(0,i.jsx)(s.code,{children:"python_source"})," which correspond to a single file. There are also target generators which exist solely for less boilerplate, like ",(0,i.jsx)(s.code,{children:"python_tests"})," and ",(0,i.jsx)(s.code,{children:"python_sources"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["We recommend re-reading ",(0,i.jsx)(s.a,{href:"/2.13/docs/using-pants/key-concepts/targets-and-build-files",children:"Targets and BUILD files"}),"."]}),"\n",(0,i.jsx)(s.h4,{id:"sourcesfield",children:(0,i.jsx)(s.code,{children:"SourcesField"})}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"Sources"})," class was replaced with ",(0,i.jsx)(s.code,{children:"SourcesField"}),", ",(0,i.jsx)(s.code,{children:"SingleSourceField"}),", and ",(0,i.jsx)(s.code,{children:"MultipleSourcesField"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["When defining new target types with the Target API, you should choose between subclassing ",(0,i.jsx)(s.code,{children:"SingleSourceField"})," and ",(0,i.jsx)(s.code,{children:"MultipleSourcesField"}),", depending on if you want the field to be ",(0,i.jsx)(s.code,{children:"source: str"})," or ",(0,i.jsx)(s.code,{children:"sources: list[str]"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["Wherever you were using ",(0,i.jsx)(s.code,{children:"Sources"})," in your ",(0,i.jsx)(s.code,{children:"@rule"}),"s, simply replace with ",(0,i.jsx)(s.code,{children:"SourcesField"}),"."]}),"\n",(0,i.jsxs)(s.h4,{id:"renames-of-some-sources-subclasses",children:["Renames of some ",(0,i.jsx)(s.code,{children:"Sources"})," subclasses"]}),"\n",(0,i.jsxs)(s.p,{children:["You should update all references to these classes in your ",(0,i.jsx)(s.code,{children:"@rule"}),"s."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"FilesSources"})," -> ",(0,i.jsx)(s.code,{children:"FileSourceField"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"ResourcesSources"})," -> ",(0,i.jsx)(s.code,{children:"ResourceSourceField"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"PythonSources"})," -> ",(0,i.jsx)(s.code,{children:"PythonSourceField"})]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"outputpathfieldvalue_or_default",children:(0,i.jsx)(s.code,{children:"OutputPathField.value_or_default()"})}),"\n",(0,i.jsxs)(s.p,{children:["The method ",(0,i.jsx)(s.code,{children:"OutputPathField.value_or_default()"})," no longer takes ",(0,i.jsx)(s.code,{children:"Address"})," as an argument."]}),"\n",(0,i.jsx)(s.h2,{id:"27",children:"2.7"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.7.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.7.x.md"})," for the changelog."]}),"\n",(0,i.jsx)(s.h3,{id:"type-hints-work-properly",children:"Type hints work properly"}),"\n",(0,i.jsx)(s.p,{children:"Pants was not using PEP 561 properly, which means that MyPy would not enforce type hints when using Pants APIs. Oops! This is now fixed."}),"\n",(0,i.jsxs)(s.h3,{id:"options-scopes-should-not-have-_",children:["Options scopes should not have ",(0,i.jsx)(s.code,{children:"_"})]}),"\n",(0,i.jsxs)(s.p,{children:["For example, use ",(0,i.jsx)(s.code,{children:"my-subsystem"})," instead of ",(0,i.jsx)(s.code,{children:"my_subsystem"}),". This is to avoid ambiguity with target types."]}),"\n",(0,i.jsx)(s.h2,{id:"26",children:"2.6"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.6.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.6.x.md"})," for the changelog."]}),"\n",(0,i.jsx)(s.h3,{id:"processcachescope",children:(0,i.jsx)(s.code,{children:"ProcessCacheScope"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"ProcessCacheScope.NEVER"})," was renamed to ",(0,i.jsx)(s.code,{children:"ProcessCacheScope.PER_SESSION"})," to better reflect that a rule never runs more than once in a session (i.e. a single Pants run) given the same inputs."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"ProcessCacheScope.PER_RESTART"})," was replaced with ",(0,i.jsx)(s.code,{children:"ProcessCacheScope.PER_RESTART_ALWAYS"})," and ",(0,i.jsx)(s.code,{children:"ProcessCacheScope.PER_RESTART_SUCCESSFUL"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"pexinterpreterconstraints",children:(0,i.jsx)(s.code,{children:"PexInterpreterConstraints"})}),"\n",(0,i.jsxs)(s.p,{children:["Now called ",(0,i.jsx)(s.code,{children:"InterpreterConstraints"})," and defined in ",(0,i.jsx)(s.code,{children:"pants.backend.python.util_rules.interpreter_constraints"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"25",children:"2.5"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.5.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.5.x.md"})," for the changelog."]}),"\n",(0,i.jsx)(s.h3,{id:"triboolfield",children:(0,i.jsx)(s.code,{children:"TriBoolField"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"BoolField.value"})," is no longer ",(0,i.jsx)(s.code,{children:"bool | None"}),", but simply ",(0,i.jsx)(s.code,{children:"bool"}),". This means that you must either set ",(0,i.jsx)(s.code,{children:"required = True"})," or set the ",(0,i.jsx)(s.code,{children:"default"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["Use ",(0,i.jsx)(s.code,{children:"TriBoolField"})," if you still want to be able to represent a trinary state: ",(0,i.jsx)(s.code,{children:"False"}),", ",(0,i.jsx)(s.code,{children:"True"}),", and ",(0,i.jsx)(s.code,{children:"None"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"added-rulerunnerwrite_files",children:["Added ",(0,i.jsx)(s.code,{children:"RuleRunner.write_files()"})]}),"\n",(0,i.jsxs)(s.p,{children:["This is a more declarative way to set up files than the older API of ",(0,i.jsx)(s.code,{children:"RuleRunner.create_file()"}),", ",(0,i.jsx)(s.code,{children:".create_files()"}),", and ",(0,i.jsx)(s.code,{children:".add_to_build_files()"}),". See ",(0,i.jsx)(s.a,{href:"/2.13/docs/writing-plugins/the-rules-api/testing-plugins",children:"Testing plugins"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"24",children:"2.4"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.4.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.4.x.md"})," for the changelog."]}),"\n",(0,i.jsxs)(s.h3,{id:"pexrequest-changes-how-entry-point-is-set",children:[(0,i.jsx)(s.code,{children:"PexRequest"})," changes how entry point is set"]}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/11620",children:"https://github.com/pantsbuild/pants/pull/11620"}),". Instead of setting ",(0,i.jsx)(s.code,{children:'entry_point="pytest"'})," in the ",(0,i.jsx)(s.code,{children:"PexRequest"})," constructor, now you set ",(0,i.jsx)(s.code,{children:'main=ConsoleScript("black")'})," or ",(0,i.jsx)(s.code,{children:'main=EntryPoint("pytest")'}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"must-use-environmentrequest-for-accessing-environment-variables",children:["Must use ",(0,i.jsx)(s.code,{children:"EnvironmentRequest"})," for accessing environment variables"]}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pull/11641",children:"https://github.com/pantsbuild/pants/pull/11641"}),". Pants now eagerly purges environment variables from the run, so using ",(0,i.jsx)(s.code,{children:"os.environ"})," in plugins won't work anymore."]}),"\n",(0,i.jsxs)(s.p,{children:["Instead, use ",(0,i.jsx)(s.code,{children:'await Get(Environment, EnvironmentRequest(["MY_ENV_VAR"])'}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["For ",(0,i.jsx)(s.code,{children:"RuleRunner"})," tests, you must now either set ",(0,i.jsx)(s.code,{children:"env"})," or the new ",(0,i.jsx)(s.code,{children:"env_inherit"})," arguments for environment variables to be set. Tests are now hermetic."]}),"\n",(0,i.jsx)(s.h2,{id:"23",children:"2.3"}),"\n",(0,i.jsxs)(s.p,{children:["There were no substantial changes to the Plugin API in 2.3. See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.3.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.3.x.md"})," for the changelog."]}),"\n",(0,i.jsx)(s.h2,{id:"22",children:"2.2"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.2.x.md",children:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/notes/2.2.x.md"})," for the changelog."]}),"\n",(0,i.jsxs)(s.h3,{id:"primitivefield-and-asyncfield-are-removed-220dev0",children:[(0,i.jsx)(s.code,{children:"PrimitiveField"})," and ",(0,i.jsx)(s.code,{children:"AsyncField"})," are removed (2.2.0.dev0)"]}),"\n",(0,i.jsxs)(s.p,{children:["Rather than subclassing ",(0,i.jsx)(s.code,{children:"PrimitiveField"}),", subclass ",(0,i.jsx)(s.code,{children:"Field"})," directly. ",(0,i.jsx)(s.code,{children:"Field"})," now behaves like ",(0,i.jsx)(s.code,{children:"PrimitiveField"})," used to, and ",(0,i.jsx)(s.code,{children:"PrimitiveField"})," was removed for simplicity."]}),"\n",(0,i.jsxs)(s.p,{children:["Rather than subclassing ",(0,i.jsx)(s.code,{children:"AsyncField"})," or ",(0,i.jsx)(s.code,{children:"AsyncStringSequenceField"}),", subclass ",(0,i.jsx)(s.code,{children:"Field"})," or a template like ",(0,i.jsx)(s.code,{children:"StringField"})," and also subclass ",(0,i.jsx)(s.code,{children:"AsyncFieldMixin"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from pants.engine.target import AsyncFieldMixin, StringField)\n\nclass MyField(StringField, AsyncFieldMixin):\n    alias = "my_field"\n    help = "Description."\n'})}),"\n",(0,i.jsxs)(s.p,{children:["Async fields now access the raw value with the property ",(0,i.jsx)(s.code,{children:".value"}),", rather than ",(0,i.jsx)(s.code,{children:".sanitized_raw_value"}),". To override the eager validation, override ",(0,i.jsx)(s.code,{children:"compute_value()"}),", rather than ",(0,i.jsx)(s.code,{children:"sanitize_raw_value()"}),". Both these changes bring async fields into alignment with non-async fields."]}),"\n",(0,i.jsxs)(s.h3,{id:"set-the-property-help-with-subsystems-targets-and-fields-220dev3",children:["Set the property ",(0,i.jsx)(s.code,{children:"help"})," with Subsystems, Targets, and Fields (2.2.0.dev3)"]}),"\n",(0,i.jsxs)(s.p,{children:["Previously, you were supposed to set the class's docstring for the ",(0,i.jsx)(s.code,{children:"./pants help"})," message. Instead, now set a class property ",(0,i.jsx)(s.code,{children:"help"}),", like this:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'class MyField(StringField):\n    alias = "my_field"\n    help = "A summary.\\n\\nOptional extra information."\n'})}),"\n",(0,i.jsxs)(s.p,{children:["Pants will now properly wrap strings and preserve newlines. You may want to run ",(0,i.jsx)(s.code,{children:"./pants help ${target/subsystem}"})," to verify things render properly."]}),"\n",(0,i.jsx)(s.h2,{id:"21",children:"2.1"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/master/src/python/pants/notes/2.1.x.rst",children:"https://github.com/pantsbuild/pants/blob/master/src/python/pants/notes/2.1.x.rst"})," for the changelog."]}),"\n",(0,i.jsxs)(s.h3,{id:"sourcessnapshot-is-now-specssnapshot-210rc0",children:[(0,i.jsx)(s.code,{children:"SourcesSnapshot"})," is now ",(0,i.jsx)(s.code,{children:"SpecsSnapshot"})," (2.1.0rc0)"]}),"\n",(0,i.jsxs)(s.p,{children:["The type was renamed for clarity. Still import it from ",(0,i.jsx)(s.code,{children:"pants.engine.fs"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"20",children:"2.0"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/master/src/python/pants/notes/2.0.x.rst",children:"https://github.com/pantsbuild/pants/blob/master/src/python/pants/notes/2.0.x.rst"})," for the changelog."]}),"\n",(0,i.jsxs)(s.h3,{id:"use-transitivetargetsrequest-as-input-for-resolving-transitivetargets-200rc0",children:["Use ",(0,i.jsx)(s.code,{children:"TransitiveTargetsRequest"})," as input for resolving ",(0,i.jsx)(s.code,{children:"TransitiveTargets"})," (2.0.0rc0)"]}),"\n",(0,i.jsxs)(s.p,{children:["Rather than ",(0,i.jsx)(s.code,{children:"await Get(TransitiveTargets, Addresses([addr1]))"}),", use ",(0,i.jsx)(s.code,{children:"await Get(TransitiveTargets, TransitiveTargetsRequest([addr1]))"}),", from ",(0,i.jsx)(s.code,{children:"pants.engine.target"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["It's no longer possible to include ",(0,i.jsx)(s.code,{children:"TransitiveTargets"})," in your ",(0,i.jsx)(s.code,{children:"@rule"})," signature in order to get the transitive closure of what the user specified on the command. Instead, put ",(0,i.jsx)(s.code,{children:"Addresses"})," in your rule's signature, and use ",(0,i.jsx)(s.code,{children:"await Get(TransitiveTargets, TransitiveTargetsRequest(addresses))"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"codegen-implementations-use-dependenciesrequestlite-and-transitivetargetslite-200rc0",children:["Codegen implementations: use ",(0,i.jsx)(s.code,{children:"DependenciesRequestLite"})," and ",(0,i.jsx)(s.code,{children:"TransitiveTargetsLite"})," (2.0.0rc0)"]}),"\n",(0,i.jsxs)(s.p,{children:["Due to a new cycle in the rule graph, for any codegen implementations, you must use ",(0,i.jsx)(s.code,{children:"DependenciesRequestLite"})," instead of ",(0,i.jsx)(s.code,{children:"DependenciesRequest"}),", and ",(0,i.jsx)(s.code,{children:"TransitiveTargetsLite"})," instead of ",(0,i.jsx)(s.code,{children:"TransitiveTargetsRequest"}),". Both imports are still from ",(0,i.jsx)(s.code,{children:"pants.engine.target"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["These behave identically, except that they do not include dependency inference in the results. Unless you are generating for ",(0,i.jsx)(s.code,{children:"input = PythonSources"}),", this should be fine, as dependency inference is currently only used with Python."]}),"\n",(0,i.jsxs)(s.p,{children:["This is tracked by ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/issues/10917",children:"https://github.com/pantsbuild/pants/issues/10917"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"dependencies-like-fields-have-more-robust-support-200rc0",children:"Dependencies-like fields have more robust support (2.0.0rc0)"}),"\n",(0,i.jsxs)(s.p,{children:["If you have any custom fields that act like the dependencies field, but do not subclass ",(0,i.jsx)(s.code,{children:"Dependencies"}),", there are two new mechanisms for better support."]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Instead of subclassing ",(0,i.jsx)(s.code,{children:"StringSequenceField"}),", subclass ",(0,i.jsx)(s.code,{children:"SpecialCasedDependencies"})," from ",(0,i.jsx)(s.code,{children:"pants.engine.target"}),". This will ensure that the dependencies show up with ",(0,i.jsx)(s.code,{children:"./pants dependencies"})," and ",(0,i.jsx)(s.code,{children:"./pants dependees"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["You can use ",(0,i.jsx)(s.code,{children:"UnparsedAddressInputs"})," from ",(0,i.jsx)(s.code,{children:"pants.engine.addresses"})," to resolve the addresses:"]}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from pants.engine.addresses import Address, Addresses, UnparsedAddressedInputs\nfrom pants.engine.target import Targets\n\n...\n\naddresses = await Get(Addresses, UnparsedAddressedInputs(["//:addr1", "project/addr2"], owning_address=None)\n\n# Or, use this.\ntargets = await Get(\n    Targets,\n    UnparsedAddressedInputs(["//:addr1", "project/addr2"], owning_address=Address("project", target_name="original")\n)\n'})}),"\n",(0,i.jsxs)(s.p,{children:["If you defined a subclass of ",(0,i.jsx)(s.code,{children:"SpecialCasedDependencies"}),", you can use ",(0,i.jsx)(s.code,{children:"await Get(Addresses | Targets, UnparsedAddressInputs, my_tgt[MyField].to_unparsed_address_inputs())"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["(Why would you ever do this? If you have dependencies that you don't treat like normal\u2014e.g. that you will call the equivalent of ",(0,i.jsx)(s.code,{children:"./pants package"})," on those deps\u2014it's often helpful to call out this magic through a dedicated field. For example, Pants's ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/blob/969c8dcba6eda0c939918b3bc5157ca45099b4d1/src/python/pants/core/target_types.py#L231-L257",children:"archive"})," target type has the fields ",(0,i.jsx)(s.code,{children:"files"})," and ",(0,i.jsx)(s.code,{children:"packages"}),", rather than ",(0,i.jsx)(s.code,{children:"dependencies"}),".)"]}),"\n",(0,i.jsxs)(s.h3,{id:"package-implementations-may-want-to-add-the-field-output_path-200rc0",children:[(0,i.jsx)(s.code,{children:"package"})," implementations may want to add the field ",(0,i.jsx)(s.code,{children:"output_path"})," (2.0.0rc0)"]}),"\n",(0,i.jsxs)(s.p,{children:["All of Pants's target types that can be built via ",(0,i.jsx)(s.code,{children:"./pants package"})," now have an ",(0,i.jsx)(s.code,{children:"output_path"})," field, which allows the user to override the path used for the created asset."]}),"\n",(0,i.jsxs)(s.p,{children:["You optionally may want to add this ",(0,i.jsx)(s.code,{children:"output_path"})," field to your custom target type for consistency:"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Include ",(0,i.jsx)(s.code,{children:"OutputPathField"})," from ",(0,i.jsx)(s.code,{children:"pants.core.goals.package"})," in your target's ",(0,i.jsx)(s.code,{children:"core_fields"})," class property."]}),"\n",(0,i.jsxs)(s.li,{children:["In your ",(0,i.jsx)(s.code,{children:"PackageFieldSet"})," subclass, include ",(0,i.jsx)(s.code,{children:"output_path: OutputPathField"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["When computing the filename in your rule, use ",(0,i.jsx)(s.code,{children:'my_package_field_set.output_path.value_or_default(field_set.address, file_ending="my_ext")'}),"."]}),"\n"]})]})}function h(e={}){let{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},848193(e,s,n){n.d(s,{R:()=>r,x:()=>o});var t=n(830758);let i={},d=t.createContext(i);function r(e){let s=t.useContext(d);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(d.Provider,{value:s},e.children)}},839792(e){e.exports=JSON.parse('{"id":"docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide","title":"Plugin upgrade guide","description":"How to adjust for changes made to the Plugin API.","source":"@site/versioned_docs/version-2.13/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide.mdx","sourceDirName":"docs/writing-plugins/common-plugin-tasks","slug":"/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide","permalink":"/2.13/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide.mdx","tags":[],"version":"2.13","sidebarPosition":9,"frontMatter":{"title":"Plugin upgrade guide","sidebar_position":9},"sidebar":"docsSidebar","previous":{"title":"Custom `python_artifact()` kwargs","permalink":"/2.13/docs/writing-plugins/common-plugin-tasks/custom-python-artifact-kwargs"},"next":{"title":"Deprecation policy","permalink":"/2.13/docs/releases/deprecation-policy"}}')}}]);