"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["410518"],{412077(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>h});var s=t(318582),r=t(886070),o=t(848193),i=t(685008),l=t(637180);let a={title:"Third-party dependencies",sidebar_position:1},d,c={},h=[{value:"Teaching Pants your &quot;universe&quot;(s) of dependencies",id:"teaching-pants-your-universes-of-dependencies",level:2},{value:"<code>requirements.txt</code>",id:"requirementstxt",level:3},{value:"Poetry",id:"poetry",level:3},{value:"How dependencies are chosen",id:"how-dependencies-are-chosen",level:2},{value:"Use <code>modules</code> and <code>module_mapping</code> when the module name is not standard",id:"use-modules-and-module_mapping-when-the-module-name-is-not-standard",level:3},{value:"Warning: multiple versions of the same dependency",id:"warning-multiple-versions-of-the-same-dependency",level:3},{value:"Lockfiles",id:"lockfiles",level:2},{value:"User lockfiles",id:"user-lockfiles",level:3},{value:"Multiple lockfiles",id:"multiple-lockfiles",level:4},{value:"Tool lockfiles",id:"tool-lockfiles",level:3},{value:"Manually generating lockfiles",id:"manually-generating-lockfiles",level:3},{value:"Advanced usage",id:"advanced-usage",level:2},{value:"Requirements with undeclared dependencies",id:"requirements-with-undeclared-dependencies",level:3},{value:"Version control requirements",id:"version-control-requirements",level:3},{value:"Custom repositories",id:"custom-repositories",level:3},{value:"PEP-503 compatible indexes",id:"pep-503-compatible-indexes",level:4},{value:"pip <code>--find-links</code>",id:"pip---find-links",level:4},{value:"Authenticating to custom repos",id:"authenticating-to-custom-repos",level:4},{value:"Local requirements",id:"local-requirements",level:3},{value:"Working around absolute paths",id:"working-around-absolute-paths",level:4},{value:"Constraints files",id:"constraints-files",level:3},{value:"<code>only_binary</code> and <code>no_binary</code>",id:"only_binary-and-no_binary",level:3},{value:"Tip: use <code>pants export</code> to create a virtual environment for IDEs",id:"tip-use-pants-export-to-create-a-virtual-environment-for-ides",level:2}];function p(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"How to use third-party Python libraries in your project."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:["Pants handles dependencies with more precision than traditional Python workflows. Traditionally, you have a single heavyweight ",(0,r.jsx)(n.a,{href:"https://docs.python.org/3/tutorial/venv.html",children:"virtual environment"})," that includes a large set of dependencies, whether or not you actually need them for your current task."]}),"\n",(0,r.jsx)(n.p,{children:"Instead, Pants understands exactly which dependencies every file in your project needs, and efficiently uses just that subset of dependencies needed for the task."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u276F pants dependencies src/py/util.py\n3rdparty/py#requests\n\n\u276F pants dependencies --transitive src/py/app.py\n3rdparty/py#flask\n3rdparty/py#requests\n"})}),"\n",(0,r.jsx)(n.p,{children:"Among other benefits, this precise and automatic understanding of your dependencies gives you fine-grained caching. This means, for example, that if none of the dependencies for a particular test file have changed, the cached result can be safely used."}),"\n",(0,r.jsx)(n.h2,{id:"teaching-pants-your-universes-of-dependencies",children:'Teaching Pants your "universe"(s) of dependencies'}),"\n",(0,r.jsx)(n.p,{children:'For Pants to know which dependencies each file uses, it must first know which specific dependencies are in your "universe", i.e. all the third-party dependencies your project directly uses.'}),"\n",(0,r.jsx)(n.p,{children:'By default, Pants uses a single universe for your whole project, but it\'s possible to set up multiple. See the header "Multiple resolves" in the "Lockfiles" section.'}),"\n",(0,r.jsxs)(n.p,{children:["Each third-party dependency you directly use is modeled by a ",(0,r.jsx)(n.code,{children:"python_requirement"})," target:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="BUILD"',children:'python_requirement(\n    name="django",\n    requirements=["Django==3.2.1"],\n)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["You do not need a ",(0,r.jsx)(n.code,{children:"python_requirement"})," target for transitive dependencies, i.e. requirements that you do not directly import."]}),"\n",(0,r.jsxs)(n.p,{children:["To minimize boilerplate, Pants has target generators to generate ",(0,r.jsx)(n.code,{children:"python_requirement"})," targets for you:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"python_requirements"})," for ",(0,r.jsx)(n.code,{children:"requirements.txt"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"poetry_requirements"})," for Poetry projects."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"requirementstxt",children:(0,r.jsx)(n.code,{children:"requirements.txt"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"python_requirements()"})," target generator parses a ",(0,r.jsxs)(n.a,{href:"https://pip.pypa.io/en/stable/user_guide/#requirements-files",children:[(0,r.jsx)(n.code,{children:"requirements.txt"}),"-style file"]})," to produce a ",(0,r.jsx)(n.code,{children:"python_requirement"})," target for each entry."]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsxs)(i.A,{groupId:"code-examples",children:[(0,r.jsx)(l.A,{value:"requirements.txt",label:"requirements.txt",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'tab={"label":"requirements.txt"}',children:"flask>=1.1.2,<1.3\nrequests[security]==2.23.0\ndataclasses ; python_version<'3.7'\n"})})}),(0,r.jsx)(l.A,{value:"build",label:"BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"BUILD"}',children:'# This will generate three targets:\n#\n#  - //:reqs#flask\n#  - //:reqs#requests\n#  - //:reqs#dataclasses\npython_requirements(name="reqs")\n\n# The above target generator is spiritually equivalent to this:\npython_requirement(\n    name="flask",\n    requirements=["flask>=1.1.2,<1.3"],\n)\npython_requirement(\n    name="requests",\n    requirements=["requests[security]==2.23.0"],\n)\npython_requirement(\n    name="dataclasses",\n    requirements=["dataclasses ; python_version<\'3.7\'"],\n)\n'})})})]}),"\n",(0,r.jsxs)(n.p,{children:["If the file uses a different name than ",(0,r.jsx)(n.code,{children:"requirements.txt"}),", set ",(0,r.jsx)(n.code,{children:"source"})," like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'python_requirements(source="reqs.txt")\n'})}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsxs)(n.mdxAdmonitionTitle,{children:["Where should I put the ",(0,r.jsx)(n.code,{children:"requirements.txt"}),"?"]}),(0,r.jsx)(n.p,{children:"You can name the file whatever you want, and put it wherever makes the most sense for your project."}),(0,r.jsx)(n.p,{children:'In smaller repositories that only use Python, it\'s often convenient to put the file at the "build root" (top-level), as used on this page.'}),(0,r.jsxs)(n.p,{children:["For larger repositories or multilingual repositories, it's often useful to have a ",(0,r.jsx)(n.code,{children:"3rdparty"})," or ",(0,r.jsx)(n.code,{children:"3rdparty/python"})," directory. Rather than the target's address being ",(0,r.jsx)(n.code,{children:"//:reqs#my_requirement"}),", its address would be ",(0,r.jsx)(n.code,{children:"3rdparty/python:reqs#my_requirement"}),", for example; or ",(0,r.jsx)(n.code,{children:"3rdparty/python#my_requirement"})," if you leave off the ",(0,r.jsx)(n.code,{children:"name"})," field for ",(0,r.jsx)(n.code,{children:"python_requirements"}),". See ",(0,r.jsx)(n.a,{href:"/2.15/docs/using-pants/key-concepts/targets-and-build-files#target-generation",children:"Target Generation"}),"."]})]}),"\n",(0,r.jsx)(n.h3,{id:"poetry",children:"Poetry"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"poetry_requirements()"})," target generator parses the ",(0,r.jsx)(n.a,{href:"https://python-poetry.org/docs/",children:"Poetry"})," section in ",(0,r.jsx)(n.code,{children:"pyproject.toml"})," to produce a ",(0,r.jsx)(n.code,{children:"python_requirement"})," target for each entry."]}),"\n",(0,r.jsxs)(i.A,{groupId:"code-examples",children:[(0,r.jsx)(l.A,{value:"pyproject.toml",label:"pyproject.toml",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'tab={"label":"pyproject.toml"}',children:'[tool.poetry.dependencies]\npython = "^3.8"\nrequests = {extras = ["security"], version = "~1"}\nflask = "~1.12"\n\n[tool.poetry.dev-dependencies]\nisort = "~5.5"\n'})})}),(0,r.jsx)(l.A,{value:"build",label:"BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"BUILD"}',children:'# This will generate three targets:\n#\n#  - //:poetry#flask\n#  - //:poetry#requests\n#  - //:poetry#dataclasses\npoetry_requirements(name="poetry")\n\n# The above target generator is spiritually equivalent to this:\npython_requirement(\n    name="requests",\n    requirements=["requests[security]>=1,<2.0"],\n)\npython_requirement(\n    name="flask",\n    requirements=["flask>=1.12,<1.13"],\n)\npython_requirement(\n    name="isort",\n    requirements=["isort>=5.5,<5.6"],\n)\n'})})})]}),"\n",(0,r.jsxs)(n.p,{children:["Note that Pants does not consume your ",(0,r.jsx)(n.code,{children:"poetry.lock"})," file. Instead, see the ",(0,r.jsx)(n.a,{href:"#lockfiles",children:"section on lockfiles"})," below."]}),"\n",(0,r.jsx)(n.h2,{id:"how-dependencies-are-chosen",children:"How dependencies are chosen"}),"\n",(0,r.jsxs)(n.p,{children:['Once Pants knows about your "universe"(s) of dependencies, it determines which subset should be used through ',(0,r.jsx)(n.a,{href:"https://blog.pantsbuild.org/dependency-inference/",children:"dependency inference"}),". Pants will read your import statements, like ",(0,r.jsx)(n.code,{children:"import django"}),", and map it back to the relevant ",(0,r.jsx)(n.code,{children:"python_requirement"})," target. Run ",(0,r.jsx)(n.a,{href:"/2.15/docs/using-pants/project-introspection",children:(0,r.jsx)(n.code,{children:"pants dependencies path/to/file.py"})})," or ",(0,r.jsx)(n.code,{children:"pants dependencies path/to:target"})," to confirm this works."]}),"\n",(0,r.jsxs)(n.p,{children:["If dependency inference does not work\u2014such as because it's a runtime dependency you do not import\u2014you can explicitly add the ",(0,r.jsx)(n.code,{children:"python_requirement"})," target to the ",(0,r.jsx)(n.code,{children:"dependencies"})," field, like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="project/BUILD"',children:'python_sources(\n    name="lib",\n    dependencies=[\n        # We don\'t have an import statement for this dep, so inference\n        # won\'t add it automatically. We add it explicitly instead.\n        "3rdparty/python#psyscopg2-binary",\n    ],\n)\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"use-modules-and-module_mapping-when-the-module-name-is-not-standard",children:["Use ",(0,r.jsx)(n.code,{children:"modules"})," and ",(0,r.jsx)(n.code,{children:"module_mapping"})," when the module name is not standard"]}),"\n",(0,r.jsxs)(n.p,{children:["Some dependencies expose a module different than their project name, such as ",(0,r.jsx)(n.code,{children:"beautifulsoup4"})," exposing ",(0,r.jsx)(n.code,{children:"bs4"}),". Pants assumes that a dependency's module is its normalized name\u2014i.e. ",(0,r.jsx)(n.code,{children:"My-distribution"})," exposes the module ",(0,r.jsx)(n.code,{children:"my_distribution"}),". If that default does not apply to a dependency, it will not be inferred."]}),"\n",(0,r.jsxs)(n.p,{children:["Pants already defines a ",(0,r.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/blob/main/src/python/pants/backend/python/dependency_inference/default_module_mapping.py",children:"default module mapping"})," for some common Python requirements, but you may need to augment this by teaching Pants additional mappings:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="3rdparty/python/BUILD"',children:'# `modules` and `module_mapping` is only needed for requirements where\n# the defaults do not work.\n\npython_requirement(\n    name="my_distribution",\n    requirements=["my_distribution==4.1"],\n    modules=["custom_module"],\n)\n\npython_requirements(\n    name="reqs",\n    module_mapping={"my_distribution": ["custom_module"]},\n)\n\npoetry_requirements(\n    name="poetry",\n    module_mapping={"my_distribution": ["custom_module"]},\n)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["If the dependency is a type stub, and the default does not work, set ",(0,r.jsx)(n.code,{children:"type_stub_modules"})," on the ",(0,r.jsx)(n.code,{children:"python_requirement"})," target, and ",(0,r.jsx)(n.code,{children:"type_stubs_module_mapping"})," on the ",(0,r.jsx)(n.code,{children:"python_requirements"})," and ",(0,r.jsx)(n.code,{children:"poetry_requirements"})," target generators. (The default for type stubs is to strip off ",(0,r.jsx)(n.code,{children:"types-"}),", ",(0,r.jsx)(n.code,{children:"-types"}),", ",(0,r.jsx)(n.code,{children:"-stubs"}),", and ",(0,r.jsx)(n.code,{children:"stubs-"}),". So, ",(0,r.jsx)(n.code,{children:"types-requests"})," gives type stubs for the module ",(0,r.jsx)(n.code,{children:"requests"}),".)"]}),"\n",(0,r.jsx)(n.h3,{id:"warning-multiple-versions-of-the-same-dependency",children:"Warning: multiple versions of the same dependency"}),"\n",(0,r.jsxs)(n.p,{children:["It's invalid in Python to have conflicting versions of the same requirement, e.g. ",(0,r.jsx)(n.code,{children:"Django==2"})," and ",(0,r.jsx)(n.code,{children:"Django==3"}),'. Instead, Pants supports "multiple resolves" (i.e. multiple lockfiles), as explained in the below section on lockfiles.']}),"\n",(0,r.jsxs)(n.p,{children:['When you have multiple targets for the same dependency and they belong to the same resolve ("lockfile"), dependency inference will not work due to ambiguity. If you\'re using lockfiles\u2014which we strongly recommend\u2014the solution is to set the ',(0,r.jsx)(n.code,{children:"resolve"})," field for problematic ",(0,r.jsx)(n.code,{children:"python_requirement"})," targets so that each resolve has only one requirement and there is no ambiguity."]}),"\n",(0,r.jsxs)(n.p,{children:["This ambiguity is often a problem when you have 2+ ",(0,r.jsx)(n.code,{children:"requirements.txt"})," or ",(0,r.jsx)(n.code,{children:"pyproject.toml"})," files in your project, such as ",(0,r.jsx)(n.code,{children:"project1/requirements.txt"})," and ",(0,r.jsx)(n.code,{children:"project2/requirements.txt"})," both specifying ",(0,r.jsx)(n.code,{children:"django"}),". You may want to set up each ",(0,r.jsx)(n.code,{children:"poetry_requirements"}),"/",(0,r.jsx)(n.code,{children:"python_requirements"})," target generator to use a distinct resolve so that there is no overlap. Alternatively, if the versions are the same, you may want to consolidate the requirements into a common file."]}),"\n",(0,r.jsx)(n.h2,{id:"lockfiles",children:"Lockfiles"}),"\n",(0,r.jsxs)(n.p,{children:["We strongly recommend using lockfiles because they make your builds ",(0,r.jsx)(n.a,{href:"https://classic.yarnpkg.com/blog/2016/11/24/lockfiles-for-all/",children:"more stable"})," so that new releases of dependencies will not break your project. They also reduce the risk of ",(0,r.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/windows/security/threat-protection/intelligence/supply-chain-malware",children:"supply chain attacks"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Pants has two types of lockfiles:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"User lockfiles, for your own code such as packaging binaries and running tests."}),"\n",(0,r.jsx)(n.li,{children:"Tool lockfiles, to install tools that Pants runs like Pytest and Flake8."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["With both types of lockfiles, Pants can generate the lockfile for you with the ",(0,r.jsx)(n.code,{children:"generate-lockfiles"})," goal."]}),"\n",(0,r.jsx)(n.h3,{id:"user-lockfiles",children:"User lockfiles"}),"\n",(0,r.jsxs)(n.p,{children:["First, set ",(0,r.jsx)(n.code,{children:"[python].enable_resolves"})," in ",(0,r.jsx)(n.code,{children:"pants.toml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:"[python]\nenable_resolves = true\n"})}),"\n",(0,r.jsxs)(n.p,{children:["By default, Pants will write the lockfile to ",(0,r.jsx)(n.code,{children:"3rdparty/python/default.lock"}),". If you want a different location, change ",(0,r.jsx)(n.code,{children:"[python].resolves"})," like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'[python]\nenable_resolves = true\n\n[python.resolves]\npython-default = "lockfile_path.lock"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Then, use ",(0,r.jsx)(n.code,{children:"pants generate-lockfiles"})," to generate the lockfile."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u276F pants generate-lockfiles\n19:00:39.26 [INFO] Completed: Generate lockfile for python-default\n19:00:39.29 [INFO] Wrote lockfile for the resolve `python-default` to 3rdparty/python/default.lock\n"})}),"\n",(0,r.jsxs)(n.admonition,{title:"FYI: user lockfiles improve performance",type:"note",children:[(0,r.jsx)(n.p,{children:'As explained at the top of these docs, Pants only uses the subset of the "universe" of your\ndependencies that is actually needed for a build, such as running tests and packaging a wheel\nfile. This gives fine-grained caching and has other benefits like built packages\n(e.g. PEX binaries) only including their true dependencies.'}),(0,r.jsx)(n.p,{children:'Without lockfiles, Pants must "resolve" the unique dependencies for each task, which involves\noften-slow steps like choosing which versions of transitive dependencies to install.'}),(0,r.jsx)(n.p,{children:"Instead, with lockfiles, Pants already did the resolve beforehand, so only installs the specific\nsubset of the lockfile relevant to the task."})]}),"\n",(0,r.jsx)(n.h4,{id:"multiple-lockfiles",children:"Multiple lockfiles"}),"\n",(0,r.jsx)(n.p,{children:"While it's often desirable to have a single lockfile for the whole repository for simplicity and consistency, sometimes you may need multiple. This is necessary, for example, when you have conflicting versions of requirements, such as one project using Django 2 and other projects using Django 3."}),"\n",(0,r.jsx)(n.p,{children:'Start by defining multiple "resolves", which are logical names for lockfile paths. For example:'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'[python]\nenable_resolves = true\ndefault_resolve = "web-app"\n\n[python.resolves]\ndata-science = "3rdparty/python/data_science.lock"\nweb-app = "3rdparty/python/web_app.lock"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Then, teach Pants which resolves every ",(0,r.jsx)(n.code,{children:"python_requirement"})," target belongs to through the ",(0,r.jsx)(n.code,{children:"resolve"})," field. It will default to ",(0,r.jsx)(n.code,{children:"[python].default_resolve"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="BUILD"',children:'python_requirement(\n    name="ansicolors",\n    requirements=["ansicolors==1.18"],\n    resolve="web-app",\n)\n\n# Often, you will want to set `resolve` on the\n# `poetry_requirements` and `python_requirements`\n# target generators.\npoetry_requirements(\n    name="poetry",\n    resolve="data-science",\n    # You can use `overrides` if you only want to change\n    # some targets.\n    overrides={"requests": {"resolve": "web-app"}},\n)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["If you want the same requirement to show up in multiple resolves, use the ",(0,r.jsx)(n.a,{href:"/2.15/docs/using-pants/key-concepts/targets-and-build-files",children:(0,r.jsx)(n.code,{children:"parametrize"})})," mechanism."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="BUILD"',children:'# The same requirement in multiple resolves:\npython_requirement(\n    name="ansicolors_web-app",\n    requirements=["ansicolors==1.18"],\n    resolve=parametrize("web-app", "data-science")\n)\n\n# You can parametrize target generators, including\n# via the `overrides` field:\npoetry_requirements(\n    name="poetry",\n    resolve="data-science",\n    overrides={\n        "requests": {\n            "resolve": parametrize("web-app", "data-science")\n        }\n    },\n)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Then, run ",(0,r.jsx)(n.code,{children:"pants generate-lockfiles"})," to generate the lockfiles. If the results aren't what you'd expect, adjust the prior step."]}),"\n",(0,r.jsxs)(n.p,{children:["Finally, update your first-party targets like ",(0,r.jsx)(n.code,{children:"python_source"})," / ",(0,r.jsx)(n.code,{children:"python_sources"}),", ",(0,r.jsx)(n.code,{children:"python_test"})," / ",(0,r.jsx)(n.code,{children:"python_tests"}),", and ",(0,r.jsx)(n.code,{children:"pex_binary"})," to set their ",(0,r.jsx)(n.code,{children:"resolve"})," field. As before, the ",(0,r.jsx)(n.code,{children:"resolve"})," field defaults to ",(0,r.jsx)(n.code,{children:"[python].default_resolve"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="project/BUILD"',children:'python_sources(\n    resolve="web-app",\n)\n\npython_tests(\n    name="tests",\n    resolve="web-app",\n    # You can use `overrides` to change certain generated targets\n    overrides={"test_utils.py": {"resolve": "data-science"}},\n)\n\npex_binary(\n    name="main",\n    entry_point="main.py",\n    resolve="web-app",\n)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["If a first-party target is compatible with multiple resolves\u2014such as some utility code\u2014you can either use the ",(0,r.jsxs)(n.a,{href:"/2.15/docs/using-pants/key-concepts/targets-and-build-files",children:[(0,r.jsx)(n.code,{children:"parametrize"})," mechanism"]})," with the ",(0,r.jsx)(n.code,{children:"resolve"})," field or create distinct targets for the same entity."]}),"\n",(0,r.jsxs)(n.p,{children:["All transitive dependencies of a target must use the same resolve. Pants's dependency inference already handles this for you by only inferring dependencies on targets that share the same resolve. If you incorrectly add a target from a different resolve to the ",(0,r.jsx)(n.code,{children:"dependencies"})," field, Pants will error with a helpful message when building your code with goals like ",(0,r.jsx)(n.code,{children:"test"}),", ",(0,r.jsx)(n.code,{children:"package"}),", and ",(0,r.jsx)(n.code,{children:"run"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"tool-lockfiles",children:"Tool lockfiles"}),"\n",(0,r.jsxs)(n.p,{children:["Pants distributes a lockfile with each tool by default. However, if you change the tool's ",(0,r.jsx)(n.code,{children:"version"})," and ",(0,r.jsx)(n.code,{children:"extra_requirements"}),"\u2014or you change its interpreter constraints to not be compatible with our default lockfile\u2014you will need to use a custom lockfile. Set the ",(0,r.jsx)(n.code,{children:"lockfile"})," option in ",(0,r.jsx)(n.code,{children:"pants.toml"})," for that tool, and then run ",(0,r.jsx)(n.code,{children:"pants generate-lockfiles"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'[flake8]\nversion = "flake8==3.8.0"\nlockfile = "3rdparty/flake8_lockfile.txt"  # This can be any path you\'d like.\n\n[pytest]\nextra_requirements.add = ["pytest-icdiff"]\nlockfile = "3rdparty/pytest_lockfile.txt"\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u276F  pants generate-lockfiles\n19:00:39.26 [INFO] Completed: Generate lockfile for flake8\n19:00:39.27 [INFO] Completed: Generate lockfile for pytest\n19:00:39.29 [INFO] Wrote lockfile for the resolve `flake8` to 3rdparty/flake8_lockfile.txt\n19:00:39.30 [INFO] Wrote lockfile for the resolve `pytest` to 3rdparty/pytest_lockfile.txt\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can also run ",(0,r.jsx)(n.code,{children:"pants generate-lockfiles --resolve=tool"}),", e.g. ",(0,r.jsx)(n.code,{children:"--resolve=flake8"}),", to only generate that tool's lockfile rather than generating all lockfiles."]}),"\n",(0,r.jsxs)(n.p,{children:["To disable lockfiles entirely for a tool, set ",(0,r.jsx)(n.code,{children:'[tool].lockfile = "<none>"'})," for that tool. Although we do not recommend this!"]}),"\n",(0,r.jsx)(n.h3,{id:"manually-generating-lockfiles",children:"Manually generating lockfiles"}),"\n",(0,r.jsxs)(n.p,{children:["Rather than using ",(0,r.jsx)(n.code,{children:"generate-lockfiles"})," to generate PEX-style lockfiles, you can manually generate lockfiles. This can be helpful, for example, when adopting Pants in a repository already using Poetry by running ",(0,r.jsx)(n.code,{children:"poetry export --dev"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Manually generated lockfiles must either use Pex's JSON format or use pip's ",(0,r.jsx)(n.code,{children:"requirements.txt"}),"-style format (ideally with ",(0,r.jsx)(n.code,{children:"--hash"})," entries for better supply chain security).\nFor example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="3rdparty/user_lock.txt"',children:"freezegun==1.2.0 \\\n  --hash=sha256:93e90676da3... \\\n  --hash=sha256:e19563d0b05...\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For manually-generated user lockfiles, set ",(0,r.jsx)(n.code,{children:"[python].resolves"})," to the path of your lockfile(s). Also set ",(0,r.jsx)(n.code,{children:"[python].resolves_generate_lockfiles"})," to ",(0,r.jsx)(n.code,{children:"False"})," so that Pants does not expect its metadata header. Warning: it will likely be slower to install manually generated user lockfiles than Pex ones because Pants cannot as efficiently extract the subset of requirements used for a particular task; see the option ",(0,r.jsx)(n.a,{href:"/2.15/reference/subsystems/python",children:(0,r.jsx)(n.code,{children:"[python].run_against_entire_lockfile"})}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["For manually-generated tool lockfiles, set ",(0,r.jsx)(n.code,{children:"[tool].lockfile"})," to the path of your lockfile, e.g. ",(0,r.jsx)(n.code,{children:"[black].lockfile"}),". Also set ",(0,r.jsx)(n.code,{children:'[python].invalid_lockfile_behavior = "error"'})," so that Pants does not expect metadata headers. Note that this option will disable the check for all lockfiles, including user lockfiles, which may not be desirable. Feel free to open a ",(0,r.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/issues/new",children:"GitHub issue"})," if you want more precise control."]}),"\n",(0,r.jsx)(n.h2,{id:"advanced-usage",children:"Advanced usage"}),"\n",(0,r.jsx)(n.h3,{id:"requirements-with-undeclared-dependencies",children:"Requirements with undeclared dependencies"}),"\n",(0,r.jsxs)(n.p,{children:["Sometimes a requirement does not properly declare in its packaging metadata the other dependencies it depends on, so those will not be installed. It's especially common to leave off dependencies on ",(0,r.jsx)(n.code,{children:"setuptools"}),", which results in import errors like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"import pkg_resources\nModuleNotFoundError: No module named 'pkg_resources'\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To work around this, you can use the ",(0,r.jsx)(n.code,{children:"dependencies"})," field of ",(0,r.jsx)(n.code,{children:"python_requirement"}),", so that anytime you depend on your requirement, you also bring in the undeclared dependency."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="BUILD"',children:'# First, make sure you have a `python_requirement` target for\n# the undeclared dependency.\npython_requirement(\n    name="setuptools",\n    requirements=["setuptools"],\n)\n\npython_requirement(\n    name="mongomock",\n    requirements=["mongomock"],\n    dependencies=[":setuptools"],\n)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["If you are using the ",(0,r.jsx)(n.code,{children:"python_requirements"})," and ",(0,r.jsx)(n.code,{children:"poetry_requirements"})," target generators, you can use the ",(0,r.jsx)(n.code,{children:"overrides"})," field to do the same thing:"]}),"\n",(0,r.jsxs)(i.A,{groupId:"code-examples",children:[(0,r.jsx)(l.A,{value:"build",label:"BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"BUILD"}',children:'python_requirements(\n    name="reqs",\n    overrides={\n        "mongomock": {"dependencies": [":reqs#setuptools"]},\n    },\n)\n'})})}),(0,r.jsx)(l.A,{value:"requirements.txt",label:"requirements.txt",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'tab={"label":"requirements.txt"}',children:"setuptools\nmongomock\n"})})})]}),"\n",(0,r.jsx)(n.h3,{id:"version-control-requirements",children:"Version control requirements"}),"\n",(0,r.jsx)(n.p,{children:"You can install requirements from version control using two styles:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["pip's proprietary VCS-style requirements, e.g.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"git+https://github.com/django/django.git#egg=Django"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"git+https://github.com/django/django.git@stable/2.1.x#egg=Django"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"git+https://github.com/django/django.git@fd209f62f1d83233cc634443cfac5ee4328d98b8#egg=Django"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["direct references from ",(0,r.jsx)(n.a,{href:"https://www.python.org/dev/peps/pep-0440/#direct-references",children:"PEP 440"}),", e.g.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Django@ git+https://github.com/django/django.git"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Django@ git+https://github.com/django/django.git@stable/2.1.x"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Django@ git+https://github.com/django/django.git@fd209f62f1d83233cc634443cfac5ee4328d98b8"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{title:"Version control via SSH",type:"note",children:[(0,r.jsx)(n.p,{children:"When using version controlled direct references hosted on private repositories with SSH access:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"target@ git+ssh://git@github.com:/myorg/myrepo.git@myhash\n"})}),(0,r.jsx)(n.p,{children:"...you may see errors like:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:" Complete output (5 lines):\n  git@github.com: Permission denied (publickey).\n  fatal: Could not read from remote repository.\n  Please make sure you have the correct access rights\n  and the repository exists.\n  ----------------------------------------\n"})}),(0,r.jsxs)(n.p,{children:["To fix this, Pants needs to be configured to pass relevant SSH specific environment variables to processes by adding the following to ",(0,r.jsx)(n.code,{children:"pants.toml"}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'[subprocess-environment]\nenv_vars.add = [\n  "SSH_AUTH_SOCK",\n]\n'})})]}),"\n",(0,r.jsx)(n.h3,{id:"custom-repositories",children:"Custom repositories"}),"\n",(0,r.jsx)(n.p,{children:"There are two mechanisms for setting up custom Python distribution repositories:"}),"\n",(0,r.jsx)(n.h4,{id:"pep-503-compatible-indexes",children:"PEP-503 compatible indexes"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"[python-repos].indexes"})," to add ",(0,r.jsx)(n.a,{href:"https://peps.python.org/pep-0503/",children:"PEP 503-compatible"})," indexes, like PyPI."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[python-repos]\nindexes.add = ["https://custom-cheeseshop.net/simple"]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["To exclusively use your custom index, i.e. to not use the default of PyPI, use ",(0,r.jsx)(n.code,{children:"indexes = [..]"})," instead of ",(0,r.jsx)(n.code,{children:"indexes.add = [..]"}),"."]}),"\n",(0,r.jsxs)(n.h4,{id:"pip---find-links",children:["pip ",(0,r.jsx)(n.code,{children:"--find-links"})]}),"\n",(0,r.jsxs)(n.p,{children:["Use the option ",(0,r.jsx)(n.code,{children:"[python-repos].find_links"})," for flat lists of packages. Same as pip's ",(0,r.jsx)(n.a,{href:"https://pip.pypa.io/en/stable/cli/pip_wheel/?highlight=find%20links#cmdoption-f",children:(0,r.jsx)(n.code,{children:"--find-links"})})," option, you can either use:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"a URL to an HTML file with links to wheel and/or sdist files, or"}),"\n",(0,r.jsxs)(n.li,{children:["a ",(0,r.jsx)(n.code,{children:"file://"})," absolute path to an HTML file with links, or to a local directory with wheel and/or\nsdist files. See the section on local requirements below."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'[python-repos]\nfind_links = [\n  "https://your/repo/here",\n  "file:///Users/pantsbuild/prebuilt_wheels",\n]\n'})}),"\n",(0,r.jsx)(n.h4,{id:"authenticating-to-custom-repos",children:"Authenticating to custom repos"}),"\n",(0,r.jsx)(n.p,{children:"To authenticate to custom repos, you may need to provide credentials (such as a username and password) in the URL."}),"\n",(0,r.jsxs)(n.p,{children:["You can use ",(0,r.jsxs)(n.a,{href:"/2.15/docs/using-pants/key-concepts/options#config-file-interpolation",children:["config file ",(0,r.jsx)(n.code,{children:"%(env.ENV_VAR)s"})," interpolation"]})," to load the values via environment variables. This avoids checking in sensitive information to version control."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[python-repos]\nindexes.add = ["http://%(env.INDEX_USERNAME)s:%(INDEX_PASSWORD)s@my.custom.repo/index"]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Alternatively, you can hardcode the value in a private (not checked-in) ",(0,r.jsx)(n.a,{href:"/2.15/docs/using-pants/key-concepts/options#pantsrc-file",children:".pants.rc file"})," in each user's Pants repo, that sets this config for the user:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title=".pants.rc"',children:'[python-repos]\nindexes.add = ["http://$USERNAME:$PASSWORD@my.custom.repo/index"]\n'})}),"\n",(0,r.jsx)(n.h3,{id:"local-requirements",children:"Local requirements"}),"\n",(0,r.jsx)(n.p,{children:"There are two ways to specify local requirements from the filesystem:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.python.org/dev/peps/pep-0440/#direct-references",children:"PEP 440 direct references"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="3rdparty/python"',children:'python_requirement(\n    name="django",\n    # Use an absolute path to a .whl or sdist file.\n    requirements=["Django @ file:///Users/pantsbuild/prebuilt_wheels/django-3.1.1-py3-none-any.whl"],\n)\n\n# Reminder: we could also put this requirement string in requirements.txt and use the\n# `python_requirements` target generator.\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The option ",(0,r.jsx)(n.code,{children:"[python-repos].find_links"})]}),"\n"]}),"\n",(0,r.jsx)(i.A,{groupId:"code-examples",children:(0,r.jsx)(l.A,{value:"pants.toml",label:"pants.toml",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[python-repos]\n# Use an absolute path to a directory containing `.whl` and/or sdist files.\nfind_links = ["file:///Users/pantsbuild/prebuilt_wheels"]\n'})})})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"\u276F ls /Users/pantsbuild/prebuilt_wheels\nansicolors-1.1.8-py2.py3-none-any.whl\ndjango-3.1.1-py3-none-any.whl\n"})}),"\n",(0,r.jsx)(i.A,{groupId:"code-examples",children:(0,r.jsx)(l.A,{value:"3rdparty/build",label:"3rdparty/BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"3rdparty/BUILD"}',children:'# Use normal requirement strings, i.e. without file paths.\npython_requirement(name="ansicolors", requirements=["ansicolors==1.1.8"])\npython_requirement(name="django", requirements=["django>=3.1,<3.2"])\n\n# Reminder: we could also put these requirement strings in requirements.txt and use the\n# `python_requirements` target generator\n'})})})}),"\n",(0,r.jsxs)(n.p,{children:["Unlike PEP 440 direct references, ",(0,r.jsx)(n.code,{children:"[python-repos].find_links"})," allows you to use multiple artifacts for the same project name. For example, you can include multiple ",(0,r.jsx)(n.code,{children:".whl"})," and sdist files for the same project in the directory; if ",(0,r.jsx)(n.code,{children:"[python-repos].indexes"})," is still set, then Pex/pip may use artifacts both from indexes like PyPI and from your local ",(0,r.jsx)(n.code,{children:"--find-links"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Both approaches require using absolute paths, and the files must exist on your machine. This is usually fine when locally iterating and debugging. This approach also works well if your entire team can use the same fixed location. Otherwise, see the below section."}),"\n",(0,r.jsx)(n.h4,{id:"working-around-absolute-paths",children:"Working around absolute paths"}),"\n",(0,r.jsxs)(n.p,{children:["If you need to share the lockfile on different machines, and you cannot use the same absolute path, then you can use the option ",(0,r.jsx)(n.code,{children:"[python-repos].path_mappings"})," along with ",(0,r.jsx)(n.code,{children:"[python-repos].find_links"}),". (",(0,r.jsx)(n.code,{children:"path_mappings"})," is not intended for PEP 440 direct requirements.)"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"path_mappings"})," option allows you to substitute a portion of the absolute path with a logical name, which can be set to a different value than your teammates. For example, the path\n",(0,r.jsx)(n.code,{children:"file:///Users/pantsbuild/prebuilt_wheels/django-3.1.1-py3-none-any.whl"})," could become ",(0,r.jsx)(n.code,{children:"file://${WHEELS_DIR}/django-3.1.1-py3-none-any.whl"}),", where each Pants user defines what ",(0,r.jsx)(n.code,{children:"WHEELS_DIR"})," should be on their machine."]}),"\n",(0,r.jsxs)(n.p,{children:["This feature only works when using Pex lockfiles via ",(0,r.jsx)(n.code,{children:"[python].resolves"})," and for tool lockfiles like Pytest and Black."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[python-repos].path_mappings"})," expects values in the form ",(0,r.jsx)(n.code,{children:"NAME|PATH"}),", e.g. ",(0,r.jsx)(n.code,{children:"WHEELS_DIR|/Users/pantsbuild/prebuilt_wheels"}),". Also, still use an absolute path for ",(0,r.jsx)(n.code,{children:"[python-repos].find_links"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["If possible, we recommend using a common file location for your whole team, and leveraging ",(0,r.jsx)(n.a,{href:"/2.15/docs/using-pants/key-concepts/options#config-file-interpolation",children:"Pants's interpolation"}),", so that you avoid each user needing to manually configure ",(0,r.jsx)(n.code,{children:"[python-repos].path_mappings"})," and ",(0,r.jsx)(n.code,{children:"[python-repos].find_links"}),". For example, in ",(0,r.jsx)(n.code,{children:"pants.toml"}),", you could set ",(0,r.jsx)(n.code,{children:"[python-repos].path_mappings"})," to ",(0,r.jsx)(n.code,{children:"WHEELS_DIR|%(buildroot)s/python_wheels"})," and ",(0,r.jsx)(n.code,{children:"[python-repos].find_links"})," to ",(0,r.jsx)(n.code,{children:"%(buildroot)s/python_wheels"}),". Then, as long as every user has the folder ",(0,r.jsx)(n.code,{children:"python_wheels"})," in the root of the repository, things will work without additional configuration. Or, you could use a value like ",(0,r.jsx)(n.code,{children:"%(env.HOME)s/pants_wheels"})," for the path ",(0,r.jsx)(n.code,{children:"~/pants_wheels"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[python-repos]\n# No one needs to change these values, as long as they can use the same shared location.\nfind_links = ["file://%(buildroot)s/prebuilt_wheels"]\npath_mappings = ["WHEELS_DIR|%(buildroot)s/prebuilt_wheels"]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["If you cannot use a common file location via interpolation, then we recommend setting these options in a ",(0,r.jsxs)(n.a,{href:"/2.15/docs/using-pants/key-concepts/options#pantsrc-file",children:[(0,r.jsx)(n.code,{children:".pants.rc"})," file"]}),". Every teammate will need to set this up for their machine."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title=".pants.rc"',children:'[python-repos]\n# Each user must set both of these to the absolute paths on their machines.\nfind_links = ["file:///Users/pantsbuild/prebuilt_wheels"]\npath_mappings = ["WHEELS_DIR|/Users/pantsbuild/prebuilt_wheels"]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["After initially setting up ",(0,r.jsx)(n.code,{children:"[python-repos].path_mappings"})," and ",(0,r.jsx)(n.code,{children:"[python-repos].find_links"}),", run ",(0,r.jsx)(n.code,{children:"pants generate-lockfiles"})," or ",(0,r.jsx)(n.code,{children:"pants generate-lockfiles --resolve=<resolve-name>"}),". You should see the ",(0,r.jsx)(n.code,{children:"path_mappings"})," key set in the lockfile's JSON."]}),"\n",(0,r.jsx)(n.h3,{id:"constraints-files",children:"Constraints files"}),"\n",(0,r.jsxs)(n.p,{children:["Sometimes, transitive dependencies of one of your third-party requirements can cause trouble. For example, sometimes requirements do not pin their dependencies well enough, and a newer version of its transitive dependency is released that breaks the requirement.\n",(0,r.jsx)(n.a,{href:"https://pip.pypa.io/en/stable/user_guide/?highlight=constraints#constraints-files",children:"Constraints files"})," allow you to pin transitive dependencies to certain versions, overriding the version that pip/Pex would normally choose."]}),"\n",(0,r.jsxs)(n.p,{children:["Constraints files are configured per-resolve, meaning that the resolves for your user code from ",(0,r.jsx)(n.code,{children:"[python].resolves"})," and each Python tool, such as Black and Pytest, can have different configuration. Use the option ",(0,r.jsx)(n.code,{children:"[python].resolves_to_constraints_file"})," to map resolve names to paths to pip-compatible constraints files. For example:"]}),"\n",(0,r.jsxs)(i.A,{groupId:"code-examples",children:[(0,r.jsx)(l.A,{value:"pants.toml",label:"pants.toml",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[python.resolves_to_constraints_file]\ndata-science = "3rdparty/python/data_science_constraints.txt"\npytest = "3rdparty/python/pytest_constraints.txt"\n'})})}),(0,r.jsx)(l.A,{value:"3rdparty/python/data_science_constraints.txt",label:"3rdparty/python/data_science_constraints.txt",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'tab={"label":"3rdparty/python/data_science_constraints.txt"}',children:"requests==22.1.0\nurrllib3==4.2\n"})})})]}),"\n",(0,r.jsxs)(n.p,{children:["You can also set the key ",(0,r.jsx)(n.code,{children:"__default__"})," to apply the same constraints file to every resolve by default, although this is not always useful because resolves often need different constraints."]}),"\n",(0,r.jsxs)(n.h3,{id:"only_binary-and-no_binary",children:[(0,r.jsx)(n.code,{children:"only_binary"})," and ",(0,r.jsx)(n.code,{children:"no_binary"})]}),"\n",(0,r.jsxs)(n.p,{children:["You can use ",(0,r.jsx)(n.code,{children:"[python].resolves_to_only_binary"})," to avoid using sdists (source distributions) for certain requirements, and ",(0,r.jsx)(n.code,{children:"[python].resolve_to_no_binary"})," to avoid using bdists (wheel files) for certain requirements."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"only_binary"})," and ",(0,r.jsx)(n.code,{children:"no_binary"})," are configured per-resolve, meaning that the resolves for your user code from ",(0,r.jsx)(n.code,{children:"[python].resolves"})," and each Python tool, such as Black and Pytest, can have different configuration. Use the options ",(0,r.jsx)(n.code,{children:"[python].resolves_to_only_binary"})," and ",(0,r.jsx)(n.code,{children:"[python].resolves_to_no_binary"})," to map resolve names to list of Python requirement names."]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[python.resolves_to_only_binary]\ndata-science = ["numpy"]\n\n[python.resolves_to_no_binary]\npytest = ["pytest-xdist"]\nmypy_extra_type_stubs = ["django-stubs"]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["You can also set the key ",(0,r.jsx)(n.code,{children:"__default__"})," to apply the same value to every resolve by default."]}),"\n",(0,r.jsxs)(n.h2,{id:"tip-use-pants-export-to-create-a-virtual-environment-for-ides",children:["Tip: use ",(0,r.jsx)(n.code,{children:"pants export"})," to create a virtual environment for IDEs"]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/2.15/docs/using-pants/setting-up-an-ide",children:"Setting up an IDE"})," for more information on ",(0,r.jsx)(n.code,{children:"pants export"}),". This will create a virtual environment for your user code for compatibility with the rest of the Python ecosystem, e.g. IDEs like Pycharm."]})]})}function u(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},753348(e,n,t){t.d(n,{A:()=>s});let s={tabItem:"tabItem_mHvh"}},618264(e,n,t){t.d(n,{A:()=>s});let s={tabList:"tabList_sFbf",tabItem:"tabItem_UVfV"}},637180(e,n,t){t.d(n,{A:()=>i});var s=t(886070);t(830758);var r=t(313526),o=t(753348);function i({children:e,hidden:n,className:t}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(o.A.tabItem,t),hidden:n,children:e})}},685008(e,n,t){t.d(n,{A:()=>m});var s=t(886070),r=t(830758),o=t(313526),i=t(911212),l=t(274875),a=t(106632),d=t(189223),c=t(618264);function h({className:e,block:n,selectedValue:t,selectValue:r,tabValues:i}){let a=[],{blockElementScrollPositionUntilNextRender:d}=(0,l.a_)(),h=e=>{let n=e.currentTarget,s=i[a.indexOf(n)].value;s!==t&&(d(n),r(s))},p=e=>{let n=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{let t=a.indexOf(e.currentTarget)+1;n=a[t]??a[0];break}case"ArrowLeft":{let t=a.indexOf(e.currentTarget)-1;n=a[t]??a[a.length-1]}}n?.focus()};return(0,s.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":n},e),children:i.map(({value:e,label:n,attributes:r})=>(0,s.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{a.push(e)},onKeyDown:p,onClick:h,...r,className:(0,o.A)("tabs__item",c.A.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function p({lazy:e,children:n,selectedValue:t}){let i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){let e=i.find(e=>e.props.value===t);return e?(0,r.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,s.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function u(e){let n=(0,a.u)(e);return(0,s.jsxs)("div",{className:(0,o.A)(i.G.tabs.container,"tabs-container",c.A.tabList),children:[(0,s.jsx)(h,{...n,...e}),(0,s.jsx)(p,{...n,...e})]})}function m(e){let n=(0,d.A)();return(0,s.jsx)(u,{...e,children:(0,a.v)(e.children)},String(n))}},106632(e,n,t){t.d(n,{u:()=>h,v:()=>d});var s=t(830758),r=t(325557),o=t(363717),i=t(125740),l=t(574229),a=t(270367);function d(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function c({value:e,tabValues:n}){return n.some(n=>n.value===e)}function h(e){let n,{defaultValue:t,queryString:h=!1,groupId:p}=e,u=function(e){let{values:n,children:t}=e;return(0,s.useMemo)(()=>{let e=n??d(t).map(({props:{value:e,label:n,attributes:t,default:s}})=>({value:e,label:n,attributes:t,default:s})),s=(0,l.XI)(e,(e,n)=>e.value===n.value);if(s.length>0)throw Error(`Docusaurus error: Duplicate values "${s.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[n,t])}(e),[m,y]=(0,s.useState)(()=>(function({defaultValue:e,tabValues:n}){if(0===n.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!c({value:e,tabValues:n}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let t=n.find(e=>e.default)??n[0];if(!t)throw Error("Unexpected error: 0 tabValues");return t.value})({defaultValue:t,tabValues:u})),[f,x]=function({queryString:e=!1,groupId:n}){let t=(0,r.W6)(),o=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,i.aZ)(o),(0,s.useCallback)(e=>{if(!o)return;let n=new URLSearchParams(t.location.search);n.set(o,e),t.replace({...t.location,search:n.toString()})},[o,t])]}({queryString:h,groupId:p}),[j,g]=function({groupId:e}){let n=e?`docusaurus.tab.${e}`:null,[t,r]=(0,a.Dv)(n);return[t,(0,s.useCallback)(e=>{n&&r.set(e)},[n,r])]}({groupId:p}),v=c({value:n=f??j,tabValues:u})?n:null;return(0,o.A)(()=>{v&&y(v)},[v]),{selectedValue:m,selectValue:(0,s.useCallback)(e=>{if(!c({value:e,tabValues:u}))throw Error(`Can't select invalid tab value=${e}`);y(e),x(e),g(e)},[x,g,u]),tabValues:u}}},848193(e,n,t){t.d(n,{R:()=>i,x:()=>l});var s=t(830758);let r={},o=s.createContext(r);function i(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:n},e.children)}},318582(e){e.exports=JSON.parse('{"id":"docs/python/overview/third-party-dependencies","title":"Third-party dependencies","description":"How to use third-party Python libraries in your project.","source":"@site/versioned_docs/version-2.15/docs/python/overview/third-party-dependencies.mdx","sourceDirName":"docs/python/overview","slug":"/docs/python/overview/third-party-dependencies","permalink":"/2.15/docs/python/overview/third-party-dependencies","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/python/overview/third-party-dependencies.mdx","tags":[],"version":"2.15","sidebarPosition":1,"frontMatter":{"title":"Third-party dependencies","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Enabling Python support","permalink":"/2.15/docs/python/overview/enabling-python-support"},"next":{"title":"Interpreter compatibility","permalink":"/2.15/docs/python/overview/interpreter-compatibility"}}')}}]);