"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["668857"],{679359(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>u});var r=n(303903),s=n(886070),o=n(848193),i=n(685008),a=n(637180);let l={title:"Create a new goal",sidebar_position:1},c,d={},u=[{value:"Registering a plugin",id:"registering-a-plugin",level:3},{value:"Creating a new target",id:"creating-a-new-target",level:3},{value:"Creating a goal",id:"creating-a-goal",level:3},{value:"Writing a rule",id:"writing-a-rule",level:3},{value:"Reading the <code>VERSION</code> file",id:"reading-the-version-file",level:3},{value:"Putting it all together",id:"putting-it-all-together",level:3}];function h(e){let t={a:"a",admonition:"admonition",code:"code",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"Getting started writing plugins for Pants by creating a new goal."}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.p,{children:["In this tutorial, you'll learn the basics needed to get started writing a plugin. You will create a new goal, ",(0,s.jsx)(t.code,{children:"project-version"}),", which will tell you the version (retrieved from the ",(0,s.jsx)(t.code,{children:"VERSION"})," text file) of a particular project in your monorepository. You will learn how to create a new custom target to refer to the ",(0,s.jsx)(t.code,{children:"VERSION"})," file, how to author a new goal, and, most importantly, how to connect rules and targets."]}),"\n",(0,s.jsxs)(t.p,{children:["You can follow along this tutorial in your own repository; you only need to be on a recent version of Pants and have a ",(0,s.jsx)(t.code,{children:"VERSION"})," file containing a version string e.g. ",(0,s.jsx)(t.code,{children:"1.2.3"}),". If you do not have a repository with Pants enabled yet, you can use ",(0,s.jsx)(t.a,{href:"https://github.com/pantsbuild/example-python/",children:"this example Python repository"})," to work on the plugin."]}),"\n",(0,s.jsx)(t.h3,{id:"registering-a-plugin",children:"Registering a plugin"}),"\n",(0,s.jsxs)(t.p,{children:["We'll be writing an ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/overview#in-repo-plugins",children:"in-repo plugin"}),", and expect you to have the ",(0,s.jsx)(t.code,{children:"pants-plugins/project_version"})," directory as well as the ",(0,s.jsx)(t.code,{children:"pants.toml"})," file with this configuration:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'# Specifying the path to our plugin\'s top-level folder using the `pythonpath` option:\npythonpath = ["%(buildroot)s/pants-plugins"]\n\nbackend_packages = [\n  "pants.backend.python",\n   ...\n  "project_version",\n]\n'})}),"\n",(0,s.jsx)(t.h3,{id:"creating-a-new-target",children:"Creating a new target"}),"\n",(0,s.jsxs)(t.p,{children:["Once you have become familiar with the ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-target-api/concepts",children:"core concepts of Targets and Fields"}),", you are ready to ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-target-api/creating-new-targets",children:"create an own custom target"})," that will represent the ",(0,s.jsx)(t.code,{children:"VERSION"})," file:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="pants-plugins/project_version/target_types.py"',children:'from pants.engine.target import COMMON_TARGET_FIELDS, SingleSourceField, Target\n\n\nclass ProjectVersionTarget(Target):\n    alias = "version_file"\n    core_fields = (*COMMON_TARGET_FIELDS, SingleSourceField)\n    help = "A project version target representing the VERSION file."\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Our target has some common target fields such as ",(0,s.jsx)(t.code,{children:"tags"})," and ",(0,s.jsx)(t.code,{children:"description"})," available via the ",(0,s.jsx)(t.code,{children:"COMMON_TARGET_FIELDS"}),"; including those fields in your targets may be convenient if you decide to use tags and provide a description later. In addition, it also has the ",(0,s.jsxs)(t.a,{href:"/2.28/docs/writing-plugins/the-rules-api/rules-and-the-target-api#sourcesfield",children:[(0,s.jsx)(t.code,{children:"source"})," field"]})," which will be used to provide path to the project's ",(0,s.jsx)(t.code,{children:"VERSION"})," file."]}),"\n",(0,s.jsxs)(t.p,{children:["We could ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-target-api/creating-new-fields",children:"add a custom field"})," to provide a file path, however, there are multiple advantages to using the ",(0,s.jsx)(t.code,{children:"source"})," field. You will learn more about them in the following tutorials."]}),"\n",(0,s.jsx)(t.p,{children:"In order to start using a target, you only need to register it:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="pants-plugins/project_version/register.py"',children:"from typing import Iterable\n\nfrom pants.engine.target import Target\nfrom project_version.target_types import ProjectVersionTarget\n\n\ndef target_types() -> Iterable[type[Target]]:\n    return [ProjectVersionTarget]\n"})}),"\n",(0,s.jsxs)(t.p,{children:["You can now run ",(0,s.jsx)(t.code,{children:"pants help version_file"})," to learn more about the target:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"\u276F pants help version_file\n\n`version_file` target\n---------------------\n\nA project version target representing the VERSION file.\n\n\nActivated by project_version\nValid fields:\n\nsource\n    type: str\n    required\n\n    A single file that belongs to this target.\n\n    Path is relative to the BUILD file's directory, e.g. `source='example.ext'`.\n\n...\n"})}),"\n",(0,s.jsxs)(t.p,{children:["You can now also add a target to the ",(0,s.jsx)(t.code,{children:"myapp/BUILD"})," file:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'version_file(\n    name="main-project-version",\n    source="VERSION",\n)\n'})}),"\n",(0,s.jsx)(t.p,{children:'Since you have registered the target, Pants will be able to "understand" it:'}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:'$ pants peek myapp:main-project-version\n[\n  {\n    "address": "myapp:main-project-version",\n    "target_type": "version_file",\n    "dependencies": [],\n    "description": null,\n    "source_raw": "VERSION",\n    "sources": [\n      "myapp/VERSION"\n    ],\n    "tags": null\n  }\n]\n'})}),"\n",(0,s.jsx)(t.h3,{id:"creating-a-goal",children:"Creating a goal"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"/2.28/docs/using-pants/key-concepts/goals",children:"Goals"})," are the commands that Pants runs such as ",(0,s.jsx)(t.code,{children:"fmt"})," or ",(0,s.jsx)(t.code,{children:"lint"}),". Writing a plugin doesn't necessarily mean adding a new goal. Most users would likely only want to enrich their build metadata with new kinds of targets or extend behavior of existing Pants goals. See ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/common-plugin-tasks/",children:"Common plugin tasks"})," to learn more."]}),"\n",(0,s.jsxs)(t.p,{children:["For the purposes of our tutorial, to be able to get a project version number (using a target we've just created), we need to ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-rules-api/goal-rules",children:"create a new goal"}),". The code below is the boilerplate necessary to create a goal, so it's not really necessary to understand how, for instance, subsystems work right now. The function decorated with the ",(0,s.jsx)(t.code,{children:"@goal_rule"})," can be named anything, but it's helpful for the name to represent the functionality your goal provides. To make your goal part of the plugin's interface, add it to the ",(0,s.jsx)(t.code,{children:"rules"})," function in the ",(0,s.jsx)(t.code,{children:"register.py"})," module."]}),"\n",(0,s.jsxs)(i.A,{groupId:"code-examples",children:[(0,s.jsx)(a.A,{value:"pants-plugins/project_version/rules.py",label:"pants-plugins/project_version/rules.py",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"pants-plugins/project_version/rules.py"}',children:'from pants.engine.goal import Goal, GoalSubsystem\nfrom pants.engine.rules import collect_rules, goal_rule\n\n\nclass ProjectVersionSubsystem(GoalSubsystem):\n    name = "project-version"\n    help = "Show representation of the project version from the `VERSION` file."\n\n\nclass ProjectVersionGoal(Goal):\n    subsystem_cls = ProjectVersionSubsystem\n    environment_behavior = Goal.EnvironmentBehavior.LOCAL_ONLY\n\n\n@goal_rule\nasync def goal_show_project_version() -> ProjectVersionGoal:\n    return ProjectVersionGoal(exit_code=0)\n\n\ndef rules():\n    return collect_rules()\n'})})}),(0,s.jsx)(a.A,{value:"pants-plugins/project_version/register.py",label:"pants-plugins/project_version/register.py",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"pants-plugins/project_version/register.py"}',children:"from typing import Iterable\n\nimport project_version.rules as project_version_rules\nfrom pants.engine.target import Target\nfrom project_version.target_types import ProjectVersionTarget\n\n\ndef target_types() -> Iterable[type[Target]]:\n    return [ProjectVersionTarget]\n\n\ndef rules():\n    return [*project_version_rules.rules()]\n"})})})]}),"\n",(0,s.jsxs)(t.p,{children:["You can now run ",(0,s.jsx)(t.code,{children:"pants project-version"})," to confirm the command exits with the exit code ",(0,s.jsx)(t.code,{children:"0"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["At this point, we are ready to do something useful with the new target of ours. Goals generally run on targets, so they need to be passed as an argument in the command line. For instance, to format the ",(0,s.jsx)(t.code,{children:"myproject"})," directory targets, you would run ",(0,s.jsx)(t.code,{children:"pants fmt myproject"}),". To get the version of a project in your repository, it makes sense to pass to the ",(0,s.jsx)(t.code,{children:"project-version"})," goal a project directory containing the ",(0,s.jsx)(t.code,{children:"version_file"})," definition."]}),"\n",(0,s.jsxs)(t.p,{children:["To make a target passed as an argument accessible in the goal rule, we pass the ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-rules-api/goal-rules#how-to-operate-on-targets",children:(0,s.jsx)(t.code,{children:"Targets"})})," as input arguments of the function along with the ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-rules-api/goal-rules#console-output-to-stdoutstderr",children:(0,s.jsx)(t.code,{children:"Console"})})," object so that we can print the details of our target in the user terminal:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"@goal_rule\nasync def goal_show_project_version(console: Console, targets: Targets) -> ProjectVersionGoal:\n    # since we don't know what targets will be passed (e.g. `::`),\n    # we want to keep only `version_file` targets\n    targets = [tgt for tgt in targets if tgt.alias == ProjectVersionTarget.alias]\n    for target in targets:\n        console.print_stdout(target.address.metadata())\n    return ProjectVersionGoal(exit_code=0)\n\n"})}),"\n",(0,s.jsx)(t.p,{children:"Having the following directory structure:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"myapp\n\u251C\u2500\u2500 BUILD\n\u2514\u2500\u2500 VERSION\n"})}),"\n",(0,s.jsx)(t.p,{children:"we are ready to inspect our new target:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"$ pants project-version myapp\n{'address': 'myapp:main-project-version'}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"writing-a-rule",children:"Writing a rule"}),"\n",(0,s.jsxs)(t.p,{children:["You can think of the ",(0,s.jsx)(t.code,{children:"@goal_rule"})," as of the ",(0,s.jsx)(t.code,{children:"main"})," function in your Python program where you would call various functions that your program needs to complete. For auxiliary code, it makes sense to place it into standalone functions which is what ",(0,s.jsx)(t.code,{children:"@rule"}),"s are for."]}),"\n",(0,s.jsxs)(t.p,{children:["Let's create a rule that will return a data structure that we'll use to represent our project version. ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-rules-api/concepts#dataclasses",children:"Data classes"})," work really well with Pants engine, so let's create one:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"@dataclass(frozen=True)\nclass ProjectVersionFileView:\n    path: str\n    version: str\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This is what our ",(0,s.jsx)(t.code,{children:"@rule"})," function would return (for now without actually reading the ",(0,s.jsx)(t.code,{children:"VERSION"})," file):"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'@rule\nasync def get_project_version_file_view(\n    target: ProjectVersionTarget,\n) -> ProjectVersionFileView:\n    return ProjectVersionFileView(\n        path="path", version="1.2.3"\n    )\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Now, we have our ",(0,s.jsx)(t.code,{children:"@goal_rule"}),", but we cannot call the ",(0,s.jsx)(t.code,{children:"get_project_version_file_view"})," function; it's Pants that will determine that a rule is used and will make a function call. Well, what should you do to tell Pants you need that rule executed? You should make a function call that:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"passes an object of the type that matches the type of the rule's input arguments"}),"\n",(0,s.jsx)(t.li,{children:"requests an object of the type that a rule returns (you can see that in a type hint)"}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["For this, you can use ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-rules-api/concepts#await-get---awaiting-results-in-a-rule-body",children:(0,s.jsx)(t.code,{children:"Get"})}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"@goal_rule\nasync def goal_show_project_version(console: Console, targets: Targets) -> ProjectVersionGoal:\n    targets = [tgt for tgt in targets if tgt.alias == ProjectVersionTarget.alias]\n    for target in targets:\n        project_version = await Get(ProjectVersionFileView, ProjectVersionTarget, target)\n        console.print_stdout(project_version)\n    return ProjectVersionGoal(exit_code=0)\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Understanding that calling ",(0,s.jsx)(t.code,{children:"Get()"})," is what causes a particular ",(0,s.jsx)(t.code,{children:"@rule"})," to be executed is essential! It may feel awkward that you cannot run your function. However, by using the ",(0,s.jsx)(t.code,{children:"Get()"}),", you are asking Pants to run your rule, and only knowing this will get you quite far!"]}),"\n",(0,s.jsxs)(t.p,{children:["Compare this ",(0,s.jsx)(t.code,{children:"Get()"})," call with the rule signature:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'# requesting an object of type "ProjectVersionFileView",\n# passing an object of type "ProjectVersionTarget" in the variable "target"\nGet(ProjectVersionFileView, ProjectVersionTarget, target)\n'})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'# it requires an object of type "ProjectVersionTarget" and\n# will return an object of type "ProjectVersionFileView"\n@rule\nasync def get_project_version_file_view(target: ProjectVersionTarget) -> ProjectVersionFileView: ...\n'})}),"\n",(0,s.jsx)(t.admonition,{title:"Understanding the requests and rules signatures",type:"note",children:(0,s.jsxs)(t.p,{children:["In our basic usage, there's a 1:1 match between the ",(0,s.jsx)(t.code,{children:"Get(output: B, input: A, obj)"})," request and the ",(0,s.jsx)(t.code,{children:"@rule(input: A) -> B"})," function signature. This doesn't have to be the case! When you make a request (providing an input type and asking for an output type), Pants looks at all the ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-rules-api/concepts#the-rule-graph",children:"rules in the graph"})," to find a way from the input to the output using all the available rules."]})}),"\n",(0,s.jsxs)(t.p,{children:["Let's consider a following scenario where you have a few ",(0,s.jsx)(t.code,{children:"@rule"}),"s and a ",(0,s.jsx)(t.code,{children:"Get()"})," request:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"@rule\nasync def rule1(A) -> B: ...\n\n@rule\nasync def rule2(B) -> C: ...\n\n@goal_rule\nasync def main(...):\n    result = await Get(C, A, obj)\n"})}),"\n",(0,s.jsxs)(t.p,{children:['With the following suite of rules, Pants will "figure out" that in order to return ',(0,s.jsx)(t.code,{children:"C"}),", it's necessary to call ",(0,s.jsx)(t.code,{children:"rule1"})," first to get ",(0,s.jsx)(t.code,{children:"B"})," and then once there's ",(0,s.jsx)(t.code,{children:"B"}),", call ",(0,s.jsx)(t.code,{children:"rule2"})," to get C. This means you can focus on writing individual rules and leave the hard work of finding out the right order of calls that will need happen to Pants!"]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"project-version"})," Pants goal now shows some useful information -- the target path along with a dummy version. This means our ",(0,s.jsx)(t.code,{children:"@rule"})," was run!"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"$ pants project-version myapp\nProjectVersionFileView(path='myapp:main-project-version', version='1.2.3')\n"})}),"\n",(0,s.jsxs)(t.p,{children:["You would normally expect for a project to have only a single ",(0,s.jsx)(t.code,{children:"version_file"})," target declared, so as an improvement, we could raise an exception if there are multiple targets of this type found within a single project. This is something we'll do in the following tutorials."]}),"\n",(0,s.jsxs)(t.h3,{id:"reading-the-version-file",children:["Reading the ",(0,s.jsx)(t.code,{children:"VERSION"})," file"]}),"\n",(0,s.jsxs)(t.p,{children:["Let's read the ",(0,s.jsx)(t.code,{children:"VERSION"})," file and print the version number in the terminal. The ",(0,s.jsx)(t.code,{children:"source"})," field of our target needs to be ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-rules-api/rules-and-the-target-api#sourcesfield",children:'"hydrated"'}),". ",(0,s.jsx)(t.a,{href:"/2.28/docs/writing-plugins/the-rules-api/file-system",children:"Reading a file"})," is pretty straightforward as well. We use ",(0,s.jsx)(t.code,{children:"Get()"})," to transform our inputs as needed. Knowing what class you need to request may be tricky, so make sure to review the documentation, and ask for help if you are stuck!"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'@rule\nasync def get_project_version_file_view(\n    target: ProjectVersionTarget,\n) -> ProjectVersionFileView:\n    sources = await Get(HydratedSources, HydrateSourcesRequest(target[SourcesField]))\n    digest_contents = await Get(DigestContents, Digest, sources.snapshot.digest)\n    file_content = digest_contents[0]\n    return ProjectVersionFileView(\n        path=file_content.path, version=file_content.content.decode("utf-8").strip()\n    )\n'})}),"\n",(0,s.jsxs)(t.p,{children:["If the ",(0,s.jsx)(t.code,{children:"@goal_rule"})," would receive multiple ",(0,s.jsx)(t.code,{children:"version_file"})," targets (which may happen if user would run the goal for multiple projects or provide a recursive glob pattern such as ",(0,s.jsx)(t.code,{children:"::"}),"), it would be required to iterate over the list of targets. For efficiency, it is generally encouraged to replace the ",(0,s.jsx)(t.code,{children:"Get()"})," calls in the ",(0,s.jsx)(t.code,{children:"for"})," loop with a ",(0,s.jsxs)(t.a,{href:"/2.28/docs/writing-plugins/the-rules-api/tips-and-debugging#tip-use-multiget-for-increased-concurrency",children:[(0,s.jsx)(t.code,{children:"MultiGet()"})," call"]}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"@goal_rule\nasync def goal_show_project_version(console: Console, targets: Targets) -> ProjectVersionGoal:\n    targets = [tgt for tgt in targets if tgt.alias == ProjectVersionTarget.alias]\n    results = await MultiGet(\n        Get(ProjectVersionFileView, ProjectVersionTarget, target) for target in targets\n    )\n    for result in results:\n        console.print_stdout(str(result))\n    return ProjectVersionGoal(exit_code=0)\n"})}),"\n",(0,s.jsx)(t.h3,{id:"putting-it-all-together",children:"Putting it all together"}),"\n",(0,s.jsx)(t.p,{children:"Let's get all of this code in one place and see what happens!"}),"\n",(0,s.jsxs)(i.A,{groupId:"code-examples",children:[(0,s.jsx)(a.A,{value:"pants-plugins/project_version/rules.py",label:"pants-plugins/project_version/rules.py",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"pants-plugins/project_version/rules.py"}',children:'from dataclasses import dataclass\n\nfrom pants.engine.console import Console\nfrom pants.engine.fs import DigestContents\nfrom pants.engine.goal import Goal, GoalSubsystem\nfrom pants.engine.internals.native_engine import Digest\nfrom pants.engine.internals.selectors import Get, MultiGet\nfrom pants.engine.rules import collect_rules, goal_rule, rule\nfrom pants.engine.target import (HydratedSources, HydrateSourcesRequest,\n                                 SourcesField, Targets)\nfrom project_version.target_types import ProjectVersionTarget\n\n\n@dataclass(frozen=True)\nclass ProjectVersionFileView:\n    path: str\n    version: str\n\n\n@rule\nasync def get_project_version_file_view(\n    target: ProjectVersionTarget,\n) -> ProjectVersionFileView:\n    sources = await Get(HydratedSources, HydrateSourcesRequest(target[SourcesField]))\n    digest_contents = await Get(DigestContents, Digest, sources.snapshot.digest)\n    file_content = digest_contents[0]\n    return ProjectVersionFileView(\n        path=file_content.path, version=file_content.content.decode("utf-8").strip()\n    )\n\n\nclass ProjectVersionSubsystem(GoalSubsystem):\n    name = "project-version"\n    help = "Show representation of the project version from the `VERSION` file."\n\n\nclass ProjectVersionGoal(Goal):\n    subsystem_cls = ProjectVersionSubsystem\n    environment_behavior = Goal.EnvironmentBehavior.LOCAL_ONLY\n\n\n@goal_rule\nasync def goal_show_project_version(\n    console: Console, targets: Targets\n) -> ProjectVersionGoal:\n    targets = [tgt for tgt in targets if tgt.alias == ProjectVersionTarget.alias]\n    results = await MultiGet(\n        Get(ProjectVersionFileView, ProjectVersionTarget, target) for target in targets\n    )\n    for result in results:\n        console.print_stdout(str(result))\n    return ProjectVersionGoal(exit_code=0)\n\n\ndef rules():\n    return collect_rules()\n'})})}),(0,s.jsx)(a.A,{value:"pants-plugins/project_version/target_types.py",label:"pants-plugins/project_version/target_types.py",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"pants-plugins/project_version/target_types.py"}',children:'from pants.engine.target import COMMON_TARGET_FIELDS, SingleSourceField, Target\n\n\nclass ProjectVersionTarget(Target):\n    alias = "version_file"\n    core_fields = (*COMMON_TARGET_FIELDS, SingleSourceField)\n    help = "A project version target representing the VERSION file."\n'})})}),(0,s.jsx)(a.A,{value:"pants-plugins/project_version/register.py",label:"pants-plugins/project_version/register.py",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"pants-plugins/project_version/register.py"}',children:"from typing import Iterable\n\nimport project_version.rules as project_version_rules\nfrom pants.engine.target import Target\nfrom project_version.target_types import ProjectVersionTarget\n\n\ndef target_types() -> Iterable[type[Target]]:\n    return [ProjectVersionTarget]\n\n\ndef rules():\n    return [*project_version_rules.rules()]\n"})})})]}),"\n",(0,s.jsx)(t.p,{children:"Running our goal:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"$ pants project-version myapp\nProjectVersionFileView(path='myapp/VERSION', version='0.0.1')\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"VERSION"})," file was read and its contents is shown in the console. Congratulations, you have now finished writing your first plugin!"]}),"\n",(0,s.jsxs)(t.p,{children:["There are a few things that we could do to improve it, though. We may want to check that the version string follows a semver convention, let user see the version in the console as a JSON object if desired, or show the version number string when exploring the ",(0,s.jsx)(t.code,{children:"version_file"})," target via the ",(0,s.jsx)(t.code,{children:"peek"})," Pants goal. This is something we'll do in the following tutorials!"]})]})}function p(e={}){let{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},753348(e,t,n){n.d(t,{A:()=>r});let r={tabItem:"tabItem_mHvh"}},618264(e,t,n){n.d(t,{A:()=>r});let r={tabList:"tabList_sFbf",tabItem:"tabItem_UVfV"}},637180(e,t,n){n.d(t,{A:()=>i});var r=n(886070);n(830758);var s=n(313526),o=n(753348);function i({children:e,hidden:t,className:n}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,s.A)(o.A.tabItem,n),hidden:t,children:e})}},685008(e,t,n){n.d(t,{A:()=>g});var r=n(886070),s=n(830758),o=n(313526),i=n(911212),a=n(274875),l=n(106632),c=n(189223),d=n(618264);function u({className:e,block:t,selectedValue:n,selectValue:s,tabValues:i}){let l=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),u=e=>{let t=e.currentTarget,r=i[l.indexOf(t)].value;r!==n&&(c(t),s(r))},h=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{let n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{let n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1]}}t?.focus()};return(0,r.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":t},e),children:i.map(({value:e,label:t,attributes:s})=>(0,r.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{l.push(e)},onKeyDown:h,onClick:u,...s,className:(0,o.A)("tabs__item",d.A.tabItem,s?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function h({lazy:e,children:t,selectedValue:n}){let i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){let e=i.find(e=>e.props.value===n);return e?(0,s.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,r.jsx)("div",{className:"margin-top--md",children:i.map((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function p(e){let t=(0,l.u)(e);return(0,r.jsxs)("div",{className:(0,o.A)(i.G.tabs.container,"tabs-container",d.A.tabList),children:[(0,r.jsx)(u,{...t,...e}),(0,r.jsx)(h,{...t,...e})]})}function g(e){let t=(0,c.A)();return(0,r.jsx)(p,{...e,children:(0,l.v)(e.children)},String(t))}},106632(e,t,n){n.d(t,{u:()=>u,v:()=>c});var r=n(830758),s=n(325557),o=n(363717),i=n(125740),a=n(574229),l=n(270367);function c(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function d({value:e,tabValues:t}){return t.some(t=>t.value===e)}function u(e){let t,{defaultValue:n,queryString:u=!1,groupId:h}=e,p=function(e){let{values:t,children:n}=e;return(0,r.useMemo)(()=>{let e=t??c(n).map(({props:{value:e,label:t,attributes:n,default:r}})=>({value:e,label:t,attributes:n,default:r})),r=(0,a.XI)(e,(e,t)=>e.value===t.value);if(r.length>0)throw Error(`Docusaurus error: Duplicate values "${r.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[t,n])}(e),[g,j]=(0,r.useState)(()=>(function({defaultValue:e,tabValues:t}){if(0===t.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!d({value:e,tabValues:t}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let n=t.find(e=>e.default)??t[0];if(!n)throw Error("Unexpected error: 0 tabValues");return n.value})({defaultValue:n,tabValues:p})),[f,m]=function({queryString:e=!1,groupId:t}){let n=(0,s.W6)(),o=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,i.aZ)(o),(0,r.useCallback)(e=>{if(!o)return;let t=new URLSearchParams(n.location.search);t.set(o,e),n.replace({...n.location,search:t.toString()})},[o,n])]}({queryString:u,groupId:h}),[x,y]=function({groupId:e}){let t=e?`docusaurus.tab.${e}`:null,[n,s]=(0,l.Dv)(t);return[n,(0,r.useCallback)(e=>{t&&s.set(e)},[t,s])]}({groupId:h}),w=d({value:t=f??x,tabValues:p})?t:null;return(0,o.A)(()=>{w&&j(w)},[w]),{selectedValue:g,selectValue:(0,r.useCallback)(e=>{if(!d({value:e,tabValues:p}))throw Error(`Can't select invalid tab value=${e}`);j(e),m(e),y(e)},[m,y,p]),tabValues:p}}},848193(e,t,n){n.d(t,{R:()=>i,x:()=>a});var r=n(830758);let s={},o=r.createContext(s);function i(e){let t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:t},e.children)}},303903(e){e.exports=JSON.parse('{"id":"docs/tutorials/create-a-new-goal","title":"Create a new goal","description":"Getting started writing plugins for Pants by creating a new goal.","source":"@site/versioned_docs/version-2.28/docs/tutorials/create-a-new-goal.mdx","sourceDirName":"docs/tutorials","slug":"/docs/tutorials/create-a-new-goal","permalink":"/2.28/docs/tutorials/create-a-new-goal","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/tutorials/create-a-new-goal.mdx","tags":[],"version":"2.28","sidebarPosition":1,"frontMatter":{"title":"Create a new goal","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Testing plugins","permalink":"/2.28/docs/tutorials/testing-plugins"},"next":{"title":"Advanced plugin concepts","permalink":"/2.28/docs/tutorials/advanced-plugin-concepts"}}')}}]);