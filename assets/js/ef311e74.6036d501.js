"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["992882"],{285303(e,s,n){n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>d});var t=n(924351),i=n(886070),o=n(848193);let r={title:"Common subsystem tasks",sidebar_position:999},l,a={},d=[{value:"Skipping individual targets",id:"skipping-individual-targets",level:2},{value:"Making subsystems exportable with their default lockfile",id:"making-subsystems-exportable-with-their-default-lockfile",level:2}];function c(e){let s={admonition:"admonition",code:"code",h2:"h2",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.p,{children:"Common tasks for Subsystems"}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"skipping-individual-targets",children:"Skipping individual targets"}),"\n",(0,i.jsxs)(s.p,{children:["Many subsystems allow skipping specific targets. For example, you might have Python files that you want to not typecheck with mypy. In Pants, this is achieved with a ",(0,i.jsx)(s.code,{children:"skip_*"})," field on the target. This is simple to implement."]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Create a field for skipping your tool"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from pants.engine.target import BoolField\n\nclass SkipFortranLintField(BoolField):\n	alias = "skip_fortran_lint"\n	default = False\n	help = "If true, don\'t run fortran-lint on this target\'s code."\n'})}),"\n",(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsx)(s.li,{children:"Register this field on the appropriate targets."}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"def rules():\n	return [\n		FortranSourceTarget.register_plugin_field(SkipFortranLintField),\n	]\n"})}),"\n",(0,i.jsxs)(s.ol,{start:"3",children:["\n",(0,i.jsxs)(s.li,{children:["Add this field as part of your subsystems ",(0,i.jsx)(s.code,{children:"opt_out"})," method:"]}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"from dataclasses import dataclass\n\nfrom pants.engine.target import FieldSet, Target\n\n\n@dataclass\nclass FortranLintFieldSet(FieldSet):\n    required_fields = (FortranSourceField,)\n\n    source: FortranSourceField\n\n    @classmethod\n    def opt_out(cls, tgt: Target) -> bool:\n        return tgt.get(SkipFortranLintField).value\n"})}),"\n",(0,i.jsx)(s.h2,{id:"making-subsystems-exportable-with-their-default-lockfile",children:"Making subsystems exportable with their default lockfile"}),"\n",(0,i.jsx)(s.admonition,{title:"Support depends on language backend of the subsystem",type:"note",children:(0,i.jsxs)(s.p,{children:["Only some language backends support ",(0,i.jsx)(s.code,{children:"pants export"}),". These include the Python and JVM backends. Only tools which are themselves written to use a backend with this feature can be exported. For example, a Python-based tool which operates on a different language is exportable."]})}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Make the subsystem a subclass of ",(0,i.jsx)(s.code,{children:"ExportableTool"})]}),"\n",(0,i.jsx)(s.admonition,{title:"Language backends may have done this in their Tool base class.",type:"note",children:(0,i.jsxs)(s.p,{children:["For example, the Python backend with ",(0,i.jsx)(s.code,{children:"PythonToolRequirementsBase"})," and JVM with ",(0,i.jsx)(s.code,{children:"JvmToolBase"})," are already subclasses."]})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"from pants.backend.python.subsystems.python_tool_base import PythonToolBase\nfrom pants.core.goals.resolves import ExportableTool\n\nclass FortranLint(PythonToolBase, ExportableTool):\n    ...\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Register your class with a ",(0,i.jsx)(s.code,{children:"UnionRule"})," with ",(0,i.jsx)(s.code,{children:"ExportableTool"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"def rules():\n    return [\n        UnionRule(ExportableTool, FortranLint)\n    ]\n"})}),"\n"]}),"\n"]})]})}function p(e={}){let{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},848193(e,s,n){n.d(s,{R:()=>r,x:()=>l});var t=n(830758);let i={},o=t.createContext(i);function r(e){let s=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:s},e.children)}},924351(e){e.exports=JSON.parse('{"id":"docs/writing-plugins/common-subsystem-tasks","title":"Common subsystem tasks","description":"Common tasks for Subsystems","source":"@site/versioned_docs/version-2.21/docs/writing-plugins/common-subsystem-tasks.mdx","sourceDirName":"docs/writing-plugins","slug":"/docs/writing-plugins/common-subsystem-tasks","permalink":"/2.21/docs/writing-plugins/common-subsystem-tasks","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/writing-plugins/common-subsystem-tasks.mdx","tags":[],"version":"2.21","sidebarPosition":999,"frontMatter":{"title":"Common subsystem tasks","sidebar_position":999},"sidebar":"docsSidebar","previous":{"title":"Plugin upgrade guide","permalink":"/2.21/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide"},"next":{"title":"Deprecation policy","permalink":"/2.21/docs/releases/deprecation-policy"}}')}}]);