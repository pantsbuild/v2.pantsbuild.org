"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["850974"],{948555(e,s,t){t.r(s),t.d(s,{assets:()=>h,contentTitle:()=>o,default:()=>p,frontMatter:()=>c,metadata:()=>n,toc:()=>d});var n=t(834098),l=t(886070),r=t(848193),i=t(685008),a=t(637180);let c={title:"Shell overview",sidebar_position:0},o,h={},d=[{value:"Initial setup: add <code>shell_sources</code> targets",id:"initial-setup-add-shell_sources-targets",level:2},{value:"shfmt autoformatter",id:"shfmt-autoformatter",level:2},{value:"Shellcheck linter",id:"shellcheck-linter",level:2},{value:"shUnit2 test runner",id:"shunit2-test-runner",level:2},{value:"Controlling output",id:"controlling-output",level:3},{value:"Force reruns with <code>--force</code>",id:"force-reruns-with---force",level:3},{value:"Setting environment variables",id:"setting-environment-variables",level:3},{value:"Timeouts",id:"timeouts",level:3},{value:"Retries",id:"retries",level:3},{value:"Testing your packaging pipeline",id:"testing-your-packaging-pipeline",level:3}];function u(e){let s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.p,{children:"Pants's support for Shellcheck, shfmt, and shUnit2."}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.p,{children:"Pants integrates with these tools to empower you to follow best practices with your Shell scripts:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"https://www.shellcheck.net",children:"Shellcheck"}),": lint for common Shell mistakes."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"https://github.com/mvdan/sh",children:"shfmt"}),": autoformat Shell code so that you can instead focus on the logic."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"https://github.com/kward/shunit2/",children:"shUnit2"}),": write light-weight unit tests for your Shell code."]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Pants installs these tools deterministically and integrates them into the workflows you already use: ",(0,l.jsx)(s.code,{children:"pants fmt"}),", ",(0,l.jsx)(s.code,{children:"pants lint"}),", and ",(0,l.jsx)(s.code,{children:"pants test"}),"."]}),"\n",(0,l.jsxs)(s.h2,{id:"initial-setup-add-shell_sources-targets",children:["Initial setup: add ",(0,l.jsx)(s.code,{children:"shell_sources"})," targets"]}),"\n",(0,l.jsxs)(s.p,{children:["Pants uses ",(0,l.jsx)(s.a,{href:"/dev/reference/targets/shell_source",children:(0,l.jsx)(s.code,{children:"shell_source"})})," and ",(0,l.jsx)(s.a,{href:"/dev/reference/targets/shunit2_test",children:(0,l.jsx)(s.code,{children:"shunit2_test"})})," ",(0,l.jsx)(s.a,{href:"/dev/docs/using-pants/key-concepts/targets-and-build-files",children:"targets"})," to know which Shell files you want to operate on and to set any metadata."]}),"\n",(0,l.jsxs)(s.p,{children:["To reduce boilerplate, the ",(0,l.jsx)(s.a,{href:"/dev/reference/targets/shell_sources",children:(0,l.jsx)(s.code,{children:"shell_sources"})})," target generates a ",(0,l.jsx)(s.code,{children:"shell_source"})," target for each file in its ",(0,l.jsx)(s.code,{children:"sources"})," field, and ",(0,l.jsx)(s.a,{href:"/dev/reference/targets/shunit2_tests",children:(0,l.jsx)(s.code,{children:"shunit2_tests"})})," generates a ",(0,l.jsx)(s.code,{children:"shunit2_test"})," target for each file in its ",(0,l.jsx)(s.code,{children:"sources"})," field."]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",metastring:'title="BUILD"',children:'shell_sources(name="lib", sources=["deploy.sh", "changelog.sh"])\nshell_tests(name="tests", sources=["changelog_test.sh"])\n\n# Spiritually equivalent to:\nshell_source(name="deploy", source="deploy.sh")\nshell_source(name="changelog", source="changelog.sh")\nshell_test(name="changelog_test", source="changelog_test.sh")\n\n# Thanks to the default `sources` values, spiritually equivalent to:\nshell_sources(name="lib")\nshell_tests(name="tests")\n'})}),"\n",(0,l.jsxs)(s.p,{children:["First, activate the Shell backend in your ",(0,l.jsx)(s.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = [\n  "pants.backend.shell",\n]\n'})}),"\n",(0,l.jsxs)(s.p,{children:["Then, run ",(0,l.jsx)(s.a,{href:"/dev/docs/getting-started/initial-configuration#5-generate-build-files",children:(0,l.jsx)(s.code,{children:"pants tailor ::"})})," to generate BUILD files:"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{children:"$ pants tailor ::\nCreated scripts/BUILD:\n  - Add shell_sources target scripts\nCreated scripts/subdir/BUILD:\n  - Add shell_sources target subdir\n"})}),"\n",(0,l.jsxs)(s.p,{children:["You can also manually add targets, which is necessary if you have any scripts that don't end in ",(0,l.jsx)(s.code,{children:".sh"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:'shell_source(name="script_without_a_extension", source="script_without_an_extension")\n'})}),"\n",(0,l.jsxs)(s.admonition,{title:"Shell dependency inference",type:"note",children:[(0,l.jsxs)(s.p,{children:["Pants will infer dependencies by looking for imports like ",(0,l.jsx)(s.code,{children:"source script.sh"})," and ",(0,l.jsx)(s.code,{children:". script.sh"}),". You can check that the correct dependencies are inferred by running ",(0,l.jsx)(s.code,{children:"pants dependencies path/to/script.sh"})," and ",(0,l.jsx)(s.code,{children:"pants dependencies --transitive path/to/script.sh"}),"."]}),(0,l.jsx)(s.p,{children:"Normally, Pants will not understand dynamic sources, e.g. using variable expansion. However, Pants uses Shellcheck for parsing, so you can use Shellcheck's syntax to give a hint to Pants:"}),(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-shell",children:'another_script="dir/some_script.sh"\n\n# Normally Pants couldn\'t infer this, but we can give a hint like this:\n# shellcheck source=dir/some_script.sh\nsource "${another_script}"\n'})}),(0,l.jsxs)(s.p,{children:["Alternatively, you can explicitly add ",(0,l.jsx)(s.code,{children:"dependencies"})," in the relevant BUILD file."]}),(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:'shell_sources(dependencies=["path/to:shell_source_tgt"])\n'})})]}),"\n",(0,l.jsx)(s.h2,{id:"shfmt-autoformatter",children:"shfmt autoformatter"}),"\n",(0,l.jsxs)(s.p,{children:["To activate, add this to your ",(0,l.jsx)(s.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = [\n  "pants.backend.shell",\n  "pants.backend.shell.lint.shfmt",\n]\n'})}),"\n",(0,l.jsxs)(s.p,{children:["Make sure that you also have set up ",(0,l.jsx)(s.code,{children:"shell_source"}),"/",(0,l.jsx)(s.code,{children:"shell_sources"})," or ",(0,l.jsx)(s.code,{children:"shunit2_test"}),"/",(0,l.jsx)(s.code,{children:"shunit2_tests"})," targets so that Pants knows to operate on the relevant files."]}),"\n",(0,l.jsxs)(s.p,{children:["Now you can run ",(0,l.jsx)(s.code,{children:"pants fmt"})," and ",(0,l.jsx)(s.code,{children:"pants lint"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{children:'$ pants lint scripts/my_script.sh\n13:05:56.34 [WARN] Completed: lint - shfmt failed (exit code 1).\n--- scripts/my_script.sh.orig\n+++ scripts/my_script.sh\n@@ -9,7 +9,7 @@\n\n set -eo pipefail\n\n-HERE=$(cd "$(dirname "${BASH_SOURCE[0]}")" && \\\n+HERE=$(cd "$(dirname "${BASH_SOURCE[0]}")" &&\n   pwd)\n\n\u{10102} shfmt failed.\n'})}),"\n",(0,l.jsxs)(s.p,{children:["Use ",(0,l.jsx)(s.code,{children:"pants fmt lint dir:"})," to run on all files in the directory, and ",(0,l.jsx)(s.code,{children:"pants fmt lint dir::"})," to run on all files in the directory and subdirectories."]}),"\n",(0,l.jsxs)(s.p,{children:["Pants will automatically include any relevant ",(0,l.jsx)(s.code,{children:".editorconfig"})," files in the run. You can also pass command line arguments with ",(0,l.jsx)(s.code,{children:"--shfmt-args='-ci -sr'"})," or permanently set them in ",(0,l.jsx)(s.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-toml",children:'[shfmt]\nargs = ["-i 2", "-ci", "-sr"]\n'})}),"\n",(0,l.jsxs)(s.p,{children:["Temporarily disable shfmt with ",(0,l.jsx)(s.code,{children:"--shfmt-skip"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"pants --shfmt-skip fmt ::\n"})}),"\n",(0,l.jsxs)(s.p,{children:["Only run shfmt with ",(0,l.jsx)(s.code,{children:"--lint-only"})," and ",(0,l.jsx)(s.code,{children:"--fmt-only"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"pants fmt --only=shfmt ::\n"})}),"\n",(0,l.jsxs)(s.admonition,{title:"Benefit of Pants: shfmt runs in parallel with Python, Java, Scala, and Go formatters",type:"tip",children:[(0,l.jsxs)(s.p,{children:["Normally, Pants runs formatters sequentially so that it can pipe the results of one formatter into the next. However, Pants will run shfmt in parallel to formatters for other languages, ",(0,l.jsx)(s.a,{href:"/dev/docs/python/overview/linters-and-formatters",children:"like Python"}),", because shfmt does not operate on those languages."]}),(0,l.jsx)(s.p,{children:"You can see this concurrency through Pants's dynamic UI."})]}),"\n",(0,l.jsx)(s.h2,{id:"shellcheck-linter",children:"Shellcheck linter"}),"\n",(0,l.jsxs)(s.p,{children:["To activate, add this to your ",(0,l.jsx)(s.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = [\n  "pants.backend.shell",\n  "pants.backend.shell.lint.shellcheck",\n]\n'})}),"\n",(0,l.jsxs)(s.p,{children:["Make sure that you also have set up ",(0,l.jsx)(s.code,{children:"shell_source"})," / ",(0,l.jsx)(s.code,{children:"shell_sources"})," or ",(0,l.jsx)(s.code,{children:"shunit2_test"})," / ",(0,l.jsx)(s.code,{children:"shunit_tests"})," targets so that Pants knows to operate on the relevant files."]}),"\n",(0,l.jsxs)(s.p,{children:["Now you can run ",(0,l.jsx)(s.code,{children:"pants lint"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{children:"$ pants lint scripts/my_script.sh\n13:09:10.49 [WARN] Completed: lint - Shellcheck failed (exit code 1).\n\nIn scripts/my_script.sh line 12:\nHERE=$(cd $(dirname ${BASH_SOURCE[0]}) && pwd)\n          ^--------------------------^ SC2046: Quote this to prevent word splitting.\n                    ^---------------^ SC2086: Double quote to prevent globbing and word splitting.\n\nDid you mean:\n...\n\n\u{10102} Shellcheck failed.\n"})}),"\n",(0,l.jsxs)(s.p,{children:["Use ",(0,l.jsx)(s.code,{children:"pants fmt lint dir:"})," to run on all files in the directory, and ",(0,l.jsx)(s.code,{children:"pants fmt lint dir::"})," to run on all files in the directory and subdirectories."]}),"\n",(0,l.jsxs)(s.p,{children:["Pants will automatically include any relevant ",(0,l.jsx)(s.code,{children:".shellcheckrc"})," and ",(0,l.jsx)(s.code,{children:"shellcheckrc"})," files in the run. You can also pass command line arguments with ",(0,l.jsx)(s.code,{children:"--shellcheck-args='-x -W 3'"})," or permanently set them in ",(0,l.jsx)(s.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-toml",children:'[shellcheck]\nargs = ["--external-sources", "--wiki-link-count=3"]\n'})}),"\n",(0,l.jsxs)(s.p,{children:["Temporarily disable Shellcheck with ",(0,l.jsx)(s.code,{children:"--shellcheck-skip"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"pants --shellcheck-skip lint ::\n"})}),"\n",(0,l.jsxs)(s.p,{children:["Only run Shellcheck with ",(0,l.jsx)(s.code,{children:"--lint-only"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"pants lint --only=shellcheck ::\n"})}),"\n",(0,l.jsx)(s.admonition,{title:"Benefit of Pants: Shellcheck runs in parallel with other linters",type:"tip",children:(0,l.jsxs)(s.p,{children:["Pants will attempt to run all activated linters and formatters at the same time for improved performance, including ",(0,l.jsx)(s.a,{href:"/dev/docs/python/overview/linters-and-formatters",children:"Python"}),", Go, Java, and Scala linters. You can see this through Pants's dynamic UI."]})}),"\n",(0,l.jsx)(s.h2,{id:"shunit2-test-runner",children:"shUnit2 test runner"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.a,{href:"https://github.com/kward/shunit2/",children:"shUnit2"})," allows you to write lightweight unit tests for your Shell code."]}),"\n",(0,l.jsx)(s.p,{children:"To use shunit2 with Pants:"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["Create a test file like ",(0,l.jsx)(s.code,{children:"tests.sh"}),", ",(0,l.jsx)(s.code,{children:"test_foo.sh"}),", or ",(0,l.jsx)(s.code,{children:"foo_test.sh"}),".","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Refer to ",(0,l.jsx)(s.a,{href:"https://github.com/kward/shunit2/",children:"https://github.com/kward/shunit2/"})," for how to write shUnit2 tests."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Create a ",(0,l.jsx)(s.code,{children:"shunit2_test"})," or ",(0,l.jsx)(s.code,{children:"shunit2_tests"})," target in the directory's BUILD file.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["You can run ",(0,l.jsx)(s.a,{href:"/dev/docs/getting-started/initial-configuration#5-generate-build-files",children:(0,l.jsx)(s.code,{children:"pants tailor"})})," to automate this step."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Specify which shell to run your tests with, either by setting a shebang directly in the test file or by setting the field ",(0,l.jsx)(s.code,{children:"shell"})," on the ",(0,l.jsx)(s.code,{children:"shunit2_test"})," / ",(0,l.jsx)(s.code,{children:"shunit2_tests"})," target.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["See ",(0,l.jsx)(s.a,{href:"/dev/reference/targets/shunit2_tests#shell",children:"here"})," for all supported shells."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(i.A,{groupId:"code-examples",children:[(0,l.jsx)(a.A,{value:"scripts/tests.sh",label:"scripts/tests.sh",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-shell",metastring:'tab={"label":"scripts/tests.sh"}',children:"#!/usr/bin/env bash\n\ntestEquality() {\n  assertEquals 1 1\n}\n"})})}),(0,l.jsx)(a.A,{value:"scripts/build",label:"scripts/BUILD",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",metastring:'tab={"label":"scripts/BUILD"}',children:'shunit2_tests(name="tests")\n'})})})]}),"\n",(0,l.jsx)(s.p,{children:"You can then run your tests like this:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"# Run all tests in the repository.\npants test ::\n\n# Run all the tests in the folder.\npants test scripts:\n\n# Run just the tests in this file.\npants test scripts/tests.sh\n"})}),"\n",(0,l.jsxs)(s.p,{children:["Pants will download the ",(0,l.jsx)(s.code,{children:"./shunit2"})," script and will add ",(0,l.jsx)(s.code,{children:"source ./shunit2"})," with the correct relpath for you."]}),"\n",(0,l.jsxs)(s.p,{children:["You can import your production code by using ",(0,l.jsx)(s.code,{children:"source"}),". Make sure the code belongs to a ",(0,l.jsx)(s.code,{children:"shell_source"})," or ",(0,l.jsx)(s.code,{children:"shell_sources"})," target. Pants's ",(0,l.jsx)(s.a,{href:"/dev/docs/using-pants/key-concepts/targets-and-build-files",children:"dependency inference"})," will add the relevant dependencies, which you can confirm by running ",(0,l.jsx)(s.code,{children:"pants dependencies scripts/tests.sh"}),". You can also manually add to the ",(0,l.jsx)(s.code,{children:"dependencies"})," field of your ",(0,l.jsx)(s.code,{children:"shunit2_tests"})," target."]}),"\n",(0,l.jsxs)(i.A,{groupId:"code-examples",children:[(0,l.jsx)(a.A,{value:"scripts/tests.sh",label:"scripts/tests.sh",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-shell",metastring:'tab={"label":"scripts/tests.sh"}',children:"#!/usr/bin/bash\n\nsource scripts/lib.sh\n\ntestAdd() {\n    assertEquals $(add_one 4) 5\n}\n"})})}),(0,l.jsx)(a.A,{value:"scripts/lib.sh",label:"scripts/lib.sh",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-shell",metastring:'tab={"label":"scripts/lib.sh"}',children:"add_one() {\n    echo $(($1 + 1))\n}\n"})})}),(0,l.jsx)(a.A,{value:"scripts/build",label:"scripts/BUILD",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-shell",metastring:'tab={"label":"scripts/BUILD"}',children:'shell_sources(name="lib")\nshell_tests(name="tests")\n'})})})]}),"\n",(0,l.jsxs)(s.admonition,{title:"Running your tests with multiple shells",type:"tip",children:[(0,l.jsx)(s.p,{children:"Pants allows you to run the same tests against multiple shells, e.g. Bash and Zsh, to ensure your code works with each shell."}),(0,l.jsxs)(s.p,{children:["To test multiple shells, use the ",(0,l.jsx)(s.code,{children:"parametrize"})," mechanism, like this:"]}),(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:'shunit2_tests(\n    name="tests",\n    shell=parametrize("bash", "zsh"),\n)\n'})}),(0,l.jsxs)(s.p,{children:["Then, use ",(0,l.jsx)(s.code,{children:"pants test"}),":"]}),(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"# Run tests with both shells.\npants test scripts/tests.sh\n\n# Run tests with only Zsh.\npants test scripts/tests.sh:tests@shell=zsh\n"})})]}),"\n",(0,l.jsx)(s.h3,{id:"controlling-output",children:"Controlling output"}),"\n",(0,l.jsxs)(s.p,{children:["By default, Pants only shows output for failed tests. You can change this by setting ",(0,l.jsx)(s.code,{children:"--test-output"})," to one of ",(0,l.jsx)(s.code,{children:"all"}),", ",(0,l.jsx)(s.code,{children:"failed"}),", or ",(0,l.jsx)(s.code,{children:"never"}),", e.g. ",(0,l.jsx)(s.code,{children:"pants test --output=all ::"}),"."]}),"\n",(0,l.jsxs)(s.p,{children:["You can permanently set the output format in your ",(0,l.jsx)(s.code,{children:"pants.toml"})," like this:"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[test]\noutput = "all"\n'})}),"\n",(0,l.jsxs)(s.h3,{id:"force-reruns-with---force",children:["Force reruns with ",(0,l.jsx)(s.code,{children:"--force"})]}),"\n",(0,l.jsxs)(s.p,{children:["To force your tests to run again, rather than reading from the cache, run ",(0,l.jsx)(s.code,{children:"pants test --force path/to/test.sh"}),"."]}),"\n",(0,l.jsx)(s.h3,{id:"setting-environment-variables",children:"Setting environment variables"}),"\n",(0,l.jsxs)(s.p,{children:["Test runs are ",(0,l.jsx)(s.em,{children:"hermetic"}),", meaning that they are stripped of the parent ",(0,l.jsx)(s.code,{children:"pants"})," process's environment variables. This is important for reproducibility, and it also increases cache hits."]}),"\n",(0,l.jsxs)(s.p,{children:["To add any arbitrary environment variable back to the process, use the option ",(0,l.jsx)(s.code,{children:"extra_env_vars"})," in the ",(0,l.jsx)(s.code,{children:"[test]"})," options scope. You can specify a value with the form ",(0,l.jsx)(s.code,{children:'"VAR1=hardcoded_value"'})," or read it from the parent ",(0,l.jsx)(s.code,{children:"pants"})," process's environment with the form ",(0,l.jsx)(s.code,{children:"VAR2"}),". ",(0,l.jsx)(s.code,{children:"fnmatch"})," globs like ",(0,l.jsx)(s.code,{children:'"VAR_PREFIXED_*"'})," can be used to read multiple environment variables."]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[test]\nextra_env_vars = ["VAR1=hardcoded_value", "VAR2", "VAR_PREFIXED_*"]\n'})}),"\n",(0,l.jsxs)(s.p,{children:["Use ",(0,l.jsx)(s.code,{children:"[bash-setup].executable_search_paths"})," to change the ",(0,l.jsx)(s.code,{children:"$PATH"})," env var used during test runs. You can use the special string ",(0,l.jsx)(s.code,{children:'"<PATH>"'})," to read the value from the parent ",(0,l.jsx)(s.code,{children:"pants"})," process's environment."]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[bash-setup]\nexecutable_search_paths = ["/usr/bin", "<PATH>"]\n'})}),"\n",(0,l.jsx)(s.h3,{id:"timeouts",children:"Timeouts"}),"\n",(0,l.jsx)(s.p,{children:"Pants can cancel tests that take too long, which is useful to prevent tests from hanging indefinitely."}),"\n",(0,l.jsxs)(s.p,{children:["To add a timeout, set the ",(0,l.jsx)(s.code,{children:"timeout"})," field to an integer value of seconds, like this:"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",metastring:'title="BUILD"',children:'shunit2_test(name="tests", source="tests.sh", timeout=120)\n'})}),"\n",(0,l.jsxs)(s.p,{children:["When you set ",(0,l.jsx)(s.code,{children:"timeout"})," on the ",(0,l.jsx)(s.code,{children:"shunit2_tests"})," target generator, the same timeout will apply to every generated ",(0,l.jsx)(s.code,{children:"shunit2_test"})," target. Instead, you can use the ",(0,l.jsx)(s.code,{children:"overrides"})," field:"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",metastring:'title="BUILD"',children:'shunit2_tests(\n    name="tests",\n    overrides={\n        "test_f1.sh": {"timeout": 20},\n        ("test_f2.sh", "test_f3.sh"): {"timeout": 35},\n    },\n)\n'})}),"\n",(0,l.jsxs)(s.p,{children:["You can also set a default value and a maximum value in ",(0,l.jsx)(s.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-toml",metastring:'title="pants.toml"',children:"[test]\ntimeout_default = 60\ntimeout_maximum = 600\n"})}),"\n",(0,l.jsxs)(s.p,{children:["If a target sets its ",(0,l.jsx)(s.code,{children:"timeout"})," higher than ",(0,l.jsx)(s.code,{children:"[test].timeout_maximum"}),", Pants will use the value in ",(0,l.jsx)(s.code,{children:"[test].timeout_maximum"}),"."]}),"\n",(0,l.jsxs)(s.p,{children:["Use the option ",(0,l.jsx)(s.code,{children:"pants test --no-timeouts"})," to temporarily disable timeouts, e.g. when debugging."]}),"\n",(0,l.jsx)(s.h3,{id:"retries",children:"Retries"}),"\n",(0,l.jsx)(s.p,{children:"Pants can automatically retry failed tests. This can help keep your builds passing even with flaky tests, like integration tests."}),"\n",(0,l.jsx)(i.A,{groupId:"code-examples",children:(0,l.jsx)(a.A,{value:"pants.toml",label:"pants.toml",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:"[test]\nattempts_default = 3\n"})})})}),"\n",(0,l.jsx)(s.h3,{id:"testing-your-packaging-pipeline",children:"Testing your packaging pipeline"}),"\n",(0,l.jsxs)(s.p,{children:["You can include the result of ",(0,l.jsx)(s.code,{children:"pants package"})," in your test through the ",(0,l.jsx)(s.code,{children:"runtime_package_dependencies field"}),". Pants will run the equivalent of ",(0,l.jsx)(s.code,{children:"pants package"})," beforehand and copy the built artifact into the test's chroot, allowing you to test things like that the artifact has the correct files present and that it's executable."]}),"\n",(0,l.jsxs)(s.p,{children:["This allows you to test your packaging pipeline by simply running ",(0,l.jsx)(s.code,{children:"pants test ::"}),", without needing custom integration test scripts."]}),"\n",(0,l.jsxs)(s.p,{children:["To depend on a built package, use the ",(0,l.jsx)(s.code,{children:"runtime_package_dependencies"})," field on the ",(0,l.jsx)(s.code,{children:"shunit2_test"})," / ",(0,l.jsx)(s.code,{children:"shunit2_tests"})," targets, which is a list of addresses to targets that can be built with ",(0,l.jsx)(s.code,{children:"pants package"}),", such as ",(0,l.jsx)(s.a,{href:"/dev/docs/python/goals/package",children:(0,l.jsx)(s.code,{children:"pex_binary"})}),", ",(0,l.jsx)(s.a,{href:"/dev/docs/python/integrations/aws-lambda",children:(0,l.jsx)(s.code,{children:"python_aws_lambda_function"})}),", and ",(0,l.jsx)(s.a,{href:"/dev/docs/using-pants/assets-and-archives",children:(0,l.jsx)(s.code,{children:"archive"})})," targets. Pants will build the package before running your test, and insert the file into the test's chroot. It will use the same name it would normally use with ",(0,l.jsx)(s.code,{children:"pants package"}),", except without the ",(0,l.jsx)(s.code,{children:"dist/"})," prefix."]}),"\n",(0,l.jsx)(s.p,{children:"For example:"}),"\n",(0,l.jsxs)(i.A,{groupId:"code-examples",children:[(0,l.jsx)(a.A,{value:"helloworld/build",label:"helloworld/BUILD",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",metastring:'tab={"label":"helloworld/BUILD"}',children:'python_source(name="py_src", source="say_hello.py")\npex_binary(name="pex", entry_point="say_hello.py")\n\nshunit2_test(\n    name="tests",\n    source="tests.sh",\n    runtime_package_dependencies=[":pex"],\n)\n'})})}),(0,l.jsx)(a.A,{value:"helloworld/say_hello.py",label:"helloworld/say_hello.py",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",metastring:'tab={"label":"helloworld/say_hello.py"}',children:'print("Hello, test!")\n'})})}),(0,l.jsx)(a.A,{value:"helloworld/tests.sh",label:"helloworld/tests.sh",children:(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-shell",metastring:'tab={"label":"helloworld/tests.sh"}',children:'#!/usr/bin/bash\n\ntestArchiveCreated() {\n  assertTrue "[[ -f helloworld/say_hello.pex ]]"\n}\n'})})})]})]})}function p(e={}){let{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(u,{...e})}):u(e)}},753348(e,s,t){t.d(s,{A:()=>n});let n={tabItem:"tabItem_mHvh"}},618264(e,s,t){t.d(s,{A:()=>n});let n={tabList:"tabList_sFbf",tabItem:"tabItem_UVfV"}},637180(e,s,t){t.d(s,{A:()=>i});var n=t(886070);t(830758);var l=t(313526),r=t(753348);function i({children:e,hidden:s,className:t}){return(0,n.jsx)("div",{role:"tabpanel",className:(0,l.A)(r.A.tabItem,t),hidden:s,children:e})}},685008(e,s,t){t.d(s,{A:()=>x});var n=t(886070),l=t(830758),r=t(313526),i=t(911212),a=t(274875),c=t(106632),o=t(189223),h=t(618264);function d({className:e,block:s,selectedValue:t,selectValue:l,tabValues:i}){let c=[],{blockElementScrollPositionUntilNextRender:o}=(0,a.a_)(),d=e=>{let s=e.currentTarget,n=i[c.indexOf(s)].value;n!==t&&(o(s),l(n))},u=e=>{let s=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let t=c.indexOf(e.currentTarget)+1;s=c[t]??c[0];break}case"ArrowLeft":{let t=c.indexOf(e.currentTarget)-1;s=c[t]??c[c.length-1]}}s?.focus()};return(0,n.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":s},e),children:i.map(({value:e,label:s,attributes:l})=>(0,n.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{c.push(e)},onKeyDown:u,onClick:d,...l,className:(0,r.A)("tabs__item",h.A.tabItem,l?.className,{"tabs__item--active":t===e}),children:s??e},e))})}function u({lazy:e,children:s,selectedValue:t}){let i=(Array.isArray(s)?s:[s]).filter(Boolean);if(e){let e=i.find(e=>e.props.value===t);return e?(0,l.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,n.jsx)("div",{className:"margin-top--md",children:i.map((e,s)=>(0,l.cloneElement)(e,{key:s,hidden:e.props.value!==t}))})}function p(e){let s=(0,c.u)(e);return(0,n.jsxs)("div",{className:(0,r.A)(i.G.tabs.container,"tabs-container",h.A.tabList),children:[(0,n.jsx)(d,{...s,...e}),(0,n.jsx)(u,{...s,...e})]})}function x(e){let s=(0,o.A)();return(0,n.jsx)(p,{...e,children:(0,c.v)(e.children)},String(s))}},106632(e,s,t){t.d(s,{u:()=>d,v:()=>o});var n=t(830758),l=t(325557),r=t(363717),i=t(125740),a=t(574229),c=t(270367);function o(e){return n.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,n.isValidElement)(e)&&function(e){let{props:s}=e;return!!s&&"object"==typeof s&&"value"in s}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h({value:e,tabValues:s}){return s.some(s=>s.value===e)}function d(e){let s,{defaultValue:t,queryString:d=!1,groupId:u}=e,p=function(e){let{values:s,children:t}=e;return(0,n.useMemo)(()=>{let e=s??o(t).map(({props:{value:e,label:s,attributes:t,default:n}})=>({value:e,label:s,attributes:t,default:n})),n=(0,a.XI)(e,(e,s)=>e.value===s.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[s,t])}(e),[x,m]=(0,n.useState)(()=>(function({defaultValue:e,tabValues:s}){if(0===s.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:s}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${s.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let t=s.find(e=>e.default)??s[0];if(!t)throw Error("Unexpected error: 0 tabValues");return t.value})({defaultValue:t,tabValues:p})),[j,g]=function({queryString:e=!1,groupId:s}){let t=(0,l.W6)(),r=function({queryString:e=!1,groupId:s}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!s)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:e,groupId:s});return[(0,i.aZ)(r),(0,n.useCallback)(e=>{if(!r)return;let s=new URLSearchParams(t.location.search);s.set(r,e),t.replace({...t.location,search:s.toString()})},[r,t])]}({queryString:d,groupId:u}),[f,b]=function({groupId:e}){let s=e?`docusaurus.tab.${e}`:null,[t,l]=(0,c.Dv)(s);return[t,(0,n.useCallback)(e=>{s&&l.set(e)},[s,l])]}({groupId:u}),y=h({value:s=j??f,tabValues:p})?s:null;return(0,r.A)(()=>{y&&m(y)},[y]),{selectedValue:x,selectValue:(0,n.useCallback)(e=>{if(!h({value:e,tabValues:p}))throw Error(`Can't select invalid tab value=${e}`);m(e),g(e),b(e)},[g,b,p]),tabValues:p}}},848193(e,s,t){t.d(s,{R:()=>i,x:()=>a});var n=t(830758);let l={},r=n.createContext(l);function i(e){let s=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),n.createElement(r.Provider,{value:s},e.children)}},834098(e){e.exports=JSON.parse('{"id":"docs/shell/index","title":"Shell overview","description":"Pants\'s support for Shellcheck, shfmt, and shUnit2.","source":"@site/docs/docs/shell/index.mdx","sourceDirName":"docs/shell","slug":"/docs/shell/","permalink":"/dev/docs/shell/","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/shell/index.mdx","tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"title":"Shell overview","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Kotlin","permalink":"/dev/docs/jvm/kotlin"},"next":{"title":"Run shell commands","permalink":"/dev/docs/shell/run-shell-commands"}}')}}]);