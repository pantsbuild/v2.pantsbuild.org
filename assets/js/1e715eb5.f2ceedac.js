"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["400797"],{60656(e,r,n){n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>t,toc:()=>d});var t=n(567009),o=n(886070),a=n(848193);let i={title:"Terraform Overview",sidebar_position:999},s,l={},d=[{value:"Initial setup",id:"initial-setup",level:2},{value:"Adding Terraform targets",id:"adding-terraform-targets",level:3},{value:"Modules",id:"modules",level:4},{value:"Deployments",id:"deployments",level:4},{value:"Lockfiles",id:"lockfiles",level:4},{value:"Basic Operations",id:"basic-operations",level:3},{value:"Formatting",id:"formatting",level:4},{value:"Validate",id:"validate",level:4},{value:"Deploying",id:"deploying",level:4}];function c(e){let r={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.hr,{}),"\n",(0,o.jsxs)(r.admonition,{title:"Terraform support is in alpha stage",type:"caution",children:[(0,o.jsx)(r.p,{children:"Pants is currently building support for developing and deploying Terraform. Simple use cases might be supported, but many options are missing."}),(0,o.jsxs)(r.p,{children:["Please share feedback for what you need to use Pants with your Terraform modules and deployments by either ",(0,o.jsx)(r.a,{href:"https://github.com/pantsbuild/pants/issues/new/choose",children:"opening a GitHub issue"})," or ",(0,o.jsx)(r.a,{href:"/community/getting-help",children:"joining our Slack"}),"!"]})]}),"\n",(0,o.jsx)(r.h2,{id:"initial-setup",children:"Initial setup"}),"\n",(0,o.jsxs)(r.p,{children:["First, activate the relevant backend in ",(0,o.jsx)(r.code,{children:"pants.toml"}),":"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = [\n  ...\n  "pants.backend.experimental.terraform",\n  ...\n]\n'})}),"\n",(0,o.jsxs)(r.p,{children:["The Terraform backend also needs Python to run Pants's analysers. The setting ",(0,o.jsx)(r.code,{children:"[python].interpreter_constraints"})," will need to be set."]}),"\n",(0,o.jsx)(r.h3,{id:"adding-terraform-targets",children:"Adding Terraform targets"}),"\n",(0,o.jsx)(r.p,{children:"The Terraform backend has 2 target types:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.code,{children:"terraform_module"})," for Terraform source code"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.code,{children:"terraform_deployment"})," for deployments that can be deployed with the ",(0,o.jsx)(r.code,{children:"experimental-deploy"})," goal"]}),"\n"]}),"\n",(0,o.jsx)(r.h4,{id:"modules",children:"Modules"}),"\n",(0,o.jsxs)(r.p,{children:["The ",(0,o.jsx)(r.code,{children:"tailor"})," goal will automatically generate ",(0,o.jsx)(r.code,{children:"terraform_module"})," targets. Run ",(0,o.jsx)(r.a,{href:"/2.18/docs/getting-started/initial-configuration#5-generate-build-files",children:(0,o.jsx)(r.code,{children:"pants tailor ::"})}),". For example:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"\u276F pants tailor ::\nCreated src/terraform/root/BUILD:\n  - Add terraform_module target root\n"})}),"\n",(0,o.jsx)(r.h4,{id:"deployments",children:"Deployments"}),"\n",(0,o.jsxs)(r.p,{children:[(0,o.jsx)(r.code,{children:"terraform_deployments"})," must be manually created. The deployment points to a ",(0,o.jsx)(r.code,{children:"terraform_module"})," target as its ",(0,o.jsx)(r.code,{children:"root_module"}),' field. This module will be the "root" module that Terraform operations will be run on. You can reference vars files with the ',(0,o.jsx)(r.code,{children:"var_files"})," field. You can have multiple deployments reference the same module:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:'terraform_module(name="root")\nterraform_deployment(name="prod", root_module=":root", var_files=["prod.tfvars"])\nterraform_deployment(name="test", root_module=":root", var_files=["test.tfvars"])\n'})}),"\n",(0,o.jsx)(r.h4,{id:"lockfiles",children:"Lockfiles"}),"\n",(0,o.jsx)(r.p,{children:"Automatic lockfile management is currently in progress. You can include lockfiles manually as a dependency:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:'terraform_deployment(name="prod", root_module=":root", dependencies=[":lockfile"])\nfile(name="lockfile", source=".terraform.lock.hcl")\n'})}),"\n",(0,o.jsx)(r.h3,{id:"basic-operations",children:"Basic Operations"}),"\n",(0,o.jsx)(r.h4,{id:"formatting",children:"Formatting"}),"\n",(0,o.jsxs)(r.p,{children:["Run ",(0,o.jsx)(r.code,{children:"terraform fmt"})," as part of the ",(0,o.jsx)(r.code,{children:"fix"}),", ",(0,o.jsx)(r.code,{children:"fmt"}),", or ",(0,o.jsx)(r.code,{children:"lint"})," goals."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"pants fix ::\n[INFO] Completed: pants.backend.terraform.lint.tffmt.tffmt.tffmt_fmt - terraform-fmt made no changes.\n\n\u2713 terraform-fmt made no changes.\n"})}),"\n",(0,o.jsx)(r.h4,{id:"validate",children:"Validate"}),"\n",(0,o.jsxs)(r.p,{children:["Run ",(0,o.jsx)(r.code,{children:"terraform validate"})," as part of the ",(0,o.jsx)(r.code,{children:"check"})," goal."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"pants check ::\n[INFO] Completed: pants.backend.terraform.goals.check.terraform_check - terraform-validate succeeded.\nSuccess! The configuration is valid.\n\n\u2713 terraform-validate succeeded.\n\n"})}),"\n",(0,o.jsxs)(r.p,{children:[(0,o.jsx)(r.code,{children:"terraform validate"}),' isn\'t valid for all Terraform modules. Some child modules, in particular those using aliased providers, need to have their providers provided by a "root" module. You can opt these modules out of ',(0,o.jsx)(r.code,{children:"validate"})," by setting ",(0,o.jsx)(r.code,{children:"skip_terraform_validate=True"}),". For example:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"terraform_module(skip_terraform_validate=True)\n"})}),"\n",(0,o.jsx)(r.h4,{id:"deploying",children:"Deploying"}),"\n",(0,o.jsx)(r.admonition,{title:"Terraform deployment support is in alpha stage",type:"caution",children:(0,o.jsx)(r.p,{children:"Many options and features aren't supported yet.\nLocal state backends aren't supported."})}),"\n",(0,o.jsxs)(r.p,{children:["Run ",(0,o.jsx)(r.code,{children:"terraform apply"})," as part of the ",(0,o.jsx)(r.code,{children:"experimental-deploy"})," goal. The process is run interactively, so you will be prompted for variables and confirmation as usual."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"pants experimental-deploy ::\n[INFO] Deploying targets...\n--- 8< ---\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only 'yes' will be accepted to approve.\n\n  Enter a value: yes\n--- 8< ---\nApply complete! Resources: 4 added, 0 changed, 0 destroyed.\n\n\u2713 testprojects/src/terraform/root:root deployed\n"})}),"\n",(0,o.jsxs)(r.p,{children:["You can set auto approve by adding ",(0,o.jsx)(r.code,{children:"-auto-approve"})," to the ",(0,o.jsx)(r.code,{children:"[download-terraform].args"})," setting in ",(0,o.jsx)(r.code,{children:"pants.toml"}),". You can also set it for a single pants invocation with ",(0,o.jsx)(r.code,{children:"--download-terraform-args='-auto-approve'"}),", for example ",(0,o.jsx)(r.code,{children:"pants experimental-deploy \"--download-terraform-args='-auto-approve'\""}),"."]})]})}function p(e={}){let{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},848193(e,r,n){n.d(r,{R:()=>i,x:()=>s});var t=n(830758);let o={},a=t.createContext(o);function i(e){let r=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(a.Provider,{value:r},e.children)}},567009(e){e.exports=JSON.parse('{"id":"docs/terraform/index","title":"Terraform Overview","description":"---","source":"@site/versioned_docs/version-2.18/docs/terraform/index.mdx","sourceDirName":"docs/terraform","slug":"/docs/terraform/","permalink":"/2.18/docs/terraform/","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/terraform/index.mdx","tags":[],"version":"2.18","sidebarPosition":999,"frontMatter":{"title":"Terraform Overview","sidebar_position":999},"sidebar":"docsSidebar","previous":{"title":"Kubeconform","permalink":"/2.18/docs/helm/kubeconform"},"next":{"title":"Integrating new tools without plugins","permalink":"/2.18/docs/ad-hoc-tools/integrating-new-tools-without-plugins"}}')}}]);