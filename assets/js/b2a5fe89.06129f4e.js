"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["359336"],{235377(e,n,o){o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>t,toc:()=>d});var t=o(67496),l=o(886070),s=o(848193);let i={title:"Making a tool exportable",sidebar_position:10},r,a={},d=[{value:"Downloadable Tools",id:"downloadable-tools",level:2},{value:"Implementing for new backends",id:"implementing-for-new-backends",level:2}];function c(e){let n={code:"code",h2:"h2",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.p,{children:["How to make a tool exportable with the ",(0,l.jsx)(n.code,{children:"export"})," goal."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsxs)(n.p,{children:["Backends that implement the ",(0,l.jsx)(n.code,{children:"export"})," goal can indicate binaries that should be exported. These will have their contents exported to a subfolder in the ",(0,l.jsx)(n.code,{children:"dist/bins"})," directory, and the binary itself will be linked in ",(0,l.jsx)(n.code,{children:"dist/bin"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"downloadable-tools",children:"Downloadable Tools"}),"\n",(0,l.jsxs)(n.p,{children:["Subclasses of ",(0,l.jsx)(n.code,{children:"ExternalTool"})," (including ",(0,l.jsx)(n.code,{children:"TemplatedExternalTool"}),") have the logic for exporting implemented. Tools are marked for export as follows:"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Implement ",(0,l.jsx)(n.code,{children:"ExternalTool.generate_exe"})," if the default is not correct. For instance, a tool downloaded might include a binary, a readme, and a license. This method will point to the binary within the downloaded files."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Register a ",(0,l.jsx)(n.code,{children:"UnionRule"})," with ",(0,l.jsx)(n.code,{children:"ExportableTool"}),". For example, ",(0,l.jsx)(n.code,{children:"UnionRule(ExportableTool, FortranLint)"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"implementing-for-new-backends",children:"Implementing for new backends"}),"\n",(0,l.jsx)(n.p,{children:"Backends need to implement:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["A subclass of ",(0,l.jsx)(n.code,{children:"ExportRequest"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"@dataclass(frozen=True)\nclass ExportExternalToolRequest(ExportRequest):\n    pass\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsxs)(n.li,{children:["A rule from this subclass to ",(0,l.jsx)(n.code,{children:"ExportResults"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"@rule\nasync def export_external_tools(\n    request: ExportExternalToolRequest, export: ExportSubsystem\n) -> ExportResults:\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsxs)(n.li,{children:["Inside of that rule, fill the ",(0,l.jsx)(n.code,{children:"ExportResult.exported_binaries"})," field."]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'ExportResult(\n    description=f"Export tool {req.resolve}",\n    reldir=dest,\n    digest=downloaded_tool.digest,\n    resolve=req.resolve,\n    exported_binaries=(ExportedBinary(name=Path(exe).name, path_in_export=exe),),\n)\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"4",children:["\n",(0,l.jsxs)(n.li,{children:["For every tool, mark it for export registering a ",(0,l.jsx)(n.code,{children:"UnionRule"})," with ",(0,l.jsx)(n.code,{children:"ExportableTool"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"def rules():\n    return [\n        ...,\n        `UnionRule(ExportableTool, FortranLint)`,\n    ]\n"})})]})}function p(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},848193(e,n,o){o.d(n,{R:()=>i,x:()=>r});var t=o(830758);let l={},s=t.createContext(l);function i(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),t.createElement(s.Provider,{value:n},e.children)}},67496(e){e.exports=JSON.parse('{"id":"docs/writing-plugins/common-plugin-tasks/allowing-tool-export","title":"Making a tool exportable","description":"How to make a tool exportable with the export goal.","source":"@site/versioned_docs/version-2.27/docs/writing-plugins/common-plugin-tasks/allowing-tool-export.mdx","sourceDirName":"docs/writing-plugins/common-plugin-tasks","slug":"/docs/writing-plugins/common-plugin-tasks/allowing-tool-export","permalink":"/2.27/docs/writing-plugins/common-plugin-tasks/allowing-tool-export","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/writing-plugins/common-plugin-tasks/allowing-tool-export.mdx","tags":[],"version":"2.27","sidebarPosition":10,"frontMatter":{"title":"Making a tool exportable","sidebar_position":10},"sidebar":"docsSidebar","previous":{"title":"Plugin upgrade guide","permalink":"/2.27/docs/writing-plugins/common-plugin-tasks/plugin-upgrade-guide"},"next":{"title":"Common subsystem tasks","permalink":"/2.27/docs/writing-plugins/common-subsystem-tasks"}}')}}]);