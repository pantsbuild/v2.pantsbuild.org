"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["220459"],{904759(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>h});var s=n(427550),a=n(886070),r=n(848193),i=n(685008),l=n(637180);let o={title:"Java and Scala overview",sidebar_position:0},c,d={},h=[{value:"Initial setup",id:"initial-setup",level:2},{value:"Choosing JDK and Scala versions",id:"choosing-jdk-and-scala-versions",level:3},{value:"JDK",id:"jdk",level:4},{value:"Scala version",id:"scala-version",level:4},{value:"First-party dependencies",id:"first-party-dependencies",level:3},{value:"Third-party dependencies and lockfiles",id:"third-party-dependencies-and-lockfiles",level:3},{value:"<code>resource</code> targets",id:"resource-targets",level:3},{value:"Compile code",id:"compile-code",level:2},{value:"Run tests",id:"run-tests",level:2},{value:"Timeouts",id:"timeouts",level:3},{value:"Setting environment variables",id:"setting-environment-variables",level:3},{value:"Protobuf",id:"protobuf",level:2},{value:"Lint and Format",id:"lint-and-format",level:2},{value:"Working in an IDE",id:"working-in-an-ide",level:2},{value:"Usage",id:"usage",level:3},{value:"Setup",id:"setup",level:3},{value:"First time setup (per-repository)",id:"first-time-setup-per-repository",level:4},{value:"Per-user setup",id:"per-user-setup",level:4},{value:"Troubleshooting",id:"troubleshooting",level:3}];function u(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"Pants's support for Java and Scala."}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsxs)(t.admonition,{title:"Java and Scala support is beta stage",type:"caution",children:[(0,a.jsxs)(t.p,{children:["We are done implementing most functionality for Pants's Java and Scala support (",(0,a.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/labels/lang-jvm",children:"tracked here"}),"). However, there may be use cases that we aren't yet handling."]}),(0,a.jsxs)(t.p,{children:["Please share feedback for what you need to use Pants with your JVM project by either ",(0,a.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/issues/new/choose",children:"opening a GitHub issue"})," or ",(0,a.jsx)(t.a,{href:"/community/members",children:"joining our Slack"}),"!"]})]}),"\n",(0,a.jsx)(t.admonition,{title:"Example Java and Scala repository",type:"note",children:(0,a.jsxs)(t.p,{children:["Check out ",(0,a.jsx)(t.a,{href:"https://github.com/pantsbuild/example-jvm",children:"github.com/pantsbuild/example-jvm"})," to try out Pants's Java and Scala support."]})}),"\n",(0,a.jsx)(t.h2,{id:"initial-setup",children:"Initial setup"}),"\n",(0,a.jsxs)(t.p,{children:["First, activate the relevant backends in ",(0,a.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = [\n  # Each backend can be used independently, so there is no need to enable Scala if you\n  # have a pure-Java repository (or vice versa).\n  "pants.backend.experimental.java",\n  "pants.backend.experimental.scala",\n]\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Then run ",(0,a.jsx)(t.a,{href:"/2.16/docs/getting-started/initial-configuration#5-generate-build-files",children:(0,a.jsx)(t.code,{children:"pants tailor ::"})})," to generate BUILD files. This will create ",(0,a.jsx)(t.code,{children:"java_sources"})," and ",(0,a.jsx)(t.code,{children:"scala_sources"})," targets in every directory containing library code, as well as test targets like ",(0,a.jsx)(t.code,{children:"scalatest_tests"})," and ",(0,a.jsx)(t.code,{children:"junit_tests"})," for filenames that look like tests."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"\u276F pants tailor ::\nCreated src/jvm/org/pantsbuild/example/app/BUILD:\n  - Add scala_sources target app\nCreated src/jvm/org/pantsbuild/example/lib/BUILD:\n  - Add java_sources target lib\nCreated tests/jvm/org/pantsbuild/example/lib/BUILD:\n  - Add scalatest_tests target lib\n"})}),"\n",(0,a.jsxs)(t.p,{children:["You can run ",(0,a.jsx)(t.code,{children:"pants list ::"})," to see all targets in your project:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"\u276F pants list\n...\nsrc/jvm/org/pantsbuild/example/app:app\nsrc/jvm/org/pantsbuild/example/app/ExampleApp.scala\nsrc/jvm/org/pantsbuild/example/lib:lib\nsrc/jvm/org/pantsbuild/example/lib/ExampleLib.java\ntests/jvm/org/pantsbuild/example/lib:lib\ntests/jvm/org/pantsbuild/example/lib/ExampleLibSpec.scala\n"})}),"\n",(0,a.jsx)(t.h3,{id:"choosing-jdk-and-scala-versions",children:"Choosing JDK and Scala versions"}),"\n",(0,a.jsxs)(t.p,{children:["Pants ",(0,a.jsx)(t.code,{children:"2.11.x"})," adds support for choosing JDK and Scala versions per target in your repository, but to reduce the amount of boilerplate required, most users set repository-wide defaults in ",(0,a.jsx)(t.code,{children:"pants.toml"}),", and then only override them when necessary for particular targets."]}),"\n",(0,a.jsx)(t.h4,{id:"jdk",children:"JDK"}),"\n",(0,a.jsxs)(t.p,{children:["JDKs used by Pants are automatically fetched using ",(0,a.jsx)(t.a,{href:"https://get-coursier.io/",children:"Coursier"}),", and are chosen using the ",(0,a.jsxs)(t.a,{href:"/2.16/reference/subsystems/jvm#section-jdk",children:[(0,a.jsx)(t.code,{children:"[jvm].jdk"})," setting"]})," to set a repository-wide default."]}),"\n",(0,a.jsxs)(t.p,{children:["To override the default on a particular target, you can use the ",(0,a.jsxs)(t.a,{href:"/2.16/reference/targets/java_source#jdk",children:[(0,a.jsx)(t.code,{children:"jdk="})," field"]}),". It can be useful to use the ",(0,a.jsxs)(t.a,{href:"/2.16/docs/using-pants/key-concepts/targets-and-build-files#parametrizing-targets",children:[(0,a.jsx)(t.code,{children:"parametrize"})," builtin"]})," with the ",(0,a.jsx)(t.code,{children:"jdk="})," field, particularly to run test targets under multiple JDKs."]}),"\n",(0,a.jsx)(t.h4,{id:"scala-version",children:"Scala version"}),"\n",(0,a.jsxs)(t.p,{children:['The Scala version to use is configured on a resolve-by-resolve basis (see the "Third-party dependencies" section below) using the ',(0,a.jsxs)(t.a,{href:"/2.16/reference/subsystems/scala#section-version_for_resolve",children:[(0,a.jsx)(t.code,{children:"[scala].version_for_resolve"})," option"]}),'. The default Scala version for your repository will thus be whichever Scala version is configured for the "default" resolve, which is configured by the ',(0,a.jsxs)(t.a,{href:"reference-jvm#section-default-resolve",children:[(0,a.jsx)(t.code,{children:"[jvm].default_resolve"})," option"]}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["To use multiple Scala versions in a repository, you would define multiple resolves, and then adjust the ",(0,a.jsxs)(t.a,{href:"/2.16/reference/targets/scalatest_test#resolve",children:[(0,a.jsx)(t.code,{children:"resolve"})," field"]})," of any targets which should be used with the non-",(0,a.jsx)(t.code,{children:"default_resolve"})," resolve."]}),"\n",(0,a.jsxs)(t.p,{children:["To cross-build a set of Scala targets for multiple Scala versions, you can use the ",(0,a.jsxs)(t.a,{href:"/2.16/docs/using-pants/key-concepts/targets-and-build-files#parametrizing-targets",children:[(0,a.jsx)(t.code,{children:"parametrize"})," builtin"]})," with the ",(0,a.jsx)(t.code,{children:"resolve="})," field of the target and its dependencies."]}),"\n",(0,a.jsx)(t.admonition,{title:"A jvm_artifact for scala-library artifact is explicitly required.",type:"caution",children:(0,a.jsxs)(t.p,{children:["The Scala backend currently requires that a ",(0,a.jsx)(t.code,{children:"jvm_artifact"})," target for the ",(0,a.jsx)(t.code,{children:"org.scala-lang:scala-library"})," Scala runtime be present in any resolve used for Scala. If such a jvm_artifact is missing, Pants will error. Pants will automatically inject a dependency on the runtime. (This target may be automatically supplied by Pants in a future version, but that is not currently implemented.)"]})}),"\n",(0,a.jsx)(t.h3,{id:"first-party-dependencies",children:"First-party dependencies"}),"\n",(0,a.jsxs)(t.p,{children:["In many cases, the dependencies of your first-party code are automatically inferred via ",(0,a.jsx)(t.a,{href:"https://blog.pantsbuild.org/automatically-unlocking-concurrent-builds-and-fine-grained-caching-on-the-jvm-with-dependency-inference/",children:"dependency inference"})," based on your ",(0,a.jsx)(t.code,{children:"import"})," statements. If you do need to declare additional dependencies for any reason, you can do so using Pants' ",(0,a.jsx)(t.a,{href:"/2.16/docs/using-pants/key-concepts/targets-and-build-files",children:"syntax for declaring dependencies for targets"}),"."]}),"\n",(0,a.jsx)(t.h3,{id:"third-party-dependencies-and-lockfiles",children:"Third-party dependencies and lockfiles"}),"\n",(0,a.jsxs)(t.p,{children:["Third-party dependencies (i.e. those from repositories like ",(0,a.jsx)(t.a,{href:"https://search.maven.org/",children:"Maven central"}),") are also automatically inferred via dependency inference, but must first be declared once per repository as ",(0,a.jsxs)(t.a,{href:"/2.16/reference/targets/jvm_artifact",children:[(0,a.jsx)(t.code,{children:"jvm_artifact"})," targets"]}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",metastring:'title="BUILD"',children:'jvm_artifact(\n    group="com.google.guava",\n    artifact="guava",\n    version="31.0.1-jre",\n    # See the callout below for more information on the `packages` argument.\n    packages=["com.google.common.**"],\n)\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Pants requires use of a lockfile for thirdparty dependencies. After adding or editing ",(0,a.jsx)(t.code,{children:"jvm_artifact"})," targets, you will need to update affected lockfiles by running ",(0,a.jsx)(t.code,{children:"pants generate-lockfiles"}),". The default lockfile is located at ",(0,a.jsx)(t.code,{children:"3rdparty/jvm/default.lock"}),", but it can be relocated (as well as additional resolves declared) via the ",(0,a.jsxs)(t.a,{href:"/2.16/reference/subsystems/jvm#section-resolves",children:[(0,a.jsx)(t.code,{children:"[jvm].resolves"})," option"]}),"."]}),"\n",(0,a.jsxs)(t.admonition,{type:"note",children:[(0,a.jsxs)(t.mdxAdmonitionTitle,{children:["Thirdparty symbols and the ",(0,a.jsx)(t.code,{children:"packages"})," argument"]}),(0,a.jsxs)(t.p,{children:["To efficiently determine which symbols are provided by thirdparty code (i.e., without hitting the network in order to compute dependencies in the common case), Pants relies on a static mapping of which artifacts provide which symbols, and defaults to treating each ",(0,a.jsx)(t.code,{children:"jvm_artifact"})," as providing symbols within its ",(0,a.jsx)(t.code,{children:"group"}),"."]}),(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"packages"})," argument allows you to override which symbols a ",(0,a.jsx)(t.code,{children:"jvm_artifact"})," provides. See the ",(0,a.jsxs)(t.a,{href:"/2.16/reference/targets/jvm_artifact#packages",children:[(0,a.jsx)(t.code,{children:"jvm_artifact"})," docs"]})," for more information."]})]}),"\n",(0,a.jsxs)(t.h3,{id:"resource-targets",children:[(0,a.jsx)(t.code,{children:"resource"})," targets"]}),"\n",(0,a.jsxs)(t.p,{children:["To have your code ",(0,a.jsx)(t.a,{href:"https://docs.oracle.com/javase/8/docs/technotes/guides/lang/resources.html",children:'load files as "resources"'}),":"]}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Add a ",(0,a.jsx)(t.code,{children:"resource"})," or ",(0,a.jsx)(t.code,{children:"resources"})," target with the relevant files in the ",(0,a.jsx)(t.code,{children:"source"})," / ",(0,a.jsx)(t.code,{children:"sources"})," field, respectively."]}),"\n",(0,a.jsxs)(t.li,{children:["Ensure that ",(0,a.jsxs)(t.a,{href:"/2.16/docs/using-pants/key-concepts/source-roots",children:["an appropriate ",(0,a.jsx)(t.code,{children:"source_root"})]})," is detected for the ",(0,a.jsx)(t.code,{children:"resources"})," target, in order to trim the relevant prefix from the filename to align with the layout of your JVM packages."]}),"\n",(0,a.jsxs)(t.li,{children:["Add that target to the ",(0,a.jsx)(t.code,{children:"dependencies"})," field of the relevant JVM target (usually the one that uses the JVM APIs to load the resource)."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"For example:"}),"\n",(0,a.jsxs)(i.A,{groupId:"code-examples",children:[(0,a.jsx)(l.A,{value:"pants.toml",label:"pants.toml",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[source]\n# In order for the resource to be loadable as `org/pantsbuild/example/lib/hello.txt`,\n# the `/src/jvm/ prefix needs to be stripped.\nroot_patterns = ["/src/*"]\n'})})}),(0,a.jsx)(l.A,{value:"src/jvm/org/pantsbuild/example/lib/build",label:"src/jvm/org/pantsbuild/example/lib/BUILD",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"src/jvm/org/pantsbuild/example/lib/BUILD"}',children:'java_sources(dependencies=[":hello"])\n\nresources(name="hello", sources=["hello.txt"])\n'})})}),(0,a.jsx)(l.A,{value:"src/jvm/org/pantsbuild/example/lib/loader.java",label:"src/jvm/org/pantsbuild/example/lib/Loader.java",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",metastring:'tab={"label":"src/jvm/org/pantsbuild/example/lib/Loader.java"}',children:'package org.pantsbuild.example.lib;\n\nimport com.google.common.io.Resources;\n\npublic class Loader {\n  public static String load() {\n    ... = Resources.getResource(Loader.class, "hello.txt");\n  }\n}\n'})})}),(0,a.jsx)(l.A,{value:"src/jvm/org/pantsbuild/example/lib/hello.txt",label:"src/jvm/org/pantsbuild/example/lib/hello.txt",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-text",metastring:'tab={"label":"src/jvm/org/pantsbuild/example/lib/hello.txt"}',children:"Hello world!\n"})})})]}),"\n",(0,a.jsx)(t.h2,{id:"compile-code",children:"Compile code"}),"\n",(0,a.jsxs)(t.p,{children:["To manually check that sources compile, use ",(0,a.jsx)(t.code,{children:"pants check"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"# Check a single file\n\u276F pants check src/jvm/org/pantsbuild/example/lib/ExampleLib.java\n\n# Check files located recursively under a directory\n\u276F pants check src/jvm::\n\n# Check the whole repository\n\u276F pants check ::\n"})}),"\n",(0,a.jsx)(t.h2,{id:"run-tests",children:"Run tests"}),"\n",(0,a.jsxs)(t.p,{children:["To run tests, use ",(0,a.jsx)(t.code,{children:"pants test"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"# Run a single test file\n\u276F pants test tests/jvm/org/pantsbuild/example/lib/ExampleLibSpec.scala\n\n# Test all files in a directory\n\u276F pants test tests/jvm::\n\n# Test the whole repository\n\u276F pants test ::\n"})}),"\n",(0,a.jsxs)(t.p,{children:["You can also pass through arguments to the test runner with ",(0,a.jsx)(t.code,{children:"--"}),", e.g.:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"# Pass `-z hello` to scalatest in order to test a single method\n\u276F pants test tests/jvm/org/pantsbuild/example/lib/ExampleLibSpec.scala -- -z hello\n"})}),"\n",(0,a.jsx)(t.h3,{id:"timeouts",children:"Timeouts"}),"\n",(0,a.jsx)(t.p,{children:"Pants can cancel tests which take too long. This is useful to prevent tests from hanging indefinitely."}),"\n",(0,a.jsxs)(t.p,{children:["To add a timeout, set the ",(0,a.jsx)(t.code,{children:"timeout"})," field to an integer value of seconds in any of the supported targets, like this:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",metastring:'title="BUILD"',children:'java_junit_test(name="java_test", source="Test.java", timeout=120)\nscala_junit_test(name="scala_junit_test", source="Test.scala", timeout=100)\nscalatest_test(name="scalatest_test", source="Spec.scala", timeout=80)\n'})}),"\n",(0,a.jsxs)(t.p,{children:["When you set timeout on any of the target generators (i.e. ",(0,a.jsx)(t.code,{children:"java_junit_tests"}),", ",(0,a.jsx)(t.code,{children:"scalatest_tests"}),", etc.), the same timeout will apply to every generated corresponding target."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",metastring:'title="BUILD"',children:'java_junit_tests(\n    name="tests",\n    overrides={\n        "MyClass1Test.java": {"timeout": 20},\n        ("MyClass2Test.java", "MyClass3Test.java"): {"timeout": 35},\n    },\n)\n'})}),"\n",(0,a.jsxs)(t.p,{children:["You can also set a default value and a maximum value in ",(0,a.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:"[test]\ntimeout_default = 60\ntimeout_maximum = 600\n"})}),"\n",(0,a.jsxs)(t.p,{children:["If a target sets its ",(0,a.jsx)(t.code,{children:"timeout"})," higher than ",(0,a.jsx)(t.code,{children:"[test].timeout_maximum"}),", Pants will use the value in ",(0,a.jsx)(t.code,{children:"[test].timeout_maximum"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["Use the option ",(0,a.jsx)(t.code,{children:"pants test --no-timeouts"})," to temporarily disable timeouts, e.g. when debugging."]}),"\n",(0,a.jsx)(t.h3,{id:"setting-environment-variables",children:"Setting environment variables"}),"\n",(0,a.jsxs)(t.p,{children:["Test runs are ",(0,a.jsx)(t.em,{children:"hermetic"}),", meaning that they are stripped of the parent ",(0,a.jsx)(t.code,{children:"pants"})," process's environment variables. This is important for reproducibility, and it also increases cache hits."]}),"\n",(0,a.jsxs)(t.p,{children:["To add any arbitrary environment variable back to the process, you can either add the environment variable to the specific tests with the ",(0,a.jsx)(t.code,{children:"extra_env_vars"})," field on ",(0,a.jsx)(t.code,{children:"junit_test"})," / ",(0,a.jsx)(t.code,{children:"junit_tests"})," / ",(0,a.jsx)(t.code,{children:"scala_junit_test"})," / ",(0,a.jsx)(t.code,{children:"scala_junit_tests"})," / ",(0,a.jsx)(t.code,{children:"scalatest_test"})," / ",(0,a.jsx)(t.code,{children:"scalatest_tests"})," targets or to all your tests with the ",(0,a.jsx)(t.code,{children:"[test].extra_env_vars"})," option. Generally, prefer the field ",(0,a.jsx)(t.code,{children:"extra_env_vars"})," field so that more of your tests are hermetic."]}),"\n",(0,a.jsxs)(t.p,{children:["With both ",(0,a.jsx)(t.code,{children:"[test].extra_env_vars"})," and the ",(0,a.jsx)(t.code,{children:"extra_env_vars"}),' field, you can either hardcode a value or leave off a value to "allowlist" it and read from the parent ',(0,a.jsx)(t.code,{children:"pants"})," process's environment."]}),"\n",(0,a.jsxs)(i.A,{groupId:"code-examples",children:[(0,a.jsx)(l.A,{value:"pants.toml",label:"pants.toml",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[test]\nextra_env_vars = ["VAR1", "VAR2=hardcoded_value"]\n'})})}),(0,a.jsx)(l.A,{value:"project/build",label:"project/BUILD",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"project/BUILD"}',children:'junit_tests(\n    name="tests",\n    # Adds to all generated `junit_test` targets,\n    # i.e. each file in the `sources` field.\n    extra_env_vars=["VAR3", "VAR4=hardcoded"],\n    # Even better, use `overrides` to be more granular.\n    overrides={\n        "StrUtilTest.java": {"extra_env_vars": ["VAR"]},\n        ("DirUtilTest.java", "OSUtilTest.java"): {"extra_env_vars": ["VAR5"]},\n    },\n)\n'})})})]}),"\n",(0,a.jsx)(t.h2,{id:"protobuf",children:"Protobuf"}),"\n",(0,a.jsxs)(t.p,{children:["There's support for ",(0,a.jsx)(t.a,{href:"https://scalapb.github.io/",children:"ScalaPB"})," and ",(0,a.jsx)(t.a,{href:"https://developers.google.com/protocol-buffers/docs/reference/java-generated",children:"protoc Java generated code"}),", currently in beta stage. To enable them, activate the relevant backends in ",(0,a.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-toml",children:'[GLOBAL]\nbackend_packages = [\n    "pants.backend.experimental.codegen.protobuf.scala",\n    "pants.backend.experimental.codegen.protobuf.java",\n]\n'})}),"\n",(0,a.jsxs)(t.p,{children:["This adds the new ",(0,a.jsx)(t.code,{children:"protobuf_source"})," target, which you can confirm by running ",(0,a.jsx)(t.code,{children:"pants help protobuf_source"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"lint-and-format",children:"Lint and Format"}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"scalafmt"})," and ",(0,a.jsx)(t.code,{children:"Google Java Format"})," can be enabled by adding the ",(0,a.jsx)(t.code,{children:"pants.backend.experimental.scala.lint.scalafmt"})," and ",(0,a.jsx)(t.code,{children:"pants.backend.experimental.java.lint.google_java_format"})," backends (respectively) to ",(0,a.jsx)(t.code,{children:"backend_packages"})," in the ",(0,a.jsx)(t.code,{children:"[GLOBAL]"})," section of ",(0,a.jsx)(t.code,{children:"pants.toml"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["Once enabled, ",(0,a.jsx)(t.code,{children:"lint"})," and ",(0,a.jsx)(t.code,{children:"fmt"})," will check and automatically reformat your code:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"# Format this directory and all subdirectories\n\u276F pants fmt src/jvm::\n\n# Check that the whole project is formatted\n\u276F pants lint ::\n\n# Format all changed files\n\u276F pants --changed-since=HEAD fmt\n"})}),"\n",(0,a.jsx)(t.h2,{id:"working-in-an-ide",children:"Working in an IDE"}),"\n",(0,a.jsxs)(t.p,{children:["Pants supports loading Java and Scala projects in IntelliJ via the ",(0,a.jsx)(t.a,{href:"https://build-server-protocol.github.io/",children:"BSP protocol"})," (which should ease VSCode support ",(0,a.jsx)(t.a,{href:"https://scalameta.org/metals/docs/editors/vscode",children:"via Metals"}),", although it is not yet supported)."]}),"\n",(0,a.jsx)(t.h3,{id:"usage",children:"Usage"}),"\n",(0,a.jsx)(t.p,{children:"After Setup (see below), and after IntelliJ has finished indexing your code, you should be able to:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Use goto definition and other symbol-index-using operations."}),"\n",(0,a.jsx)(t.li,{children:"Run test classes, which will first compile them will Pants (and render compile failures if not), and then run them in the foreground with IntelliJ's test runner."}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"setup",children:"Setup"}),"\n",(0,a.jsx)(t.h4,{id:"first-time-setup-per-repository",children:"First time setup (per-repository)"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Use a version of Pants containing BSP support:","\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Versions after ",(0,a.jsx)(t.code,{children:"2.12.0a0"})," support code indexing."]}),"\n",(0,a.jsxs)(t.li,{children:["Versions after ",(0,a.jsx)(t.code,{children:"2.13.0.dev2"})," support test running."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["Add a ",(0,a.jsx)(t.code,{children:".gitignore"})," entry for the ",(0,a.jsx)(t.code,{children:".bsp"})," directory:"]}),"\n"]}),"\n",(0,a.jsxs)(i.A,{groupId:"code-examples",children:[(0,a.jsx)(l.A,{value:".gitignore",label:".gitignore",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-text",metastring:'tab={"label":".gitignore"}',children:"# This directory is not committed: each BSP user will create it independently.\n/.bsp/\n"})})}),(0,a.jsx)(l.A,{value:"...",label:"...",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-text",metastring:'tab={"label":"..."}'})})})]}),"\n",(0,a.jsxs)(t.ol,{start:"3",children:["\n",(0,a.jsx)(t.li,{children:'Add a "group" config file like the one below, adjusting the address specs and resolve name as appropriate.'}),"\n"]}),"\n",(0,a.jsxs)(i.A,{groupId:"code-examples",children:[(0,a.jsx)(l.A,{value:"bsp-groups.toml",label:"bsp-groups.toml",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-toml",metastring:'tab={"label":"bsp-groups.toml"}',children:'# A "group" named `default`.\n# Multiple groups are supported: consider creating a group per project or team.\n[groups.default]\naddresses = [\n  "src/jvm::",\n  "tests/jvm::",\n]\n\nresolve = "jvm:jvm-default"\n'})})}),(0,a.jsx)(l.A,{value:"...",label:"...",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-text",metastring:'tab={"label":"..."}'})})})]}),"\n",(0,a.jsxs)(t.ol,{start:"4",children:["\n",(0,a.jsxs)(t.li,{children:["Add to ",(0,a.jsx)(t.code,{children:"pants.toml"})," an option to point at the BSP configuration file:"]}),"\n"]}),"\n",(0,a.jsxs)(i.A,{groupId:"code-examples",children:[(0,a.jsx)(l.A,{value:"pants.toml",label:"pants.toml",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[experimental-bsp]\ngroups_config_files = ["bsp-groups.toml"]\n'})})}),(0,a.jsx)(l.A,{value:"...",label:"...",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-text",metastring:'tab={"label":"..."}'})})})]}),"\n",(0,a.jsx)(t.h4,{id:"per-user-setup",children:"Per-user setup"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsx)(t.li,{children:"Run pants experimental-bsp to write the BSP connection file and script."}),"\n",(0,a.jsx)(t.li,{children:"Ensure that you have the IntelliJ Scala plugin installed (it provides BSP support)."}),"\n",(0,a.jsxs)(t.li,{children:["In IntelliJ, choose ",(0,a.jsx)(t.code,{children:"File > New > Project from Existing Sources\u2026"})]}),"\n",(0,a.jsx)(t.li,{children:"Choose the root of the repository for the project from the file dialog."}),"\n",(0,a.jsx)(t.li,{children:'In the "Import Project" dialog, choose "Import project from external model" and select "BSP."'}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:"https://files.readme.io/47ad6e7-Screen_Shot_2022-05-13_at_09.40.33.png",alt:""})}),"\n",(0,a.jsxs)(t.ol,{start:"6",children:["\n",(0,a.jsx)(t.li,{children:'Click "Create".'}),"\n",(0,a.jsx)(t.li,{children:"IntelliJ will invoke Pants to run the BSP server and synchronize state to produce IntelliJ modules."}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["If you see errors related to missing tools, you can set additional environment variables for BSP invocations in ",(0,a.jsx)(t.code,{children:"pants.toml"})," under the ",(0,a.jsx)(t.code,{children:"[experimental-bsp].runner_env_vars"})," option, and then re-run ",(0,a.jsx)(t.code,{children:"pants experimental-bsp"}),".","\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["This is necessary because IntelliJ is invoked on macOS generally by launchd and not from the shell. Any ",(0,a.jsx)(t.code,{children:"PATH"})," set in the shell will not be passed to the Pants BSP server in that case."]}),"\n",(0,a.jsxs)(t.li,{children:["If this is developer-specific, consider setting ",(0,a.jsx)(t.code,{children:"--experimental-bsp-runner-env-args"})," as a command-line option, or using a ",(0,a.jsx)(t.code,{children:".pantsrc"})," file."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["After configuration changes, or after adding new thirdparty dependencies, you will generally need to reload the BSP configuration (",(0,a.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/issues/15054",children:"for now"}),"), which you can do with this button in the side panel:"]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:"https://files.readme.io/b6db23d-Screen_Shot_2022-05-13_at_09.50.28.png",alt:""})}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["When filing bug reports, include the log output of the Pants instance hosting the BSP server, which goes to ",(0,a.jsx)(t.code,{children:".pants.d/bsp/logs/stderr.log"}),"."]}),"\n"]})]})}function p(e={}){let{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},753348(e,t,n){n.d(t,{A:()=>s});let s={tabItem:"tabItem_mHvh"}},618264(e,t,n){n.d(t,{A:()=>s});let s={tabList:"tabList_sFbf",tabItem:"tabItem_UVfV"}},637180(e,t,n){n.d(t,{A:()=>i});var s=n(886070);n(830758);var a=n(313526),r=n(753348);function i({children:e,hidden:t,className:n}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.A)(r.A.tabItem,n),hidden:t,children:e})}},685008(e,t,n){n.d(t,{A:()=>m});var s=n(886070),a=n(830758),r=n(313526),i=n(911212),l=n(274875),o=n(106632),c=n(189223),d=n(618264);function h({className:e,block:t,selectedValue:n,selectValue:a,tabValues:i}){let o=[],{blockElementScrollPositionUntilNextRender:c}=(0,l.a_)(),h=e=>{let t=e.currentTarget,s=i[o.indexOf(t)].value;s!==n&&(c(t),a(s))},u=e=>{let t=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{let n=o.indexOf(e.currentTarget)+1;t=o[n]??o[0];break}case"ArrowLeft":{let n=o.indexOf(e.currentTarget)-1;t=o[n]??o[o.length-1]}}t?.focus()};return(0,s.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},e),children:i.map(({value:e,label:t,attributes:a})=>(0,s.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{o.push(e)},onKeyDown:u,onClick:h,...a,className:(0,r.A)("tabs__item",d.A.tabItem,a?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function u({lazy:e,children:t,selectedValue:n}){let i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){let e=i.find(e=>e.props.value===n);return e?(0,a.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,s.jsx)("div",{className:"margin-top--md",children:i.map((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function p(e){let t=(0,o.u)(e);return(0,s.jsxs)("div",{className:(0,r.A)(i.G.tabs.container,"tabs-container",d.A.tabList),children:[(0,s.jsx)(h,{...t,...e}),(0,s.jsx)(u,{...t,...e})]})}function m(e){let t=(0,c.A)();return(0,s.jsx)(p,{...e,children:(0,o.v)(e.children)},String(t))}},106632(e,t,n){n.d(t,{u:()=>h,v:()=>c});var s=n(830758),a=n(325557),r=n(363717),i=n(125740),l=n(574229),o=n(270367);function c(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function d({value:e,tabValues:t}){return t.some(t=>t.value===e)}function h(e){let t,{defaultValue:n,queryString:h=!1,groupId:u}=e,p=function(e){let{values:t,children:n}=e;return(0,s.useMemo)(()=>{let e=t??c(n).map(({props:{value:e,label:t,attributes:n,default:s}})=>({value:e,label:t,attributes:n,default:s})),s=(0,l.XI)(e,(e,t)=>e.value===t.value);if(s.length>0)throw Error(`Docusaurus error: Duplicate values "${s.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[t,n])}(e),[m,j]=(0,s.useState)(()=>(function({defaultValue:e,tabValues:t}){if(0===t.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!d({value:e,tabValues:t}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let n=t.find(e=>e.default)??t[0];if(!n)throw Error("Unexpected error: 0 tabValues");return n.value})({defaultValue:n,tabValues:p})),[x,g]=function({queryString:e=!1,groupId:t}){let n=(0,a.W6)(),r=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,i.aZ)(r),(0,s.useCallback)(e=>{if(!r)return;let t=new URLSearchParams(n.location.search);t.set(r,e),n.replace({...n.location,search:t.toString()})},[r,n])]}({queryString:h,groupId:u}),[v,f]=function({groupId:e}){let t=e?`docusaurus.tab.${e}`:null,[n,a]=(0,o.Dv)(t);return[n,(0,s.useCallback)(e=>{t&&a.set(e)},[t,a])]}({groupId:u}),b=d({value:t=x??v,tabValues:p})?t:null;return(0,r.A)(()=>{b&&j(b)},[b]),{selectedValue:m,selectValue:(0,s.useCallback)(e=>{if(!d({value:e,tabValues:p}))throw Error(`Can't select invalid tab value=${e}`);j(e),g(e),f(e)},[g,f,p]),tabValues:p}}},848193(e,t,n){n.d(t,{R:()=>i,x:()=>l});var s=n(830758);let a={},r=s.createContext(a);function i(e){let t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:t},e.children)}},427550(e){e.exports=JSON.parse('{"id":"docs/java-and-scala/index","title":"Java and Scala overview","description":"Pants\'s support for Java and Scala.","source":"@site/versioned_docs/version-2.16/docs/java-and-scala/index.mdx","sourceDirName":"docs/java-and-scala","slug":"/docs/java-and-scala/","permalink":"/2.16/docs/java-and-scala/","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/java-and-scala/index.mdx","tags":[],"version":"2.16","sidebarPosition":0,"frontMatter":{"title":"Java and Scala overview","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Protobuf","permalink":"/2.16/docs/go/integrations/protobuf"},"next":{"title":"Kotlin","permalink":"/2.16/docs/java-and-scala/kotlin"}}')}}]);