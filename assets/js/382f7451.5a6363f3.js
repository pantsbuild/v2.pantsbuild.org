"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["952418"],{900723(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var o=n(422694),s=n(886070),i=n(848193);let r={title:"Setting up Pants",sidebar_position:0},l,d={},c=[{value:"Step 1: Fork and clone <code>pantsbuild/pants</code>",id:"step-1-fork-and-clone-pantsbuildpants",level:2},{value:"Step 2: Set up Git hooks",id:"step-2-set-up-git-hooks",level:2},{value:"Step 3: Bootstrap the Rust engine",id:"step-3-bootstrap-the-rust-engine",level:2},{value:"Configure your IDE (optional)",id:"configure-your-ide-optional",level:2},{value:"Hooking up the Python virtual environment",id:"hooking-up-the-python-virtual-environment",level:3},{value:"PyCharm guide",id:"pycharm-guide",level:3},{value:"VSCode guide",id:"vscode-guide",level:3}];function a(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"How to set up Pants for local development."}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.h2,{id:"step-1-fork-and-clone-pantsbuildpants",children:["Step 1: Fork and clone ",(0,s.jsx)(t.code,{children:"pantsbuild/pants"})]}),"\n",(0,s.jsxs)(t.p,{children:["We use the popular forking workflow typically used by open source projects. See ",(0,s.jsx)(t.a,{href:"https://guides.github.com/activities/forking/",children:"https://guides.github.com/activities/forking/"})," for a guide on how to fork ",(0,s.jsx)(t.a,{href:"https://github.com/pantsbuild/pants",children:"pantsbuild/pants"}),", then clone it to your local machine."]}),"\n",(0,s.jsxs)(t.admonition,{type:"caution",children:[(0,s.jsxs)(t.mdxAdmonitionTitle,{children:["macOS users: install a newer ",(0,s.jsx)(t.code,{children:"openssl"})]}),(0,s.jsx)(t.p,{children:"Pants requires a more modern OpenSSL version than the one that comes with macOS. To get all dependencies to resolve correctly, run these commands:"}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ brew install openssl\n$ echo 'export PATH=\"/usr/local/opt/openssl/bin:$PATH\"' >> ~/.bashrc\n$ echo 'export LDFLAGS=\"-L/usr/local/opt/openssl/lib\"' >> ~/.bashrc\n$ echo 'export CPPFLAGS=\"-I/usr/local/opt/openssl/include\"' >> ~/.bashrc\n"})}),(0,s.jsxs)(t.p,{children:["(If you don't have ",(0,s.jsx)(t.code,{children:"brew"})," installed, see ",(0,s.jsx)(t.a,{href:"https://brew.sh",children:"https://brew.sh"}),".)"]})]}),"\n",(0,s.jsx)(t.h2,{id:"step-2-set-up-git-hooks",children:"Step 2: Set up Git hooks"}),"\n",(0,s.jsxs)(t.p,{children:["We use two ",(0,s.jsx)(t.a,{href:"https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks",children:"Git hooks"}),":"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["If you didn't touch any Rust code, we add ",(0,s.jsx)(t.code,{children:"[ci skip-rust]"})," to your commit message. If you didn't touch any of our release-related code, we add ",(0,s.jsx)(t.code,{children:"[ci skip-build-wheels]"})," to your commit message."]}),"\n",(0,s.jsxs)(t.li,{children:["Every time you run ",(0,s.jsx)(t.code,{children:"git commit"}),", we run some checks and lints."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"To install these, run:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ build-support/bin/setup.sh\n"})}),"\n",(0,s.jsx)(t.p,{children:"You can manually run the pre-commit check by running:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ build-support/githooks/pre-commit\n"})}),"\n",(0,s.jsxs)(t.admonition,{title:"How to temporarily skip the pre-commit checks",type:"note",children:[(0,s.jsxs)(t.p,{children:["Use ",(0,s.jsx)(t.code,{children:"git commit --no-verify"})," to skip the checks."]}),(0,s.jsx)(t.p,{children:"We do not recommend this, though! The Python formatter Black frequently needs to make changes, and you'll need to do an entire new CI run if there are any formatting or linting issues."})]}),"\n",(0,s.jsx)(t.h2,{id:"step-3-bootstrap-the-rust-engine",children:"Step 3: Bootstrap the Rust engine"}),"\n",(0,s.jsxs)(t.p,{children:["Pants uses Rustup to install Rust. Run the command from ",(0,s.jsx)(t.a,{href:"https://rustup.rs",children:"https://rustup.rs"})," to install Rustup; ensure that ",(0,s.jsx)(t.code,{children:"rustup"})," is on your ",(0,s.jsx)(t.code,{children:"$PATH"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Then, run ",(0,s.jsx)(t.code,{children:"./pants"})," to set up the Python virtual environment and compile the engine."]}),"\n",(0,s.jsxs)(t.admonition,{title:"This will take several minutes",type:"caution",children:[(0,s.jsx)(t.p,{children:"Rust compilation is really slow. Fortunately, this step gets cached, so you will only need to wait the first time."}),(0,s.jsxs)(t.p,{children:["If this takes more than 25 minutes, please comment on ",(0,s.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/issues/9822",children:"https://github.com/pantsbuild/pants/issues/9822"})," with the time it took for you to compile. (It's extra helpful if you are willing to share your CPU's speed and # of cores.)"]})]}),"\n",(0,s.jsxs)(t.admonition,{title:"Want a faster compile?",type:"note",children:[(0,s.jsxs)(t.p,{children:["We default to compiling with Rust's ",(0,s.jsx)(t.code,{children:"release"})," mode, instead of its ",(0,s.jsx)(t.code,{children:"debug"})," mode, because this makes Pants substantially faster. However, this results in the compile taking 5-10x longer."]}),(0,s.jsxs)(t.p,{children:["If you are okay with Pants running much slower when iterating, set the environment variable ",(0,s.jsx)(t.code,{children:"MODE=debug"})," and rerun ",(0,s.jsx)(t.code,{children:"./pants"})," to compile in debug mode."]})]}),"\n",(0,s.jsxs)(t.admonition,{title:"Rust compilation can use lots of storage",type:"caution",children:[(0,s.jsx)(t.p,{children:"Compiling the engine typically results in several gigabytes of storage over time. We have not yet implemented automated garbage collection for building the engine because contributors are the only ones to need to compile Rust, not every-day users."}),(0,s.jsxs)(t.p,{children:["To free up space, run ",(0,s.jsx)(t.code,{children:"rm -rf src/rust/engine/target"}),"."]}),(0,s.jsx)(t.p,{children:"Warning: this will cause Rust to recompile everything."})]}),"\n",(0,s.jsx)(t.h2,{id:"configure-your-ide-optional",children:"Configure your IDE (optional)"}),"\n",(0,s.jsx)(t.h3,{id:"hooking-up-the-python-virtual-environment",children:"Hooking up the Python virtual environment"}),"\n",(0,s.jsxs)(t.p,{children:["Most IDEs allow you to configure a Python ",(0,s.jsx)(t.a,{href:"https://docs.python.org/3/tutorial/venv.html",children:"virtual environment"})," so that the editor understands your Python import statements."]}),"\n",(0,s.jsxs)(t.p,{children:["Pants sets up its development virtualenv at ",(0,s.jsx)(t.code,{children:"~/.cache/pants/pants_dev_deps/<arch>.<version>.venv/"}),". Point your editor to the ",(0,s.jsx)(t.code,{children:"bin/python"})," file in this folder, e.g. ",(0,s.jsx)(t.code,{children:"~/.cache/pants/pants_dev_deps/Darwin.py37.venv/bin/python"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"pycharm-guide",children:"PyCharm guide"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:'Use "New project" and click the option "Existing interpreter". Point the interpreter to the virtual environment location described above.'}),"\n",(0,s.jsxs)(t.li,{children:["In your project tree (the list of folders and files), secondary-click the folder ",(0,s.jsx)(t.code,{children:"src/python"}),'. Click "Mark directory as" and choose "Sources".']}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"vscode-guide",children:"VSCode guide"}),"\n",(0,s.jsxs)(t.p,{children:["Add this to your ",(0,s.jsx)(t.code,{children:"settings.json"})," file inside the build root's ",(0,s.jsx)(t.code,{children:".vscode"})," folder:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",metastring:'title="settings.json"',children:'{\n  "python.analysis.extraPaths": ["src/python"],\n  "python.formatting.provider": "black",\n  "python.linting.enabled": true,\n  "python.linting.flake8Enabled": true,\n  "python.linting.flake8Args": ["--config=build-support/flake8/.flake8"]\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"python.analysis.extraPaths"})," lets VSCode know where to find Pants's source root. The other config enables ",(0,s.jsx)(t.code,{children:"black"})," and ",(0,s.jsx)(t.code,{children:"flake8"}),"."]}),"\n",(0,s.jsx)(t.admonition,{title:"Help us to document how to set up your favorite editor",type:"tip",children:(0,s.jsxs)(t.p,{children:['We\'d love your help. You can either click "Suggest edits" in the top right corner of this page or message us on ',(0,s.jsx)(t.a,{href:"/community/members",children:"Slack"}),"."]})})]})}function h(e={}){let{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},848193(e,t,n){n.d(t,{R:()=>r,x:()=>l});var o=n(830758);let s={},i=o.createContext(s);function r(e){let t=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(i.Provider,{value:t},e.children)}},422694(e){e.exports=JSON.parse('{"id":"docs/contributions/development/setting-up-pants","title":"Setting up Pants","description":"How to set up Pants for local development.","source":"@site/versioned_docs/version-2.8/docs/contributions/development/setting-up-pants.mdx","sourceDirName":"docs/contributions/development","slug":"/docs/contributions/development/setting-up-pants","permalink":"/2.8/docs/contributions/development/setting-up-pants","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/contributions/development/setting-up-pants.mdx","tags":[],"version":"2.8","sidebarPosition":0,"frontMatter":{"title":"Setting up Pants","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Development","permalink":"/2.8/docs/contributions/development/"},"next":{"title":"Style guide","permalink":"/2.8/docs/contributions/development/style-guide"}}')}}]);