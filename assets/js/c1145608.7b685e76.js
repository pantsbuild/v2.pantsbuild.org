"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["676990"],{375752(e,n,o){o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>t,toc:()=>d});var t=o(977796),s=o(886070),r=o(848193);let i={authors:["eric"],tags:["codegen"]},a="Pants 2.2 adds dependency inference for Protobuf",l={authorsImageUrls:[void 0]},d=[{value:"WTH is Pants?",id:"wth-is-pants",level:3},{value:"How it works",id:"how-it-works",level:2},{value:"Trying out Pants",id:"trying-out-pants",level:2}];function c(e){let n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components},{CaptionedImg:t}=n;return t||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CaptionedImg",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t,{src:o(248968).A,children:(0,s.jsxs)(n.p,{children:["Photo by ",(0,s.jsx)(n.a,{href:"https://unsplash.com/@simonfromengland?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Simon\nWilkes"}),"\n/\n",(0,s.jsx)(n.a,{href:"https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Unsplash"})]})}),"\n",(0,s.jsx)(n.p,{children:"As of Pants 2.2, Pants now knows how to use dependency inference with Protobuf! This includes:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Protobuf imports of other Protobuf files"}),"\n",(0,s.jsx)(n.li,{children:"Python imports of generated Protobuf code, including gRPC."}),"\n"]}),"\n","\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["As discussed ",(0,s.jsx)(n.a,{href:"/blog/2020/10/29/dependency-inference",children:"in our post on dependency inference"}),", Pants understands which files depend on which to offer fine-grained caching. If none of the inputs have changed, Pants can safely cache your builds like running tests and generating code."]}),"\n",(0,s.jsxs)(n.p,{children:["With conventional scalable build tools, this fine-grained invalidation requires substantial boilerplate: maintaining BUILD files that explicitly declare every dependency. Instead, Pants uses ",(0,s.jsx)(n.em,{children:"dependency inference"})," to reduce this boilerplate by up to 90% by reading your code and figuring out the dependencies for you."]}),"\n",(0,s.jsxs)(n.p,{children:["As of Pants 2.2, Pants now knows how to use dependency inference with ",(0,s.jsx)(n.a,{href:"https://developers.google.com/protocol-buffers/",children:"Protobuf"}),"! This includes:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Protobuf imports of other Protobuf files."}),"\n",(0,s.jsx)(n.li,{children:"Python imports of generated Protobuf code, including gRPC."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["While Pants currently only generates code with Protobuf, we are eager to work with ",(0,s.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/community",children:"community members"})," to support other protocols like Apache Thrift."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"wth-is-pants",children:"WTH is Pants?"}),"\n",(0,s.jsx)(n.p,{children:"Pants is a scalable build tool, meaning that it orchestrates the tools you use in a modern Python repository, like Black, Pytest, Protoc (Protobufs), and setuptools. Pants will run these and many other tools concurrently, and brings fine-grained caching with minimal boilerplate, including as your codebase scales up in size."}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"/blog/2020/10/27/introducing-pants-v2",children:"our blog post introducting Pants v2/"}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,s.jsxs)(n.p,{children:["Pants will first look at your repository's code layout and your Protobuf and Python file names to develop a global mapping. For example, we know that ",(0,s.jsx)(n.code,{children:"protos/project/models.proto"})," corresponds to the Protobuf import ",(0,s.jsx)(n.code,{children:"project/models.proto"})," and the Python modules ",(0,s.jsx)(n.code,{children:"project.models_pb2"})," and (possibly) ",(0,s.jsx)(n.code,{children:"project.models_pb2_grpc"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"With this global mapping computed, Pants then parses the relevant files to extract their import statements and look up the corresponding owner, if any."}),"\n",(0,s.jsx)(n.p,{children:"For example, given this Proto:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-protobuf",children:'// protos/build/remote/execution/remote_execution.proto\npackage build.remote.execution;\n\nimport "build/semver/semver.proto";\nimport "google/api/annotations.proto";\nimport "google/rpc/status.proto";\nimport "google/protobuf/duration.proto";\n'})}),"\n",(0,s.jsx)(n.p,{children:"Pants infers dependencies on the correct Protobuf files:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell-session",children:"$ ./pants dependencies protos/build/remote/execution/remote_execution.proto\nprotos/build/semver/semver.proto\nprotos/google/api/annotations.proto\nprotos/google/rpc/status.proto\nprotos/google/protobuf/duration.proto\n"})}),"\n",(0,s.jsx)(n.p,{children:"Pants will also understand Python imports of these Protobuf files, normalizing their full paths into Python module names:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# src/py/project/app.py\nimport build.semver.semver_pb2\nimport google.api.annotations_pb2_grpc\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell-session",children:"$ ./pants dependencies src/py/project/app.py\nprotos/build/semver/semver.proto\nprotos/google/api/annotations.proto\n"})}),"\n",(0,s.jsxs)(n.p,{children:["As discussed in ",(0,s.jsx)(n.a,{href:"/blog/2021/02/01/fast-incremental-builds-speculation-cancellation",children:"our post on Pants's performance"}),", this inference is 1) very safe and 2) very fast. Because Pants invokes processes hermetically with a sandbox, failing to infer a dependency can never cause the wrong thing to be cached. Further, the inference is fast thanks to Pants's core being implemented in Rust, along with a daemon, parallelism, and very fine-grained invalidation."]}),"\n",(0,s.jsx)(n.h2,{id:"trying-out-pants",children:"Trying out Pants"}),"\n",(0,s.jsx)(n.p,{children:"Using Pants ensures that your builds always use your up-to-date Protobuf code\u2014no more need to manually invoke scripts! Further, thanks to Pants's fine-grained understanding of your project's dependencies, you will only ever generate the Protobuf files you actually need."}),"\n",(0,s.jsxs)(n.p,{children:["We optimized Pants to be easy to ",(0,s.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/existing-repositories",children:"add incrementally to existing repositories"}),", including an upcoming feature in Pants 2.3 to auto-generate BUILD files (stay tuned for a blog post!)."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/community",children:"Pants community"})," would love to help you get started. ",(0,s.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.1/docs",children:"www.pantsbuild.org/docs"})]})]})}function p(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},248968(e,n,o){o.d(n,{A:()=>t});let t=o.p+"assets/images/splash-6e08e7b6591760be5c13de8702a79286.jpg"},848193(e,n,o){o.d(n,{R:()=>i,x:()=>a});var t=o(830758);let s={},r=t.createContext(s);function i(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(r.Provider,{value:n},e.children)}},977796(e){e.exports=JSON.parse('{"permalink":"/blog/2021/02/22/pants-2-2-adds-dependency-inference-for-protobuf","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-02-22-pants-2-2-adds-dependency-inference-for-protobuf/index.mdx","source":"@site/blog/2021-02-22-pants-2-2-adds-dependency-inference-for-protobuf/index.mdx","title":"Pants 2.2 adds dependency inference for Protobuf","description":"Photo by [Simon","date":"2021-02-22T00:00:00.000Z","tags":[{"inline":true,"label":"codegen","permalink":"/blog/tags/codegen"}],"readingTime":3.15,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["codegen"]},"unlisted":false,"prevItem":{"title":"Tailoring Pants to your codebase","permalink":"/blog/2021/03/19/tailoring-pants-to-your-codebase"},"nextItem":{"title":"fast-incremental-builds-speculation-cancellation","permalink":"/blog/2021/02/01/fast-incremental-builds-speculation-cancellation"}}')}}]);