"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["372120"],{484086(e,t,n){n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>h});var s=n(776521),r=n(886070),i=n(848193),o=n(989898),d=n(375002);let c={title:"shell_command",description:"Execute any external tool for its side effects.\n"},l,a={},h=[{value:"<code>command</code>",id:"command",level:2},{value:"<code>description</code>",id:"description",level:2},{value:"<code>environment</code>",id:"environment",level:2},{value:"<code>execution_dependencies</code>",id:"execution_dependencies",level:2},{value:"<code>extra_env_vars</code>",id:"extra_env_vars",level:2},{value:"<code>log_output</code>",id:"log_output",level:2},{value:"<code>output_dependencies</code>",id:"output_dependencies",level:2},{value:"<code>output_directories</code>",id:"output_directories",level:2},{value:"<code>output_files</code>",id:"output_files",level:2},{value:"<code>root_output_directory</code>",id:"root_output_directory",level:2},{value:"<code>runnable_dependencies</code>",id:"runnable_dependencies",level:2},{value:"<code>tags</code>",id:"tags",level:2},{value:"<code>timeout</code>",id:"timeout",level:2},{value:"<code>tools</code>",id:"tools",level:2},{value:"<code>workdir</code>",id:"workdir",level:2}];function u(e){let t={code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.p,{children:"Execute any external tool for its side effects."}),"\n",(0,r.jsx)(t.p,{children:"Example BUILD file:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'shell_command(\n    command="./my-script.sh --flag",\n    tools=["tar", "curl", "cat", "bash", "env"],\n    execution_dependencies=[":scripts"],\n    output_files=["logs/my-script.log"],\n    output_directories=["results"],\n)\n\nshell_sources(name="scripts")\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Remember to add this target to the dependencies of each consumer, such as your ",(0,r.jsx)(t.code,{children:"python_tests"})," or ",(0,r.jsx)(t.code,{children:"docker_image"}),". When relevant, Pants will run your ",(0,r.jsx)(t.code,{children:"command"})," and insert the ",(0,r.jsx)(t.code,{children:"outputs"})," into that consumer's context."]}),"\n",(0,r.jsx)(t.p,{children:"The command may be retried and/or cancelled, so ensure that it is idempotent."}),"\n",(0,r.jsxs)(t.p,{children:["Backend: ",(0,r.jsx)("span",{className:"color--primary",children:(0,r.jsx)(t.code,{children:"pants.backend.shell"})})]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsxs)("span",{className:d.A.options,children:[(0,r.jsx)(t.h2,{id:"command",children:(0,r.jsx)(t.code,{children:"command"})}),(0,r.jsxs)(o.A,{type_repr:"str",children:[(0,r.jsx)(t.p,{children:"Shell command to execute."}),(0,r.jsxs)(t.p,{children:["The command is executed as 'bash -c <command>' by default. If you want to invoke a binary use ",(0,r.jsx)(t.code,{children:"exec -a $0 <binary> <args>"})," as the command so that the binary gets the correct ",(0,r.jsx)(t.code,{children:"argv[0]"})," set."]})]}),(0,r.jsx)(t.h2,{id:"description",children:(0,r.jsx)(t.code,{children:"description"})}),(0,r.jsxs)(o.A,{type_repr:"str | None",default_repr:"None",children:[(0,r.jsx)(t.p,{children:"A human-readable description of the target."}),(0,r.jsxs)(t.p,{children:["Use ",(0,r.jsx)(t.code,{children:"pants list --documented ::"})," to see all targets with descriptions."]})]}),(0,r.jsx)(t.h2,{id:"environment",children:(0,r.jsx)(t.code,{children:"environment"})}),(0,r.jsxs)(o.A,{type_repr:"str | None",default_repr:"'__local__'",children:[(0,r.jsx)(t.p,{children:"Specify which environment target to consume environment-sensitive options from."}),(0,r.jsxs)(t.p,{children:["Once environments are defined in ",(0,r.jsx)(t.code,{children:"[environments-preview].names"}),", you can specify the environment for this target by its name. Any fields that are defined in that environment will override the values from options set by ",(0,r.jsx)(t.code,{children:"pants.toml"}),", command line values, or environment variables."]}),(0,r.jsxs)(t.p,{children:["You can specify multiple valid environments by using ",(0,r.jsx)(t.code,{children:"parametrize"}),". If ",(0,r.jsx)(t.code,{children:"__local__"})," is specified, Pants will fall back to the ",(0,r.jsx)(t.code,{children:"local_environment"})," defined for the current platform, or no environment if no such environment exists."]})]}),(0,r.jsx)(t.h2,{id:"execution_dependencies",children:(0,r.jsx)(t.code,{children:"execution_dependencies"})}),(0,r.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"None",children:[(0,r.jsx)(t.p,{children:"The execution dependencies for this command."}),(0,r.jsxs)(t.p,{children:["Dependencies specified here are those required to make the command complete successfully (e.g. file inputs, packages compiled from other targets, etc), but NOT required to make the output side-effects useful. Dependencies that are required to use the side-effects produced by this command should be specified using the ",(0,r.jsx)(t.code,{children:"output_dependencies"})," field."]}),(0,r.jsxs)(t.p,{children:["If this field is specified, dependencies from ",(0,r.jsx)(t.code,{children:"output_dependencies"})," will not be added to the execution sandbox."]}),(0,r.jsxs)(t.p,{children:["See also ",(0,r.jsx)(t.code,{children:"output_dependencies"})," and ",(0,r.jsx)(t.code,{children:"runnable_dependencies"}),"."]})]}),(0,r.jsx)(t.h2,{id:"extra_env_vars",children:(0,r.jsx)(t.code,{children:"extra_env_vars"})}),(0,r.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"None",children:[(0,r.jsx)(t.p,{children:"Additional environment variables to provide to the process."}),(0,r.jsxs)(t.p,{children:["Entries are strings in the form ",(0,r.jsx)(t.code,{children:"ENV_VAR=value"})," to use explicitly; or just ",(0,r.jsx)(t.code,{children:"ENV_VAR"})," to copy the value of a variable in Pants's own environment."]})]}),(0,r.jsx)(t.h2,{id:"log_output",children:(0,r.jsx)(t.code,{children:"log_output"})}),(0,r.jsx)(o.A,{type_repr:"bool",default_repr:"False",children:(0,r.jsx)(t.p,{children:"Set to true if you want the output logged to the console."})}),(0,r.jsx)(t.h2,{id:"output_dependencies",children:(0,r.jsx)(t.code,{children:"output_dependencies"})}),(0,r.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"None",children:[(0,r.jsx)(t.p,{children:"Any dependencies that the output artifacts require in order to be effectively consumed."}),(0,r.jsxs)(t.p,{children:["To enable legacy use cases, if ",(0,r.jsx)(t.code,{children:"execution_dependencies"})," is ",(0,r.jsx)(t.code,{children:"None"}),", these dependencies will be materialized in the execution sandbox. This behavior is deprecated, and will be removed in version 2.17.0.dev0."]}),(0,r.jsxs)(t.p,{children:["See also ",(0,r.jsx)(t.code,{children:"execution_dependencies"})," and ",(0,r.jsx)(t.code,{children:"runnable_dependencies"}),"."]})]}),(0,r.jsx)(t.h2,{id:"output_directories",children:(0,r.jsx)(t.code,{children:"output_directories"})}),(0,r.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"()",children:[(0,r.jsxs)(t.p,{children:["Specify full directories (including recursive descendants) of output to capture, relative to the value of ",(0,r.jsx)(t.code,{children:"workdir"}),"."]}),(0,r.jsxs)(t.p,{children:["For individual files, use ",(0,r.jsx)(t.code,{children:"output_files"}),". At least one of ",(0,r.jsx)(t.code,{children:"output_files"})," and",(0,r.jsx)(t.code,{children:"output_directories"})," must be specified."]}),(0,r.jsxs)(t.p,{children:["Relative paths (including ",(0,r.jsx)(t.code,{children:".."}),") may be used, as long as the path does not ascend further than the build root."]})]}),(0,r.jsx)(t.h2,{id:"output_files",children:(0,r.jsx)(t.code,{children:"output_files"})}),(0,r.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"()",children:[(0,r.jsxs)(t.p,{children:["Specify the output files to capture, relative to the value of ",(0,r.jsx)(t.code,{children:"workdir"}),"."]}),(0,r.jsxs)(t.p,{children:["For directories, use ",(0,r.jsx)(t.code,{children:"output_directories"}),". At least one of ",(0,r.jsx)(t.code,{children:"output_files"})," and",(0,r.jsx)(t.code,{children:"output_directories"})," must be specified."]}),(0,r.jsxs)(t.p,{children:["Relative paths (including ",(0,r.jsx)(t.code,{children:".."}),") may be used, as long as the path does not ascend further than the build root."]})]}),(0,r.jsx)(t.h2,{id:"root_output_directory",children:(0,r.jsx)(t.code,{children:"root_output_directory"})}),(0,r.jsxs)(o.A,{type_repr:"str | None",default_repr:"'/'",children:[(0,r.jsx)(t.p,{children:"Adjusts the location of files output by this target, when consumed as a dependency."}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"    Values are relative to the build root, except in the following cases:\n\n    * `.` specifies the location of the `BUILD` file.\n    * Values beginning with `./` are relative to the location of the `BUILD` file.\n    * `/` or the empty string specifies the build root.\n    * Values beginning with `/` are also relative to the build root.\n"})})]}),(0,r.jsx)(t.h2,{id:"runnable_dependencies",children:(0,r.jsx)(t.code,{children:"runnable_dependencies"})}),(0,r.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"None",children:[(0,r.jsx)(t.p,{children:"The runnable dependencies for this command."}),(0,r.jsxs)(t.p,{children:["Dependencies specified here are those required to exist on the ",(0,r.jsx)(t.code,{children:"PATH"})," to make the command complete successfully (interpreters specified in a ",(0,r.jsx)(t.code,{children:"#!"})," command, etc). Note that these dependencies will be made available on the ",(0,r.jsx)(t.code,{children:"PATH"})," with the name of the target."]}),(0,r.jsxs)(t.p,{children:["See also ",(0,r.jsx)(t.code,{children:"output_dependencies"})," and `execution_dependencies."]})]}),(0,r.jsx)(t.h2,{id:"tags",children:(0,r.jsx)(t.code,{children:"tags"})}),(0,r.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"None",children:[(0,r.jsx)(t.p,{children:"Arbitrary strings to describe a target."}),(0,r.jsxs)(t.p,{children:["For example, you may tag some test targets with 'integration_test' so that you could run ",(0,r.jsx)(t.code,{children:"pants --tag='integration_test' test ::"})," to only run on targets with that tag."]})]}),(0,r.jsx)(t.h2,{id:"timeout",children:(0,r.jsx)(t.code,{children:"timeout"})}),(0,r.jsx)(o.A,{type_repr:"int | None",default_repr:"30",children:(0,r.jsx)(t.p,{children:"Command execution timeout (in seconds)."})}),(0,r.jsx)(t.h2,{id:"tools",children:(0,r.jsx)(t.code,{children:"tools"})}),(0,r.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"()",children:[(0,r.jsx)(t.p,{children:"Specify required executable tools that might be used."}),(0,r.jsx)(t.p,{children:"Only the tools explicitly provided will be available on the search PATH, and these tools must be found on the paths provided by [shell-setup].executable_search_paths (which defaults to the system PATH)."})]}),(0,r.jsx)(t.h2,{id:"workdir",children:(0,r.jsx)(t.code,{children:"workdir"})}),(0,r.jsxs)(o.A,{type_repr:"str | None",default_repr:"'.'",children:[(0,r.jsx)(t.p,{children:"Sets the working directory for the process."}),(0,r.jsx)(t.p,{children:"Values are relative to the build root, except in the following cases:"}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"."})," specifies the location of the ",(0,r.jsx)(t.code,{children:"BUILD"})," file."]}),"\n",(0,r.jsxs)(t.li,{children:["Values beginning with ",(0,r.jsx)(t.code,{children:"./"})," are relative to the location of the ",(0,r.jsx)(t.code,{children:"BUILD"})," file."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"/"})," or the empty string specifies the build root."]}),"\n",(0,r.jsxs)(t.li,{children:["Values beginning with ",(0,r.jsx)(t.code,{children:"/"})," are also relative to the build root."]}),"\n"]})]})]})]})}function p(e={}){let{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},375002(e,t,n){n.d(t,{A:()=>s});let s={options:"options_nrbo"}},989898(e,t,n){n.d(t,{A:()=>r});var s=n(886070);function r({children:e,type_repr:t,default_repr:n,backend:r}){return(0,s.jsxs)("div",{className:"margin-bottom--lg",children:[(0,s.jsx)("code",{style:{color:"var(--pants-reference-option-repr)"},children:t}),(0,s.jsx)("br",{}),(0,s.jsxs)("div",{style:{paddingLeft:"2em"},children:[n&&(0,s.jsxs)("span",{children:["default:"," ",(0,s.jsx)("code",{style:{color:"var(--ifm-color-success)"},children:n})]}),!n&&(0,s.jsx)("span",{style:{color:"var(--ifm-color-success)"},children:"required"}),r&&(0,s.jsxs)("div",{children:["backend:"," ",(0,s.jsx)("code",{style:{color:"var(--ifm-color-success)"},children:r})]}),e]})]})}},848193(e,t,n){n.d(t,{R:()=>o,x:()=>d});var s=n(830758);let r={},i=s.createContext(r);function o(e){let t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:t},e.children)}},776521(e){e.exports=JSON.parse('{"id":"reference/targets/shell_command","title":"shell_command","description":"Execute any external tool for its side effects.\\n","source":"@site/versioned_docs/version-2.16/reference/targets/shell_command.mdx","sourceDirName":"reference/targets","slug":"/reference/targets/shell_command","permalink":"/2.16/reference/targets/shell_command","draft":false,"unlisted":false,"tags":[],"version":"2.16","frontMatter":{"title":"shell_command","description":"Execute any external tool for its side effects.\\n"},"sidebar":"referenceSidebar","previous":{"title":"scalatest_tests","permalink":"/2.16/reference/targets/scalatest_tests"},"next":{"title":"shell_source","permalink":"/2.16/reference/targets/shell_source"}}')}}]);