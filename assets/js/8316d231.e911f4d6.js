"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["440840"],{280261(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>c,metadata:()=>a,toc:()=>h});var a=n(601173),s=n(886070),l=n(848193),r=n(685008),i=n(637180);let c={title:"Helm Overview",sidebar_position:0},o,d={},h=[{value:"Initial setup",id:"initial-setup",level:2},{value:"Adding <code>helm_chart</code> targets",id:"adding-helm_chart-targets",level:3},{value:"Basic operations",id:"basic-operations",level:3},{value:"Linting",id:"linting",level:4},{value:"Package",id:"package",level:4},{value:"Helm Unit tests",id:"helm-unit-tests",level:2},{value:"Feeding additional files to unit tests",id:"feeding-additional-files-to-unit-tests",level:4},{value:"Timeouts",id:"timeouts",level:4},{value:"Publishing Helm charts",id:"publishing-helm-charts",level:2},{value:"Configuring OCI registries",id:"configuring-oci-registries",level:3},{value:"Setting a repository name",id:"setting-a-repository-name",level:3},{value:"Managing Chart Dependencies",id:"managing-chart-dependencies",level:2},{value:"<code>Chart.yaml</code> dependencies",id:"chartyaml-dependencies",level:3},{value:"Explicitly provided dependencies in <code>BUILD</code> files",id:"explicitly-provided-dependencies-in-build-files",level:3},{value:"Third party chart artifacts",id:"third-party-chart-artifacts",level:3}];function m(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.admonition,{title:"Helm support is in alpha stage",type:"caution",children:[(0,s.jsx)(t.p,{children:"Pants has good support for the most common operations for managing Helm charts sources. However there may be use cases not covered yet."}),(0,s.jsxs)(t.p,{children:["Please share feedback for what you need to use Pants with your Helm charts by either ",(0,s.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/issues/new/choose",children:"opening a GitHub issue"})," or ",(0,s.jsx)(t.a,{href:"/community/getting-help",children:"joining our Slack"}),"!"]})]}),"\n",(0,s.jsx)(t.h2,{id:"initial-setup",children:"Initial setup"}),"\n",(0,s.jsxs)(t.p,{children:["First, activate the relevant backend in ",(0,s.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = [\n  ...\n  "pants.backend.experimental.helm",\n  ...\n]\n'})}),"\n",(0,s.jsxs)(t.p,{children:["If you have more than one Helm chart in the same repository, organise them such that each of them lives in a separate folder with the chart definition file (",(0,s.jsx)(t.code,{children:"Chart.yaml"}),") at their root. The Helm backend is capable of auto-detecting the root folder of your Helm charts taking the chart definition file ",(0,s.jsx)(t.code,{children:"Chart.yaml"})," as the reference for that root."]}),"\n",(0,s.jsxs)(r.A,{groupId:"code-examples",children:[(0,s.jsx)(i.A,{value:"src/helm/foo/chart.yaml",label:"src/helm/foo/Chart.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/foo/Chart.yaml"}',children:"apiVersion: v2\ndescription: Foo Helm chart\nname: foo\nversion: 0.1.0\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/bar/chart.yaml",label:"src/helm/bar/Chart.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/bar/Chart.yaml"}',children:"apiVersion: v2\ndescription: Bar Helm chart\nname: bar\nversion: 0.1.0\n"})})})]}),"\n",(0,s.jsxs)(t.h3,{id:"adding-helm_chart-targets",children:["Adding ",(0,s.jsx)(t.code,{children:"helm_chart"})," targets"]}),"\n",(0,s.jsxs)(t.p,{children:["Helm charts are identified by the presence of a ",(0,s.jsx)(t.code,{children:"Chart.yaml"})," or ",(0,s.jsx)(t.code,{children:"Chart.yml"})," file, which contains relevant metadata about the chart like its name, version, dependencies, etc. To get started quickly you can create a simple ",(0,s.jsx)(t.code,{children:"Chart.yaml"})," file in your sources folder:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title="Chart.yaml"',children:"apiVersion: v2\ndescription: Example Helm chart\nname: example\nversion: 0.1.0\n"})}),"\n",(0,s.jsxs)(t.admonition,{type:"note",children:[(0,s.jsxs)(t.mdxAdmonitionTitle,{children:["Using ",(0,s.jsx)(t.code,{children:"helm create"})]}),(0,s.jsxs)(t.p,{children:["You can use the ",(0,s.jsx)(t.code,{children:"helm create"})," command to create an initial skeleton for your chart but be sure you have properly configured your source root patterns (as shown in the previous section) since the ",(0,s.jsx)(t.code,{children:"helm create"})," command will create a folder name with the name of your chart and place the sources inside."]})]}),"\n",(0,s.jsxs)(t.p,{children:["Then run ",(0,s.jsx)(t.a,{href:"/2.15/docs/getting-started/initial-configuration#5-generate-build-files",children:(0,s.jsx)(t.code,{children:"pants tailor ::"})})," to generate ",(0,s.jsx)(t.code,{children:"BUILD"})," files. This will scan your source repository in search of ",(0,s.jsx)(t.code,{children:"Chart.yaml"})," or ",(0,s.jsx)(t.code,{children:"Chart.yml"})," files and create a ",(0,s.jsx)(t.code,{children:"helm_chart"})," target for each of them."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"\u276F pants tailor ::\nCreated src/helm/example/BUILD:\n  - Add helm_chart target example\n"})}),"\n",(0,s.jsx)(t.h3,{id:"basic-operations",children:"Basic operations"}),"\n",(0,s.jsx)(t.p,{children:"The given setup is enough to now do some common operations on our Helm chart source code."}),"\n",(0,s.jsx)(t.h4,{id:"linting",children:"Linting"}),"\n",(0,s.jsxs)(t.p,{children:["The Helm backend has an implementation of the Pants' ",(0,s.jsx)(t.code,{children:"lint"})," goal which hooks it with the ",(0,s.jsx)(t.code,{children:"helm lint"})," command:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"pants lint ::\n==> Linting example\n[INFO] Chart.yaml: icon is recommended\n\n1 chart(s) linted, 0 chart(s) failed\n\n\n\u2713 helm succeeded.\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The linting command is non-strict by default. If you want to enforce strict linting it can be either done globally in the ",(0,s.jsx)(t.code,{children:"pants.toml"})," file, or in a per-chart target basis, using one of the two following ways:"]}),"\n",(0,s.jsxs)(r.A,{groupId:"code-examples",children:[(0,s.jsx)(i.A,{value:"pants.toml",label:"pants.toml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:"[helm]\n# Enables strict linting globally\nlint_strict = true\n"})})}),(0,s.jsx)(i.A,{value:"build",label:"BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"BUILD"}',children:"helm_chart(lint_strict=True)\n"})})})]}),"\n",(0,s.jsxs)(t.p,{children:["Likewise, in a similar way you could enable strict linting globally and then choose to disable it in a per-target basis. Run ",(0,s.jsx)(t.code,{children:"pants help helm"})," or ",(0,s.jsx)(t.code,{children:"pants help helm_chart"})," for more information."]}),"\n",(0,s.jsxs)(t.p,{children:["You can set the field ",(0,s.jsx)(t.code,{children:"skip_lint=True"})," on each ",(0,s.jsx)(t.code,{children:"helm_chart"})," target to avoid linting it."]}),"\n",(0,s.jsx)(t.h4,{id:"package",children:"Package"}),"\n",(0,s.jsxs)(t.p,{children:["Packing helm charts is supported out of the box via the Pants' ",(0,s.jsx)(t.code,{children:"package"})," goal. The final package will be saved as a ",(0,s.jsx)(t.code,{children:".tgz"})," file under the ",(0,s.jsx)(t.code,{children:"dist"})," folder at your source root."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"pants package ::\n10:23:15.24 [INFO] Completed: Packaging Helm chart: testprojects/src/helm/example\n10:23:15.24 [INFO] Wrote dist/testprojects.src.helm.example/example/example-0.2.0.tgz\nBuilt Helm chart artifact: testprojects.src.helm.example/example/example-0.2.0.tgz\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The final output folder can customised using the ",(0,s.jsx)(t.code,{children:"output_path"})," field in the ",(0,s.jsx)(t.code,{children:"helm_chart"})," target. Run ",(0,s.jsx)(t.code,{children:"pants help helm_chart"})," for more information."]}),"\n",(0,s.jsx)(t.h2,{id:"helm-unit-tests",children:"Helm Unit tests"}),"\n",(0,s.jsxs)(t.p,{children:["The Helm backend supports running Helm unit tests via the ",(0,s.jsxs)(t.a,{href:"https://github.com/quintush/helm-unittest",children:["Helm ",(0,s.jsx)(t.code,{children:"unittest"})," plugin"]}),". To run unit tests follow the instructions on how to use that plugin and then create a ",(0,s.jsx)(t.code,{children:"BUILD"})," file in the same folder where your tests live with the following target:"]}),"\n",(0,s.jsxs)(r.A,{groupId:"code-examples",children:[(0,s.jsx)(i.A,{value:"src/helm/example/tests/build",label:"src/helm/example/tests/BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"src/helm/example/tests/BUILD"}',children:"helm_unittest_tests()\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/example/templates/env-configmap.yaml",label:"src/helm/example/templates/env-configmap.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/example/templates/env-configmap.yaml"}',children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: example-configmap\ndata:\n{{- range $envKey, $envVal := .Values.env }}\n  {{ $envKey | upper }}: {{ $envVal | quote }}\n{{- end }}\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/example/tests/env-configmap_test.yaml",label:"src/helm/example/tests/env-configmap_test.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/example/tests/env-configmap_test.yaml"}',children:'suite: test env-configmap\ntemplates:\n  - env-configmap.yaml\ntests:\n  - it: should contain the env map variables\n    set:\n      env:\n        VAR1_NAME: var1Value\n        var2_name: var2Value\n    asserts:\n      - equal:\n          path: data.VAR1_NAME\n          value: "var1Value"\n      - equal:\n          path: data.VAR2_NAME\n          value: "var2Value"\n'})})})]}),"\n",(0,s.jsxs)(t.p,{children:["With the test files in places, you can now run ",(0,s.jsx)(t.code,{children:"pants test ::"})," and Pants will execute each of your tests individually:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"pants test ::\n10:50:12.45 [INFO] Completed: Running Helm unittest on: testprojects/src/helm/example/tests/env-configmap_test.yaml\n10:50:12.46 [INFO] Completed: Run Helm Unittest - testprojects/src/helm/example/tests/env-configmap_test.yaml succeeded.\n\n\u2713 testprojects/src/helm/example/tests/env-configmap_test.yaml succeeded in 0.75s.\n"})}),"\n",(0,s.jsx)(t.h4,{id:"feeding-additional-files-to-unit-tests",children:"Feeding additional files to unit tests"}),"\n",(0,s.jsxs)(t.p,{children:["In some cases we may want our tests to have access to additional files which are not part of the chart. This can be achieved by setting a dependency between our unit test targets and a ",(0,s.jsx)(t.code,{children:"resources"})," target as follows:"]}),"\n",(0,s.jsxs)(r.A,{groupId:"code-examples",children:[(0,s.jsx)(i.A,{value:"src/helm/example/tests/build",label:"src/helm/example/tests/BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"src/helm/example/tests/BUILD"}',children:'helm_unittest_tests(dependencies=[":extra-values"])\n\nresources(name="extra-values", sources=["extra-values.yml"])\n'})})}),(0,s.jsx)(i.A,{value:"src/helm/example/templates/env-configmap.yaml",label:"src/helm/example/templates/env-configmap.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/example/templates/env-configmap.yaml"}',children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: example-configmap\ndata:\n{{- range $key, $val := .Values.data }}\n  {{ $key | upper }}: {{ $val | quote }}\n{{- end }}\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/example/tests/extra-values.yml",label:"src/helm/example/tests/extra-values.yml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/example/tests/extra-values.yml"}',children:"data:\n  VAR1_NAME: var1Value\n  var2_name: var2Value\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/example/tests/env-configmap_test.yaml",label:"src/helm/example/tests/env-configmap_test.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/example/tests/env-configmap_test.yaml"}',children:'suite: test env-configmap\ntemplates:\n  - env-configmap.yaml\nvalues:\n  - extra-values.yml\ntests:\n  - it: should contain the env map variables\n    asserts:\n      - equal:\n          path: data.VAR1_NAME\n          value: "var1Value"\n      - equal:\n          path: data.VAR2_NAME\n          value: "var2Value"\n'})})})]}),"\n",(0,s.jsx)(t.p,{children:"Additional files can be referenced from any location inside your workspace. Note that the actual path to the additional files will be relative to the source roots configured in Pants."}),"\n",(0,s.jsxs)(t.p,{children:["In this example, since Helm charts define their source root at the location of the ",(0,s.jsx)(t.code,{children:"Chart.yaml"})," file and the ",(0,s.jsx)(t.code,{children:"extra-values.yml"})," file is inside the ",(0,s.jsx)(t.code,{children:"tests"})," folder relative to the chart, the test suite can access it as being local to it."]}),"\n",(0,s.jsxs)(t.p,{children:["However, in the following case, we need to reference the extra file relative to the chart root. Note the ",(0,s.jsx)(t.code,{children:"../data/extra-values.yml"})," path in the test suite."]}),"\n",(0,s.jsxs)(r.A,{groupId:"code-examples",children:[(0,s.jsx)(i.A,{value:"pants.toml",label:"pants.toml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[source]\nroot_patterns=["src/extra"]\n'})})}),(0,s.jsx)(i.A,{value:"src/extra/data/build",label:"src/extra/data/BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"src/extra/data/BUILD"}',children:'resources(name="extra-values", sources=["extra-values.yml"])\n'})})}),(0,s.jsx)(i.A,{value:"src/extra/data/extra-values.yml",label:"src/extra/data/extra-values.yml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/extra/data/extra-values.yml"}',children:"data:\n  VAR1_NAME: var1Value\n  var2_name: var2Value\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/example/tests/build",label:"src/helm/example/tests/BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"src/helm/example/tests/BUILD"}',children:'helm_unittest_tests(dependencies=["src/extra/data:extra-values"])\n'})})}),(0,s.jsx)(i.A,{value:"src/helm/example/templates/env-configmap.yaml",label:"src/helm/example/templates/env-configmap.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/example/templates/env-configmap.yaml"}',children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: example-configmap\ndata:\n{{- range $key, $val := .Values.data }}\n  {{ $key | upper }}: {{ $val | quote }}\n{{- end }}\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/example/tests/env-configmap_test.yaml",label:"src/helm/example/tests/env-configmap_test.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/example/tests/env-configmap_test.yaml"}',children:'suite: test env-configmap\ntemplates:\n  - env-configmap.yaml\nvalues:\n  - ../data/extra-values.yml\ntests:\n  - it: should contain the env map variables\n    asserts:\n      - equal:\n          path: data.VAR1_NAME\n          value: "var1Value"\n      - equal:\n          path: data.VAR2_NAME\n          value: "var2Value"\n'})})})]}),"\n",(0,s.jsxs)(t.admonition,{type:"caution",children:[(0,s.jsxs)(t.mdxAdmonitionTitle,{children:["Using ",(0,s.jsx)(t.code,{children:"file"}),", ",(0,s.jsx)(t.code,{children:"files"})," and ",(0,s.jsx)(t.code,{children:"relocated_files"})," targets"]}),(0,s.jsxs)(t.p,{children:["Other file-centric targets are also supported, just be aware that ",(0,s.jsx)(t.code,{children:"file"})," and ",(0,s.jsx)(t.code,{children:"files"})," targets are\nnot affected by the source roots setting. When using ",(0,s.jsx)(t.code,{children:"relocated_files"}),", the files will be relative\nto the value set in the ",(0,s.jsx)(t.code,{children:"dest"})," field."]})]}),"\n",(0,s.jsx)(t.h4,{id:"timeouts",children:"Timeouts"}),"\n",(0,s.jsx)(t.p,{children:"Pants can cancel tests that take too long, which is useful to prevent tests from hanging indefinitely."}),"\n",(0,s.jsxs)(t.p,{children:["To add a timeout, set the ",(0,s.jsx)(t.code,{children:"timeout"})," field to an integer value of seconds, like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="BUILD"',children:'helm_unittest_test(name="tests", source="env-configmap_test.yaml", timeout=120)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["When you set ",(0,s.jsx)(t.code,{children:"timeout"})," on the ",(0,s.jsx)(t.code,{children:"helm_unittest_tests"})," target generator, the same timeout will apply to every generated ",(0,s.jsx)(t.code,{children:"helm_unittest_test"})," target. Instead, you can use the ",(0,s.jsx)(t.code,{children:"overrides"})," field:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="BUILD"',children:'helm_unittest_tests(\n    name="tests",\n    overrides={\n        "env-configmap_test.yaml": {"timeout": 20},\n        ("deployment_test.yaml", "pod_test.yaml"): {"timeout": 35},\n    },\n)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["You can also set a default value and a maximum value in ",(0,s.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:"[test]\ntimeout_default = 60\ntimeout_maximum = 600\n"})}),"\n",(0,s.jsxs)(t.p,{children:["If a target sets its ",(0,s.jsx)(t.code,{children:"timeout"})," higher than ",(0,s.jsx)(t.code,{children:"[test].timeout_maximum"}),", Pants will use the value in ",(0,s.jsx)(t.code,{children:"[test].timeout_maximum"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Use the option ",(0,s.jsx)(t.code,{children:"pants test --no-timeouts"})," to temporarily disable timeouts, e.g. when debugging."]}),"\n",(0,s.jsx)(t.h2,{id:"publishing-helm-charts",children:"Publishing Helm charts"}),"\n",(0,s.jsx)(t.p,{children:"Pants only supports publishing Helm charts to OCI registries, a feature that was made generally available in Helm 3.8."}),"\n",(0,s.jsxs)(t.p,{children:["The publishing is done with Pants' ",(0,s.jsx)(t.code,{children:"publish"})," goal but first you will need to tell Pants what are the possible destination registries where to upload your charts."]}),"\n",(0,s.jsx)(t.h3,{id:"configuring-oci-registries",children:"Configuring OCI registries"}),"\n",(0,s.jsxs)(t.p,{children:["In a similar way as the ",(0,s.jsx)(t.code,{children:"docker_image"})," target, a ",(0,s.jsx)(t.code,{children:"helm_chart"})," target takes an optional ",(0,s.jsx)(t.code,{children:"registries"})," field whose value is a list of registry endpoints (prefixed by the ",(0,s.jsx)(t.code,{children:"oci://"})," protocol):"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="src/helm/example/BUILD"',children:'helm_chart(\n  name="example",\n  registries=[\n    "oci://reg.company.internal"\n  ]\n)\n'})}),"\n",(0,s.jsx)(t.p,{children:"The chart published from that given target will be uploaded to the OCI registry specified."}),"\n",(0,s.jsxs)(t.p,{children:["If you have several charts that have to be published into the same registries, you can add them to your ",(0,s.jsx)(t.code,{children:"pants.toml"})," file and then reference them by using their alias prefixed by a ",(0,s.jsx)(t.code,{children:"@"})," symbol."]}),"\n",(0,s.jsxs)(t.p,{children:["You can also designate one or more registries as default and then charts that have no explicit ",(0,s.jsx)(t.code,{children:"registries"})," field will use those default registries."]}),"\n",(0,s.jsxs)(r.A,{groupId:"code-examples",children:[(0,s.jsx)(i.A,{value:"pants.toml",label:"pants.toml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[helm.registries.company-registry1]\naddress = "oci://reg1.company.internal"\ndefault = true\n\n[helm.registries.company-registry2]\naddress = "oci://reg2.company.internal"\n'})})}),(0,s.jsx)(i.A,{value:"src/example/build",label:"src/example/BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"src/example/BUILD"}',children:'helm_chart(name="demo")\n\n# This is equivalent to the previous target,\n# since company-registry1 is the default registry:\nhelm_chart(\n    name="demo",\n    registries=["@company-registry1"],\n)\n\n# You can mix named and direct registry references.\nhelm_chart(\n    name="demo2",\n    registries=[\n        "@company-registry2",\n        "oci://ext-registry.company-b.net:8443",\n    ]\n)\n'})})})]}),"\n",(0,s.jsx)(t.h3,{id:"setting-a-repository-name",children:"Setting a repository name"}),"\n",(0,s.jsxs)(t.p,{children:["When publishing charts into an OCI registry, you most likely will be interested on separating them from other kind of OCI assets (i.e. container images). For doing so you can set a ",(0,s.jsx)(t.code,{children:"repository"})," field in the ",(0,s.jsx)(t.code,{children:"helm_chart"})," target so the chart artifact will be uploaded to the given path:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="src/helm/example/BUILD"',children:'helm_chart(\n  name="example",\n  repository="charts"\n)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["With the previous setting, your chart would be published to your default registry under the ",(0,s.jsx)(t.code,{children:"charts"})," folder like in ",(0,s.jsx)(t.code,{children:"oci://myregistry.internal/charts/example-0.1.0.tgz"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["You can also set a default global repository in ",(0,s.jsx)(t.code,{children:"pants.toml"})," as in the following example:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[helm]\ndefault_registry_repository = "charts"\n'})}),"\n",(0,s.jsx)(t.h2,{id:"managing-chart-dependencies",children:"Managing Chart Dependencies"}),"\n",(0,s.jsx)(t.p,{children:"Helm charts can depend on other charts, whether first-party charts defined in the same repo, or third-party charts published in a registry. Pants uses this dependency information to know when work needs to be re-run."}),"\n",(0,s.jsx)(t.admonition,{title:"Chart.yaml version",type:"note",children:(0,s.jsxs)(t.p,{children:["To benefit from Pants dependency management and inference in your Helm charts, you will need to use ",(0,s.jsx)(t.code,{children:"apiVersion: v2"})," in your ",(0,s.jsx)(t.code,{children:"Chart.yaml"})," file."]})}),"\n",(0,s.jsxs)(t.h3,{id:"chartyaml-dependencies",children:[(0,s.jsx)(t.code,{children:"Chart.yaml"})," dependencies"]}),"\n",(0,s.jsxs)(t.p,{children:["Pants will automatically infer dependencies from the ",(0,s.jsx)(t.code,{children:"Chart.yaml"})," file."]}),"\n",(0,s.jsxs)(t.p,{children:["For example, given two charts ",(0,s.jsx)(t.code,{children:"foo"})," and ",(0,s.jsx)(t.code,{children:"bar"})," and a dependency between them:"]}),"\n",(0,s.jsxs)(r.A,{groupId:"code-examples",children:[(0,s.jsx)(i.A,{value:"src/helm/foo/chart.yaml",label:"src/helm/foo/Chart.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/foo/Chart.yaml"}',children:"apiVersion: v2\ndescription: Foo Helm chart\nname: foo\nversion: 0.1.0\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/foo/build",label:"src/helm/foo/BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"src/helm/foo/BUILD"}',children:"helm_chart()\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/bar/chart.yaml",label:"src/helm/bar/Chart.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/bar/Chart.yaml"}',children:"apiVersion: v2\ndescription: Bar Helm chart\nname: bar\nversion: 0.1.0\ndependencies:\n  - name: foo\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/bar/build",label:"src/helm/bar/BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"src/helm/bar/BUILD"}',children:"helm_chart()\n"})})})]}),"\n",(0,s.jsxs)(t.p,{children:["Then, running ",(0,s.jsx)(t.code,{children:"pants dependencies"}),"on ",(0,s.jsx)(t.code,{children:"bar"})," will list ",(0,s.jsx)(t.code,{children:"foo"})," as a dependency:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"pants dependencies src/helm/bar\nsrc/helm/foo\n"})}),"\n",(0,s.jsxs)(t.h3,{id:"explicitly-provided-dependencies-in-build-files",children:["Explicitly provided dependencies in ",(0,s.jsx)(t.code,{children:"BUILD"})," files"]}),"\n",(0,s.jsxs)(t.p,{children:['If you prefer, you can let your BUILD files be the "source of truth" for dependencies, instead of specifying them in ',(0,s.jsx)(t.code,{children:"Chart.yaml"}),":"]}),"\n",(0,s.jsxs)(r.A,{groupId:"code-examples",children:[(0,s.jsx)(i.A,{value:"src/helm/foo/chart.yaml",label:"src/helm/foo/Chart.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/foo/Chart.yaml"}',children:"apiVersion: v2\ndescription: Foo Helm chart\nname: foo\nversion: 0.1.0\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/foo/build",label:"src/helm/foo/BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"src/helm/foo/BUILD"}',children:"helm_chart()\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/bar/chart.yaml",label:"src/helm/bar/Chart.yaml",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'tab={"label":"src/helm/bar/Chart.yaml"}',children:"apiVersion: v2\ndescription: Bar Helm chart\nname: bar\nversion: 0.1.0\n"})})}),(0,s.jsx)(i.A,{value:"src/helm/bar/build",label:"src/helm/bar/BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"src/helm/bar/BUILD"}',children:'helm_chart(dependencies=["//src/helm/foo"])\n'})})})]}),"\n",(0,s.jsxs)(t.p,{children:["In this case, the ",(0,s.jsx)(t.code,{children:"pants dependencies"})," command will show the same result and, in addition, Pants will modify its copy of ",(0,s.jsx)(t.code,{children:"bar"}),"'s ",(0,s.jsx)(t.code,{children:"Chart.yaml"})," before using it, so that it includes ",(0,s.jsx)(t.code,{children:"foo"})," in its dependency list. Note that Pants will not modify the original copy in your source tree, only the copy it uses in the sandboxed execution environment."]}),"\n",(0,s.jsx)(t.h3,{id:"third-party-chart-artifacts",children:"Third party chart artifacts"}),"\n",(0,s.jsxs)(t.p,{children:["Third party charts are provided to Pants using the ",(0,s.jsx)(t.code,{children:"helm_artifact"})," target:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title="3rdparty/helm/BUILD"',children:'helm_artifact(\n  artifact="chart_name",\n  version="0.0.1",\n  registry="...",     # Optional\n  repository="...",   # Optional for OCI registries\n)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Third party artifacts are resolved using ",(0,s.jsx)(t.code,{children:"helm pull"}),". Other charts can reference them in the same way as first-party charts (either in the ",(0,s.jsx)(t.code,{children:"Chart.yaml"})," or in the ",(0,s.jsx)(t.code,{children:"BUILD"})," file)."]}),"\n",(0,s.jsxs)(t.p,{children:["When adding third party artifacts, the ",(0,s.jsx)(t.code,{children:"artifact"})," and ",(0,s.jsx)(t.code,{children:"version"})," fields are mandatory, in addition to one ",(0,s.jsx)(t.em,{children:"origin"})," from which to download the actual archive. There are two different origins supported: ",(0,s.jsx)(t.em,{children:"classic Helm repositories"})," and ",(0,s.jsx)(t.em,{children:"OCI registries"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["For ",(0,s.jsx)(t.strong,{children:"classic repositories"}),", provide with the full URL to the location of the chart archive, excluding the archive file itself:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="3rdparty/helm/jetstack/BUILD"',children:'helm_artifact(\n  artifact="cert-manager",\n  version="v0.7.0",\n  repository="https://charts.jetstack.io",\n)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["For ",(0,s.jsx)(t.strong,{children:"OCI registries"}),", you must provide with the URL to the registry in the ",(0,s.jsx)(t.code,{children:"registry"})," field and an optional ",(0,s.jsx)(t.code,{children:"repository"})," field with the path inside that registry."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="3rdparty/helm/example/BUILD"',children:'helm_artifact(\n  artifact="foo",\n  version="1.0.0",\n  registry="oci://registry.example.com",\n  repository="charts",\n)\n'})})]})}function p(e={}){let{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},753348(e,t,n){n.d(t,{A:()=>a});let a={tabItem:"tabItem_mHvh"}},618264(e,t,n){n.d(t,{A:()=>a});let a={tabList:"tabList_sFbf",tabItem:"tabItem_UVfV"}},637180(e,t,n){n.d(t,{A:()=>r});var a=n(886070);n(830758);var s=n(313526),l=n(753348);function r({children:e,hidden:t,className:n}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(l.A.tabItem,n),hidden:t,children:e})}},685008(e,t,n){n.d(t,{A:()=>u});var a=n(886070),s=n(830758),l=n(313526),r=n(911212),i=n(274875),c=n(106632),o=n(189223),d=n(618264);function h({className:e,block:t,selectedValue:n,selectValue:s,tabValues:r}){let c=[],{blockElementScrollPositionUntilNextRender:o}=(0,i.a_)(),h=e=>{let t=e.currentTarget,a=r[c.indexOf(t)].value;a!==n&&(o(t),s(a))},m=e=>{let t=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{let n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{let n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1]}}t?.focus()};return(0,a.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":t},e),children:r.map(({value:e,label:t,attributes:s})=>(0,a.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{c.push(e)},onKeyDown:m,onClick:h,...s,className:(0,l.A)("tabs__item",d.A.tabItem,s?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function m({lazy:e,children:t,selectedValue:n}){let r=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){let e=r.find(e=>e.props.value===n);return e?(0,s.cloneElement)(e,{className:(0,l.A)("margin-top--md",e.props.className)}):null}return(0,a.jsx)("div",{className:"margin-top--md",children:r.map((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function p(e){let t=(0,c.u)(e);return(0,a.jsxs)("div",{className:(0,l.A)(r.G.tabs.container,"tabs-container",d.A.tabList),children:[(0,a.jsx)(h,{...t,...e}),(0,a.jsx)(m,{...t,...e})]})}function u(e){let t=(0,o.A)();return(0,a.jsx)(p,{...e,children:(0,c.v)(e.children)},String(t))}},106632(e,t,n){n.d(t,{u:()=>h,v:()=>o});var a=n(830758),s=n(325557),l=n(363717),r=n(125740),i=n(574229),c=n(270367);function o(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function d({value:e,tabValues:t}){return t.some(t=>t.value===e)}function h(e){let t,{defaultValue:n,queryString:h=!1,groupId:m}=e,p=function(e){let{values:t,children:n}=e;return(0,a.useMemo)(()=>{let e=t??o(n).map(({props:{value:e,label:t,attributes:n,default:a}})=>({value:e,label:t,attributes:n,default:a})),a=(0,i.XI)(e,(e,t)=>e.value===t.value);if(a.length>0)throw Error(`Docusaurus error: Duplicate values "${a.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[t,n])}(e),[u,x]=(0,a.useState)(()=>(function({defaultValue:e,tabValues:t}){if(0===t.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!d({value:e,tabValues:t}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let n=t.find(e=>e.default)??t[0];if(!n)throw Error("Unexpected error: 0 tabValues");return n.value})({defaultValue:n,tabValues:p})),[g,f]=function({queryString:e=!1,groupId:t}){let n=(0,s.W6)(),l=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,r.aZ)(l),(0,a.useCallback)(e=>{if(!l)return;let t=new URLSearchParams(n.location.search);t.set(l,e),n.replace({...n.location,search:t.toString()})},[l,n])]}({queryString:h,groupId:m}),[j,y]=function({groupId:e}){let t=e?`docusaurus.tab.${e}`:null,[n,s]=(0,c.Dv)(t);return[n,(0,a.useCallback)(e=>{t&&s.set(e)},[t,s])]}({groupId:m}),v=d({value:t=g??j,tabValues:p})?t:null;return(0,l.A)(()=>{v&&x(v)},[v]),{selectedValue:u,selectValue:(0,a.useCallback)(e=>{if(!d({value:e,tabValues:p}))throw Error(`Can't select invalid tab value=${e}`);x(e),f(e),y(e)},[f,y,p]),tabValues:p}}},848193(e,t,n){n.d(t,{R:()=>r,x:()=>i});var a=n(830758);let s={},l=a.createContext(s);function r(e){let t=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(l.Provider,{value:t},e.children)}},601173(e){e.exports=JSON.parse('{"id":"docs/helm/index","title":"Helm Overview","description":"---","source":"@site/versioned_docs/version-2.15/docs/helm/index.mdx","sourceDirName":"docs/helm","slug":"/docs/helm/","permalink":"/2.15/docs/helm/","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/helm/index.mdx","tags":[],"version":"2.15","sidebarPosition":0,"frontMatter":{"title":"Helm Overview","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Tagging Docker images","permalink":"/2.15/docs/docker/tagging-docker-images"},"next":{"title":"Deployments","permalink":"/2.15/docs/helm/deployments"}}')}}]);