"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["539705"],{519619(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>a});var i=n(52039),s=n(886070),l=n(848193);let r={title:"Linters and formatters",sidebar_position:3},o,d={},a=[{value:"Activating linters and formatters",id:"activating-linters-and-formatters",level:2},{value:"Configuring the tools, e.g. adding plugins",id:"configuring-the-tools-eg-adding-plugins",level:2},{value:"Skipping a formatter or linter",id:"skipping-a-formatter-or-linter",level:2},{value:"Tip: only run over changed files",id:"tip-only-run-over-changed-files",level:2},{value:"Tips for specific tools",id:"tips-for-specific-tools",level:2},{value:"Bandit and Flake8: report files",id:"bandit-and-flake8-report-files",level:3},{value:"Pylint and Flake8: how to add first-party plugins",id:"pylint-and-flake8-how-to-add-first-party-plugins",level:3},{value:"Bandit: less verbose logging",id:"bandit-less-verbose-logging",level:3},{value:"Black and isort can work together",id:"black-and-isort-can-work-together",level:3},{value:"Pyupgrade: specify which Python version to target",id:"pyupgrade-specify-which-python-version-to-target",level:3},{value:"Autoflake and Pyupgrade are experimental",id:"autoflake-and-pyupgrade-are-experimental",level:3},{value:"isort: possible issues with its import classifier algorithm",id:"isort-possible-issues-with-its-import-classifier-algorithm",level:3}];function c(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"How to activate and use the Python linters and formatters bundled with Pants."}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"activating-linters-and-formatters",children:"Activating linters and formatters"}),"\n",(0,s.jsxs)(t.p,{children:["Linter/formatter support is implemented in separate ",(0,s.jsx)(t.a,{href:"/2.9/docs/using-pants/key-concepts/backends",children:"backends"})," so that they are easy to opt in to individually:"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Backend"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Tool"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"pants.backend.python.lint.bandit"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.a,{href:"https://bandit.readthedocs.io/en/latest/",children:"Bandit"}),": security linter"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"pants.backend.python.lint.black"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.a,{href:"https://black.readthedocs.io/en/stable/",children:"Black"}),": code formatter"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"pants.backend.python.lint.docformatter"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.a,{href:"https://pypi.org/project/docformatter/",children:"Docformatter"}),": docstring formatter"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"pants.backend.python.lint.flake8"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.a,{href:"https://flake8.pycqa.org/en/latest/",children:"Flake8"}),": style and bug linter"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"pants.backend.python.lint.isort"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.a,{href:"https://readthedocs.org/projects/isort/",children:"isort"}),": import statement formatter"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"pants.backend.python.lint.pylint"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.a,{href:"https://www.pylint.org/",children:"Pylint"}),": style and bug linter"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"pants.backend.python.lint.yapf"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.a,{href:"https://github.com/google/yapf",children:"Yapf"}),": code formatter"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"pants.backend.experimental.python.lint.autoflake"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.a,{href:"https://github.com/myint/autoflake",children:"Autoflake"}),": remove unused imports"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"pants.backend.experimental.python.lint.pyupgrade"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.a,{href:"https://github.com/asottile/pyupgrade",children:"Pyupgrade"}),": automatically update code to use modern Python idioms like ",(0,s.jsx)(t.code,{children:"f-strings"})]})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["To enable, add the appropriate backends in ",(0,s.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:"[GLOBAL]\n...\nbackend_packages = [\n  'pants.backend.python',\n  'pants.backend.python.lint.black',\n  'pants.backend.python.lint.isort',\n]\n"})}),"\n",(0,s.jsxs)(t.p,{children:["You should now be able to run ",(0,s.jsx)(t.code,{children:"./pants lint"}),", and possibly ",(0,s.jsx)(t.code,{children:"./pants fmt"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"$ ./pants lint src/py/project.py\n17:54:32.51 [INFO] Completed: lint - Flake8 succeeded.\n17:54:32.70 [INFO] Completed: lint - Black succeeded.\nAll done! \u2728 \u{1F370} \u2728\n1 file would be left unchanged.\n\n17:54:33.91 [INFO] Completed: lint - isort succeeded.\n\n\u2713 Black succeeded.\n\u2713 Flake8 succeeded.\n\u2713 isort succeeded.\n"})}),"\n",(0,s.jsx)(t.admonition,{title:"How to activate MyPy",type:"note",children:(0,s.jsxs)(t.p,{children:["MyPy is run with the ",(0,s.jsx)(t.a,{href:"/2.9/docs/python/goals/check",children:"check goal"}),", rather than ",(0,s.jsx)(t.code,{children:"lint"}),"."]})}),"\n",(0,s.jsx)(t.h2,{id:"configuring-the-tools-eg-adding-plugins",children:"Configuring the tools, e.g. adding plugins"}),"\n",(0,s.jsx)(t.p,{children:"You can configure each formatter and linter using these options:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Option"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"What it does"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"version"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["E.g. ",(0,s.jsx)(t.code,{children:"flake8==3.8.0"}),"."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"extra_requirements"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Any additional dependencies to install, such as any plugins."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"interpreter_constraints"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["What interpreter to run the tool with. (",(0,s.jsx)(t.code,{children:"bandit"}),", ",(0,s.jsx)(t.code,{children:"flake8"}),", and ",(0,s.jsx)(t.code,{children:"pylint"})," instead determine this based on your ",(0,s.jsx)(t.a,{href:"/2.9/docs/python/overview/interpreter-compatibility",children:"code's interpreter constraints"}),".)"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"args"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Any command-line arguments you want to pass to the tool."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"config"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Path to a config file. Useful if the file is in a non-standard location such that it cannot be auto-discovered."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"lockfile"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Path to a custom lockfile if the default does not work, or ",(0,s.jsx)(t.code,{children:'"<none>"'})," to opt out. See ",(0,s.jsx)(t.a,{href:"/2.9/docs/python/overview/third-party-dependencies#tool-lockfiles",children:"Third-party dependencies"}),"."]})]})]})]}),"\n",(0,s.jsx)(t.p,{children:"For example:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[docformatter]\nargs = ["--wrap-summaries=100", "--wrap-descriptions=100"]\n\n[flake8]\n# Load a config file in a non-standard location.\nconfig = "build-support/flake8"\n# Change the version and add a custom plugin. Because we do this, we\n# use a custom lockfile.\nversion = "flake8==3.8.0"\nextra_requirements.add = ["flake8-2020"]\nlockfile = "3rdparty/flake8_lockfile.txt"\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Run ",(0,s.jsx)(t.code,{children:"./pants help-advanced black"}),", ",(0,s.jsx)(t.code,{children:"./pants help-advanced flake8"}),", and so on for more information."]}),"\n",(0,s.jsxs)(t.admonition,{title:"Config files are normally auto-discovered",type:"note",children:[(0,s.jsx)(t.p,{children:"For tools that autodiscover config files\u2014such as Black, isort, Flake8, and Pylint\u2014Pants will include any relevant config files in the process's sandbox when running the tool."}),(0,s.jsxs)(t.p,{children:["If your config file is in a non-standard location, you must instead set the ",(0,s.jsx)(t.code,{children:"--config"})," option, e.g. ",(0,s.jsx)(t.code,{children:"[isort].config"}),". This will ensure that the config file is included in the process's sandbox and Pants will instruct the tool to load the config."]})]}),"\n",(0,s.jsx)(t.h2,{id:"skipping-a-formatter-or-linter",children:"Skipping a formatter or linter"}),"\n",(0,s.jsxs)(t.p,{children:["To temporarily skip a tool, use the ",(0,s.jsx)(t.code,{children:"--skip"})," option for that tool. For example, run:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ ./pants --black-skip --flake8-skip lint ::\n"})}),"\n",(0,s.jsxs)(t.p,{children:["You can also skip for certain targets with the ",(0,s.jsx)(t.code,{children:"skip_tool"})," field, which can be useful for ",(0,s.jsx)(t.a,{href:"https://www.youtube.com/watch?v=BOhcdRsmv0s",children:"incrementally adopting new tools"}),". For example:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'title="project/BUILD"',children:'python_sources(\n    name="lib",\n    # Skip Black for all non-test files in this folder.\n    skip_black=True,\n    overrides={\n        "strutil.py": {"skip_flake8": True},\n        ("docutil.py", "dirutil.py"): {"skip_isort": True},\n    },\n)\n\npython_tests(\n    name="tests",\n    # Skip isort for all the test files in this folder.\n    skip_isort=True,\n)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["When you run ",(0,s.jsx)(t.code,{children:"./pants fmt"})," and ",(0,s.jsx)(t.code,{children:"./pants lint"}),", Pants will ignore any files belonging to skipped targets."]}),"\n",(0,s.jsx)(t.h2,{id:"tip-only-run-over-changed-files",children:"Tip: only run over changed files"}),"\n",(0,s.jsx)(t.p,{children:"With formatters and linters, there is usually no need to rerun on files that have not changed."}),"\n",(0,s.jsxs)(t.p,{children:["Use the option ",(0,s.jsx)(t.code,{children:"--changed-since"})," to get much better performance, like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ ./pants --changed-since=HEAD fmt\n"})}),"\n",(0,s.jsx)(t.p,{children:"or"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ ./pants --changed-since=main lint\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Pants will find which files have changed and only run over those files. See ",(0,s.jsx)(t.a,{href:"/2.9/docs/using-pants/advanced-target-selection",children:"Advanced target selection"})," for more information."]}),"\n",(0,s.jsx)(t.h2,{id:"tips-for-specific-tools",children:"Tips for specific tools"}),"\n",(0,s.jsx)(t.h3,{id:"bandit-and-flake8-report-files",children:"Bandit and Flake8: report files"}),"\n",(0,s.jsx)(t.p,{children:"Flake8 and Bandit can both generate report files saved to disk."}),"\n",(0,s.jsxs)(t.p,{children:["For Pants to properly preserve the reports, instruct both tools to write to the ",(0,s.jsx)(t.code,{children:"reports/"})," folder by updating their config files or ",(0,s.jsx)(t.code,{children:"--flake8-args"})," and ",(0,s.jsx)(t.code,{children:"--bandit-args"}),". For example, in your ",(0,s.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",children:'[bandit]\nargs = ["--output=reports/report.txt"]\n\n[flake8]\nargs = ["--output-file=reports/report.txt"]\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Pants will copy all reports into the folder ",(0,s.jsx)(t.code,{children:"dist/lint/<linter_name>"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"pylint-and-flake8-how-to-add-first-party-plugins",children:"Pylint and Flake8: how to add first-party plugins"}),"\n",(0,s.jsxs)(t.p,{children:["See ",(0,s.jsx)(t.a,{href:"/2.9/reference/subsystems/pylint#section-source-plugins",children:(0,s.jsx)(t.code,{children:"[pylint].source_plugins"})})," and ",(0,s.jsx)(t.a,{href:"/2.9/reference/subsystems/flake8#section-source-plugins",children:(0,s.jsx)(t.code,{children:"[flake8].source_plugins"})})," for instructions to add plugins written by you."]}),"\n",(0,s.jsx)(t.h3,{id:"bandit-less-verbose-logging",children:"Bandit: less verbose logging"}),"\n",(0,s.jsxs)(t.p,{children:["Bandit output can be extremely verbose, including on successful runs. You may want to use its ",(0,s.jsx)(t.code,{children:"--quiet"})," option, which will turn off output for successful runs but keep it for failures."]}),"\n",(0,s.jsxs)(t.p,{children:["For example, you can set this in your ",(0,s.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",children:'[bandit]\nargs = ["--quiet"]\n'})}),"\n",(0,s.jsx)(t.h3,{id:"black-and-isort-can-work-together",children:"Black and isort can work together"}),"\n",(0,s.jsxs)(t.p,{children:["If you use both ",(0,s.jsx)(t.code,{children:"black"})," and ",(0,s.jsx)(t.code,{children:"isort"}),", you most likely will need to tell ",(0,s.jsx)(t.code,{children:"isort"})," to work in a mode compatible with ",(0,s.jsx)(t.code,{children:"black"}),". It is also a good idea to ensure they use the same line length. This requires tool specific configuration, which could go into ",(0,s.jsx)(t.code,{children:"pyproject.toml"})," for example:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",children:'# pyproject.toml\n[tool.isort]\nprofile = "black"\nline_length = 100\n\n[tool.black]\nline-length = 100\n'})}),"\n",(0,s.jsx)(t.h3,{id:"pyupgrade-specify-which-python-version-to-target",children:"Pyupgrade: specify which Python version to target"}),"\n",(0,s.jsx)(t.p,{children:"You must tell Pyupgrade which version of Python to target, like this:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",children:'# pants.toml\n[pyupgrade]\nargs = ["--py36-plus"]\n'})}),"\n",(0,s.jsx)(t.h3,{id:"autoflake-and-pyupgrade-are-experimental",children:"Autoflake and Pyupgrade are experimental"}),"\n",(0,s.jsxs)(t.p,{children:["These tools are marked experimental because we are debating adding a new goal called ",(0,s.jsx)(t.code,{children:"fix"})," and running them with ",(0,s.jsx)(t.code,{children:"fix"})," rather than ",(0,s.jsx)(t.code,{children:"fmt"}),". The tools are safe to use, other than possibly changing how you invoke them in the future."]}),"\n",(0,s.jsxs)(t.p,{children:["We invite you to ",(0,s.jsx)(t.a,{href:"https://github.com/pantsbuild/pants/issues/13504",children:"weigh in with what you think"}),"!"]}),"\n",(0,s.jsx)(t.h3,{id:"isort-possible-issues-with-its-import-classifier-algorithm",children:"isort: possible issues with its import classifier algorithm"}),"\n",(0,s.jsxs)(t.p,{children:["Some Pants users had to explicitly set ",(0,s.jsx)(t.code,{children:'default_section = "THIRDPARTY"'})," to get iSort 5 to correctly classify their first-party imports, even though this is the default value."]}),"\n",(0,s.jsx)(t.p,{children:"They report that this config works for them:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",children:'# pyproject.toml\n[tool.isort]\nknown_first_party = ["my_org"]\ndefault_section = "THIRDPARTY"\n'})}),"\n",(0,s.jsxs)(t.p,{children:["You may also want to try downgrading to iSort 4.x by setting ",(0,s.jsx)(t.code,{children:'version = "isort>=4.6,<5"'})," in the ",(0,s.jsx)(t.code,{children:"[isort]"})," options scope."]})]})}function h(e={}){let{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},848193(e,t,n){n.d(t,{R:()=>r,x:()=>o});var i=n(830758);let s={},l=i.createContext(s);function r(e){let t=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(l.Provider,{value:t},e.children)}},52039(e){e.exports=JSON.parse('{"id":"docs/python/overview/linters-and-formatters","title":"Linters and formatters","description":"How to activate and use the Python linters and formatters bundled with Pants.","source":"@site/versioned_docs/version-2.9/docs/python/overview/linters-and-formatters.mdx","sourceDirName":"docs/python/overview","slug":"/docs/python/overview/linters-and-formatters","permalink":"/2.9/docs/python/overview/linters-and-formatters","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/python/overview/linters-and-formatters.mdx","tags":[],"version":"2.9","sidebarPosition":3,"frontMatter":{"title":"Linters and formatters","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Interpreter compatibility","permalink":"/2.9/docs/python/overview/interpreter-compatibility"},"next":{"title":"Pex files","permalink":"/2.9/docs/python/overview/pex-files"}}')}}]);