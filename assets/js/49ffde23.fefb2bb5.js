"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["918227"],{461479(e,n,o){o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>a});var s=o(401695),t=o(886070),r=o(848193);let i={title:"Source roots",sidebar_position:4},c,l={},a=[{value:"What are source roots?",id:"what-are-source-roots",level:2},{value:"Configuring source roots",id:"configuring-source-roots",level:2},{value:"Configuring source roots using patterns",id:"configuring-source-roots-using-patterns",level:3},{value:"Configuring no source roots",id:"configuring-no-source-roots",level:4},{value:"Configuring source roots using marker files",id:"configuring-source-roots-using-marker-files",level:3},{value:"Examples",id:"examples",level:2},{value:"<code>src/&lt;lang&gt;</code> setup",id:"srclang-setup",level:3},{value:"Project:",id:"project",level:4},{value:"Example imports:",id:"example-imports",level:4},{value:"Config:",id:"config",level:4},{value:"Multiple top-level projects",id:"multiple-top-level-projects",level:3},{value:"Project:",id:"project-1",level:4},{value:"Example imports:",id:"example-imports-1",level:4},{value:"Config:",id:"config-1",level:4},{value:"No source root",id:"no-source-root",level:3},{value:"Project:",id:"project-2",level:4},{value:"Example imports:",id:"example-imports-2",level:4},{value:"Config:",id:"config-2",level:4}];function p(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Configuring Pants to understand your imports."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.admonition,{title:"Go and Shell can skip this page",type:"note",children:[(0,t.jsxs)(n.p,{children:["Go does have a notion of source roots: where your ",(0,t.jsx)(n.code,{children:"go.mod"})," is located. However, that is handled automatically by Pants without you needing to follow this page."]}),(0,t.jsx)(n.p,{children:"Shell does not have any notion of source roots."})]}),"\n",(0,t.jsx)(n.h2,{id:"what-are-source-roots",children:"What are source roots?"}),"\n",(0,t.jsxs)(n.p,{children:["Some project layouts use top-level folders for namespace purposes, but have the code live underneath. However, the code's imports will ignore these top-level folders, thanks to mechanisms like the ",(0,t.jsx)(n.code,{children:"$PYTHONPATH"})," and the JVM classpath. ",(0,t.jsx)(n.em,{children:"Source roots"})," are a generic equivalent of these concepts."]}),"\n",(0,t.jsx)(n.p,{children:"For example, given this Python project:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"src\n\u2514\u2500\u2500 python\n    \u2514\u2500\u2500 project\n        \u251C\u2500\u2500 __init__.py\n        \u251C\u2500\u2500 app.py\n        \u251C\u2500\u2500 config\n        \u2502 \u251C\u2500\u2500 __init__.py\n        \u2502 \u2514\u2500\u2500 prod.json\n        \u2514\u2500\u2500 util\n            \u251C\u2500\u2500 __init__.py\n            \u2514\u2500\u2500 math.py\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You would likely set ",(0,t.jsx)(n.code,{children:"PYTHONPATH=src/python"})," and use imports like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from project.app import App\nfrom project.util.math import add_two\n\npkgutil.get_data("project.config", "prod.json")\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In the example above, ",(0,t.jsx)(n.code,{children:"src/python"})," is a source root. So, when some code says ",(0,t.jsx)(n.code,{children:"from project.app import App"}),", Pants can know that this corresponds to the code in ",(0,t.jsx)(n.code,{children:"src/python/project/app.py"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"configuring-source-roots",children:"Configuring source roots"}),"\n",(0,t.jsx)(n.p,{children:"There are two ways to configure source roots:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Using patterns"}),"\n",(0,t.jsx)(n.li,{children:"Using marker files"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["You can mix and match between both styles. Run ",(0,t.jsx)(n.code,{children:"pants roots"})," to see what Pants is using:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"pants roots\nsrc/assets\nsrc/python\nsrc/rust\n"})}),"\n",(0,t.jsx)(n.h3,{id:"configuring-source-roots-using-patterns",children:"Configuring source roots using patterns"}),"\n",(0,t.jsx)(n.p,{children:"You can provide a set of patterns that match your source roots:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:"[source]\nroot_patterns = [\n  '/src/python',\n  '/test/python',\n]\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"/"})," prefix means that the source root is located at the build root, so it will match ",(0,t.jsx)(n.code,{children:"src/python"}),", but not ",(0,t.jsx)(n.code,{children:"project1/src/python"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["You can leave off the ",(0,t.jsx)(n.code,{children:"/"})," prefix to match any directory whose suffix matches a pattern. For example, ",(0,t.jsx)(n.code,{children:'root_patterns = ["src/python"]'})," would consider all of these to be source roots, if they exist:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"src/python"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"project1/src/python"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["You can use ",(0,t.jsx)(n.code,{children:"*"})," as a glob. For example, ",(0,t.jsx)(n.code,{children:'root_patterns = ["/src/*"]'})," would consider all of these to be source roots:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"src/python"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"src/java"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"src/assets"})}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"configuring-no-source-roots",children:"Configuring no source roots"}),"\n",(0,t.jsx)(n.p,{children:"Many projects do not have any top-level folders used for namespacing."}),"\n",(0,t.jsx)(n.p,{children:"For example, given this Python project:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"project\n\u251C\u2500\u2500 __init__.py\n\u251C\u2500\u2500 app.py\n\u251C\u2500\u2500 config\n\u2502 \u251C\u2500\u2500 __init__.py\n\u2502 \u2514\u2500\u2500 prod.json\n\u2514\u2500\u2500 util\n    \u251C\u2500\u2500 __init__.py\n    \u2514\u2500\u2500 math.py\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You would likely ",(0,t.jsx)(n.em,{children:"not"})," set ",(0,t.jsx)(n.code,{children:"PYTHONPATH"})," and would still use imports like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from project.app import App\nfrom project.util.math import add_two\n\npkgutil.get_data("project.config", "prod.json")\n'})}),"\n",(0,t.jsx)(n.p,{children:"If you have no source roots, use this config:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[source]\nroot_patterns = ["/"]\n'})}),"\n",(0,t.jsxs)(n.admonition,{title:"Default source roots",type:"note",children:[(0,t.jsxs)(n.p,{children:["The default value of the ",(0,t.jsx)(n.code,{children:"root_patterns"})," config key is ",(0,t.jsx)(n.code,{children:'["/", "src", "src/python", "src/py", "src/java", "src/scala", "src/thrift", "src/protos", "src/protobuf"]'}),"."]}),(0,t.jsx)(n.p,{children:"These capture a range of common cases, including a source root at the root of the repository. If your source roots match these patterns, you don't need to explicitly configure them."})]}),"\n",(0,t.jsx)(n.h3,{id:"configuring-source-roots-using-marker-files",children:"Configuring source roots using marker files"}),"\n",(0,t.jsx)(n.p,{children:"You can also denote your source roots using specially-named marker files. To do so, first pick a name (or multiple names) to use:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[source]\nmarker_filenames = ["SOURCE_ROOT"]\n'})}),"\n",(0,t.jsx)(n.p,{children:"Then, place a file of that name in each of the source roots. The contents of those files don't matter. They can be empty."}),"\n",(0,t.jsxs)(n.p,{children:["For example, given this Python repo, where we have a ",(0,t.jsx)(n.code,{children:"setup.py"})," for each distinct project:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:".\n\u251C\u2500\u2500 server\n\u2502 \u251C\u2500\u2500 server\n\u2502 \u2502 \u251C\u2500\u2500 __init__.py\n\u2502 \u2502 \u2514\u2500\u2500 app.py\n\u2502 \u2514\u2500\u2500 setup.py\n\u2514\u2500\u2500 utils\n    \u251C\u2500\u2500 setup.py\n    \u2514\u2500\u2500 utils\n        \u251C\u2500\u2500 __init__.py\n        \u251C\u2500\u2500 math.py\n        \u2514\u2500\u2500 strutil.py\n"})}),"\n",(0,t.jsx)(n.p,{children:"We could use this config:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[source]\nmarker_filenames = ["setup.py"]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["We can then run ",(0,t.jsx)(n.code,{children:"pants roots"})," to find these source roots used:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"pants roots\nserver\nutils\n"})}),"\n",(0,t.jsx)(n.p,{children:"This means that Pants would work with these imports:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import server.app\nfrom utils.strutil import capitalize\n"})}),"\n",(0,t.jsx)(n.p,{children:"Whereas these imports are invalid:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import server.server.app\nfrom utils.utils.strutil import capitalize\n"})}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.p,{children:"These project structures are all valid; Pants does not expect you to reorganize your codebase to use the tool."}),"\n",(0,t.jsxs)(n.h3,{id:"srclang-setup",children:[(0,t.jsx)(n.code,{children:"src/<lang>"})," setup"]}),"\n",(0,t.jsx)(n.p,{children:'This setup is common in "polyglot" repositories: i.e. repos with multiple languages.'}),"\n",(0,t.jsx)(n.h4,{id:"project",children:"Project:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:".\n\u251C\u2500\u2500 3rdparty\n\u2502 \u251C\u2500\u2500 java\n\u2502 \u2502 \u2514\u2500\u2500 ivy.xml\n\u2502 \u2514\u2500\u2500 python\n\u2502     \u2514\u2500\u2500 requirements.txt\n\u251C\u2500\u2500 src\n\u2502 \u251C\u2500\u2500 java\n\u2502 \u2502 \u2514\u2500\u2500 org\n\u2502 \u2502     \u2514\u2500\u2500 pantsbuild\n\u2502 \u2502         \u2514\u2500\u2500 project\n\u2502 \u2502             \u251C\u2500\u2500 App.java\n\u2502 \u2502             \u2514\u2500\u2500 util\n\u2502 \u2502                 \u2514\u2500\u2500 Math.java\n\u2502 \u2514\u2500\u2500 python\n\u2502     \u2514\u2500\u2500 project\n\u2502         \u251C\u2500\u2500 __init__.py\n\u2502         \u251C\u2500\u2500 app.py\n\u2502         \u251C\u2500\u2500 config\n\u2502         \u2502 \u251C\u2500\u2500 __init__.py\n\u2502         \u2502 \u2514\u2500\u2500 prod.json\n\u2502         \u2514\u2500\u2500 util\n\u2502             \u251C\u2500\u2500 __init__.py\n\u2502             \u2514\u2500\u2500 math.py\n\u2514\u2500\u2500 test\n    \u2514\u2500\u2500 python\n        \u2514\u2500\u2500 project\n            \u251C\u2500\u2500 __init__.py\n            \u2514\u2500\u2500 util\n                \u251C\u2500\u2500 __init__.py\n                \u2514\u2500\u2500 test_math.py\n"})}),"\n",(0,t.jsx)(n.p,{children:"While we have tests in a separate source root here, it's also valid to have tests colocated with their src files."}),"\n",(0,t.jsx)(n.h4,{id:"example-imports",children:"Example imports:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# Python\nfrom project.app import App\nfrom project.util.test_math import test_add_2\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"// Java\nimport org.pantsbuild.project.App\nimport org.pantsbuild.project.util.Math\n"})}),"\n",(0,t.jsx)(n.h4,{id:"config",children:"Config:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[source]\nroot_patterns = [\n    "/src/java",\n    "/src/python",\n    "/test/python",\n]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note that we organized our 3rdparty requirements in the top-level folders ",(0,t.jsx)(n.code,{children:"3rdparty/python"})," and ",(0,t.jsx)(n.code,{children:"3rdparty/java"}),", but we do not need to include them as source roots because we do not have any first-party code there."]}),"\n",(0,t.jsx)(n.h3,{id:"multiple-top-level-projects",children:"Multiple top-level projects"}),"\n",(0,t.jsx)(n.h4,{id:"project-1",children:"Project:"}),"\n",(0,t.jsx)(n.p,{children:"This layout has lots of nesting; this is only one possible way to organize the repository."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:".\n\u251C\u2500\u2500 ads\n\u2502 \u2514\u2500\u2500 py\n\u2502     \u2514\u2500\u2500 ads\n\u2502         \u251C\u2500\u2500 __init__.py\n\u2502         \u251C\u2500\u2500 billing\n\u2502         \u2502 \u251C\u2500\u2500 __init__.py\n\u2502         \u2502 \u2514\u2500\u2500 calculate_bill.py\n\u2502         \u2514\u2500\u2500 targeting\n\u2502             \u251C\u2500\u2500 __init__.py\n\u2502             \u2514\u2500\u2500 validation.py\n\u251C\u2500\u2500 base\n\u2502 \u2514\u2500\u2500 py\n\u2502     \u2514\u2500\u2500 base\n\u2502         \u251C\u2500\u2500 __init__.py\n\u2502         \u251C\u2500\u2500 models\n\u2502         \u2502 \u251C\u2500\u2500 __init__.py\n\u2502         \u2502 \u251C\u2500\u2500 org.py\n\u2502         \u2502 \u2514\u2500\u2500 user.py\n\u2502         \u2514\u2500\u2500 util\n\u2502             \u251C\u2500\u2500 __init__.py\n\u2502             \u2514\u2500\u2500 math.py\n\u2514\u2500\u2500 news\n    \u2514\u2500\u2500 js\n        \u2514\u2500\u2500 spa.js\n"})}),"\n",(0,t.jsx)(n.h4,{id:"example-imports-1",children:"Example imports:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import ads.billing.calculate_bill\nfrom base.models.user import User\nfrom base.util.math import add_two\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Note that even though the projects live in different top-level folders, you are still able to import from other projects. If you would like to limit this, you can use ",(0,t.jsx)(n.code,{children:"pants dependents"})," or ",(0,t.jsx)(n.code,{children:"pants dependencies"})," in CI to track where imports are being used. See ",(0,t.jsx)(n.a,{href:"/dev/docs/using-pants/project-introspection",children:"Project introspection"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"config-1",children:"Config:"}),"\n",(0,t.jsx)(n.p,{children:"Either of these are valid and they have the same result:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[source]\nroot_patterns = [\n  "/ads/py",\n  "/base/py",\n  "/new/js",\n]\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[source]\nroot_patterns = [\n  "py",\n  "js",\n]\n'})}),"\n",(0,t.jsx)(n.h3,{id:"no-source-root",children:"No source root"}),"\n",(0,t.jsx)(n.p,{children:"Warning: while this project structure is valid, it often does not scale as well as your codebase grows, such as adding new languages."}),"\n",(0,t.jsx)(n.h4,{id:"project-2",children:"Project:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:".\n\u251C\u2500\u2500 project\n\u2502 \u251C\u2500\u2500 __init__.py\n\u2502 \u251C\u2500\u2500 app.py\n\u2502 \u251C\u2500\u2500 config\n\u2502 \u2502 \u251C\u2500\u2500 __init__.py\n\u2502 \u2502 \u2514\u2500\u2500 prod.json\n\u2502 \u2514\u2500\u2500 util\n\u2502     \u251C\u2500\u2500 __init__.py\n\u2502     \u2514\u2500\u2500 math.py\n\u2514\u2500\u2500 pyproject.toml\n"})}),"\n",(0,t.jsx)(n.h4,{id:"example-imports-2",children:"Example imports:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from project.app import App\nfrom project.util.math import add_two\n\npkgutil.get_data("project.config", "prod.json")\n'})}),"\n",(0,t.jsx)(n.h4,{id:"config-2",children:"Config:"}),"\n",(0,t.jsx)(n.p,{children:"Either of these are valid and they have the same result:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[source]\nroot_patterns = ["/"]\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[source]\nmarker_filenames = ["pyproject.toml"]\n'})})]})}function d(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},848193(e,n,o){o.d(n,{R:()=>i,x:()=>c});var s=o(830758);let t={},r=s.createContext(t);function i(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(r.Provider,{value:n},e.children)}},401695(e){e.exports=JSON.parse('{"id":"docs/using-pants/key-concepts/source-roots","title":"Source roots","description":"Configuring Pants to understand your imports.","source":"@site/docs/docs/using-pants/key-concepts/source-roots.mdx","sourceDirName":"docs/using-pants/key-concepts","slug":"/docs/using-pants/key-concepts/source-roots","permalink":"/dev/docs/using-pants/key-concepts/source-roots","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/using-pants/key-concepts/source-roots.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Source roots","sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"Backends","permalink":"/dev/docs/using-pants/key-concepts/backends"},"next":{"title":"Troubleshooting / common issues","permalink":"/dev/docs/using-pants/troubleshooting-common-issues"}}')}}]);