"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["796791"],{494092(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var o=t(850925),s=t(886070),i=t(848193);let r={title:"Kubeconform",sidebar_position:999},a,c={},d=[{value:"Overview",id:"overview",level:2},{value:"Validating charts and deployments",id:"validating-charts-and-deployments",level:2}];function l(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",hr:"hr",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["The Helm backend has opt-in support for using ",(0,s.jsx)(n.a,{href:"https://github.com/yannh/kubeconform",children:"Kubeconform"})," as a validation tool for both Helm charts and deployments. This gives the extra confidence that the templates defined in the different charts are conformant to a Kubernetes version or specification, plus the additional benefit of ensuring that their final version (when used in deployments) also meets that criteria."]}),"\n",(0,s.jsxs)(n.p,{children:["To enable the usage of Kubeconform, first we need to activate the relevant backend in ",(0,s.jsx)(n.code,{children:"pants.toml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = [\n  ...\n  "pants.backend.experimental.helm.check.kubeconform",\n  ...\n]\n'})}),"\n",(0,s.jsxs)(n.p,{children:["This will enable the ",(0,s.jsx)(n.code,{children:"kubeconform"})," subsystem in our workspace and enrich our ",(0,s.jsx)(n.code,{children:"helm_chart"})," and ",(0,s.jsx)(n.code,{children:"helm_deployment"})," with common fields that can be used to fine tune Kubeconform's behaviour in each of our targets."]}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsxs)(n.mdxAdmonitionTitle,{children:["Extra documentation on ",(0,s.jsx)(n.code,{children:"kubeconform"})]}),(0,s.jsxs)(n.p,{children:["Enabling the backend will add the ",(0,s.jsx)(n.code,{children:"kubeconform"})," subsystem in our workspace and enrich our ",(0,s.jsx)(n.code,{children:"helm_chart"})," and ",(0,s.jsx)(n.code,{children:"helm_deployment"})," with common fields that can be used to fine tune Kubeconform's behaviour in each of our targets. Please run ",(0,s.jsx)(n.code,{children:"pants help kubeconform"})," as well as ",(0,s.jsx)(n.code,{children:"pants help helm_chart"}),"/",(0,s.jsx)(n.code,{children:"pants help helm_deployment"})," after enabling the backend to consult the different configuration settings."]})]}),"\n",(0,s.jsx)(n.h2,{id:"validating-charts-and-deployments",children:"Validating charts and deployments"}),"\n",(0,s.jsxs)(n.p,{children:["After enabling the backend, we can run the ",(0,s.jsx)(n.code,{children:"check"})," goal in both ",(0,s.jsx)(n.code,{children:"helm_chart"})," and ",(0,s.jsx)(n.code,{children:"helm_deployment"})," targets as we please:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u276F pants check ::\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The check always happens in the rendered form of the Helm chart in question. In the case of ",(0,s.jsx)(n.code,{children:"helm_chart"})," targets, the chart will be rendered as has been defined, using the default companion ",(0,s.jsx)(n.code,{children:"values.yaml"})," (or ",(0,s.jsx)(n.code,{children:"values.yml"}),") file defined for the chart."]}),"\n",(0,s.jsxs)(n.p,{children:["For ",(0,s.jsx)(n.code,{children:"helm_deployment"})," targets, the referenced chart will be rendered using the deployment sources and other settings like inline values, etc. This will also include all post-renderers defined for that given deployment (in case any has been defined). The effect this has is that running ",(0,s.jsx)(n.code,{children:"pants check src/helm/mydeployment"})," requires a bit more of work under the hood than checking a standalone chart."]}),"\n",(0,s.jsxs)(n.p,{children:["You can use the ",(0,s.jsx)(n.code,{children:"skip_kubeconform"})," field in both ",(0,s.jsx)(n.code,{children:"helm_chart"})," or ",(0,s.jsx)(n.code,{children:"helm_deployment"})," to prevent running it against a given target in case you consider it to be a redundant check."]}),"\n",(0,s.jsx)(n.admonition,{title:"Skipping check on publishable charts",type:"caution",children:(0,s.jsxs)(n.p,{children:["On a workspace that contains both ",(0,s.jsx)(n.code,{children:"helm_deployment"})," and ",(0,s.jsx)(n.code,{children:"helm_chart"})," targets is easy to consider that checking the charts is a redundant task as doing it so on the deployment is effectively the same. This is a safe assumption as long as you don't publish your charts to be consumed elsewhere. For that specific case we recommend also checking the standalone chart as that gives assurance that the chart package itself is sound.\nRegardless of that, running Kubeconform on a standalone chart is a pretty lightweight operation so unless you are facing extremelly long build times, better to not skip it."]})})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},848193(e,n,t){t.d(n,{R:()=>r,x:()=>a});var o=t(830758);let s={},i=o.createContext(s);function r(e){let n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(i.Provider,{value:n},e.children)}},850925(e){e.exports=JSON.parse('{"id":"docs/helm/kubeconform","title":"Kubeconform","description":"---","source":"@site/versioned_docs/version-2.31/docs/helm/kubeconform.mdx","sourceDirName":"docs/helm","slug":"/docs/helm/kubeconform","permalink":"/prerelease/docs/helm/kubeconform","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/helm/kubeconform.mdx","tags":[],"version":"2.31","sidebarPosition":999,"frontMatter":{"title":"Kubeconform","sidebar_position":999},"sidebar":"docsSidebar","previous":{"title":"Deployments","permalink":"/prerelease/docs/helm/deployments"},"next":{"title":"Terraform","permalink":"/prerelease/docs/terraform/"}}')}}]);