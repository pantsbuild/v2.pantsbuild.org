"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["832429"],{516687(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var s=t(685337),i=t(886070),o=t(848193);let a={title:"Go overview",sidebar_position:0},r,l={},d=[{value:"Initial setup",id:"initial-setup",level:2},{value:"The <code>embed</code> directive and <code>resource</code> targets",id:"the-embed-directive-and-resource-targets",level:3},{value:"Package and run binaries",id:"package-and-run-binaries",level:2},{value:"Compile code",id:"compile-code",level:2},{value:"Run tests",id:"run-tests",level:2},{value:"Loose files in tests (<code>testdata</code>)",id:"loose-files-in-tests-testdata",level:3},{value:"Timeouts",id:"timeouts",level:3},{value:"Gofmt",id:"gofmt",level:2},{value:"golangci-lint",id:"golangci-lint",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Pants's support for Golang."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.admonition,{title:"Go support is beta stage",type:"caution",children:[(0,i.jsxs)(n.p,{children:["We are done implementing the initial core functionality for Pants's initial Go support (",(0,i.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/issues/17447",children:"tracked here"}),"). However, there may be some edge cases we aren't yet handling. There are also some features that are not yet supported like vendoring, which we'd love your input on how to prioritize!"]}),(0,i.jsxs)(n.p,{children:["Please share feedback for what you need to use Pants with your Go project by either ",(0,i.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/issues/new/choose",children:"opening a GitHub issue"})," or ",(0,i.jsx)(n.a,{href:"/community/members",children:"joining our Slack"}),"!"]})]}),"\n",(0,i.jsxs)(n.admonition,{title:"Why use Pants with Go?",type:"tip",children:[(0,i.jsx)(n.p,{children:"Go's builtin tooling is already excellent! Many projects may be fine only using Go's tooling, although Pants offers some unique benefits:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A consistent interface for all languages/tools in your repository, such as being able to run ",(0,i.jsx)(n.code,{children:"pants fmt lint check test package"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Integration with Git, such as running ",(0,i.jsx)(n.code,{children:"pants --changed-since=HEAD test"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Caching, such as caching test results on a per-package basis."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/2.20/docs/using-pants/remote-caching-and-execution/",children:"Remote execution and remote caching"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/2.20/docs/using-pants/project-introspection",children:"Advanced project introspection"}),", such as finding all code that transitively depends on a certain package."]}),"\n"]})]}),"\n",(0,i.jsx)(n.admonition,{title:"Example Go repository",type:"note",children:(0,i.jsxs)(n.p,{children:["Check out ",(0,i.jsx)(n.a,{href:"https://github.com/pantsbuild/example-golang",children:"github.com/pantsbuild/example-golang"})," to try out Pants's Go support."]})}),"\n",(0,i.jsx)(n.h2,{id:"initial-setup",children:"Initial setup"}),"\n",(0,i.jsxs)(n.p,{children:["First, activate the Go backend in ",(0,i.jsx)(n.code,{children:"pants.toml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = ["pants.backend.experimental.go"]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You may want to set the option ",(0,i.jsx)(n.code,{children:"[golang].minimum_expected_version"})," to a value like ",(0,i.jsx)(n.code,{children:'"1.17"'}),". Pants will use this to find a Go distribution that is the same version or newer. You still set your projects' Go version with ",(0,i.jsx)(n.code,{children:"go.mod"})," with the ",(0,i.jsx)(n.code,{children:"go"})," directive; this option is only used for Pants to discover a compatible Go distribution."]}),"\n",(0,i.jsxs)(n.p,{children:["You can also set ",(0,i.jsx)(n.code,{children:"[golang].go_search_paths"})," to influence where Pants looks for Go, e.g. ",(0,i.jsx)(n.code,{children:'["/usr/bin"]'}),". It defaults to your ",(0,i.jsx)(n.code,{children:"PATH"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Then run ",(0,i.jsx)(n.a,{href:"/2.20/docs/getting-started/initial-configuration#5-generate-build-files",children:(0,i.jsx)(n.code,{children:"pants tailor ::"})})," to generate BUILD files. This will add a ",(0,i.jsx)(n.code,{children:"go_mod"})," target where you have your ",(0,i.jsx)(n.code,{children:"go.mod"})," file, a ",(0,i.jsx)(n.code,{children:"go_package"})," target for every directory with a ",(0,i.jsx)(n.code,{children:".go"})," file, and a ",(0,i.jsx)(n.code,{children:"go_binary"})," target in every directory where you have ",(0,i.jsx)(n.code,{children:"package main"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u276F pants tailor ::\nCreated BUILD:\n  - Add go_mod target root\nCreated cmd/deploy/BUILD:\n  - Add go_binary target bin\n  - Add go_package target deploy\nCreated cmd/runner/BUILD:\n  - Add go_binary target bin\n  - Add go_package target runner\nCreated pkg/deploy/BUILD:\n  - Add go_package target deploy\nCreated pkg/runner/BUILD:\n  - Add go_package target runner\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Each ",(0,i.jsx)(n.code,{children:"go_package"})," target allows you to set metadata for that directory, such as the ",(0,i.jsx)(n.code,{children:"test_timeout"})," field. However, Pants uses sensible defaults so, usually, you can simply use what was generated by ",(0,i.jsx)(n.code,{children:"tailor"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"go_mod"})," target generates a ",(0,i.jsx)(n.code,{children:"go_third_party_package"})," target for each package belonging to the modules declared in your ",(0,i.jsx)(n.code,{children:"go.mod"}),". You will rarely need to interact with these directly, thanks to dependency inference."]}),"\n",(0,i.jsxs)(n.p,{children:["You can run ",(0,i.jsx)(n.code,{children:"pants list ::"})," to see all targets in your project, including generated ",(0,i.jsx)(n.code,{children:"go_third_party_package"})," targets:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u276F pants list\n...\n//:root#golang.org/x/net/ipv4\n//:root#golang.org/x/net/ipv6\n...\ncmd/deploy:bin\ncmd/deploy:deploy\ncmd/runner:bin\ncmd/runner:runner\npkg/deploy:deploy\npkg/runner:runner\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"caution",children:[(0,i.jsxs)(n.mdxAdmonitionTitle,{children:[(0,i.jsx)(n.code,{children:"go.mod"})," and ",(0,i.jsx)(n.code,{children:"go.sum"})," need to be up-to-date"]}),(0,i.jsxs)(n.p,{children:["Pants does not yet update your ",(0,i.jsx)(n.code,{children:"go.mod"})," and ",(0,i.jsx)(n.code,{children:"go.sum"})," for you; it only reads these files when downloading modules. Run ",(0,i.jsx)(n.code,{children:"go mod download all"})," to make sure these files are correct."]})]}),"\n",(0,i.jsxs)(n.h3,{id:"the-embed-directive-and-resource-targets",children:["The ",(0,i.jsx)(n.code,{children:"embed"})," directive and ",(0,i.jsx)(n.code,{children:"resource"})," targets"]}),"\n",(0,i.jsxs)(n.p,{children:["To use the ",(0,i.jsxs)(n.a,{href:"https://pkg.go.dev/embed",children:[(0,i.jsx)(n.code,{children:"embed"})," directive"]}),", you must first teach Pants about the ",(0,i.jsx)(n.a,{href:"/2.20/docs/using-pants/assets-and-archives",children:"files"})," with the ",(0,i.jsx)(n.code,{children:"resource"})," / ",(0,i.jsx)(n.code,{children:"resources"})," targets:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Add a ",(0,i.jsx)(n.code,{children:"resource"})," or ",(0,i.jsx)(n.code,{children:"resources"})," target with the embedded files in the ",(0,i.jsx)(n.code,{children:"source"})," / ",(0,i.jsx)(n.code,{children:"sources"})," field, respectively."]}),"\n",(0,i.jsxs)(n.li,{children:["Add that target to the ",(0,i.jsx)(n.code,{children:"dependencies"})," field of the relevant ",(0,i.jsx)(n.code,{children:"go_package"})," target."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="pkg/runner/BUILD"',children:'go_package(dependencies=[":embeds"])\n\nresources(name="embeds", sources=["hello.txt"])\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",metastring:'title="pkg/runner/lib.go"',children:'package runner\n\nimport _ "embed"\n\n//go:embed hello.txt\nvar s string\nprint(s)\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",metastring:'title="pkg/runner/hello.txt"',children:"Hello world!\n"})}),"\n",(0,i.jsx)(n.h2,{id:"package-and-run-binaries",children:"Package and run binaries"}),"\n",(0,i.jsxs)(n.p,{children:["To run a binary, use ",(0,i.jsx)(n.code,{children:"pants run path/to/main_pkg:"})," (note the colon). You can pass through arguments with ",(0,i.jsx)(n.code,{children:"--"}),", like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u276F pants run cmd/deploy: -- --help\nUsage of /Users/pantsbuild/example/.pants.d/workdir/tmpzfh33ggu/cmd.deploy/bin:\n      --allow-insecure-auth        allow credentials to be passed unencrypted (i.e., no TLS)\n  -A, --auth-token-env string      name of environment variable with auth bearer token\n...\npflag: help requested\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can also package your binaries (aka ",(0,i.jsx)(n.code,{children:"go build"}),") by using ",(0,i.jsx)(n.code,{children:"pants package"}),". ",(0,i.jsx)(n.code,{children:"package ::"})," will build all your project's binaries, whereas ",(0,i.jsx)(n.code,{children:"package path/to/main_pkg:"})," will build only the binary in that directory."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u276F pants package ::\n[INFO] Wrote dist/cmd.deploy/bin\n[INFO] Wrote dist/cmd.runner/bin\n"})}),"\n",(0,i.jsxs)(n.p,{children:["By default, Pants names the binary with the scheme ",(0,i.jsx)(n.code,{children:"path.to.directory/target_name"}),", e.g. ",(0,i.jsx)(n.code,{children:"cmd.deploy/bin"}),". You can set the field ",(0,i.jsx)(n.code,{children:"output_path"})," to use a different name:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",metastring:'title="cmd/deploy/BUILD"',children:'go_binary(name="bin", output_path="deploy")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"compile-code",children:"Compile code"}),"\n",(0,i.jsxs)(n.p,{children:["To manually check that a package compiles, use ",(0,i.jsx)(n.code,{children:"pants check"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Check this package\n\u276F pants check pkg/deploy:\n\n# Check this directory and all subdirectories\n\u276F pants check pkg::\n\n# Check the whole project\n\u276F pants check ::\n"})}),"\n",(0,i.jsxs)(n.p,{children:["(Instead, you can simply run ",(0,i.jsx)(n.code,{children:"package"}),", ",(0,i.jsx)(n.code,{children:"run"}),", and ",(0,i.jsx)(n.code,{children:"test"}),". Pants will compile all the relevant packages.)"]}),"\n",(0,i.jsx)(n.h2,{id:"run-tests",children:"Run tests"}),"\n",(0,i.jsxs)(n.p,{children:["To run tests, use ",(0,i.jsx)(n.code,{children:"pants test"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Test this package\n\u276F pants test pkg/deploy:\n\n# Test this directory and all subdirectories\n\u276F pants check pkg::\n\n# Test the whole project\n\u276F pants test ::\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can pass through arguments with ",(0,i.jsx)(n.code,{children:"--"}),", e.g. ",(0,i.jsx)(n.code,{children:"pants test pkg/deploy: -- -v -run TestFoo"}),"."]}),"\n",(0,i.jsxs)(n.h3,{id:"loose-files-in-tests-testdata",children:["Loose files in tests (",(0,i.jsx)(n.code,{children:"testdata"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["To open files in your tests, use ",(0,i.jsxs)(n.a,{href:"/2.20/docs/using-pants/assets-and-archives",children:[(0,i.jsx)(n.code,{children:"file"})," / ",(0,i.jsx)(n.code,{children:"files"})]})," targets and add them as ",(0,i.jsx)(n.code,{children:"dependencies"})," to your ",(0,i.jsx)(n.code,{children:"go_package"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="pkg/runner/BUILD"',children:'go_package(dependencies=[":testdata"])\n\nfiles(name="testdata", sources=["testdata/*"])\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",metastring:'title="pkg/runner/foo_test.go"',children:'package foo\n\nimport (\n "os"\n "testing"\n)\n\nfunc TestFilesAvailable(t *testing.T) {\n _, err := os.Stat("testdata/f.txt")\n if err != nil {\n  t.Fatalf("Could not stat pkg/runner/testdata/f.txt: %v", err)\n }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",metastring:'title="pkg/runner/testdata/f.txt"',children:'"Hello world!"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Traditionally in Go, these files are located in the ",(0,i.jsx)(n.code,{children:"testdata"})," directory. However, with Pants, you can place the files wherever you'd like. Pants sets the working directory to the path of the ",(0,i.jsx)(n.code,{children:"go_package"}),", which allows you to open files regardless of where there are in your repository, such as with ",(0,i.jsx)(n.code,{children:'os.Stat("../f.txt")'}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"timeouts",children:"Timeouts"}),"\n",(0,i.jsx)(n.p,{children:"Pants can cancel tests that take too long, which is useful to prevent tests from hanging indefinitely."}),"\n",(0,i.jsxs)(n.p,{children:["To add a timeout, set the ",(0,i.jsx)(n.code,{children:"test_timeout"})," field to an integer value of seconds, like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="BUILD"',children:"go_package(test_timeout=120)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can also set a default value and a maximum value in ",(0,i.jsx)(n.code,{children:"pants.toml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:"[test]\ntimeout_default = 60\ntimeout_maximum = 600\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If a target sets its ",(0,i.jsx)(n.code,{children:"timeout"})," higher than ",(0,i.jsx)(n.code,{children:"[test].timeout_maximum"}),", Pants will use the value in ",(0,i.jsx)(n.code,{children:"[test].timeout_maximum"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Use the option ",(0,i.jsx)(n.code,{children:"pants test --no-timeouts"})," to temporarily disable timeouts, e.g. when debugging."]}),"\n",(0,i.jsx)(n.h2,{id:"gofmt",children:"Gofmt"}),"\n",(0,i.jsxs)(n.p,{children:["Gofmt is activated by default when you activate the Go backend. Simply run ",(0,i.jsx)(n.code,{children:"pants fmt"})," and ",(0,i.jsx)(n.code,{children:"pants lint"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Format a single directory\n\u276F pants fmt cmd/deploy:\n\n# Format this directory and all subdirectories\n\u276F pants fmt cmd::\n\n# Check that the whole project is formatted\n\u276F pants lint ::\n\n# Format all changed files\n\u276F pants --changed-since=HEAD fmt\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you'd like to disable Gofmt, set this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",metastring:'title="pants.toml"',children:"[gofmt]\nskip = true\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To only run Gofmt, use ",(0,i.jsx)(n.code,{children:"--fmt-only"})," and ",(0,i.jsx)(n.code,{children:"--lint-only"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"\u276F pants fmt --only=gofmt ::\n"})}),"\n",(0,i.jsx)(n.h2,{id:"golangci-lint",children:"golangci-lint"}),"\n",(0,i.jsxs)(n.p,{children:["Pants can run ",(0,i.jsx)(n.a,{href:"https://golangci-lint.run/",children:"golangci-lint"})," on your Go source\ncode. To activate, add this to your ",(0,i.jsx)(n.code,{children:"pants.toml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tomls",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = [\n  "pants.backend.experimental.go",\n  "pants.backend.experimental.go.lint.golangci_lint",\n]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Now you can run ",(0,i.jsx)(n.code,{children:"pants lint"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"$ pants lint main.go\n20:39:43.10 [ERROR] Completed: Lint with golangci-lint - golangci-lint failed (exit code 1).\nmain.go:5:6: func `bad` is unused (unused)\nfunc bad() {\n      ^\n\n\n\n\u2715 golangci-lint failed.\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Pants will automatically include any relevant ",(0,i.jsx)(n.code,{children:".golangci.yml"}),", ",(0,i.jsx)(n.code,{children:".golangci.yaml"}),",\n",(0,i.jsx)(n.code,{children:".golangci.json"}),", or ",(0,i.jsx)(n.code,{children:".golangci.toml"})," files in the run. You can also pass\ncommand line arguments with ",(0,i.jsx)(n.code,{children:"--golangci-lint-args='--tests --fast' or permanently set them in"}),"pants.toml`."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[golangci-lint]\nargs = ["--fast", "--tests"]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Temporarily disable golangci-lint with ",(0,i.jsx)(n.code,{children:"--golangci-lint-skip"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pants --golangci-lint-skip lint ::\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Only run golangci-lint with ",(0,i.jsx)(n.code,{children:"--lint-only"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pants lint --only=golangci-lint ::\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"Benefit of Pants: golangci-lint runs in parallel with other linters",type:"tip",children:(0,i.jsxs)(n.p,{children:["Pants will attempt to run all activated linters and formatters at the same time for improved performance, including ",(0,i.jsx)(n.a,{href:"/2.20/docs/python/overview/linters-and-formatters",children:"Python"}),", Shell, Java, and Scala linters. You can see this through Pants's dynamic UI."]})})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},848193(e,n,t){t.d(n,{R:()=>a,x:()=>r});var s=t(830758);let i={},o=s.createContext(i);function a(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}},685337(e){e.exports=JSON.parse('{"id":"docs/go/index","title":"Go overview","description":"Pants\'s support for Golang.","source":"@site/versioned_docs/version-2.20/docs/go/index.mdx","sourceDirName":"docs/go","slug":"/docs/go/","permalink":"/2.20/docs/go/","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/go/index.mdx","tags":[],"version":"2.20","sidebarPosition":0,"frontMatter":{"title":"Go overview","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Jupyter","permalink":"/2.20/docs/python/integrations/jupyter"},"next":{"title":"Integrations","permalink":"/2.20/docs/go/integrations/"}}')}}]);