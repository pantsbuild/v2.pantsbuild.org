"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["870577"],{738398(e,n,t){t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var s=t(554716),r=t(886070),o=t(848193);let a={authors:["joshua"],tags:["python"]},i="Two hermetic Pythons",h={authorsImageUrls:[void 0]},l=[{value:"Case 1: A Pants-internal Python",id:"case-1-a-pants-internal-python",level:2},{value:"Case 2: A Pants-provided Python",id:"case-2-a-pants-provided-python",level:2},{value:"How to preview the new hermetic Pythons",id:"how-to-preview-the-new-hermetic-pythons",level:2}];function c(e){let n={a:"a",code:"code",em:"em",h2:"h2",hr:"hr",li:"li",ol:"ol",p:"p",...(0,o.R)(),...e.components},{CaptionedImg:s}=n;return s||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CaptionedImg",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s,{src:t(470950).A,children:(0,r.jsxs)(n.p,{children:["Photo by ",(0,r.jsx)(n.a,{href:"https://unsplash.com/@hambourine?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Hamish\nDuncan"}),"\n/\n",(0,r.jsx)(n.a,{href:"https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Unsplash"})]})}),"\n",(0,r.jsx)(n.p,{children:"Make builds more reliable and save time doing so. The upcoming Pants 2.16 introduces a couple of exciting changes to make Pants safer, faster, and more user-friendly. Here we preview a pair of changes which increase hermeticity."}),"\n","\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:["Recently, ",(0,r.jsx)(n.a,{href:"/blog/2023/02/23/the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants",children:"Pants got a new launcher binary"})," that has a Python interpreter embedded. This was an important step forward for decoupling running Pants from what's installed on the system. However, there was still work to do; internally Pants still scoured the running machine looking for Python binaries for 2 use-cases:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"For Pants' own ability to run Python scripts as part of the build. Python is an intuitive and cross-platform scripting language. As such it is very convenient to use it for complex scripts (like file locking, parsing complicated text, or ironically, determining a compatible Python interpreter given interpreter constraints)."}),"\n",(0,r.jsxs)(n.li,{children:["For running user Python code. If you enable ",(0,r.jsx)(n.code,{children:"pants.backend.python"})," one or more Python interpreters need to be found/used to run your code, tools, and tests."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"case-1-a-pants-internal-python",children:"Case 1: A Pants-internal Python"}),"\n",(0,r.jsxs)(n.p,{children:["For case 1 where Pants just need ",(0,r.jsx)(n.em,{children:"some"})," Python interpreter to run scripts, we take a two-pronged approach."]}),"\n",(0,r.jsxs)(n.p,{children:["For ",(0,r.jsx)(n.a,{href:"/blog/2023/02/24/pants-2-15",children:"Docker builds"})," we download and sandbox a ",(0,r.jsx)(n.a,{href:"https://gregoryszorc.com/docs/python-build-standalone/main/",children:"Python Build Standalone"})," (the same kind of Python interpreter the new Pants binary launcher uses). Pants no longer dictates that a supported (or any) version of Python is present in the docker image running your build. Additionally, Pants is able to choose which version, meaning we could upgrade to faster ",(0,r.jsx)(n.a,{href:"https://github.com/markshannon/faster-cpython/blob/master/plan.mdx",children:"CPython versions"})," as they are released."]}),"\n",(0,r.jsxs)(n.p,{children:["For local builds, we just use ",(0,r.jsx)(n.code,{children:"sys.executable"})," (the Python interpreter that's running Pants itself). Eventually, the Pants binary launcher will be the only way to run Pants, meaning a hermetic, version-pinned interpreter will be the one-and-only way Pants is run."]}),"\n",(0,r.jsx)(n.p,{children:"Combining these, the result is Pants completely decoupled from the system to run internal scripts, better hermeticity, and faster runs (by not consulting the system and by using the latest Python version available)."}),"\n",(0,r.jsx)(n.h2,{id:"case-2-a-pants-provided-python",children:"Case 2: A Pants-provided Python"}),"\n",(0,r.jsxs)(n.p,{children:["A long-standing request of Pants is to have ",(0,r.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/issues/10447",children:"Pants provide a Python interpreter"})," for running your code, tools, and tests, instead of consulting the system. Consulting the system can be time-consuming, error-prone, and results in builds with reduced hermeticity."]}),"\n",(0,r.jsxs)(n.p,{children:["Pants 2.16 has added a mechanism for plugins to provide versions of Python compatible with your code, along with an ",(0,r.jsx)(n.a,{href:"/blog/2022/11/21/quick-feedback-on-new-features-via-experimental-backends",children:"experimental"})," backend to use ",(0,r.jsx)(n.a,{href:"https://github.com/pyenv/pyenv",children:"pyenv"})," as a provider. When the backend is enabled, for each version of Python that needs to be used based on your interpreter constraints, Pants either uses a hermetic, cached version if one exists, or installs it on-the-fly (roughly takes ~2-3 minutes). This results in faster builds (no more scouring the system) as well as ensuring maximal hermeticity when running your code, your tools, and your tests."]}),"\n",(0,r.jsx)(n.h2,{id:"how-to-preview-the-new-hermetic-pythons",children:"How to preview the new hermetic Pythons"}),"\n",(0,r.jsxs)(n.p,{children:["Interested in trying out these features? Upgrade to Pants 2.16 to benefit from a hermetic internal Python. Additionally, for a hermetic Python for your code enable ",(0,r.jsx)(n.code,{children:"pants.backend.python.providers.experimental.pyenv"})," to your ",(0,r.jsx)(n.code,{children:"[GLOBAL].backend_packages"})," and start enjoying the benefits. As with any experimental backend, we encourage you to ",(0,r.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/getting-help",children:"share your feedback on Slack"}),"!"]})]})}function d(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},470950(e,n,t){t.d(n,{A:()=>s});let s=t.p+"assets/images/splash-b7ec0c8eb20425536a550449816f4cd3.jpg"},848193(e,n,t){t.d(n,{R:()=>a,x:()=>i});var s=t(830758);let r={},o=s.createContext(r);function a(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(o.Provider,{value:n},e.children)}},554716(e){e.exports=JSON.parse('{"permalink":"/blog/2023/03/31/two-hermetic-pythons","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2023-03-31-two-hermetic-pythons/index.mdx","source":"@site/blog/2023-03-31-two-hermetic-pythons/index.mdx","title":"Two hermetic Pythons","description":"Photo by [Hamish","date":"2023-03-31T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":3.14,"hasTruncateMarker":true,"authors":[{"name":"Joshua Cannon","title":"Pants Maintainer","url":"https://github.com/thejcannon","imageURL":"https://github.com/thejcannon.png","key":"joshua","page":null}],"frontMatter":{"authors":["joshua"],"tags":["python"]},"unlisted":false,"prevItem":{"title":"Tada, it\'s our new chat archive!","permalink":"/blog/2023/04/01/new-chat-archive"},"nextItem":{"title":"Environments: simpler multi-platform workflows","permalink":"/blog/2023/03/28/environments-simpler-multi-platform-workflows"}}')}}]);