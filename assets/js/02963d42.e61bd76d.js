"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["246052"],{654202(e,s,n){n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>d,metadata:()=>t,toc:()=>h});var t=n(359477),i=n(886070),r=n(848193),o=n(989898),c=n(375002);let d={title:"test_shell_command",description:"Run a script as a test via the `test` goal, with all dependencies packaged/copied available in the chroot.\n"},l,a={},h=[{value:"<code>command</code>",id:"command",level:2},{value:"<code>cache_scope</code>",id:"cache_scope",level:2},{value:"<code>description</code>",id:"description",level:2},{value:"<code>environment</code>",id:"environment",level:2},{value:"<code>execution_dependencies</code>",id:"execution_dependencies",level:2},{value:"<code>extra_env_vars</code>",id:"extra_env_vars",level:2},{value:"<code>log_output</code>",id:"log_output",level:2},{value:"<code>output_directories</code>",id:"output_directories",level:2},{value:"<code>output_files</code>",id:"output_files",level:2},{value:"<code>outputs_match_mode</code>",id:"outputs_match_mode",level:2},{value:"<code>path_env_modify</code>",id:"path_env_modify",level:2},{value:"<code>root_output_directory</code>",id:"root_output_directory",level:2},{value:"<code>runnable_dependencies</code>",id:"runnable_dependencies",level:2},{value:"<code>skip_tests</code>",id:"skip_tests",level:2},{value:"<code>tags</code>",id:"tags",level:2},{value:"<code>timeout</code>",id:"timeout",level:2},{value:"<code>tools</code>",id:"tools",level:2},{value:"<code>workdir</code>",id:"workdir",level:2}];function p(e){let s={code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.p,{children:["Run a script as a test via the ",(0,i.jsx)(s.code,{children:"test"})," goal, with all dependencies packaged/copied available in the chroot."]}),"\n",(0,i.jsx)(s.p,{children:"Example BUILD file:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:'test_shell_command(\n    name="test",\n    tools=["test"],\n    command="test -r $CHROOT/some-data-file.txt",\n    execution_dependencies=["src/project/files:data"],\n)\n'})}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"command"})," may use the ",(0,i.jsx)(s.code,{children:"{chroot}"})," marker on the command line or in environment variables to get the root directory where any dependencies are materialized during execution."]}),"\n",(0,i.jsxs)(s.p,{children:["In contrast to the ",(0,i.jsx)(s.code,{children:"run_shell_command"}),", this target is intended to run shell commands as tests and will only run them via the ",(0,i.jsx)(s.code,{children:"test"})," goal."]}),"\n",(0,i.jsxs)(s.p,{children:["Backend: ",(0,i.jsx)("span",{className:"color--primary",children:(0,i.jsx)(s.code,{children:"pants.backend.shell"})})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)("span",{className:c.A.options,children:[(0,i.jsx)(s.h2,{id:"command",children:(0,i.jsx)(s.code,{children:"command"})}),(0,i.jsxs)(o.A,{type_repr:"str",children:[(0,i.jsx)(s.p,{children:"Shell command to execute."}),(0,i.jsxs)(s.p,{children:["The command is executed as ",(0,i.jsx)(s.code,{children:"'bash -c <command>'"})," by default. If you want to invoke a binary use ",(0,i.jsx)(s.code,{children:"exec -a $0 <binary> <args>"})," as the command so that the binary gets the correct ",(0,i.jsx)(s.code,{children:"argv[0]"})," set."]})]}),(0,i.jsx)(s.h2,{id:"cache_scope",children:(0,i.jsx)(s.code,{children:"cache_scope"})}),(0,i.jsxs)(o.A,{type_repr:"'from_environment' | 'session' | 'success' | 'success_per_pantsd_restart' | None",default_repr:"'from_environment'",children:[(0,i.jsx)(s.p,{children:'Set the "cache scope" of the executed process to provided value. The cache scope determines for how long Pants will cache the result of the process execution (assuming no changes to files or dependencies invalidate the result in the meantime).'}),(0,i.jsx)(s.p,{children:"The valid values are:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"from_environment"}),": Use the default cache scope for the applicable environment in which the process will execute. This is ",(0,i.jsx)(s.code,{children:"success"})," for all environments except for ",(0,i.jsx)(s.code,{children:"experimental_workspace_environment"}),", in which case ",(0,i.jsx)(s.code,{children:"session"})," cache scope will be used."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"success"}),": Cache successful executions of the process."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"success_per_pantsd_restart"}),": Cache successful executions of the process for the life of the\napplicable pantsd process."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"session"}),": Only cache the result for a single Pants session. This will usually be a single invocation of the ",(0,i.jsx)(s.code,{children:"pants"})," tool."]}),"\n"]}),"\n"]})]}),(0,i.jsx)(s.h2,{id:"description",children:(0,i.jsx)(s.code,{children:"description"})}),(0,i.jsxs)(o.A,{type_repr:"str | None",default_repr:"None",children:[(0,i.jsx)(s.p,{children:"A human-readable description of the target."}),(0,i.jsxs)(s.p,{children:["Use ",(0,i.jsx)(s.code,{children:"pants list --documented ::"})," to see all targets with descriptions."]})]}),(0,i.jsx)(s.h2,{id:"environment",children:(0,i.jsx)(s.code,{children:"environment"})}),(0,i.jsxs)(o.A,{type_repr:"str | None",default_repr:"'__local__'",children:[(0,i.jsx)(s.p,{children:"Specify which environment target to consume environment-sensitive options from."}),(0,i.jsxs)(s.p,{children:["Once environments are defined in ",(0,i.jsx)(s.code,{children:"[environments-preview].names"}),", you can specify the environment for this target by its name. Any fields that are defined in that environment will override the values from options set by ",(0,i.jsx)(s.code,{children:"pants.toml"}),", command line values, or environment variables."]}),(0,i.jsxs)(s.p,{children:["You can specify multiple valid environments by using ",(0,i.jsx)(s.code,{children:"parametrize"}),". If ",(0,i.jsx)(s.code,{children:"__local__"})," is specified, Pants will fall back to the ",(0,i.jsx)(s.code,{children:"local_environment"})," defined for the current platform, or no environment if no such environment exists."]})]}),(0,i.jsx)(s.h2,{id:"execution_dependencies",children:(0,i.jsx)(s.code,{children:"execution_dependencies"})}),(0,i.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"None",children:[(0,i.jsx)(s.p,{children:"The execution dependencies for this command."}),(0,i.jsxs)(s.p,{children:["Dependencies specified here are those required to make the command complete successfully (e.g. file inputs, packages compiled from other targets, etc), but NOT required to make the outputs of the command useful. Dependencies that are required to use the outputs produced by this command should be specified using the ",(0,i.jsx)(s.code,{children:"output_dependencies"})," field."]}),(0,i.jsxs)(s.p,{children:["If this field is specified, dependencies from ",(0,i.jsx)(s.code,{children:"output_dependencies"})," will not be added to the execution sandbox."]}),(0,i.jsxs)(s.p,{children:["See also ",(0,i.jsx)(s.code,{children:"output_dependencies"})," and ",(0,i.jsx)(s.code,{children:"runnable_dependencies"}),"."]})]}),(0,i.jsx)(s.h2,{id:"extra_env_vars",children:(0,i.jsx)(s.code,{children:"extra_env_vars"})}),(0,i.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"None",children:[(0,i.jsx)(s.p,{children:"Additional environment variables to provide to the process."}),(0,i.jsxs)(s.p,{children:["Entries are strings in the form ",(0,i.jsx)(s.code,{children:"ENV_VAR=value"})," to use explicitly; or just ",(0,i.jsx)(s.code,{children:"ENV_VAR"})," to copy the value of a variable in Pants's own environment. ",(0,i.jsx)(s.code,{children:"fnmatch"})," globs like ",(0,i.jsx)(s.code,{children:"ENV_VAR_PREFIXED_*"})," can be used to copy multiple environment variables."]})]}),(0,i.jsx)(s.h2,{id:"log_output",children:(0,i.jsx)(s.code,{children:"log_output"})}),(0,i.jsx)(o.A,{type_repr:"bool",default_repr:"False",children:(0,i.jsx)(s.p,{children:"Set to true if you want the output logged to the console."})}),(0,i.jsx)(s.h2,{id:"output_directories",children:(0,i.jsx)(s.code,{children:"output_directories"})}),(0,i.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"()",children:[(0,i.jsxs)(s.p,{children:["Specify full directories (including recursive descendants) of output to capture, relative to the value of ",(0,i.jsx)(s.code,{children:"workdir"}),"."]}),(0,i.jsxs)(s.p,{children:["For individual files, use ",(0,i.jsx)(s.code,{children:"output_files"}),". At least one of ",(0,i.jsx)(s.code,{children:"output_files"})," and ",(0,i.jsx)(s.code,{children:"output_directories"})," must be specified."]}),(0,i.jsxs)(s.p,{children:["Relative paths (including ",(0,i.jsx)(s.code,{children:".."}),") may be used, as long as the path does not ascend further than the build root."]})]}),(0,i.jsx)(s.h2,{id:"output_files",children:(0,i.jsx)(s.code,{children:"output_files"})}),(0,i.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"()",children:[(0,i.jsxs)(s.p,{children:["Specify the output files to capture, relative to the value of ",(0,i.jsx)(s.code,{children:"workdir"}),"."]}),(0,i.jsxs)(s.p,{children:["For directories, use ",(0,i.jsx)(s.code,{children:"output_directories"}),". At least one of ",(0,i.jsx)(s.code,{children:"output_files"})," and ",(0,i.jsx)(s.code,{children:"output_directories"})," must be specified."]}),(0,i.jsxs)(s.p,{children:["Relative paths (including ",(0,i.jsx)(s.code,{children:".."}),") may be used, as long as the path does not ascend further than the build root."]})]}),(0,i.jsx)(s.h2,{id:"outputs_match_mode",children:(0,i.jsx)(s.code,{children:"outputs_match_mode"})}),(0,i.jsxs)(o.A,{type_repr:"'all' | 'all_warn' | 'allow_empty' | 'at_least_one' | 'at_least_one_warn' | None",default_repr:"'all_warn'",children:[(0,i.jsxs)(s.p,{children:["Configure whether all, or some, of the values in the ",(0,i.jsx)(s.code,{children:"output_files"})," and ",(0,i.jsx)(s.code,{children:"output_directories"}),' fields must actually match the outputs generated by the invoked process. These values are called "globs". Outputs may be matched by more than one glob.']}),(0,i.jsx)(s.p,{children:"Valid values are:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"all_warn"}),": Log a warning if any glob fails to match an output. (In other words, all globs must match to avoid a warning.) This is the default value."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"all"}),": Ensure all globs match an output or else raise an error."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"at_least_one_warn"}),": Log a warning if none of the globs match an output."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"at_least_one"}),": Ensure at least one glob matches an output or else raise an error."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"allow_empty"}),": Allow empty digests (which means nothing was captured). This disables checking that globs match outputs."]}),"\n"]}),"\n"]})]}),(0,i.jsx)(s.h2,{id:"path_env_modify",children:(0,i.jsx)(s.code,{children:"path_env_modify"})}),(0,i.jsxs)(o.A,{type_repr:"'append' | 'off' | 'prepend' | None",default_repr:"'prepend'",children:[(0,i.jsxs)(s.p,{children:["When executing the command of an ",(0,i.jsx)(s.code,{children:"adhoc_tool"}),", ",(0,i.jsx)(s.code,{children:"shell_command"}),", or ",(0,i.jsx)(s.code,{children:"test_shell_command"})," target, Pants may augment the ",(0,i.jsx)(s.code,{children:"PATH"})," environment variable with the location of any binary shims created for ",(0,i.jsx)(s.code,{children:"tools"})," and any runnable dependencies."]}),(0,i.jsxs)(s.p,{children:["Modification of the ",(0,i.jsx)(s.code,{children:"PATH"})," environment variable can be configured as follows:"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"prepend"}),": Prepend the extra path components to any existing ",(0,i.jsx)(s.code,{children:"PATH"})," value."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"append"}),": Append the extra path componenets to any existing ",(0,i.jsx)(s.code,{children:"PATH"})," value."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"off"}),": Do not modify the existing ",(0,i.jsx)(s.code,{children:"PATH"})," value."]}),"\n"]}),"\n"]})]}),(0,i.jsx)(s.h2,{id:"root_output_directory",children:(0,i.jsx)(s.code,{children:"root_output_directory"})}),(0,i.jsxs)(o.A,{type_repr:"str | None",default_repr:"'/'",children:[(0,i.jsx)(s.p,{children:"Adjusts the location of files output by this target, when consumed as a dependency."}),(0,i.jsx)(s.p,{children:"Values are relative to the build root, except in the following cases:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"."})," specifies the location of the ",(0,i.jsx)(s.code,{children:"BUILD"})," file."]}),"\n",(0,i.jsxs)(s.li,{children:["Values beginning with ",(0,i.jsx)(s.code,{children:"./"})," are relative to the location of the ",(0,i.jsx)(s.code,{children:"BUILD"})," file."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"/"})," or the empty string specifies the build root."]}),"\n",(0,i.jsxs)(s.li,{children:["Values beginning with ",(0,i.jsx)(s.code,{children:"/"})," are also relative to the build root."]}),"\n"]})]}),(0,i.jsx)(s.h2,{id:"runnable_dependencies",children:(0,i.jsx)(s.code,{children:"runnable_dependencies"})}),(0,i.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"None",children:[(0,i.jsx)(s.p,{children:"The runnable dependencies for this command."}),(0,i.jsxs)(s.p,{children:["Dependencies specified here are those required to exist on the ",(0,i.jsx)(s.code,{children:"PATH"})," to make the command complete successfully (interpreters specified in a ",(0,i.jsx)(s.code,{children:"#!"})," command, etc). Note that these dependencies will be made available on the ",(0,i.jsx)(s.code,{children:"PATH"})," with the name of the target."]}),(0,i.jsxs)(s.p,{children:["See also ",(0,i.jsx)(s.code,{children:"output_dependencies"})," and ",(0,i.jsx)(s.code,{children:"execution_dependencies"}),"."]})]}),(0,i.jsx)(s.h2,{id:"skip_tests",children:(0,i.jsx)(s.code,{children:"skip_tests"})}),(0,i.jsx)(o.A,{type_repr:"bool",default_repr:"False",children:(0,i.jsx)(s.p,{children:"If true, don't run this tests for target."})}),(0,i.jsx)(s.h2,{id:"tags",children:(0,i.jsx)(s.code,{children:"tags"})}),(0,i.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"None",children:[(0,i.jsx)(s.p,{children:"Arbitrary strings to describe a target."}),(0,i.jsxs)(s.p,{children:["For example, you may tag some test targets with 'integration_test' so that you could run ",(0,i.jsx)(s.code,{children:"pants --tag='integration_test' test ::"})," to only run on targets with that tag."]})]}),(0,i.jsx)(s.h2,{id:"timeout",children:(0,i.jsx)(s.code,{children:"timeout"})}),(0,i.jsx)(o.A,{type_repr:"int | None",default_repr:"30",children:(0,i.jsx)(s.p,{children:"Command execution timeout (in seconds)."})}),(0,i.jsx)(s.h2,{id:"tools",children:(0,i.jsx)(s.code,{children:"tools"})}),(0,i.jsxs)(o.A,{type_repr:"Iterable[str] | None",default_repr:"()",children:[(0,i.jsx)(s.p,{children:"Specify required executable tools that might be used."}),(0,i.jsxs)(s.p,{children:["Only the tools explicitly provided will be available on the search PATH, and these tools must be found on the paths provided by ",(0,i.jsx)(s.code,{children:"[shell-setup].executable_search_paths"})," (which defaults to the system PATH)."]})]}),(0,i.jsx)(s.h2,{id:"workdir",children:(0,i.jsx)(s.code,{children:"workdir"})}),(0,i.jsxs)(o.A,{type_repr:"str | None",default_repr:"'.'",children:[(0,i.jsx)(s.p,{children:"Sets the working directory for the process."}),(0,i.jsx)(s.p,{children:"Values are relative to the build root, except in the following cases:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"."})," specifies the location of the ",(0,i.jsx)(s.code,{children:"BUILD"})," file."]}),"\n",(0,i.jsxs)(s.li,{children:["Values beginning with ",(0,i.jsx)(s.code,{children:"./"})," are relative to the location of the ",(0,i.jsx)(s.code,{children:"BUILD"})," file."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"/"})," or the empty string specifies the build root."]}),"\n",(0,i.jsxs)(s.li,{children:["Values beginning with ",(0,i.jsx)(s.code,{children:"/"})," are also relative to the build root."]}),"\n"]})]})]})]})}function u(e={}){let{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},375002(e,s,n){n.d(s,{A:()=>t});let t={options:"options_nrbo"}},989898(e,s,n){n.d(s,{A:()=>i});var t=n(886070);function i({children:e,type_repr:s,default_repr:n,backend:i}){return(0,t.jsxs)("div",{className:"margin-bottom--lg",children:[(0,t.jsx)("code",{style:{color:"var(--pants-reference-option-repr)"},children:s}),(0,t.jsx)("br",{}),(0,t.jsxs)("div",{style:{paddingLeft:"2em"},children:[n&&(0,t.jsxs)("span",{children:["default:"," ",(0,t.jsx)("code",{style:{color:"var(--ifm-color-success)"},children:n})]}),!n&&(0,t.jsx)("span",{style:{color:"var(--ifm-color-success)"},children:"required"}),i&&(0,t.jsxs)("div",{children:["backend:"," ",(0,t.jsx)("code",{style:{color:"var(--ifm-color-success)"},children:i})]}),e]})]})}},848193(e,s,n){n.d(s,{R:()=>o,x:()=>c});var t=n(830758);let i={},r=t.createContext(i);function o(e){let s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:s},e.children)}},359477(e){e.exports=JSON.parse('{"id":"reference/targets/test_shell_command","title":"test_shell_command","description":"Run a script as a test via the `test` goal, with all dependencies packaged/copied available in the chroot.\\n","source":"@site/versioned_docs/version-2.31/reference/targets/test_shell_command.mdx","sourceDirName":"reference/targets","slug":"/reference/targets/test_shell_command","permalink":"/prerelease/reference/targets/test_shell_command","draft":false,"unlisted":false,"tags":[],"version":"2.31","frontMatter":{"title":"test_shell_command","description":"Run a script as a test via the `test` goal, with all dependencies packaged/copied available in the chroot.\\n"},"sidebar":"referenceSidebar","previous":{"title":"terraform_var_files","permalink":"/prerelease/reference/targets/terraform_var_files"},"next":{"title":"thrift_source","permalink":"/prerelease/reference/targets/thrift_source"}}')}}]);