"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["681821"],{421760(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>m,frontMatter:()=>i,metadata:()=>r,toc:()=>u});var r=n(471751),s=n(886070),a=n(848193),l=n(685008),o=n(637180);let i={title:"Run shell commands",sidebar_position:1},c,d={},u=[{value:"The <code>shell_command</code> target",id:"the-shell_command-target",level:2},{value:"The <code>run_shell_command</code> target",id:"the-run_shell_command-target",level:2}];function h(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",hr:"hr",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"How to execute arbitrary scripts and programs"}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.a,{href:"/2.28/reference/targets/shell_command",children:(0,s.jsx)(t.code,{children:"shell_command"})})," target allows you to run any command during a Pants execution, for the purpose of modifying or creating files to be used by other targets, or its (idempotent: see below) side effects when accessing services over the network."]}),"\n",(0,s.jsxs)(l.A,{groupId:"code-examples",children:[(0,s.jsx)(o.A,{value:"build",label:"BUILD",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"BUILD"}',children:'shell_command(\n    command="./my-script.sh download some-archive.tar.gz",\n    tools=["curl", "env", "bash", "mkdir", "tar"],\n    output_directories=["files"],\n    dependencies=[":shell-scripts", ":images"]\n)\n\nshell_sources(name="shell-scripts")\nfiles(name="images", sources=["*.png"])\n'})})}),(0,s.jsx)(o.A,{value:"my-script.sh",label:"my-script.sh",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",metastring:'tab={"label":"my-script.sh"}',children:'#!/usr/bin/env bash\ncase "$1" in\n    download)\n        echo "Downloading $2..."\n        curl https://my-storage.example.net/blob/$2 -O\n        mkdir files && tar xzf $2 -C files ;;\n     *)\n        echo "Usage: $0 [download|...]" ;;\nesac\n'})})})]}),"\n",(0,s.jsxs)(t.h2,{id:"the-shell_command-target",children:["The ",(0,s.jsx)(t.code,{children:"shell_command"})," target"]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"command"})," field is passed to ",(0,s.jsx)(t.code,{children:"bash -c <command>"}),". The execution sandbox will include any files from the ",(0,s.jsx)(t.code,{children:"dependencies"})," field. Any executable tools that might be used must be specified in the ",(0,s.jsx)(t.code,{children:"tools"})," field, in order to be available on the ",(0,s.jsx)(t.code,{children:"PATH"})," while executing the command."]}),"\n",(0,s.jsx)(t.p,{children:"The command is limited to operating on the specific set of input files provided as dependencies, and only produces output files for other targets to consume. It is not possible to mutate any file in the workspace."}),"\n",(0,s.jsxs)(t.p,{children:["In case there are resulting files that should be captured and passed to any consuming targets, list them in the ",(0,s.jsx)(t.code,{children:"outputs"})," field. To capture directories, simply add the path to the directory, with a trailing slash (as in the example ",(0,s.jsx)(t.code,{children:"\u201Dfiles/\u201D"}),", above)."]}),"\n",(0,s.jsx)(t.admonition,{title:"Idempotency requirement",type:"note",children:(0,s.jsx)(t.p,{children:"The shell command may be cancelled or retried any number of times, so it is important that any side effects are idempotent. That is, it should not matter if it is run several times, or only partially."})}),"\n",(0,s.jsx)(t.admonition,{title:"Running other Pants targets as commands",type:"note",children:(0,s.jsxs)(t.p,{children:["See the ",(0,s.jsx)(t.a,{href:"/2.28/docs/ad-hoc-tools/integrating-new-tools-without-plugins",children:(0,s.jsx)(t.code,{children:"adhoc_tool"})})," documentation for discussion of how to run source files, third-party tools, and version-matched system binaries from within the Pants sandbox."]})}),"\n",(0,s.jsxs)(t.h2,{id:"the-run_shell_command-target",children:["The ",(0,s.jsx)(t.code,{children:"run_shell_command"})," target"]}),"\n",(0,s.jsxs)(t.p,{children:["Unlike ",(0,s.jsx)(t.code,{children:"shell_command"}),", the ",(0,s.jsxs)(t.a,{href:"/2.28/reference/targets/run_shell_command",children:[(0,s.jsx)(t.code,{children:"run_shell_command"})," target"]})," runs directly in your workspace, without sandboxing."]}),"\n",(0,s.jsx)(t.p,{children:"This target type allows you to formalize the Pants dependencies of shell scripts, and track when their impact on your workspace might have changed. But since its outputs cannot be captured, it must be a root target in your build graph (i.e.: it may not be consumed by other targets)."})]})}function m(e={}){let{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},753348(e,t,n){n.d(t,{A:()=>r});let r={tabItem:"tabItem_mHvh"}},618264(e,t,n){n.d(t,{A:()=>r});let r={tabList:"tabList_sFbf",tabItem:"tabItem_UVfV"}},637180(e,t,n){n.d(t,{A:()=>l});var r=n(886070);n(830758);var s=n(313526),a=n(753348);function l({children:e,hidden:t,className:n}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,s.A)(a.A.tabItem,n),hidden:t,children:e})}},685008(e,t,n){n.d(t,{A:()=>p});var r=n(886070),s=n(830758),a=n(313526),l=n(911212),o=n(274875),i=n(106632),c=n(189223),d=n(618264);function u({className:e,block:t,selectedValue:n,selectValue:s,tabValues:l}){let i=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.a_)(),u=e=>{let t=e.currentTarget,r=l[i.indexOf(t)].value;r!==n&&(c(t),s(r))},h=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{let n=i.indexOf(e.currentTarget)+1;t=i[n]??i[0];break}case"ArrowLeft":{let n=i.indexOf(e.currentTarget)-1;t=i[n]??i[i.length-1]}}t?.focus()};return(0,r.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},e),children:l.map(({value:e,label:t,attributes:s})=>(0,r.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{i.push(e)},onKeyDown:h,onClick:u,...s,className:(0,a.A)("tabs__item",d.A.tabItem,s?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function h({lazy:e,children:t,selectedValue:n}){let l=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){let e=l.find(e=>e.props.value===n);return e?(0,s.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,r.jsx)("div",{className:"margin-top--md",children:l.map((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function m(e){let t=(0,i.u)(e);return(0,r.jsxs)("div",{className:(0,a.A)(l.G.tabs.container,"tabs-container",d.A.tabList),children:[(0,r.jsx)(u,{...t,...e}),(0,r.jsx)(h,{...t,...e})]})}function p(e){let t=(0,c.A)();return(0,r.jsx)(m,{...e,children:(0,i.v)(e.children)},String(t))}},106632(e,t,n){n.d(t,{u:()=>u,v:()=>c});var r=n(830758),s=n(325557),a=n(363717),l=n(125740),o=n(574229),i=n(270367);function c(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function d({value:e,tabValues:t}){return t.some(t=>t.value===e)}function u(e){let t,{defaultValue:n,queryString:u=!1,groupId:h}=e,m=function(e){let{values:t,children:n}=e;return(0,r.useMemo)(()=>{let e=t??c(n).map(({props:{value:e,label:t,attributes:n,default:r}})=>({value:e,label:t,attributes:n,default:r})),r=(0,o.XI)(e,(e,t)=>e.value===t.value);if(r.length>0)throw Error(`Docusaurus error: Duplicate values "${r.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[t,n])}(e),[p,f]=(0,r.useState)(()=>(function({defaultValue:e,tabValues:t}){if(0===t.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!d({value:e,tabValues:t}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let n=t.find(e=>e.default)??t[0];if(!n)throw Error("Unexpected error: 0 tabValues");return n.value})({defaultValue:n,tabValues:m})),[b,x]=function({queryString:e=!1,groupId:t}){let n=(0,s.W6)(),a=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,l.aZ)(a),(0,r.useCallback)(e=>{if(!a)return;let t=new URLSearchParams(n.location.search);t.set(a,e),n.replace({...n.location,search:t.toString()})},[a,n])]}({queryString:u,groupId:h}),[g,v]=function({groupId:e}){let t=e?`docusaurus.tab.${e}`:null,[n,s]=(0,i.Dv)(t);return[n,(0,r.useCallback)(e=>{t&&s.set(e)},[t,s])]}({groupId:h}),y=d({value:t=b??g,tabValues:m})?t:null;return(0,a.A)(()=>{y&&f(y)},[y]),{selectedValue:p,selectValue:(0,r.useCallback)(e=>{if(!d({value:e,tabValues:m}))throw Error(`Can't select invalid tab value=${e}`);f(e),x(e),v(e)},[x,v,m]),tabValues:m}}},848193(e,t,n){n.d(t,{R:()=>l,x:()=>o});var r=n(830758);let s={},a=r.createContext(s);function l(e){let t=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(a.Provider,{value:t},e.children)}},471751(e){e.exports=JSON.parse('{"id":"docs/shell/run-shell-commands","title":"Run shell commands","description":"How to execute arbitrary scripts and programs","source":"@site/versioned_docs/version-2.28/docs/shell/run-shell-commands.mdx","sourceDirName":"docs/shell","slug":"/docs/shell/run-shell-commands","permalink":"/2.28/docs/shell/run-shell-commands","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/shell/run-shell-commands.mdx","tags":[],"version":"2.28","sidebarPosition":1,"frontMatter":{"title":"Run shell commands","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Shell overview","permalink":"/2.28/docs/shell/"},"next":{"title":"Self-extractable archives","permalink":"/2.28/docs/shell/self-extractable-archives"}}')}}]);