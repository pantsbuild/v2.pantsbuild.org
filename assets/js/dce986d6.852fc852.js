"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["467023"],{787328(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>h});var i=t(857681),s=t(886070),r=t(848193);let a={authors:["eric"],tags:["codegen","python"]},o="Pants 2.10 adds Apache Thrift support for Python",l={authorsImageUrls:[void 0]},h=[{value:"Precise generation, without boilerplate",id:"precise-generation-without-boilerplate",level:2},{value:"Trying out Pants",id:"trying-out-pants",level:2}];function c(e){let n={a:"a",code:"code",em:"em",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components},{CaptionedImg:i}=n;return i||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CaptionedImg",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i,{src:t(929858).A,children:(0,s.jsxs)(n.p,{children:["Photo by ",(0,s.jsx)(n.a,{href:"https://unsplash.com/@swimstaralex?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Alexander\nSinn"}),"\n/\n",(0,s.jsx)(n.a,{href:"https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Unsplash"})]})}),"\n",(0,s.jsx)(n.p,{children:"Pants's codegen support solves one of the biggest problems with code generation: how to make sure that local developers, CI, and production are using the same generated code?"}),"\n","\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.11",children:"Pants build system"})," now supports generating Python code from ",(0,s.jsx)(n.a,{href:"https://thrift.apache.org/",children:"Apache Thrift"}),", in addition to already supporting Protobuf and gRPC."]}),"\n",(0,s.jsxs)(n.p,{children:["Pants's codegen support solves one of the ",(0,s.jsx)(n.a,{href:"https://stackoverflow.com/questions/893913/should-i-store-generated-code-in-source-control",children:"biggest problems"})," with code generation: ",(0,s.jsx)(n.em,{children:"how to make sure that local developers, CI, and production are using the same generated code?"})]}),"\n",(0,s.jsx)(n.p,{children:"Organizations often adopt subpar solutions like writing scripts that must be invoked before building, along with checking in the generated code to version control."}),"\n",(0,s.jsx)(n.p,{children:"Instead, Pants automates generating exactly what is needed for the current task. Rather than writing files to your repository directly\u2014where they can be changed unintentionally\u2014Pants runs processes like tests in hermetic sandboxes, guaranteeing you're using the most up-to-date generated files."}),"\n",(0,s.jsxs)(n.p,{children:["(If you do want to save your generated files to disk, you can optionally run ",(0,s.jsx)(n.code,{children:"./pants export-codegen ::"}),")"]}),"\n",(0,s.jsx)(n.h2,{id:"precise-generation-without-boilerplate",children:"Precise generation, without boilerplate"}),"\n",(0,s.jsxs)(n.p,{children:["Pants understands which files to generate through ",(0,s.jsx)(n.a,{href:"/blog/2020/10/29/dependency-inference",children:(0,s.jsx)(n.em,{children:"dependency inference"})}),", which automatically maps your import statements to the rest of your code."]}),"\n",(0,s.jsx)(n.p,{children:"For example, if you have this Thrift file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-thrift",children:'include "models/name.thrift"\nnamespace py codegen.models.user\n'})}),"\n",(0,s.jsx)(n.p,{children:"Pants will understand that this Python import requires generating that Thrift file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from codegen.models.user.ttypes import User\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell-session",children:"$ ./pants dependencies project/app.py\nthrift/models/name.thrift\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Dependency inference understands the unique semantics of Thrift, like what happens if you leave off ",(0,s.jsx)(n.code,{children:"namespace py"}),". It also understands dependencies amongst Thrift files via ",(0,s.jsx)(n.code,{children:"include"})," directives."]}),"\n",(0,s.jsxs)(n.p,{children:["This fine-grained dependency information is what unlocks fine-grained caching of builds, like running tests and ",(0,s.jsx)(n.a,{href:"/blog/2021/10/13/pants-pex-and-docker",children:"packaging Python binaries with Docker"}),". If none of the inputs have changed, Pants can safely use the cache."]}),"\n",(0,s.jsxs)(n.p,{children:["As discussed in ",(0,s.jsx)(n.a,{href:"/blog/2021/02/01/fast-incremental-builds-speculation-cancellation",children:"our post on Pants's performance"}),", this inference is 1) very safe and 2) very fast. Because Pants invokes processes hermetically with a sandbox, failing to infer a dependency can never cause the wrong thing to be cached. Further, the inference is fast thanks to Pants's core being implemented in Rust, along with a daemon, parallelism, and very fine-grained invalidation."]}),"\n",(0,s.jsx)(n.h2,{id:"trying-out-pants",children:"Trying out Pants"}),"\n",(0,s.jsx)(n.p,{children:"In addition to generating Thrift and Protobuf/gRPC, Pants automates and improves the rest of your builds, including:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Run linters and formatters with a single consistent interface, parallelizing them all when safe. Including: Black, isort, Yapf, Flake8, Pylint, Shellcheck, Shfmt."}),"\n",(0,s.jsx)(n.li,{children:"Execute tests with hermeticity, safe parallelization, and fine-grained caching."}),"\n",(0,s.jsxs)(n.li,{children:["Package your code into PEX binaries, ",(0,s.jsx)(n.a,{href:"/blog/2022/02/18/packaging-python-with-the-pyoxidizer-pants-plugin",children:"PyOxidizer binaries"}),", AWS Lambdas, Google Cloud Functions, and Python wheels/sdists."]}),"\n",(0,s.jsxs)(n.li,{children:["Provide insight via ",(0,s.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.10/docs/project-introspection",children:"project introspection"}),", such as querying which files depend on which."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Check out the ",(0,s.jsx)(n.a,{href:"https://github.com/pantsbuild/example-codegen",children:"example-codegen repository"})," to try out Pants 2.10's Thrift support. And let us know what you think in ",(0,s.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/getting-help",children:"Slack"})," and ",(0,s.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/issues",children:"GitHub"}),"!"]}),"\n",(0,s.jsxs)(n.p,{children:["To use Pants with your project, check out our ",(0,s.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.8/docs/getting-started",children:"Getting started guide"})," and our ",(0,s.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.10/docs/thrift-python",children:"Thrift docs"}),"."]})]})}function d(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},929858(e,n,t){t.d(n,{A:()=>i});let i=t.p+"assets/images/splash-e9a6b24e8a3402a2484abb2b497a1e61.jpg"},848193(e,n,t){t.d(n,{R:()=>a,x:()=>o});var i=t(830758);let s={},r=i.createContext(s);function a(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}},857681(e){e.exports=JSON.parse('{"permalink":"/blog/2022/03/07/thrift-python","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2022-03-07-thrift-python/index.mdx","source":"@site/blog/2022-03-07-thrift-python/index.mdx","title":"Pants 2.10 adds Apache Thrift support for Python","description":"Photo by [Alexander","date":"2022-03-07T00:00:00.000Z","tags":[{"inline":true,"label":"codegen","permalink":"/blog/tags/codegen"},{"inline":true,"label":"python","permalink":"/blog/tags/python"}],"readingTime":2.96,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["codegen","python"]},"unlisted":false,"prevItem":{"title":"The monorepo approach to code management","permalink":"/blog/2022/03/09/the-monorepo-approach-to-code-management"},"nextItem":{"title":"Meet our newest Maintainer: Alexey Tereshenkov","permalink":"/blog/2022/02/28/meet-our-newest-maintainer-alexey-tereshenkov"}}')}}]);