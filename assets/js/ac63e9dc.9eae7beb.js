"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["983964"],{108476(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var i=t(933710),o=t(886070),s=t(848193);let a={title:"Remote caching",sidebar_position:0},r,c={},l=[{value:"What is remote caching?",id:"what-is-remote-caching",level:2},{value:"Remote Execution API",id:"remote-execution-api",level:2},{value:"Server",id:"server",level:3},{value:"Pants Configuration",id:"pants-configuration",level:3},{value:"GitHub Actions Cache",id:"github-actions-cache",level:2},{value:"Workflow",id:"workflow",level:3},{value:"Pants Configuration",id:"pants-configuration-1",level:3},{value:"Local file system",id:"local-file-system",level:2},{value:"Pants Configuration",id:"pants-configuration-2",level:3},{value:"Reference",id:"reference",level:2}];function h(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"what-is-remote-caching",children:"What is remote caching?"}),"\n",(0,o.jsx)(n.p,{children:"Remote caching allows Pants to store and retrieve the results of process execution to and from a remote server, rather than only using your machine's local Pants cache. This allows Pants to efficiently share a cache across different runs and different machines, for example, all of your CI workers sharing the same fine-grained cache."}),"\n",(0,o.jsx)(n.p,{children:"Pants supports several remote caching providers:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/bazelbuild/remote-apis",children:"Remote Execution API"}),' ("REAPI"), which also supports ',(0,o.jsx)(n.a,{href:"/2.26/docs/using-pants/remote-caching-and-execution/remote-execution",children:"remote execution"})]}),"\n",(0,o.jsx)(n.li,{children:"GitHub Actions Cache"}),"\n",(0,o.jsx)(n.li,{children:"Local file system"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"remote-execution-api",children:"Remote Execution API"}),"\n",(0,o.jsx)(n.h3,{id:"server",children:"Server"}),"\n",(0,o.jsxs)(n.p,{children:["See the ",(0,o.jsx)(n.a,{href:"/2.26/docs/using-pants/remote-caching-and-execution/#server-compatibility",children:"REAPI server compatibility guide"})," for more information about REAPI-compatible caches."]}),"\n",(0,o.jsx)(n.h3,{id:"pants-configuration",children:"Pants Configuration"}),"\n",(0,o.jsx)(n.p,{children:"After you have either set up a REAPI cache server or obtained access to one, the next step is to point Pants to it so that Pants will use it to read and write process results."}),"\n",(0,o.jsxs)(n.p,{children:["For the following examples, assume that the REAPI server is running on ",(0,o.jsx)(n.code,{children:"cache.corp.example.com"}),' at port 8980 and that it is on an internal network. Also assume that the name of the REAPI instance is "main." At a minimum, you will need to configure ',(0,o.jsx)(n.code,{children:"pants.toml"})," as follows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-toml",children:'[GLOBAL]\nremote_cache_read = true\nremote_cache_write = true\nremote_store_address = "grpc://build.corp.example.com:8980"\nremote_instance_name = "main"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["If the endpoint is using TLS, then the ",(0,o.jsx)(n.code,{children:"remote_store_address"})," option would be specified with the ",(0,o.jsx)(n.code,{children:"grpcs://"})," scheme, i.e. ",(0,o.jsx)(n.code,{children:'"grpcs://cache.corp.example.com:8980"'}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"github-actions-cache",children:"GitHub Actions Cache"}),"\n",(0,o.jsxs)(n.p,{children:["GitHub Actions provides a built-in caching service which Pants supports using for sharing caches across GitHub Actions runs (not with machines outside of GitHub Actions). It is typically used via the ",(0,o.jsx)(n.code,{children:"actions/cache"})," action to cache whole directories and files, but Pants can use the same functionality for fine-grained caching."]}),"\n",(0,o.jsxs)(n.admonition,{title:"GitHub Actions Cache support is still experimental",type:"caution",children:[(0,o.jsxs)(n.p,{children:["Support for this cache provider is still under development, with more refinement required. Pants' fine-grained caching makes for many requests, and thus ",(0,o.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/issues/20133",children:"often hits rate limit errors"}),"."]}),(0,o.jsxs)(n.p,{children:["Please ",(0,o.jsx)(n.a,{href:"/community/getting-help",children:"let us know"})," if you use it and encounter errors or warnings."]})]}),"\n",(0,o.jsx)(n.h3,{id:"workflow",children:"Workflow"}),"\n",(0,o.jsxs)(n.p,{children:["The values of the ",(0,o.jsx)(n.code,{children:"ACTIONS_CACHE_URL"})," and ",(0,o.jsx)(n.code,{children:"ACTIONS_RUNTIME_TOKEN"})," environment variables need to be provided to Pants via the ",(0,o.jsx)(n.code,{children:"[GLOBAL].remote_store_address"})," and ",(0,o.jsx)(n.code,{children:"[GLOBAL].remote_oauth_bearer_token"})," options respectively. They are only provided to action calls (not shell steps that use ",(0,o.jsx)(n.code,{children:"run: ..."}),"). Include a step like the following in your jobs, which sets those options via environment variables, before executing any Pants commands:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"- name: Configure Pants caching to GitHub Actions Cache\n  uses: actions/github-script@v6\n  with:\n    script: |\n      core.exportVariable('PANTS_REMOTE_STORE_ADDRESS', process.env.ACTIONS_CACHE_URL);\n      core.exportVariable('PANTS_REMOTE_OAUTH_BEARER_TOKEN', process.env.ACTIONS_RUNTIME_TOKEN);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"pants-configuration-1",children:"Pants Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["Once the GitHub values are configured, Pants will read the environment variables. You will also need to configure pants to read and write to the cache only while in CI, such as ",(0,o.jsxs)(n.a,{href:"/2.26/docs/using-pants/using-pants-in-ci#configuring-pants-for-ci-pantscitoml-optional",children:["via a ",(0,o.jsx)(n.code,{children:"pants.ci.toml"})," configuration file"]}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-toml",children:'[GLOBAL]\n# GitHub Actions cache URL and token are set via environment variables\nremote_provider = "experimental-github-actions-cache"\nremote_cache_read = true\nremote_cache_write = true\n'})}),"\n",(0,o.jsxs)(n.p,{children:["If desired, you can also set ",(0,o.jsx)(n.code,{children:"remote_instance_name"})," to a string that's included as a prefix on each cache key, which will be then be displayed in the 'Actions' > 'Caches' UI."]}),"\n",(0,o.jsx)(n.h2,{id:"local-file-system",children:"Local file system"}),"\n",(0,o.jsx)(n.p,{children:'Pants can cache "remotely" to a local file system path, which can be used for a networked mount cache, without having to pay the cost of storing Pants\' local cache on the network mount too. This can also be used for testing/validation.'}),"\n",(0,o.jsx)(n.admonition,{title:"Local file system caching support is still experimental",type:"caution",children:(0,o.jsxs)(n.p,{children:["Support for this cache provider is still under development, with more refinement required. Please ",(0,o.jsx)(n.a,{href:"/community/getting-help",children:"let us know"})," if you use it and encounter errors or warnings."]})}),"\n",(0,o.jsx)(n.h3,{id:"pants-configuration-2",children:"Pants Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["To read and write the cache to ",(0,o.jsx)(n.code,{children:"/path/to/cache"}),", you will need to configure ",(0,o.jsx)(n.code,{children:"pants.toml"})," as follows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-toml",children:'[GLOBAL]\nremote_provider = "experimental-file"\nremote_store_address = "file:///path/to/cache"\nremote_cache_read = true\nremote_cache_write = true\n'})}),"\n",(0,o.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,o.jsxs)(n.p,{children:["Run ",(0,o.jsx)(n.code,{children:"pants help-advanced global"})," or refer to ",(0,o.jsx)(n.a,{href:"/2.26/reference/global-options",children:"Global options"}),". Most remote execution and caching options begin with the prefix ",(0,o.jsx)(n.code,{children:"--remote"}),"."]})]})}function d(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},848193(e,n,t){t.d(n,{R:()=>a,x:()=>r});var i=t(830758);let o={},s=i.createContext(o);function a(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(s.Provider,{value:n},e.children)}},933710(e){e.exports=JSON.parse('{"id":"docs/using-pants/remote-caching-and-execution/remote-caching","title":"Remote caching","description":"---","source":"@site/versioned_docs/version-2.26/docs/using-pants/remote-caching-and-execution/remote-caching.mdx","sourceDirName":"docs/using-pants/remote-caching-and-execution","slug":"/docs/using-pants/remote-caching-and-execution/remote-caching","permalink":"/2.26/docs/using-pants/remote-caching-and-execution/remote-caching","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/using-pants/remote-caching-and-execution/remote-caching.mdx","tags":[],"version":"2.26","sidebarPosition":0,"frontMatter":{"title":"Remote caching","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Remote caching & execution","permalink":"/2.26/docs/using-pants/remote-caching-and-execution/"},"next":{"title":"Remote execution","permalink":"/2.26/docs/using-pants/remote-caching-and-execution/remote-execution"}}')}}]);