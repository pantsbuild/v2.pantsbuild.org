"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["436874"],{47463(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var s=t(469804),i=t(886070),o=t(848193);let a={title:"Adopting Pants in existing repos",sidebar_position:7},r,l={},d=[{value:"Recommended steps",id:"recommended-steps",level:2},{value:"1. A basic <code>pants.toml</code>",id:"1-a-basic-pantstoml",level:3},{value:"2. Set up formatters/linters with basic BUILD files",id:"2-set-up-formatterslinters-with-basic-build-files",level:3},{value:"3. Set up tests",id:"3-set-up-tests",level:3},{value:"4. Set up <code>./pants package</code>",id:"4-set-up-pants-package",level:3},{value:"5. Check out writing a plugin",id:"5-check-out-writing-a-plugin",level:3},{value:"Migrating from other BUILD tools? Set custom BUILD file names",id:"migrating-from-other-build-tools-set-custom-build-file-names",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Tips for how to incrementally add Pants to your repository."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"recommended-steps",children:"Recommended steps"}),"\n",(0,i.jsx)(n.p,{children:"We recommend using an incremental migration to adopt Pants, as it will help to ensure that your builds keep behaving how you'd expect."}),"\n",(0,i.jsx)(n.admonition,{title:"Joining Slack",type:"note",children:(0,i.jsxs)(n.p,{children:["We would love to help you with adopting Pants. Please reach out through ",(0,i.jsx)(n.a,{href:"/community/members",children:"Slack"}),"."]})}),"\n",(0,i.jsxs)(n.h3,{id:"1-a-basic-pantstoml",children:["1. A basic ",(0,i.jsx)(n.code,{children:"pants.toml"})]}),"\n",(0,i.jsxs)(n.p,{children:["Follow the ",(0,i.jsx)(n.a,{href:"/2.0/docs/introduction/getting-started/",children:"Getting Started"})," guide to install Pants and set up an initial ",(0,i.jsx)(n.code,{children:"pants.toml"}),". Validate that running ",(0,i.jsx)(n.code,{children:"./pants count-loc '**'"})," works properly."]}),"\n",(0,i.jsxs)(n.p,{children:["Add ",(0,i.jsx)(n.code,{children:'backend_packages = ["pants.backend.python"]'})," to the ",(0,i.jsx)(n.code,{children:"[GLOBAL]"})," section."]}),"\n",(0,i.jsx)(n.h3,{id:"2-set-up-formatterslinters-with-basic-build-files",children:"2. Set up formatters/linters with basic BUILD files"}),"\n",(0,i.jsx)(n.p,{children:"Formatters and linters are often the simplest to get working because\u2014for all tools other than Pylint\u2014 you do not need to worry about things like dependencies and third-party requirements."}),"\n",(0,i.jsxs)(n.p,{children:["First, create a BUILD file in each directory with Python code. As explained in ",(0,i.jsx)(n.a,{href:"/2.0/docs/using-pants/concepts/targets-and-build-files",children:"Targets and BUILD files"}),", you can use fewer BUILD files, such as one BUILD file per subproject; but we find that one BUILD file per directory is a good default."]}),"\n",(0,i.jsxs)(n.p,{children:["If your directory only contains production code, use ",(0,i.jsx)(n.code,{children:"python_library"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"python_library()\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If your directory only contains tests, use ",(0,i.jsx)(n.code,{children:"python_tests"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"python_tests()\n"})}),"\n",(0,i.jsx)(n.p,{children:"If your directory contains both production code and tests, use both:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'python_library()\n\npython_tests(name="tests")\n'})}),"\n",(0,i.jsx)(n.p,{children:"Unless you want to change the default values, such as setting timeouts for your tests, you can simply use these 1-3 lines in each BUILD file."}),"\n",(0,i.jsxs)(n.p,{children:["Then, activate the Python ",(0,i.jsx)(n.a,{href:"/2.0/docs/python/overview/linters-and-formatters",children:"Linters and formatters"})," you'd like to use. Hook up the ",(0,i.jsx)(n.code,{children:"fmt"})," and ",(0,i.jsx)(n.code,{children:"lint"})," goals to your ",(0,i.jsx)(n.a,{href:"/2.0/docs/using-pants/using-pants-in-ci",children:"CI"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"3-set-up-tests",children:"3. Set up tests"}),"\n",(0,i.jsxs)(n.p,{children:["To get ",(0,i.jsx)(n.a,{href:"/2.0/docs/python/goals/test",children:"tests"})," working, you will first need to ",(0,i.jsx)(n.a,{href:"/2.0/docs/python/overview/third-party-dependencies",children:"set up third-party dependencies"}),". We strongly recommend setting up a lockfile for reproducibility and better performance."]}),"\n",(0,i.jsx)(n.p,{children:"Pants's dependency inference will infer most dependencies for you by looking at your Python import statements. Generally, you will not need to update your BUILD files any more than the previous step."}),"\n",(0,i.jsxs)(n.p,{children:["However, if your tests depend on any resource files, you will need to explicitly declare these dependencies because Pants cannot infer them. See ",(0,i.jsx)(n.a,{href:"/2.0/docs/using-pants/resources-and-archives",children:"Resources"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Try running ",(0,i.jsx)(n.code,{children:"./pants test ::"})," in CI to see if any tests fail. Sometimes, your tests will fail with Pants even if they pass with your normal setup because tests are more isolated than when running Pytest/unittest directly:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Tests run in a chroot, meaning they can only access dependencies that Pants knows about. If you have a missing file or missing import, run ",(0,i.jsx)(n.code,{children:"./pants dependencies path/to/my_test.py"})," and ",(0,i.jsx)(n.code,{children:"./pants dependencies --transitive path/to/my_test.py"})," to confirm what you are expecting is known by Pants. If not, add to the ",(0,i.jsxs)(n.a,{href:"/2.0/docs/using-pants/concepts/targets-and-build-files",children:[(0,i.jsx)(n.code,{children:"dependencies"})," field"]}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Test files are isolated from each other. If your tests depended on running in a certain order, they may now fail. This requires rewriting your tests to remove the shared global state."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["In your CI, you may want to speed up your build by having Pants only run tests for changed files. Refer to ",(0,i.jsx)(n.a,{href:"/2.0/docs/using-pants/using-pants-in-ci",children:"Using Pants in CI"}),"."]}),"\n",(0,i.jsxs)(n.h3,{id:"4-set-up-pants-package",children:["4. Set up ",(0,i.jsx)(n.code,{children:"./pants package"})]}),"\n",(0,i.jsxs)(n.p,{children:["You can use ",(0,i.jsx)(n.code,{children:"./pants package"})," to package your code into various formats, such as a ",(0,i.jsx)(n.a,{href:"/2.0/docs/python/goals/package",children:"PEX binary"}),", a ",(0,i.jsx)(n.a,{href:"/2.0/reference/goals/setup-py",children:"wheel"}),", an ",(0,i.jsx)(n.a,{href:"/2.0/docs/aws-lambda/python-support",children:"AWS Lambda"}),", or a ",(0,i.jsx)(n.a,{href:"/2.0/docs/using-pants/resources-and-archives",children:"zip/tar archive"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["We recommend manually verifying that this step is working how you'd like by inspecting the built packages. Alternatively, you can ",(0,i.jsx)(n.a,{href:"/2.0/docs/python/goals/test",children:"write automated tests"})," that will call the equivalent of ",(0,i.jsx)(n.code,{children:"./pants package"})," for you, and insert the built package into your test environment."]}),"\n",(0,i.jsx)(n.h3,{id:"5-check-out-writing-a-plugin",children:"5. Check out writing a plugin"}),"\n",(0,i.jsx)(n.p,{children:"Pants is highly extensible. In fact, all of Pants's core functionality is implemented using the exact same API used by plugins."}),"\n",(0,i.jsxs)(n.p,{children:["Check out ",(0,i.jsx)(n.a,{href:"/2.0/docs/writing-plugins/overview",children:"Plugins Overview"}),". We'd also love to help in the #plugins channel on ",(0,i.jsx)(n.a,{href:"/community/members",children:"Slack"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Some example plugins that users have written:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Cython support"}),"\n",(0,i.jsxs)(n.li,{children:["Building a Docker image with packages built via ",(0,i.jsx)(n.code,{children:"./pants package"})]}),"\n",(0,i.jsxs)(n.li,{children:["Custom ",(0,i.jsx)(n.code,{children:"setup.py"})," logic to compute the ",(0,i.jsx)(n.code,{children:"version"})," dynamically"]}),"\n",(0,i.jsx)(n.li,{children:"Jupyter support"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"migrating-from-other-build-tools-set-custom-build-file-names",children:"Migrating from other BUILD tools? Set custom BUILD file names"}),"\n",(0,i.jsxs)(n.p,{children:["If you're migrating from another build tool that already uses the name ",(0,i.jsx)(n.code,{children:"BUILD"}),", such as Bazel or Please, you can tell Pants to use a different file name than ",(0,i.jsx)(n.code,{children:"BUILD"})," to avoid conflicts:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbuild_patterns = ["BUILD.pants"]\n'})}),"\n",(0,i.jsx)(n.p,{children:"Alternatively, you can tell Pants to not look for BUILD files in certain locations. This can be helpful, for example, if you use a tool like Bazel for Java, but use Pants for Python:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbuild_ignore = ["src/java"]\n'})})]})}function p(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},848193(e,n,t){t.d(n,{R:()=>a,x:()=>r});var s=t(830758);let i={},o=s.createContext(i);function a(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}},469804(e){e.exports=JSON.parse('{"id":"docs/using-pants/adopting-pants-in-existing-repos","title":"Adopting Pants in existing repos","description":"Tips for how to incrementally add Pants to your repository.","source":"@site/versioned_docs/version-2.0/docs/using-pants/adopting-pants-in-existing-repos.mdx","sourceDirName":"docs/using-pants","slug":"/docs/using-pants/adopting-pants-in-existing-repos","permalink":"/2.0/docs/using-pants/adopting-pants-in-existing-repos","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/using-pants/adopting-pants-in-existing-repos.mdx","tags":[],"version":"2.0","sidebarPosition":7,"frontMatter":{"title":"Adopting Pants in existing repos","sidebar_position":7},"sidebar":"docsSidebar","previous":{"title":"Using Pants in CI","permalink":"/2.0/docs/using-pants/using-pants-in-ci"},"next":{"title":"Remote Execution","permalink":"/2.0/docs/using-pants/remote-execution"}}')}}]);