"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["576160"],{870869(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>h});var s=n(181859),r=n(886070),o=n(848193),i=n(685008),l=n(637180);let a={title:"Lockfiles",sidebar_position:2},c,d={},h=[{value:"What are lockfiles?",id:"what-are-lockfiles",level:3},{value:"Getting started with resolves",id:"getting-started-with-resolves",level:3},{value:"Multiple lockfiles",id:"multiple-lockfiles",level:3},{value:"Interpreter constraints",id:"interpreter-constraints",level:3},{value:"Modifying lockfile generation behavior",id:"modifying-lockfile-generation-behavior",level:3},{value:"Updating lockfiles",id:"updating-lockfiles",level:3},{value:"Lockfile subsetting",id:"lockfile-subsetting",level:3},{value:"Lockfiles for tools",id:"lockfiles-for-tools",level:3},{value:"Invalidating tool lockfiles",id:"invalidating-tool-lockfiles",level:3},{value:"Sharing lockfiles between tools and code",id:"sharing-lockfiles-between-tools-and-code",level:3},{value:"Manually generating lockfiles",id:"manually-generating-lockfiles",level:3}];function p(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"Securely locking down your third-party dependencies."}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsxs)(t.p,{children:['Third-party dependencies are typically specified via ranges of allowed versions, known as "requirements", one for each dependency, in a file such as requirements.txt or pyproject.toml. Examples of requirement strings include ',(0,r.jsx)(t.code,{children:"mypy>1.0.0"}),", ",(0,r.jsx)(t.code,{children:"Django>=3.1.0,<4"}),", ",(0,r.jsx)(t.code,{children:"pytest==7.1.1"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["A dependency resolution tool like ",(0,r.jsx)(t.a,{href:"https://pip.pypa.io/en/stable/",children:"Pip"})," then takes these initial requirements and attempts to find and download a consistent set of transitive dependencies that are mutually compatible with each other and with the target Python interpreter version."]}),"\n",(0,r.jsx)(t.p,{children:"When used naively, this dependency resolution process is unstable: if you run a resolve, and then some time later run another resolve on the same inputs, you may end up with a different resulting set of dependencies. This is because new versions of direct or transitive dependencies may have been published (or, in rare cases, yanked) between the two runs."}),"\n",(0,r.jsxs)(t.p,{children:["This is an issue both for correctness (your code may not be compatible with the new versions) and security (a new version may contain a vulnerability). A further security concern is that repeatedly downloading even the ",(0,r.jsx)(t.em,{children:"same"})," versions exposes you to greater risk if one of those versions is later compromised."]}),"\n",(0,r.jsx)(t.p,{children:"Dependency resolution can also be a performance bottleneck, with the same complex version compatibility logic running repeatedly, and unnecessarily."}),"\n",(0,r.jsxs)(t.p,{children:["Pants offers a solution to these issues that ensures stable, hermetic, secure builds over time, in the form of ",(0,r.jsx)(t.em,{children:"lockfiles"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"what-are-lockfiles",children:"What are lockfiles?"}),"\n",(0,r.jsx)(t.p,{children:"A lockfile is a metadata file that enumerates specific pinned versions of every transitive third-party dependency. It also provides the expected SHA256 hashes of the downloadable artifacts (sdists and wheels) for each dependency. A lockfile can contain dependency version information that is valid across multiple platforms and Python interpreter versions. Lockfiles can be large and complex, but fortunately Pants will generate them for you!"}),"\n",(0,r.jsx)(t.p,{children:"If you use lockfiles, and we highly recommend that you do, then Pants will use the locked transitive dependency versions in every build, and only change them when you deliberately update your lockfiles. Pants will also verify the downloaded artifacts against their expected hashes, to ensure that they haven't been compromised after the lockfile was generated."}),"\n",(0,r.jsx)(t.p,{children:'Pants supports multiple lockfiles for different parts of your repo, via the mechanism of "resolves" - logical names given to lockfiles so that they are easy to reference.'}),"\n",(0,r.jsx)(t.admonition,{title:"Lockfiles are generated by Pex",type:"note",children:(0,r.jsxs)(t.p,{children:["Pants delegates lockfile creation and consumption to the ",(0,r.jsx)(t.a,{href:"https://github.com/pex-tool/pex",children:"Pex"}),' tool. So you may see standard lockfiles referred to as "Pex-style" lockfiles.']})}),"\n",(0,r.jsx)(t.h3,{id:"getting-started-with-resolves",children:"Getting started with resolves"}),"\n",(0,r.jsx)(t.p,{children:"First, you'll need to turn on the resolves functionality for the repo:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:"[python]\nenable_resolves = true\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Initially, Pants will assume a single resolve named ",(0,r.jsx)(t.code,{children:"python-default"})," which uses the repo's ",(0,r.jsx)(t.a,{href:"/2.24/reference/subsystems/python#interpreter_constraints",children:"default interpreter constraints"})," and references a lockfile at ",(0,r.jsx)(t.code,{children:"3rdparty/python/default.lock"}),". You can change the name of the default resolve, and/or the location of its lockfile, via:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[python]\nenable_resolves = true\ndefault_resolve = "myresolve"\n\n[python.resolves]\nmyresolve = "path/to/mylockfile"\n'})}),"\n",(0,r.jsx)(t.p,{children:"You generate the lockfile as follows:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",metastring:'title="Bash"',children:"$ pants generate-lockfiles\n19:00:39.26 [INFO] Completed: Generate lockfile for python-default\n19:00:39.29 [INFO] Wrote lockfile for the resolve `python-default` to 3rdparty/python/default.lock\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The inputs used to generate a lockfile are third-party dependencies in your repo, expressed via ",(0,r.jsxs)(t.a,{href:"/2.24/docs/python/overview/third-party-dependencies",children:[(0,r.jsx)(t.code,{children:"python_requirement"})," targets"]})," , or the ",(0,r.jsx)(t.code,{children:"python_requirements"})," / ",(0,r.jsx)(t.code,{children:"poetry_requirements"})," generator targets. In this case, since you haven't yet explicitly mapped your requirement targets to a resolve, they will all map to ",(0,r.jsx)(t.code,{children:"python-default"}),", and so all serve as inputs to the default lockfile."]}),"\n",(0,r.jsx)(t.h3,{id:"multiple-lockfiles",children:"Multiple lockfiles"}),"\n",(0,r.jsx)(t.p,{children:"It's generally simpler to have a single resolve for the whole repository, if you can get away with it. But sometimes you may need more than one resolve, if you genuinely have conflicting requirements in different parts of your repo. For example, you may have both Django 3 and Django 4 projects in your repo."}),"\n",(0,r.jsx)(t.p,{children:"If you need multiple resolves, you declare them in your config file:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[python]\nenable_resolves = true\ndefault_resolve = "data_science"\n\n[python.resolves]\ndata_science = "3rdparty/python/data_science.lock"\nwebapps_django3 = "3rdparty/python/webapps_django3.lock"\nwebapps_django4 = "3rdparty/python/webapps_django4.lock"\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Then, you partition your requirements targets across these resolves using the ",(0,r.jsx)(t.code,{children:"resolve"})," field, and possibly the ",(0,r.jsx)(t.a,{href:"/2.24/docs/using-pants/key-concepts/targets-and-build-files#parametrizing-targets",children:"parametrize"})," mechanism:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",metastring:'title="3rdparty/python/BUILD"',children:'python_requirement(\n    name="django3",\n    requirements=["django>=3.1.0,<4"],\n    resolve="webapps_django3",\n)\n\npython_requirement(\n    name="django4",\n    requirements=["django>=4.0.0,<5"],\n    resolve="webapps_django4",\n)\n\npython_requirements(\n    name="webapps_shared",\n    source="webapps-shared-requirements.txt",\n    resolve=parametrize("webapps_django3", "webapps_django4")\n)\n\npoetry_requirements(\n    name="data_science_requirements",\n)\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Any requirements targets that don't specify an explicit ",(0,r.jsx)(t.code,{children:"resolve="})," will be associated with the default resolve."]}),"\n",(0,r.jsxs)(t.p,{children:["As before, you run ",(0,r.jsx)(t.code,{children:"pants generate-lockfiles"})," to generate the lockfiles. You can use the ",(0,r.jsx)(t.code,{children:"--resolve"})," flag to generate just a subset of lockfiles. E.g.,"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",metastring:'title="Bash"',children:"$ pants generate-lockfiles --resolve=webapps_django3 --resolve=webapps_django4\n19:00:39.26 [INFO] Completed: Generate lockfile for webapps_django3\n19:00:39.29 [INFO] Completed: Generate lockfile for webapps_django4\n19:00:40.02 [INFO] Wrote lockfile for the resolve `webapps_django3` to 3rdparty/python/webapps_django3.lock\n19:00:40.17 [INFO] Wrote lockfile for the resolve `webapps_django4` to 3rdparty/python/webapps_django4.lock\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Finally, you update your first-party code targets, such as ",(0,r.jsx)(t.code,{children:"python_sources"}),", ",(0,r.jsx)(t.code,{children:"python_tests"}),", and ",(0,r.jsx)(t.code,{children:"pex_binary"})," to set their ",(0,r.jsx)(t.code,{children:"resolve="})," field (which, as before, defaults to the default resolve)."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",metastring:'title="my/project/BUILD"',children:'python_sources(\n    resolve="django_webapp3",\n)\n\npython_tests(\n    name="tests",\n    resolve="django_webapp3",\n    # You can use `overrides` to change certain generated targets\n    overrides={"test_django4.py": {"resolve": "django_webapp4"}},\n)\n'})}),"\n",(0,r.jsxs)(t.p,{children:["If a first-party target is compatible with multiple resolves, e.g., shared utility code, you can use the ",(0,r.jsx)(t.a,{href:"/2.24/docs/using-pants/key-concepts/targets-and-build-files#parametrizing-targets",children:"parametrize"})," mechanism with the ",(0,r.jsx)(t.code,{children:"resolve="})," field."]}),"\n",(0,r.jsxs)(t.admonition,{title:"Transitive dependencies must use the same resolve",type:"note",children:[(0,r.jsx)(t.p,{children:"All transitive dependencies of a source target must use the same resolve. Pants's dependency inference already handles this for you by only inferring dependencies between targets that share the same resolve."}),(0,r.jsx)(t.p,{children:"If you manually add a dependency across different resolves, Pants will error with a helpful message when you try to use that dependency."})]}),"\n",(0,r.jsxs)(t.p,{children:["To reiterate an important distinction: The ",(0,r.jsx)(t.code,{children:"resolve="})," field on a third-party requirements target specifies that these requirements are ",(0,r.jsx)(t.em,{children:"inputs"})," to the lockfile generator for that resolve. The ",(0,r.jsx)(t.code,{children:"resolve="})," field on a first-party source target specifies that this target will ",(0,r.jsx)(t.em,{children:"consume"})," the generated lockfile for that resolve."]}),"\n",(0,r.jsx)(t.h3,{id:"interpreter-constraints",children:"Interpreter constraints"}),"\n",(0,r.jsxs)(t.p,{children:["A lockfile will contain dependencies for all requested Python versions. By default, these are the global constraints specified by the ",(0,r.jsx)(t.a,{href:"/2.24/reference/subsystems/python#interpreter_constraints",children:"[python].interpreter_constraints"})," option. You can override this per-lockfile using the ",(0,r.jsx)(t.a,{href:"/2.24/reference/subsystems/python#resolves_to_interpreter_constraints",children:"[python].resolves_to_interpreter_constraints"})," option."]}),"\n",(0,r.jsx)(t.h3,{id:"modifying-lockfile-generation-behavior",children:"Modifying lockfile generation behavior"}),"\n",(0,r.jsx)(t.p,{children:"You can use the following options to affect how the lockfile generator resolves dependencies for each resolve:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/2.24/reference/subsystems/python#resolves_to_constraints_file",children:"[python].resolves_to_constraints_file"}),": For each resolve, a path to a ",(0,r.jsx)(t.a,{href:"https://pip.pypa.io/en/stable/user_guide/#constraints-files",children:"Pip constraints file"})," to use when resolving that lockfile."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/2.24/reference/subsystems/python#resolves_to_no_binary",children:"[python].resolves_to_no_binary"}),": For each resolve, a list of projects that must only resolve to sdists and not wheels. Use the value ",(0,r.jsx)(t.code,{children:'[":all:"]'})," to disable wheels for all packages."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/2.24/reference/subsystems/python#resolves_to_only_binary",children:"[python].resolves_to_only_binary"}),": For each resolve, a list of projects that must only resolve to wheels and not sdists. Use the value ",(0,r.jsx)(t.code,{children:'[":all:"]'})," to disable sdists for all packages."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["You can use the key ",(0,r.jsx)(t.code,{children:"__default__"})," to set the value for all resolves at once."]}),"\n",(0,r.jsx)(t.h3,{id:"updating-lockfiles",children:"Updating lockfiles"}),"\n",(0,r.jsxs)(t.p,{children:["If you modify the third-party requirements of a resolve then you must regenerate its lockfile by running the ",(0,r.jsx)(t.code,{children:"generate-lockfiles"})," goal. Pants will display an error if a lockfile is no longer compatible with its updated requirements."]}),"\n",(0,r.jsx)(t.p,{children:"You can have Pants display a useful summary of what changed between the old and new versions of the generated lockfile, by setting:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:"[generate-lockfiles]\ndiff = true\n"})}),"\n",(0,r.jsxs)(t.p,{children:["In theory, when you generate a lockfile, you should want to audit it for bugs, compliance and security concerns. In practice this is intractable to do manually. We would like to integrate with automated auditing tools and services in the future, so watch this space for updates, or feel free to ",(0,r.jsx)(t.a,{href:"/community/members",children:"reach out on Slack"})," if this is important to you and you'd like to work on it."]}),"\n",(0,r.jsx)(t.h3,{id:"lockfile-subsetting",children:"Lockfile subsetting"}),"\n",(0,r.jsx)(t.p,{children:"When consuming a lockfile, Pants uses only the necessary subset of its transitive dependencies in each situation."}),"\n",(0,r.jsxs)(t.p,{children:["For example, when running a test, only the requirements actually used (transitively) by that test will be present on the ",(0,r.jsx)(t.code,{children:"sys.path"}),". This means that a test run won't be invalidated if unrelated requirements have changed, which improves cache hit rates. The same holds true when running and packaging code."]}),"\n",(0,r.jsxs)(t.p,{children:["You can override this subsetting behavior by setting the ",(0,r.jsx)(t.a,{href:"/2.24/reference/subsystems/python#run_against_entire_lockfile",children:"[python].run_against_entire_lockfile"})," option."]}),"\n",(0,r.jsx)(t.h3,{id:"lockfiles-for-tools",children:"Lockfiles for tools"}),"\n",(0,r.jsxs)(t.p,{children:["Pants's Python support typically involves invoking underlying tools, such as ",(0,r.jsx)(t.code,{children:"pytest"}),", ",(0,r.jsx)(t.code,{children:"mypy"}),", ",(0,r.jsx)(t.code,{children:"black"})," etc. in subprocesses. Almost all these tools are themselves written in Python and thus depended on via requirement strings, just like your third-party import dependencies."]}),"\n",(0,r.jsx)(t.p,{children:"It is strongly recommended that these tools be installed from a hermetic lockfile, for the same security and stability reasons stated above. In fact, Pants ships with built-in lockfiles for every Python tool it uses, and uses them automatically."}),"\n",(0,r.jsx)(t.p,{children:"The only time you need to think about this is if you want to customize the tool requirements that Pants uses. This might be the case if you want to modify the version of a tool or add extra requirements (for example, tool plugins)."}),"\n",(0,r.jsxs)(t.p,{children:["Tools can also be installed from a specific resolve instead of from the built-in lockfile. This is useful for specifying a version of the tool and including extra packages. To do this, set ",(0,r.jsx)(t.code,{children:"install_from_resolve"})," and ",(0,r.jsx)(t.code,{children:"requirements"})," on the tool's config section:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[python.resolves]\npytest = "3rdparty/python/pytest.lock"\n\n[pytest]\ninstall_from_resolve = "pytest"  # Use this resolve\'s lockfiles.\nrequirements = ["//3rdparty/python:pytest"]  # Use these requirements from the lockfile.\n'})}),"\n",(0,r.jsx)(t.p,{children:"Then set up the resolve's inputs:"}),"\n",(0,r.jsxs)(i.A,{groupId:"code-examples",children:[(0,r.jsx)(l.A,{value:"3rdparty/python/build",label:"3rdparty/python/BUILD",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"3rdparty/python/BUILD"}',children:'python_requirements(\n    name="pytest",\n    source="pytest-requirements.txt",\n    resolve="pytest",\n)\n'})})}),(0,r.jsx)(l.A,{value:"3rdparty/python/pytest-requirements.txt",label:"3rdparty/python/pytest-requirements.txt",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",metastring:'tab={"label":"3rdparty/python/pytest-requirements.txt"}',children:"# The default requirements (possibly with custom versions).\npytest==7.1.1\npytest-cov>=2.12,!=2.12.1,<3.1\npytest-xdist>=2.5,<3\nipdb\n# Our extra requirement.\npytest-myplugin>=1.2.0,<2\n"})})})]}),"\n",(0,r.jsx)(t.p,{children:"And generate its custom lockfile:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",metastring:'title="Bash"',children:"$ pants generate-lockfiles --resolve=pytest\n19:00:39.26 [INFO] Completed: Generate lockfile for pytest\n19:00:39.29 [INFO] Wrote lockfile for the resolve `pytest` to 3rdparty/python/pytest.lock\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Note that some tools, such as Flake8 and Bandit, must run on a Python interpreter that is compatible with the code they operate on. In this case you must ensure that the ",(0,r.jsx)(t.a,{href:"#interpreter-constraints",children:"interpreter constraints"})," for the tool's resolve are the same as those for the code in question."]}),"\n",(0,r.jsx)(t.h3,{id:"invalidating-tool-lockfiles",children:"Invalidating tool lockfiles"}),"\n",(0,r.jsxs)(t.p,{children:["Pants will verify that any requirements set in the ",(0,r.jsx)(t.code,{children:"requirements"})," option are provided by the lockfile specified by install_from_resolve, and will error if not. This lets you ensure that you don't inadvertently use an older version of a tool if you update its requirements but forget to regenerate the lockfile.\nThe ",(0,r.jsx)(t.code,{children:"requirements"})," option can either list requirement strings, such as ",(0,r.jsx)(t.code,{children:"pytest==7.3.1"}),", or target addresses, such as ",(0,r.jsx)(t.code,{children:"//3rdparty/python:pytest"})," (the ",(0,r.jsx)(t.code,{children:"//"})," prefix tells Pants that these are target addresses). The latter is particularly useful as it allows you to avoid specifying the requirements redundantly in two places. Instead, the target can serve as both an input to the lockfile generator and as the requirements to verify.\nPants will only use the given ",(0,r.jsx)(t.code,{children:"requirements"})," from the lockfile. If you don't set ",(0,r.jsx)(t.code,{children:"requirements"}),", Pants will use the entire lockfile, and won't validate that it provides the desired tool at the desired version."]}),"\n",(0,r.jsx)(t.h3,{id:"sharing-lockfiles-between-tools-and-code",children:"Sharing lockfiles between tools and code"}),"\n",(0,r.jsxs)(t.p,{children:["In some cases a tool also provides a runtime library. For example, ",(0,r.jsx)(t.code,{children:"pytest"})," is run as a tool in a subprocess, but your tests can also ",(0,r.jsx)(t.code,{children:"import pytest"})," to access testing functionality."]}),"\n",(0,r.jsx)(t.p,{children:"Rather than repeat the same requirement in two different resolves, you can point the tool at an existing resolve that you also use for your code:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[pytest]\ninstall_from_resolve = "python-default"\n'})}),"\n",(0,r.jsx)(t.p,{children:"Of course, you have to ensure that this resolve does in fact provide appropriate versions of the tool."}),"\n",(0,r.jsxs)(t.p,{children:["As above, you will want to point ",(0,r.jsx)(t.code,{children:"requirements"})," to the subset of targets representing the tool's requirements, so that Pants can verify that the resolve provides them, and can use just the needed subset without unnecessary invalidation:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[pytest]\ninstall_from_resolve = "python-default"\n\nrequirements = [\n  "//3rdparty/python#pytest",\n  "//3rdparty/python#pytest-cov",\n  "//3rdparty/python#pytest-xdist",\n  "//3rdparty/python#pytest-myplugin",\n  "//3rdparty/python#ipdb",\n]\n'})}),"\n",(0,r.jsxs)(t.p,{children:["You can have a single resolve for all your tools, or even a single resolve for all your tools and code! This may be useful if you want to ",(0,r.jsx)(t.a,{href:"/2.24/reference/goals/export",children:"export"})," a virtualenv that includes all your dependencies and all the tools you use."]}),"\n",(0,r.jsx)(t.p,{children:'But note that the more frequently you update a lockfile the more likely it is that unrelated updates will come along for the ride, since Pants does not yet support an "only-if-needed" upgrade strategy.'}),"\n",(0,r.jsxs)(t.admonition,{title:"The previous way of generating tool lockfiles is deprecated!",type:"caution",children:[(0,r.jsxs)(t.p,{children:["There is an older way of generating tool lockfiles, by setting the ",(0,r.jsx)(t.code,{children:"version"})," and ",(0,r.jsx)(t.code,{children:"extra_requirements"})," fields on a tool's config. This method is deprecated in favor of the standard one described above."]}),(0,r.jsx)(t.p,{children:"If you're using this deprecated tool lockfile generation mechanism, please switch to using the one described here as soon as possible!"})]}),"\n",(0,r.jsx)(t.h3,{id:"manually-generating-lockfiles",children:"Manually generating lockfiles"}),"\n",(0,r.jsxs)(t.p,{children:["Rather than using ",(0,r.jsx)(t.code,{children:"generate-lockfiles"})," to generate Pex-style lockfiles, you can generate them manually. This can be useful when adopting Pants in a repository already using Poetry by running ",(0,r.jsx)(t.code,{children:"poetry export --dev"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Manually generated lockfiles must either use Pex's JSON format or use pip's ",(0,r.jsx)(t.code,{children:"requirements.txt"}),"-style format (ideally with ",(0,r.jsx)(t.code,{children:"--hash"})," entries for better supply chain security).\nFor example:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",metastring:'title="3rdparty/user_lock.txt"',children:"freezegun==1.2.0 \\\n  --hash=sha256:93e90676da3... \\\n  --hash=sha256:e19563d0b05...\n"})}),"\n",(0,r.jsxs)(t.p,{children:["To use a manually generated lockfile for a resolve, point the resolve to that lockfile's path in ",(0,r.jsx)(t.a,{href:"/2.24/reference/subsystems/python#resolves",children:(0,r.jsx)(t.code,{children:"[python].resolves"})}),". Then set ",(0,r.jsx)(t.a,{href:"/2.24/reference/subsystems/python#resolves_generate_lockfiles",children:(0,r.jsx)(t.code,{children:"[python].resolves_generate_lockfiles"})})," to ",(0,r.jsx)(t.code,{children:"False"}),". Warning: it will likely be slower to install manually-generated user lockfiles than Pex ones, because Pants cannot as efficiently extract the subset of requirements used for a particular task; see the option ",(0,r.jsx)(t.a,{href:"/2.24/reference/subsystems/python#run_against_entire_lockfile",children:(0,r.jsx)(t.code,{children:"[python].run_against_entire_lockfile"})}),"."]})]})}function u(e={}){let{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},753348(e,t,n){n.d(t,{A:()=>s});let s={tabItem:"tabItem_mHvh"}},618264(e,t,n){n.d(t,{A:()=>s});let s={tabList:"tabList_sFbf",tabItem:"tabItem_UVfV"}},637180(e,t,n){n.d(t,{A:()=>i});var s=n(886070);n(830758);var r=n(313526),o=n(753348);function i({children:e,hidden:t,className:n}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(o.A.tabItem,n),hidden:t,children:e})}},685008(e,t,n){n.d(t,{A:()=>f});var s=n(886070),r=n(830758),o=n(313526),i=n(911212),l=n(274875),a=n(106632),c=n(189223),d=n(618264);function h({className:e,block:t,selectedValue:n,selectValue:r,tabValues:i}){let a=[],{blockElementScrollPositionUntilNextRender:c}=(0,l.a_)(),h=e=>{let t=e.currentTarget,s=i[a.indexOf(t)].value;s!==n&&(c(t),r(s))},p=e=>{let t=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{let n=a.indexOf(e.currentTarget)+1;t=a[n]??a[0];break}case"ArrowLeft":{let n=a.indexOf(e.currentTarget)-1;t=a[n]??a[a.length-1]}}t?.focus()};return(0,s.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":t},e),children:i.map(({value:e,label:t,attributes:r})=>(0,s.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{a.push(e)},onKeyDown:p,onClick:h,...r,className:(0,o.A)("tabs__item",d.A.tabItem,r?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function p({lazy:e,children:t,selectedValue:n}){let i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){let e=i.find(e=>e.props.value===n);return e?(0,r.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,s.jsx)("div",{className:"margin-top--md",children:i.map((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function u(e){let t=(0,a.u)(e);return(0,s.jsxs)("div",{className:(0,o.A)(i.G.tabs.container,"tabs-container",d.A.tabList),children:[(0,s.jsx)(h,{...t,...e}),(0,s.jsx)(p,{...t,...e})]})}function f(e){let t=(0,c.A)();return(0,s.jsx)(u,{...e,children:(0,a.v)(e.children)},String(t))}},106632(e,t,n){n.d(t,{u:()=>h,v:()=>c});var s=n(830758),r=n(325557),o=n(363717),i=n(125740),l=n(574229),a=n(270367);function c(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function d({value:e,tabValues:t}){return t.some(t=>t.value===e)}function h(e){let t,{defaultValue:n,queryString:h=!1,groupId:p}=e,u=function(e){let{values:t,children:n}=e;return(0,s.useMemo)(()=>{let e=t??c(n).map(({props:{value:e,label:t,attributes:n,default:s}})=>({value:e,label:t,attributes:n,default:s})),s=(0,l.XI)(e,(e,t)=>e.value===t.value);if(s.length>0)throw Error(`Docusaurus error: Duplicate values "${s.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[t,n])}(e),[f,y]=(0,s.useState)(()=>(function({defaultValue:e,tabValues:t}){if(0===t.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!d({value:e,tabValues:t}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let n=t.find(e=>e.default)??t[0];if(!n)throw Error("Unexpected error: 0 tabValues");return n.value})({defaultValue:n,tabValues:u})),[m,g]=function({queryString:e=!1,groupId:t}){let n=(0,r.W6)(),o=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,i.aZ)(o),(0,s.useCallback)(e=>{if(!o)return;let t=new URLSearchParams(n.location.search);t.set(o,e),n.replace({...n.location,search:t.toString()})},[o,n])]}({queryString:h,groupId:p}),[v,x]=function({groupId:e}){let t=e?`docusaurus.tab.${e}`:null,[n,r]=(0,a.Dv)(t);return[n,(0,s.useCallback)(e=>{t&&r.set(e)},[t,r])]}({groupId:p}),j=d({value:t=m??v,tabValues:u})?t:null;return(0,o.A)(()=>{j&&y(j)},[j]),{selectedValue:f,selectValue:(0,s.useCallback)(e=>{if(!d({value:e,tabValues:u}))throw Error(`Can't select invalid tab value=${e}`);y(e),g(e),x(e)},[g,x,u]),tabValues:u}}},848193(e,t,n){n.d(t,{R:()=>i,x:()=>l});var s=n(830758);let r={},o=s.createContext(r);function i(e){let t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:t},e.children)}},181859(e){e.exports=JSON.parse('{"id":"docs/python/overview/lockfiles","title":"Lockfiles","description":"Securely locking down your third-party dependencies.","source":"@site/versioned_docs/version-2.24/docs/python/overview/lockfiles.mdx","sourceDirName":"docs/python/overview","slug":"/docs/python/overview/lockfiles","permalink":"/2.24/docs/python/overview/lockfiles","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/python/overview/lockfiles.mdx","tags":[],"version":"2.24","sidebarPosition":2,"frontMatter":{"title":"Lockfiles","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Third-party dependencies","permalink":"/2.24/docs/python/overview/third-party-dependencies"},"next":{"title":"Interpreter compatibility","permalink":"/2.24/docs/python/overview/interpreter-compatibility"}}')}}]);