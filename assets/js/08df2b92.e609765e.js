"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["646649"],{309265(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var s=t(278050),o=t(886070),i=t(848193);let r={authors:["eric"],tags:["announcement","python","deployment"]},a="Introducing Pants 2.7: Python tool lockfiles, Yapf, Docker, and ./pants peek",l={authorsImageUrls:[void 0]},p=[{value:"Python tool lockfiles",id:"python-tool-lockfiles",level:2},{value:"Experimental Docker support",id:"experimental-docker-support",level:2},{value:"Yapf Python formatter",id:"yapf-python-formatter",level:2},{value:"<code>./pants peek</code>",id:"pants-peek",level:2},{value:"Other changes",id:"other-changes",level:2},{value:"Upcoming in Pants 2.8",id:"upcoming-in-pants-28",level:2}];function c(e){let n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{CaptionedImg:s}=n;return s||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CaptionedImg",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s,{src:t(207277).A,children:(0,o.jsxs)(n.p,{children:["Photo by ",(0,o.jsx)(n.a,{href:"https://unsplash.com/@jhonkasalo?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Joakim\nHonkasalo"}),"\n/\n",(0,o.jsx)(n.a,{href:"https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit",children:"Unsplash"})]})}),"\n","\n",(0,o.jsx)(n.p,{children:"We're pleased to announce Pants 2.7.0, the latest release of Pants, the scalable and ergonomic build system."}),"\n",(0,o.jsxs)(n.p,{children:["To update, set ",(0,o.jsx)(n.code,{children:'pants_version = "2.7.0"'})," in your pants.toml. See ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/upgrade-tips",children:"upgrade tips"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"python-tool-lockfiles",children:"Python tool lockfiles"}),"\n",(0,o.jsxs)(n.p,{children:["Pants now ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.7/docs/python-third-party-dependencies#tool-lockfiles",children:"pins every dependency"})," used when installing Python tools like Black, Pytest, and MyPy. This makes your builds more stable and more secure from supply chain attacks (by using pip's checksum validation for downloaded files)."]}),"\n",(0,o.jsxs)(n.p,{children:["Each tool comes with a default lockfile. If you change the tool's version or add plugins, you can generate a new lockfile by running ",(0,o.jsx)(n.code,{children:"./pants generate-lockfiles"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell-session",children:"$ ./pants generate-lockfiles\n19:00:39.29 [INFO] Wrote lockfile for the resolve `flake8` to 3rdparty/flake8_lockfile.txt\n19:00:39.30 [INFO] Wrote lockfile for the resolve `pytest` to 3rdparty/pytest_lockfile.txt\n"})}),"\n",(0,o.jsx)(n.p,{children:"Whenever you change the tool's version or extra requirements, Pants will remind you to regenerate the lockfile."}),"\n",(0,o.jsxs)(n.p,{children:["(This new feature lays the foundation for an ",(0,o.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/issues/12314",children:"upcoming revamp of lockfiles"})," for your user code, including supporting using different lockfiles for different portions of your code, and generating the files for you!)"]}),"\n",(0,o.jsx)(n.h2,{id:"experimental-docker-support",children:"Experimental Docker support"}),"\n",(0,o.jsx)(n.p,{children:"Pants can now create Docker images for you that include any of Pants' supported artifact types, including archives, PEX binary files, and Python wheel files!"}),"\n",(0,o.jsx)(n.p,{children:"For example, given this Dockerfile and Pants metadata:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dockerfile",metastring:'title="project/Dockerfile"',children:'FROM python:3.8\nENTRYPOINT ["/bin/my_app"]\nCOPY project/app.pex /bin/my_app\n'})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",metastring:'title="project/BUILD"',children:'pex_binary(name="app", entry_point="app.py")\ndocker_image(name="docker_app", dependencies=[":app"])\n'})}),"\n",(0,o.jsx)(n.p,{children:"Pants will first build your PEX binary, and then insert it into the Dockerfile's context."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell-session",children:"$ ./pants package project/Dockerfile\n18:07:29.66 [INFO] Completed: Building project/app.pex\n18:07:31.83 [INFO] Completed: Building docker image docker_app:latest\n18:07:31.83 [INFO] Built docker image: docker_app:latest\nTo try out the image interactively:\n    docker run -it --rm docker_app:latest [entrypoint args...]\nTo push your image:\n    docker push docker_app:latest\n$ docker run -it --rm docker_app:latest\nHello, Docker!\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Pants also now supports ",(0,o.jsx)(n.a,{href:"https://github.com/hadolint/hadolint",children:"Hadolint"})," to lint your Dockerfiles. This gives you a consistent interface to run all your project's linters by running ",(0,o.jsx)(n.code,{children:"./pants lint"}),": Pants will run all activated linters\u2014selected from Hadolint, Shellcheck, Black, Flake8, isort, Pylint, and more\u2014in parallel."]}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.7/docs/docker",children:"https://www.pantsbuild.org/v2.7/docs/docker"})," to get started, and stay tuned for a blog post from ",(0,o.jsx)(n.a,{href:"/blog/2021/09/14/meet-our-newest-maintainer-andreas-stenius",children:"our newest maintainer"})," Andreas Stenius about adding this highly requested feature."]}),"\n",(0,o.jsxs)(n.p,{children:["Disclaimer: this backend is still experimental and may change based on user feedback. Share what you think in ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/getting-help",children:"Slack"}),"!"]}),"\n",(0,o.jsx)(n.h2,{id:"yapf-python-formatter",children:"Yapf Python formatter"}),"\n",(0,o.jsxs)(n.p,{children:["Pants now supports the Yapf formatter, in addition to ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.7/docs/python-linters-and-formatters",children:"already supporting"})," Black, isort, Docformatter, and Shfmt!"]}),"\n",(0,o.jsx)(n.p,{children:"For example, if we start with this code:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"x  =     3 +  3\nprint( x )\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You can run ",(0,o.jsx)(n.code,{children:"./pants fmt"})," and Yapf will reformat the file to:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"x = 3 + 3\nprint(x)\n"})}),"\n",(0,o.jsx)(n.p,{children:"Stay tuned for a blog post from Pants Contributor Alexey Tereshenkov about his experience writing his first Pants plugin."}),"\n",(0,o.jsx)(n.h2,{id:"pants-peek",children:(0,o.jsx)(n.code,{children:"./pants peek"})}),"\n",(0,o.jsx)(n.p,{children:"You can now programmatically query targets to see what metadata you're setting for your code, getting back a JSON representation of your metadata."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell-session",children:'$ ./pants peek helloworld/app.py\n[\n  {\n    "address": "helloworld/app.py",\n    "target_type": "python_library",\n    "dependencies": null,\n    "interpreter_constraints": ["==3.7.*"],\n    "skip_black": false,\n    ...\n    "skip_mypy": false,\n    "sources": [\n      "app.py",\n    ],\n  },\n]\n'})}),"\n",(0,o.jsxs)(n.p,{children:["For example, Pants supports ",(0,o.jsx)(n.a,{href:"/blog/2021/05/20/introducing-pants-2-5",children:"incremental tool adoption"})," where you can say to skip running the tool on some code by setting fields like ",(0,o.jsx)(n.code,{children:"skip_flake8=True"}),". Now, you can combine ",(0,o.jsx)(n.code,{children:"./pants peek"})," with ",(0,o.jsx)(n.a,{href:"https://stedolan.github.io/jq/",children:"jq"})," to find all targets where you set ",(0,o.jsx)(n.code,{children:"skip_flake8=True"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell-session",children:"$ ./pants peek :: | jq -r '.[] | select(.skip_flake8 == true) | .[\"address\"]'\nhelloworld/greet:lib\nhelloworld/greet:tests\nhelloworld/util:lib\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Likewise, you could set up Pants to run only part of your test suite, and then use ",(0,o.jsx)(n.code,{children:"./pants peek"})," and ",(0,o.jsx)(n.code,{children:"jq"})," to find all tests that set ",(0,o.jsx)(n.code,{children:"skip_tests=True"})," and pipe those into your old test runner. This allows you to incrementally switch to Pants's test support."]}),"\n",(0,o.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Cache reuse is higher for resolving third-party dependencies."}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"python_distribution"})," has a new, more flexible ",(0,o.jsxs)(n.a,{href:"https://www.pantsbuild.org/v2.7/docs/python-distributions#using-a-generated-setuppy",children:[(0,o.jsx)(n.code,{children:"entry_points"})," field"]}),", which replaces the now deprecated ",(0,o.jsx)(n.code,{children:".with_binaries()"})," mechanism."]}),"\n",(0,o.jsxs)(n.li,{children:["Pants can now build ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.7/docs/python-distributions#using-an-existing-setuppy",children:"existing setup.py files"})," for you."]}),"\n",(0,o.jsxs)(n.li,{children:["macOS ARM (Apple Silicon) is better supported when installing native tools like ",(0,o.jsx)(n.code,{children:"protoc"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["ASDF support was added to ",(0,o.jsx)(n.code,{children:"[python-setup].interpreter_search_paths"}),"."]}),"\n",(0,o.jsx)(n.li,{children:"Pants now uses PEP 561, meaning that plugin authors will benefit from type hints."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["See the full ",(0,o.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/blob/release_2.7.0/src/python/pants/notes/2.7.x.md",children:"changelog"})," for more changes."]}),"\n",(0,o.jsx)(n.h2,{id:"upcoming-in-pants-28",children:"Upcoming in Pants 2.8"}),"\n",(0,o.jsx)(n.p,{children:"We've been working on adding support for other languages, starting with Go and Java. We hope to have made enough meaningful progress for alpha/beta testing."}),"\n",(0,o.jsxs)(n.p,{children:["Other upcoming improvements in Pants ",(0,o.jsx)(n.a,{href:"https://github.com/pantsbuild/pants/blob/main/docs/notes/2.8.x.md",children:"2.8"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["TOML dictionaries will work for ",(0,o.jsx)(n.code,{children:"dict"})," options."]}),"\n",(0,o.jsxs)(n.li,{children:["Google Cloud Functions, similar to the ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/v2.7/docs/awslambda-python",children:"AWS Lambda support"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"pex_binary"})," has a ",(0,o.jsx)(n.code,{children:"script"})," field to allow setting console scripts."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"[coverage-py].fail_under"})," option to fail if test coverage is too low."]}),"\n",(0,o.jsxs)(n.li,{children:["An ",(0,o.jsx)(n.code,{children:"experimental_shell_command"})," target to support scripting of build steps."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"--"}),"\n",(0,o.jsxs)(n.p,{children:["Try out our ",(0,o.jsx)(n.a,{href:"https://github.com/pantsbuild/example-python/",children:"example repository"}),", and let us know what you think in ",(0,o.jsx)(n.a,{href:"https://www.pantsbuild.org/docs/getting-help",children:"Slack!"})]})]})}function d(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},207277(e,n,t){t.d(n,{A:()=>s});let s=t.p+"assets/images/splash-e0b3e965e92033179fd2bb7e766e9ebc.jpg"},848193(e,n,t){t.d(n,{R:()=>r,x:()=>a});var s=t(830758);let o={},i=s.createContext(o);function r(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}},278050(e){e.exports=JSON.parse('{"permalink":"/blog/2021/09/27/introducing-pants-2-7","editUrl":"https://github.com/pantsbuild/pantsbuild.org/edit/main/blog/2021-09-27-introducing-pants-2-7/index.mdx","source":"@site/blog/2021-09-27-introducing-pants-2-7/index.mdx","title":"Introducing Pants 2.7: Python tool lockfiles, Yapf, Docker, and ./pants peek","description":"Photo by [Joakim","date":"2021-09-27T00:00:00.000Z","tags":[{"inline":true,"label":"announcement","permalink":"/blog/tags/announcement"},{"inline":true,"label":"python","permalink":"/blog/tags/python"},{"inline":true,"label":"deployment","permalink":"/blog/tags/deployment"}],"readingTime":4.76,"hasTruncateMarker":true,"authors":[{"name":"Eric Arellano","title":"Pants Maintainer","url":"https://github.com/Eric-Arellano","imageURL":"https://github.com/Eric-Arellano.png","key":"eric","page":null}],"frontMatter":{"authors":["eric"],"tags":["announcement","python","deployment"]},"unlisted":false,"prevItem":{"title":"My experience contributing YAPF formatter support to Pants 2.7","permalink":"/blog/2021/09/27/contributing-yapf-support"},"nextItem":{"title":"Meet our newest Maintainer: Andreas Stenius","permalink":"/blog/2021/09/14/meet-our-newest-maintainer-andreas-stenius"}}')}}]);