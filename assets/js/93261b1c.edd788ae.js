"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["804579"],{192119(e,s,n){n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>t,toc:()=>h});var t=n(982763),i=n(886070),r=n(848193);let a={title:"Release process",sidebar_position:1},o,l={},h=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create a PGP signing key",id:"create-a-pgp-signing-key",level:3},{value:"Add your PGP key to GitHub.",id:"add-your-pgp-key-to-github",level:3},{value:"Configure Git to use your PGP key.",id:"configure-git-to-use-your-pgp-key",level:3},{value:"Authenticate with the GitHub API",id:"authenticate-with-the-github-api",level:3},{value:"Step 0: Preliminaries",id:"step-0-preliminaries",level:2},{value:"<code>dev</code> - Check for any deprecations",id:"dev---check-for-any-deprecations",level:3},{value:"<code>a0</code> - Release notes for next version",id:"a0---release-notes-for-next-version",level:3},{value:"<code>rc</code> - Check for cherry-picks",id:"rc---check-for-cherry-picks",level:3},{value:"Step 1: Create the release commit",id:"step-1-create-the-release-commit",level:2},{value:"Bump the VERSION",id:"bump-the-version",level:3},{value:"Merge the pull request",id:"merge-the-pull-request",level:3},{value:"<code>a0</code> - new release cycle",id:"a0---new-release-cycle",level:3},{value:"Create new branch",id:"create-new-branch",level:4},{value:"Identify pull requests needing changes",id:"identify-pull-requests-needing-changes",level:4},{value:"Step 2: Tag the release to trigger publishing",id:"step-2-tag-the-release-to-trigger-publishing",level:2},{value:"Step 3: Test the release",id:"step-3-test-the-release",level:2},{value:"Step 4: Run release testing on public repositories",id:"step-4-run-release-testing-on-public-repositories",level:2},{value:"Step 5: Publish a schema in JSON Schema Store",id:"step-5-publish-a-schema-in-json-schema-store",level:2},{value:"When Things Go Wrong",id:"when-things-go-wrong",level:2}];function c(e){let s={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.p,{children:"How to release a new version of Pants and its plugins."}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.p,{children:["This page covers the nitty-gritty of executing a release, and is probably only interesting for maintainers. If you're interested in when and why Pants is released, please see the ",(0,i.jsx)(s.a,{href:"/stable/docs/contributions/releases/release-strategy",children:"Release strategy"})," page."]}),"\n",(0,i.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(s.p,{children:"You only need to set these up once."}),"\n",(0,i.jsx)(s.h3,{id:"create-a-pgp-signing-key",children:"Create a PGP signing key"}),"\n",(0,i.jsx)(s.p,{children:"If you already have one, you can reuse it."}),"\n",(0,i.jsxs)(s.p,{children:["You likely want to use the gpg implementation of pgp. On macOS, you can ",(0,i.jsx)(s.code,{children:"brew install gpg"}),". Once gpg is installed, generate a new key: ",(0,i.jsx)(s.a,{href:"https://docs.github.com/en/github/authenticating-to-github/generating-a-new-gpg-key",children:"https://docs.github.com/en/github/authenticating-to-github/generating-a-new-gpg-key"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"Please use a password for your key!"}),"\n",(0,i.jsx)(s.h3,{id:"add-your-pgp-key-to-github",children:"Add your PGP key to GitHub."}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://docs.github.com/en/github/authenticating-to-github/adding-a-new-gpg-key-to-your-github-account",children:"https://docs.github.com/en/github/authenticating-to-github/adding-a-new-gpg-key-to-your-github-account"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"configure-git-to-use-your-pgp-key",children:"Configure Git to use your PGP key."}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://docs.github.com/en/github/authenticating-to-github/telling-git-about-your-signing-key",children:"https://docs.github.com/en/github/authenticating-to-github/telling-git-about-your-signing-key"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"Note: the last step is required on macOS."}),"\n",(0,i.jsx)(s.h3,{id:"authenticate-with-the-github-api",children:"Authenticate with the GitHub API"}),"\n",(0,i.jsxs)(s.p,{children:["Ensure that you have a ",(0,i.jsx)(s.a,{href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token",children:"personal access token"})," for your GitHub account in your ",(0,i.jsx)(s.code,{children:".netrc"})," file."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"machine api.github.com\n    login <username>\n    password <token>\n"})}),"\n",(0,i.jsx)(s.h2,{id:"step-0-preliminaries",children:"Step 0: Preliminaries"}),"\n",(0,i.jsxs)(s.h3,{id:"dev---check-for-any-deprecations",children:[(0,i.jsx)(s.code,{children:"dev"})," - Check for any deprecations"]}),"\n",(0,i.jsxs)(s.p,{children:["If this is a dev release, ensure that deprecations set to expire in the released version have been removed. To check for this, search the code for the version you're releasing. For example, ",(0,i.jsx)(s.code,{children:"git grep 2.9.0.dev0"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"If there is deprecated code that must be removed, you can either:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Ping the person who made the deprecation to ask them to remove it."}),"\n",(0,i.jsx)(s.li,{children:"Remove it yourself, in a precursor PR."}),"\n",(0,i.jsx)(s.li,{children:"Bump the deprecation removal target back by one dev release."}),"\n"]}),"\n",(0,i.jsxs)(s.h3,{id:"a0---release-notes-for-next-version",children:[(0,i.jsx)(s.code,{children:"a0"})," - Release notes for next version"]}),"\n",(0,i.jsxs)(s.p,{children:["When releasing an ",(0,i.jsx)(s.code,{children:"a0"})," version, we need to prepare the release notes for the ",(0,i.jsx)(s.em,{children:"next"})," version:"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Create pull request adding the release notes file for the next version in ",(0,i.jsx)(s.code,{children:"docs/notes/"}),", e.g. if you're releasing 2.8.0a0, create ",(0,i.jsx)(s.code,{children:"docs/notes/2.9.x.md"}),".","\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Copy the title and template over from the prior release, e.g. ",(0,i.jsx)(s.code,{children:"2.8.x.md"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"Delete the content, leaving just the headings, so the file is mostly empty."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["NB. this can merge after the release pull request, but should be available soon so that pull requests tht land in ",(0,i.jsx)(s.code,{children:"main"})," can update it"]}),"\n"]}),"\n",(0,i.jsxs)(s.h3,{id:"rc---check-for-cherry-picks",children:[(0,i.jsx)(s.code,{children:"rc"})," - Check for cherry-picks"]}),"\n",(0,i.jsxs)(s.p,{children:["If this is a release candidate, ensure that pending cherry-picks have been applied in the release branch. Cherry-picks are usually applied automatically, but this may not always succeed, so ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/pulls?q=is%3Apr+label%3Aneeds-cherrypick+is%3Aclosed",children:"check for any pending cherry-picks"}),", and find the relevant ones by looking at the milestone: for instance, if doing a release for 2.16, the relevant cherry-picks are those for milestone ",(0,i.jsx)(s.code,{children:"2.16.x"})," or earlier."]}),"\n",(0,i.jsx)(s.p,{children:"The process may fail in one of two ways:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["The cherry-picking process failed, and tagged the PR with ",(0,i.jsx)(s.code,{children:"auto-cherry-picking-failed"}),": follow the instructions in the comment on the pull request. (This likely means there are merge conflicts that require manual resolution.)"]}),"\n",(0,i.jsxs)(s.li,{children:["the cherry-pick hasn't (yet) run: trigger the automation manually by going to ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/actions/workflows/auto-cherry-picker.yaml",children:"the GitHub Action"}),', clicking on the "Run workflow" button, and providing the PR number.']}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"step-1-create-the-release-commit",children:"Step 1: Create the release commit"}),"\n",(0,i.jsxs)(s.p,{children:["The release commit is the commit that bumps the VERSION string. For ",(0,i.jsx)(s.code,{children:"dev"}),"/",(0,i.jsx)(s.code,{children:"a0"})," releases this happens in the ",(0,i.jsx)(s.code,{children:"main"})," branch, in the same commit that updates the release notes and the ",(0,i.jsx)(s.code,{children:"CONTRIBUTORS.md"})," file. For ",(0,i.jsx)(s.code,{children:"rc"})," and stable releases, this happens in the relevant stable branch."]}),"\n",(0,i.jsx)(s.h3,{id:"bump-the-version",children:"Bump the VERSION"}),"\n",(0,i.jsxs)(s.p,{children:["From the ",(0,i.jsx)(s.code,{children:"main"})," branch, run ",(0,i.jsx)(s.code,{children:"pants run src/python/pants_release/start_release.py -- --new 2.9.0.dev1 --release-manager your_github_username --publish"})," with the relevant version and your own GitHub username."]}),"\n",(0,i.jsx)(s.p,{children:"This will create a pull request that:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["updates ",(0,i.jsx)(s.code,{children:"CONTRIBUTORS.md"})]}),"\n",(0,i.jsxs)(s.li,{children:["bumps the ",(0,i.jsx)(s.code,{children:"VERSION"})," on the branch"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"merge-the-pull-request",children:"Merge the pull request"}),"\n",(0,i.jsxs)(s.p,{children:["Post the PR to the ",(0,i.jsx)(s.code,{children:"#development"})," channel in Slack. Merge once approved and green."]}),"\n",(0,i.jsxs)(s.h3,{id:"a0---new-release-cycle",children:[(0,i.jsx)(s.code,{children:"a0"})," - new release cycle"]}),"\n",(0,i.jsxs)(s.p,{children:["If you're releasing an ",(0,i.jsx)(s.code,{children:"a0"})," release, you must:"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"create the stable branch for that version,"}),"\n",(0,i.jsx)(s.li,{children:"identify pull requests that need changes to their release notes."}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"create-new-branch",children:"Create new branch"}),"\n",(0,i.jsxs)(s.p,{children:["For example, if you're releasing ",(0,i.jsx)(s.code,{children:"2.9.0a0"}),", create the branch ",(0,i.jsx)(s.code,{children:"2.9.x"})," by running the command below. Make sure you are on your release commit before doing this."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"$ git checkout -b 2.9.x\n$ git push upstream 2.9.x\n"})}),"\n",(0,i.jsx)(s.h4,{id:"identify-pull-requests-needing-changes",children:"Identify pull requests needing changes"}),"\n",(0,i.jsx)(s.p,{children:"Find unmerged pull requests with release notes changes that will now be targetting the new release, and so should be updated:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Use this ",(0,i.jsx)(s.code,{children:"gh"})," CLI command to find pull requests targetting ",(0,i.jsx)(s.code,{children:"main"})," that touch any release notes file:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",children:"gh pr list --limit 1000 --json url,files --base main | jq 'map(select(.files | map(.path | startswith(\"docs/notes/\")) | any) | .url)'\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:['For each of them, add a "Request changes" review that asks for an update. Suggested review text (replace ',(0,i.jsx)(s.code,{children:"$OLD_VERSION"})," and ",(0,i.jsx)(s.code,{children:"$NEW_VERSION"})," as appropriate, e.g. if you're releasing 2.8.0a0, ",(0,i.jsx)(s.code,{children:"OLD_VERSION = 2.8"}),", ",(0,i.jsx)(s.code,{children:"NEW_VERSION = 2.9"}),"):"]}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["Thanks for the contribution. We've just branched for $OLD_VERSION, so merging this pull request now will come out in $NEW_VERSION, please move the release notes updates to ",(0,i.jsx)(s.code,{children:"docs/notes/$NEW_VERSION.x.md"})," if that's appropriate."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"In some cases, the release note changes can remain in the old version (for example, if the pull request is a bug fix that needs to be cherry-picked)."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"step-2-tag-the-release-to-trigger-publishing",children:"Step 2: Tag the release to trigger publishing"}),"\n",(0,i.jsxs)(s.p,{children:["Once you have merged the ",(0,i.jsx)(s.code,{children:"VERSION"})," bump \u2014 which will be on ",(0,i.jsx)(s.code,{children:"main"})," for ",(0,i.jsx)(s.code,{children:"dev"})," and ",(0,i.jsx)(s.code,{children:"a0"})," releases, and on the release branch for release candidates \u2014 tag the release commit to trigger wheel building and publishing."]}),"\n",(0,i.jsx)(s.p,{children:"First, ensure that you are on your release branch at your version bump commit."}),"\n",(0,i.jsx)(s.admonition,{title:"Tip: if new commits have landed after your release commit",type:"note",children:(0,i.jsxs)(s.p,{children:["You can reset to your release commit by running ",(0,i.jsx)(s.code,{children:"git reset --hard <sha>"}),"."]})}),"\n",(0,i.jsx)(s.p,{children:"Then, run:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"./pants run src/python/pants_release/release.py -- tag-release\n"})}),"\n",(0,i.jsxs)(s.p,{children:["This will tag the release with your PGP key, and push the tag to origin, which will kick off a ",(0,i.jsxs)(s.a,{href:"https://github.com/pantsbuild/pants/actions/workflows/release.yaml",children:[(0,i.jsx)(s.code,{children:"Release"})," job"]})," to build the wheels and publish them to PyPI."]}),"\n",(0,i.jsx)(s.h2,{id:"step-3-test-the-release",children:"Step 3: Test the release"}),"\n",(0,i.jsx)(s.p,{children:"Run this script as a basic smoke test:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"./pants run src/python/pants_release/release.py -- test-release\n"})}),"\n",(0,i.jsxs)(s.p,{children:["You should also check ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/releases",children:"GitHub Releases"}),' to ensure everything looks good. Find the version you released, then click it and confirm that the "Assets" list includes PEXes for macOS and Linux.']}),"\n",(0,i.jsx)(s.h2,{id:"step-4-run-release-testing-on-public-repositories",children:"Step 4: Run release testing on public repositories"}),"\n",(0,i.jsxs)(s.p,{children:["Manually trigger a run of the ",(0,i.jsx)(s.a,{href:"https://github.com/pantsbuild/pants/actions/workflows/public_repos.yaml",children:"public repositories testing workflow"}),', specifying the version just published as the "Pants version".']}),"\n",(0,i.jsx)(s.p,{children:"This workflow checks out various open-source repositories that use Pants and runs the given version of Pants against them, to try to validate if they can upgrade smoothly or if there's any (obvious) bugs. The workflow runs the repositories in two configurations: first with the repo's default configuration as a baseline, and then with the specified Pants version (and any additional options)."}),"\n",(0,i.jsx)(s.p,{children:"Once the workflow finishes, look through any failures and determine if there's any interesting/unknown problems, ensuring there's issues filed (and tagged with the appropriate milestone) for them. For instance, a custom plugin that is broken by a plugin API change is okay, but other sorts of breakage might not be. If there's a failure during the baseline, a similar failure during the real (non-baseline) test can be ignored, as it likely means the repository in question is broken."}),"\n",(0,i.jsxs)(s.p,{children:["Alternatively, after starting the workflow, post the link to the in-progress run in ",(0,i.jsx)(s.code,{children:"#development"})," in Slack, so that someone can come back to it when it does finish."]}),"\n",(0,i.jsx)(s.h2,{id:"step-5-publish-a-schema-in-json-schema-store",children:"Step 5: Publish a schema in JSON Schema Store"}),"\n",(0,i.jsxs)(s.p,{children:["Some editors can use JSON Schema for better completions when editing TOML files like ",(0,i.jsx)(s.code,{children:"pants.toml"}),".\nPants configuration file schema is published at ",(0,i.jsx)(s.a,{href:"https://www.schemastore.org/",children:"https://www.schemastore.org/"}),". For every stable ",(0,i.jsx)(s.code,{children:"2.x.0"})," release,\na new schema needs to be generated and uploaded by submitting a PR against ",(0,i.jsx)(s.a,{href:"https://github.com/SchemaStore/schemastore",children:"https://github.com/SchemaStore/schemastore"}),".\nThis is an example pull request for reference: ",(0,i.jsx)(s.a,{href:"https://github.com/SchemaStore/schemastore/pull/3880",children:"https://github.com/SchemaStore/schemastore/pull/3880"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["To produce ",(0,i.jsx)(s.code,{children:"pantsbuild-<version>.json"})," schema file, run:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pants help-all > all-help.json\npants run build-support/bin/generate_json_schema.py -- --all-help-file=all-help.json\n"})}),"\n",(0,i.jsxs)(s.p,{children:["It may be helpful to compare the last schema file with the newly produced one to make sure there are no discrepancies\n(e.g. the config values have a sensible type and the help strings are rendered adequately). You can download the\nschemas of previous releases from the store website; the JSON files are available at\n",(0,i.jsx)(s.code,{children:"https://json.schemastore.org/pantsbuild-<version>.json"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"Watch out for any configuration parameters that may rely on your local environment as certain default config values\nwill be expanded using local runtime environment which is undesirable. The script handles those known config values\nby keeping a list of them, however, it may need to be extended as more options with environment specific default\nvalues are added."}),"\n",(0,i.jsx)(s.h2,{id:"when-things-go-wrong",children:"When Things Go Wrong"}),"\n",(0,i.jsx)(s.p,{children:"From time to time, a release will fail. It's a complex process. The first thing to do after you've\nexhausted your knowledge and debugging skills or patience is to contact others. You might reach out\nto the development or maintainers channels on Pantsbuild Slack in the absence of other ideas about\nwhom to ask for help."})]})}function d(e={}){let{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},848193(e,s,n){n.d(s,{R:()=>a,x:()=>o});var t=n(830758);let i={},r=t.createContext(i);function a(e){let s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:s},e.children)}},982763(e){e.exports=JSON.parse('{"id":"docs/contributions/releases/release-process","title":"Release process","description":"How to release a new version of Pants and its plugins.","source":"@site/versioned_docs/version-2.30/docs/contributions/releases/release-process.mdx","sourceDirName":"docs/contributions/releases","slug":"/docs/contributions/releases/release-process","permalink":"/stable/docs/contributions/releases/release-process","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/contributions/releases/release-process.mdx","tags":[],"version":"2.30","sidebarPosition":1,"frontMatter":{"title":"Release process","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Release strategy","permalink":"/stable/docs/contributions/releases/release-strategy"},"next":{"title":"GitHub Actions macOS runners","permalink":"/stable/docs/contributions/releases/github-actions-macos-arm64-runners"}}')}}]);