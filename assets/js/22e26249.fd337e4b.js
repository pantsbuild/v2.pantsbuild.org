"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["823564"],{847556(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>y,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var s=t(24475),r=t(886070),o=t(848193),i=t(685008),l=t(637180);let a={title:"check",sidebar_position:0},c,d={},p=[{value:"Activating MyPy",id:"activating-mypy",level:2},{value:"Hook up a MyPy config file",id:"hook-up-a-mypy-config-file",level:3},{value:"Change the MyPy version",id:"change-the-mypy-version",level:3},{value:"Incrementally adopt MyPy with <code>skip_mypy=True</code>",id:"incrementally-adopt-mypy-with-skip_mypytrue",level:3},{value:"First-party type stubs (<code>.pyi</code> files)",id:"first-party-type-stubs-pyi-files",level:3},{value:"Third-party type stubs",id:"third-party-type-stubs",level:3},{value:"Add a third-party plugin",id:"add-a-third-party-plugin",level:3},{value:"Add a first-party plugin",id:"add-a-first-party-plugin",level:3},{value:"Reports",id:"reports",level:3},{value:"Known limitations",id:"known-limitations",level:2},{value:"Performance is sometimes slower than normal",id:"performance-is-sometimes-slower-than-normal",level:3},{value:"Tip: only run over changed files and their dependents",id:"tip-only-run-over-changed-files-and-their-dependents",level:2}];function h(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"How to use MyPy."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"activating-mypy",children:"Activating MyPy"}),"\n",(0,r.jsxs)(n.p,{children:["To opt-in, add ",(0,r.jsx)(n.code,{children:"pants.backend.python.typecheck.mypy"})," to ",(0,r.jsx)(n.code,{children:"backend_packages"})," in your config file."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages.add = [\n  "pants.backend.python",\n  "pants.backend.python.typecheck.mypy",\n]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["This will register a new ",(0,r.jsx)(n.code,{children:"check"})," goal:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ pants check helloworld/util/lang.py\n$ pants check ::\n"})}),"\n",(0,r.jsxs)(n.admonition,{title:"Benefit of Pants: typecheck Python 2-only and Python 3-only code at the same time",type:"tip",children:[(0,r.jsxs)(n.p,{children:["MyPy determines which Python version to use based on its ",(0,r.jsx)(n.code,{children:"python_version"})," option. If that's undefined, MyPy uses the interpreter the tool is run with. Because you can only use one config file at a time with MyPy, you cannot normally say to use ",(0,r.jsx)(n.code,{children:"2.7"})," for part of your codebase but ",(0,r.jsx)(n.code,{children:"3.6"})," for the rest; you must choose a single version."]}),(0,r.jsxs)(n.p,{children:["Instead, Pants will group your targets based on their ",(0,r.jsx)(n.a,{href:"/2.17/docs/python/overview/interpreter-compatibility",children:"interpreter constraints"}),", and run all the Python 2 targets together and all the Python 3 targets together. It will automatically set ",(0,r.jsx)(n.code,{children:"python_version"})," to the minimum compatible interpreter, such as a constraint like ",(0,r.jsx)(n.code,{children:'["==2.7.*", ">3.6"]'})," using ",(0,r.jsx)(n.code,{children:"2.7"}),"."]}),(0,r.jsxs)(n.p,{children:["To turn this off, you can still set ",(0,r.jsx)(n.code,{children:"python_version"})," in ",(0,r.jsx)(n.code,{children:"mypy.ini"})," or ",(0,r.jsx)(n.code,{children:"--python-version"}),"/",(0,r.jsx)(n.code,{children:"--py2"})," in ",(0,r.jsx)(n.code,{children:"--mypy-args"}),"; Pants will respect the value you set."]})]}),"\n",(0,r.jsx)(n.h3,{id:"hook-up-a-mypy-config-file",children:"Hook up a MyPy config file"}),"\n",(0,r.jsxs)(n.p,{children:["Pants will automatically include your config file if it's located at ",(0,r.jsx)(n.code,{children:"mypy.ini"}),", ",(0,r.jsx)(n.code,{children:".mypy.ini"}),", ",(0,r.jsx)(n.code,{children:"setup.cfg"}),", or ",(0,r.jsx)(n.code,{children:"pyproject.toml"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Otherwise, you must set the option ",(0,r.jsx)(n.code,{children:"[mypy].config"})," for Pants to include the config file in the process's sandbox and to instruct MyPy to load it."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[mypy]\nconfig = "build-support/mypy.ini"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"change-the-mypy-version",children:"Change the MyPy version"}),"\n",(0,r.jsxs)(n.p,{children:["Use the ",(0,r.jsx)(n.code,{children:"install_from_resolve"})," option in the ",(0,r.jsx)(n.code,{children:"[mypy]"})," scope:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[python.resolves]\nmypy = "3rdparty/python/mypy.lock"\n\n[mypy]\ninstall_from_resolve = "mypy"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/2.17/docs/python/overview/lockfiles#lockfiles-for-tools",children:"Lockfiles for tools"}),"."]}),"\n",(0,r.jsxs)(n.h3,{id:"incrementally-adopt-mypy-with-skip_mypytrue",children:["Incrementally adopt MyPy with ",(0,r.jsx)(n.code,{children:"skip_mypy=True"})]}),"\n",(0,r.jsxs)(n.p,{children:["You can tell Pants to skip running MyPy on certain files by adding ",(0,r.jsx)(n.code,{children:"skip_mypy=True"})," to the relevant targets."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="project/BUILD"',children:'# Skip MyPy for all the Python files in this directory\n# (both test and non-test files).\npython_sources(name="lib", skip_mypy=True)\npython_tests(name="tests", skip_mypy=True)\n\n# To only skip certain files, use the `overrides` field.\npython_sources(\n    name="lib",\n    overrides={\n        "util.py": {"skip_mypy": True},\n        # Use a tuple to specify multiple files.\n        ("user.py", "admin.py"): {"skip_mypy": True},\n    },\n)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["When you run ",(0,r.jsx)(n.code,{children:"pants check ::"}),", Pants will skip any files belonging to skipped targets."]}),"\n",(0,r.jsxs)(n.admonition,{title:"MyPy may still try to check the skipped files!",type:"caution",children:[(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"skip_mypy"})," field only tells Pants not to provide the skipped files as direct input to MyPy. But MyPy, by default, will still try to check files that are ",(0,r.jsx)(n.a,{href:"https://mypy.readthedocs.io/en/stable/running_mypy.html#following-imports",children:"dependencies of the direct inputs"}),". So if your skipped files are dependencies of unskipped files, they may still be checked."]}),(0,r.jsxs)(n.p,{children:["To change this behavior, use MyPy's ",(0,r.jsxs)(n.a,{href:"https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-follow-imports",children:[(0,r.jsx)(n.code,{children:"--follow-imports"})," option"]}),", typically by setting it to ",(0,r.jsx)(n.code,{children:"silent"}),". You can do so either by adding it to the ",(0,r.jsxs)(n.a,{href:"/2.17/reference/subsystems/mypy#section-args",children:[(0,r.jsx)(n.code,{children:"args"})," option"]})," in the ",(0,r.jsx)(n.code,{children:"[mypy]"})," section of your Pants config file, or by setting it in ",(0,r.jsx)(n.a,{href:"https://mypy.readthedocs.io/en/stable/config_file.html",children:(0,r.jsx)(n.code,{children:"mypy.ini"})}),"."]})]}),"\n",(0,r.jsxs)(n.h3,{id:"first-party-type-stubs-pyi-files",children:["First-party type stubs (",(0,r.jsx)(n.code,{children:".pyi"})," files)"]}),"\n",(0,r.jsxs)(n.p,{children:["You can use ",(0,r.jsxs)(n.a,{href:"https://mypy.readthedocs.io/en/stable/stubs.html",children:[(0,r.jsx)(n.code,{children:".pyi"})," files"]})," for both first-party and third-party code. Include the ",(0,r.jsx)(n.code,{children:".pyi"})," files in the ",(0,r.jsx)(n.code,{children:"sources"})," field for ",(0,r.jsx)(n.code,{children:"python_source"})," / ",(0,r.jsx)(n.code,{children:"python_sources"})," and ",(0,r.jsx)(n.code,{children:"python_test"})," / ",(0,r.jsx)(n.code,{children:"python_tests"})," targets. MyPy will use these stubs rather than looking at the implementation."]}),"\n",(0,r.jsxs)(n.p,{children:["Pants's dependency inference knows to infer a dependency both on the implementation and the type stub. You can verify this by running ",(0,r.jsx)(n.code,{children:"pants dependencies path/to/file.py"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["When writing stubs for third-party libraries, you may need the set up the ",(0,r.jsx)(n.code,{children:"[source].root_patterns"})," option so that ",(0,r.jsx)(n.a,{href:"/2.17/docs/using-pants/key-concepts/source-roots",children:"source roots"})," are properly stripped. For example:"]}),"\n",(0,r.jsxs)(i.A,{groupId:"code-examples",children:[(0,r.jsx)(l.A,{value:"pants.toml",label:"pants.toml",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[source]\nroot_patterns = ["mypy-stubs", "src/python"]\n'})})}),(0,r.jsx)(l.A,{value:"mypy-stubs/colors.pyi",label:"mypy-stubs/colors.pyi",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"mypy-stubs/colors.pyi"}',children:"# Because we set `mypy-stubs` as a source root, this file will be\n# stripped to be simply `colors.pyi`. MyPy will look at this file for\n# imports of the `colors` module.\n\ndef red(s: str) -> str: ...\n"})})}),(0,r.jsx)(l.A,{value:"mypy-stubs/build",label:"mypy-stubs/BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"mypy-stubs/BUILD"}',children:'python_sources(name="lib")\n'})})}),(0,r.jsx)(l.A,{value:"src/python/project/app.py",label:"src/python/project/app.py",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"src/python/project/app.py"}',children:'from colors import red\n\nif __name__ == "__main__":\n    print(red("I\'m red!"))\n'})})}),(0,r.jsx)(l.A,{value:"src/python/project/build",label:"src/python/project/BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"src/python/project/BUILD"}',children:'# Pants will infer a dependency both on the `ansicolors` requirement\n# and our type stub.\npython_sources(name="lib")\n'})})})]}),"\n",(0,r.jsx)(n.h3,{id:"third-party-type-stubs",children:"Third-party type stubs"}),"\n",(0,r.jsxs)(n.p,{children:["You can install third-party type stubs (for example, ",(0,r.jsx)(n.code,{children:"types-requests"}),") like ",(0,r.jsx)(n.a,{href:"/2.17/docs/python/overview/third-party-dependencies",children:"normal Python requirements"}),". Pants will infer a dependency on both the type stub and the actual dependency, for example, both ",(0,r.jsx)(n.code,{children:"types-requests"})," and ",(0,r.jsx)(n.code,{children:"requests"}),", which you can confirm by running ",(0,r.jsx)(n.code,{children:"pants dependencies path/to/f.py"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["If you install MyPy from a ",(0,r.jsx)(n.a,{href:"/2.17/docs/python/overview/lockfiles#lockfiles-for-tools",children:"custom lockfile"})," you can also add type stub requirements to that lockfile.\nThis ensures that the stubs are only used when running MyPy and are not included when, for example,\n",(0,r.jsx)(n.a,{href:"/2.17/docs/python/goals/package",children:"packaging a PEX"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"add-a-third-party-plugin",children:"Add a third-party plugin"}),"\n",(0,r.jsxs)(n.p,{children:["Add any third-party MyPy plugins to a ",(0,r.jsx)(n.a,{href:"/2.17/docs/python/overview/lockfiles#lockfiles-for-tools",children:"custom lockfile"}),":"]}),"\n",(0,r.jsxs)(i.A,{groupId:"code-examples",children:[(0,r.jsx)(l.A,{value:"pants.toml",label:"pants.toml",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[python.resolves]\nmypy = "3rdparty/python/mypy-lock.txt"\n\n[mypy]\ninstall_from_resolve = "mypy"\n'})})}),(0,r.jsx)(l.A,{value:"3rdparty/python/mypy-requirements.txt",label:"3rdparty/python/mypy-requirements.txt",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'tab={"label":"3rdparty/python/mypy-requirements.txt"}',children:"mypy==1.3.0\npydantic==1.6.1\n"})})}),(0,r.jsx)(l.A,{value:"3rdparty/python/build",label:"3rdparty/python/BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"3rdparty/python/BUILD"}',children:'python_requirements(\n    name="mypy",\n    source="mypy-requirements.txt",\n    resolve="mypy",\n)\n'})})})]}),"\n",(0,r.jsxs)(n.p,{children:["Then update your ",(0,r.jsx)(n.code,{children:"mypy.ini"})," to load the plugin:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="mypy.ini"',children:"[mypy]\nplugins =\n    pydantic.mypy\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For some plugins, such as ",(0,r.jsx)(n.code,{children:"django-stubs"}),", you may need to always load certain source files, such as a ",(0,r.jsx)(n.code,{children:"settings.py"})," file. You can make sure that this source file is always used by hijacking the ",(0,r.jsx)(n.code,{children:"source_plugins"})," option, which allows you to specify targets whose ",(0,r.jsx)(n.code,{children:"sources"})," should always be used when running MyPy. See the section below for more information about source plugins."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, to fully use the ",(0,r.jsx)(n.code,{children:"django-stubs"})," plugin, your setup might look like this:"]}),"\n",(0,r.jsxs)(i.A,{groupId:"code-examples",children:[(0,r.jsx)(l.A,{value:"pants.toml",label:"pants.toml",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[source]\nroot_patterns = ["src/python"]\n\n[mypy]\ninstall_from_resolve = "mypy"\nsource_plugins = ["src/python/project:django_settings"]\n'})})}),(0,r.jsx)(l.A,{value:"3rdparty/python/mypy-requirements.txt",label:"3rdparty/python/mypy-requirements.txt",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'tab={"label":"3rdparty/python/mypy-requirements.txt"}',children:"mypy==1.3.0\ndjango-stubs==1.5.0\n"})})}),(0,r.jsx)(l.A,{value:"3rdparty/python/build",label:"3rdparty/python/BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"3rdparty/python/BUILD"}',children:'python_requirements(\n    name="mypy",\n    source="mypy-requirements.txt",\n    resolve="mypy",\n)\n'})})}),(0,r.jsx)(l.A,{value:"mypy.ini",label:"mypy.ini",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'tab={"label":"mypy.ini"}',children:"[mypy]\nplugins =\n    mypy_django_plugin.main\n\n[mypy.plugins.django-stubs]\ndjango_settings_module = project.django_settings\n"})})}),(0,r.jsx)(l.A,{value:"src/python/project/django_settings.py",label:"src/python/project/django_settings.py",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"src/python/project/django_settings.py"}',children:'from django.urls import URLPattern\n\nDEBUG = True\nDEFAULT_FROM_EMAIL = "webmaster@example.com"\nSECRET_KEY = "not so secret"\nMY_SETTING = URLPattern(pattern="foo", callback=lambda: None)\n'})})}),(0,r.jsx)(l.A,{value:"src/python/project/build",label:"src/python/project/BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"src/python/project/BUILD"}',children:'python_source(name="django_settings", source="django_settings.py")\n'})})})]}),"\n",(0,r.jsxs)(n.admonition,{title:"Importing type stubs",type:"caution",children:[(0,r.jsxs)(n.p,{children:["Type stubs specified in the MyPy custom lockfile are not visible to the ",(0,r.jsx)(n.code,{children:"python-infer"})," subsystem, and cannot be referenced as explicit ",(0,r.jsx)(n.code,{children:"dependencies"}),". If you ",(0,r.jsx)(n.code,{children:"import"})," from a stubs module in your code, and it does not have a corresponding implementation ",(0,r.jsx)(n.code,{children:"python_requirement"})," target that provides the imported module, you may see a warning/error depending on the value you've configured for ",(0,r.jsx)(n.code,{children:"[python-infer].unowned_dependency_behavior"}),". Goals other than ",(0,r.jsx)(n.code,{children:"check"})," will also raise ",(0,r.jsx)(n.code,{children:"ImportError"}),"s if the ",(0,r.jsx)(n.code,{children:"import"})," isn't conditional on the value of ",(0,r.jsx)(n.code,{children:"typing.TYPE_CHECKING"}),":"]}),(0,r.jsxs)(i.A,{groupId:"code-examples",children:[(0,r.jsx)(l.A,{value:"pants.toml",label:"pants.toml",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[python-infer]\nunowned_dependency_behavior = "warning"\n[mypy]\ninstall_from_resolve = "mypy"\n'})})}),(0,r.jsx)(l.A,{value:"3rdparty/python/mypy-requirements.txt",label:"3rdparty/python/mypy-requirements.txt",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'tab={"label":"3rdparty/python/mypy-requirements.txt"}',children:"mypy==1.3.0\nmypy_boto3_ec2==1.26.136\n"})})}),(0,r.jsx)(l.A,{value:"3rdparty/python/build",label:"3rdparty/python/BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"3rdparty/python/BUILD"}',children:'python_requirements(\nname="mypy",\nsource="mypy-requirements.txt",\nresolve="mypy",\n)\n'})})}),(0,r.jsx)(l.A,{value:"src/example.py",label:"src/example.py",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"src/example.py"}',children:"from typing import TYPE_CHECKING\n\n# Unsafe! Will fail outside of `check`\nfrom mypy_boto3_ec2 import EC2Client\n\nif TYPE_CHECKING:\n    # Safe, but will be flagged as a warning\n    from mypy_boto3_ec2 import EC2ServiceResource\n"})})})]}),(0,r.jsxs)(n.p,{children:["For these reasons, it's recommended to load any type-stub libraries that require explicit imports as part of your normal ",(0,r.jsx)(n.a,{href:"/2.17/docs/python/overview/third-party-dependencies",children:"third-party dependencies"}),". Alternatively, you can set ",(0,r.jsx)(n.code,{children:"# pants: no-infer-dep"}),' on the lines of type-stub imports "guarded" by a check of ',(0,r.jsx)(n.code,{children:"if TYPE_CHECKING"}),"."]})]}),"\n",(0,r.jsx)(n.admonition,{title:"MyPy Protobuf support",type:"note",children:(0,r.jsxs)(n.p,{children:["Add ",(0,r.jsx)(n.code,{children:"mypy_plugin = true"})," to the ",(0,r.jsx)(n.code,{children:"[python-protobuf]"})," scope. See ",(0,r.jsx)(n.a,{href:"/2.17/docs/python/integrations/protobuf-and-grpc",children:"Protobuf"})," for more information."]})}),"\n",(0,r.jsx)(n.h3,{id:"add-a-first-party-plugin",children:"Add a first-party plugin"}),"\n",(0,r.jsxs)(n.p,{children:["To add a ",(0,r.jsx)(n.a,{href:"https://mypy.readthedocs.io/en/stable/extending_mypy.html",children:"MyPy plugin"})," you wrote, add a ",(0,r.jsx)(n.code,{children:"python_source"})," or ",(0,r.jsx)(n.code,{children:"python_sources"})," target with the plugin's Python file(s) included in the ",(0,r.jsx)(n.code,{children:"sources"})," field."]}),"\n",(0,r.jsxs)(n.p,{children:["Then, add ",(0,r.jsx)(n.code,{children:"plugins = path.to.module"})," to your MyPy config file, using the name of the module without source roots. For example, if your Python file is called ",(0,r.jsx)(n.code,{children:"pants-plugins/mypy_plugins/custom_plugin.py"}),", and you set ",(0,r.jsx)(n.code,{children:"pants-plugins"})," as a source root, then set ",(0,r.jsx)(n.code,{children:"plugins = mypy_plugins.custom_plugin"}),". Set the ",(0,r.jsx)(n.code,{children:"config"})," option in the ",(0,r.jsx)(n.code,{children:"[mypy]"})," scope in your ",(0,r.jsx)(n.code,{children:"pants.toml"})," to point to your MyPy config file."]}),"\n",(0,r.jsxs)(n.p,{children:["Finally, set the option ",(0,r.jsx)(n.code,{children:"source_plugins"})," in the ",(0,r.jsx)(n.code,{children:"[mypy]"})," scope to include this target's address, e.g. ",(0,r.jsx)(n.code,{children:'source_plugins = ["pants-plugins/mypy_plugins:plugin"]'}),". This will ensure that your plugin's sources are always included in the subprocess."]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsxs)(i.A,{groupId:"code-examples",children:[(0,r.jsx)(l.A,{value:"pants.toml",label:"pants.toml",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'tab={"label":"pants.toml"}',children:'[mypy]\nsource_plugins = ["pants-plugins/mypy_plugins:plugin"]\n'})})}),(0,r.jsx)(l.A,{value:"mypy.ini",label:"mypy.ini",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'tab={"label":"mypy.ini"}',children:"plugins =\n    mypy_plugins.change_return_type\n"})})}),(0,r.jsx)(l.A,{value:"pants-plugins/mypy_plugins/build",label:"pants-plugins/mypy_plugins/BUILD",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"pants-plugins/mypy_plugins/BUILD"}',children:'python_source(name="plugin", source="change_return_type.py")\n'})})}),(0,r.jsx)(l.A,{value:"pants-plugins/mypy_plugins/change_return_type.py",label:"pants-plugins/mypy_plugins/change_return_type.py",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'tab={"label":"pants-plugins/mypy_plugins/change_return_type.py"}',children:'"""A contrived plugin that changes the return type of any\nfunction ending in `__overriden_by_plugin` to return None."""\n\nfrom typing import Callable, Optional, Type\n\nfrom mypy.plugin import FunctionContext, Plugin\nfrom mypy.types import NoneType, Type as MyPyType\n\nfrom plugins.subdir.dep import is_overridable_function\n\nclass ChangeReturnTypePlugin(Plugin):\n    def get_function_hook(\n        self, fullname: str\n    ) -> Optional[Callable[[FunctionContext], MyPyType]]:\n        return hook if name.endswith("__overridden_by_plugin") else None\n\n\ndef hook(ctx: FunctionContext) -> MyPyType:\n    return NoneType()\n\n\ndef plugin(_version: str) -> Type[Plugin]:\n    return ChangeReturnTypePlugin\n'})})})]}),"\n",(0,r.jsxs)(n.p,{children:["Because this is a ",(0,r.jsx)(n.code,{children:"python_source"})," or ",(0,r.jsx)(n.code,{children:"python_sources"})," target, Pants will treat this code like your other Python files, such as running linters on it or allowing you to write a ",(0,r.jsx)(n.code,{children:"python_distribution"})," target to distribute the plugin externally."]}),"\n",(0,r.jsx)(n.h3,{id:"reports",children:"Reports"}),"\n",(0,r.jsxs)(n.p,{children:["MyPy can generate ",(0,r.jsx)(n.a,{href:"https://mypy.readthedocs.io/en/stable/command_line.html#report-generation",children:"various report files"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["For Pants to properly preserve the reports, instruct MyPy to write to the ",(0,r.jsx)(n.code,{children:"reports/"})," folder by updating its config file or ",(0,r.jsx)(n.code,{children:"--mypy-args"}),". For example, in your pants.toml:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[mypy]\nargs = ["--linecount-report=reports"]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Pants will copy all reports into the folder ",(0,r.jsx)(n.code,{children:"dist/check/mypy"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"known-limitations",children:"Known limitations"}),"\n",(0,r.jsx)(n.h3,{id:"performance-is-sometimes-slower-than-normal",children:"Performance is sometimes slower than normal"}),"\n",(0,r.jsxs)(n.p,{children:["Pants 2.14 added support for leveraging MyPy's cache, making subsequent runs of MyPy extremely performant.\nThe support, however, requires features that were added to MyPy in version ",(0,r.jsx)(n.code,{children:"0.700"}),", and requires that\n",(0,r.jsx)(n.code,{children:"python_version"})," isn't set in MyPy's config or in ",(0,r.jsx)(n.code,{children:"[mypy].args"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["If you're using a version of MyPy older than ",(0,r.jsx)(n.code,{children:"0.700"}),", consider upgrading to unlock super-speedy subsequent runs of MyPy.\nAdditionally consider not providing ",(0,r.jsx)(n.code,{children:"python_version"})," in your config or args."]}),"\n",(0,r.jsx)(n.h2,{id:"tip-only-run-over-changed-files-and-their-dependents",children:"Tip: only run over changed files and their dependents"}),"\n",(0,r.jsx)(n.p,{children:"When changing type hints code, you not only need to run over the changed files, but also any code that depends on the changed files:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ pants --changed-since=HEAD --changed-dependents=transitive check\n"})}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/2.17/docs/using-pants/advanced-target-selection",children:"Advanced target selection"})," for more information."]})]})}function y(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},753348(e,n,t){t.d(n,{A:()=>s});let s={tabItem:"tabItem_mHvh"}},618264(e,n,t){t.d(n,{A:()=>s});let s={tabList:"tabList_sFbf",tabItem:"tabItem_UVfV"}},637180(e,n,t){t.d(n,{A:()=>i});var s=t(886070);t(830758);var r=t(313526),o=t(753348);function i({children:e,hidden:n,className:t}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(o.A.tabItem,t),hidden:n,children:e})}},685008(e,n,t){t.d(n,{A:()=>u});var s=t(886070),r=t(830758),o=t(313526),i=t(911212),l=t(274875),a=t(106632),c=t(189223),d=t(618264);function p({className:e,block:n,selectedValue:t,selectValue:r,tabValues:i}){let a=[],{blockElementScrollPositionUntilNextRender:c}=(0,l.a_)(),p=e=>{let n=e.currentTarget,s=i[a.indexOf(n)].value;s!==t&&(c(n),r(s))},h=e=>{let n=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{let t=a.indexOf(e.currentTarget)+1;n=a[t]??a[0];break}case"ArrowLeft":{let t=a.indexOf(e.currentTarget)-1;n=a[t]??a[a.length-1]}}n?.focus()};return(0,s.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":n},e),children:i.map(({value:e,label:n,attributes:r})=>(0,s.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{a.push(e)},onKeyDown:h,onClick:p,...r,className:(0,o.A)("tabs__item",d.A.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function h({lazy:e,children:n,selectedValue:t}){let i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){let e=i.find(e=>e.props.value===t);return e?(0,r.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,s.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function y(e){let n=(0,a.u)(e);return(0,s.jsxs)("div",{className:(0,o.A)(i.G.tabs.container,"tabs-container",d.A.tabList),children:[(0,s.jsx)(p,{...n,...e}),(0,s.jsx)(h,{...n,...e})]})}function u(e){let n=(0,c.A)();return(0,s.jsx)(y,{...e,children:(0,a.v)(e.children)},String(n))}},106632(e,n,t){t.d(n,{u:()=>p,v:()=>c});var s=t(830758),r=t(325557),o=t(363717),i=t(125740),l=t(574229),a=t(270367);function c(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function d({value:e,tabValues:n}){return n.some(n=>n.value===e)}function p(e){let n,{defaultValue:t,queryString:p=!1,groupId:h}=e,y=function(e){let{values:n,children:t}=e;return(0,s.useMemo)(()=>{let e=n??c(t).map(({props:{value:e,label:n,attributes:t,default:s}})=>({value:e,label:n,attributes:t,default:s})),s=(0,l.XI)(e,(e,n)=>e.value===n.value);if(s.length>0)throw Error(`Docusaurus error: Duplicate values "${s.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[n,t])}(e),[u,m]=(0,s.useState)(()=>(function({defaultValue:e,tabValues:n}){if(0===n.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!d({value:e,tabValues:n}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let t=n.find(e=>e.default)??n[0];if(!t)throw Error("Unexpected error: 0 tabValues");return t.value})({defaultValue:t,tabValues:y})),[g,x]=function({queryString:e=!1,groupId:n}){let t=(0,r.W6)(),o=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,i.aZ)(o),(0,s.useCallback)(e=>{if(!o)return;let n=new URLSearchParams(t.location.search);n.set(o,e),t.replace({...t.location,search:n.toString()})},[o,t])]}({queryString:p,groupId:h}),[f,j]=function({groupId:e}){let n=e?`docusaurus.tab.${e}`:null,[t,r]=(0,a.Dv)(n);return[t,(0,s.useCallback)(e=>{n&&r.set(e)},[n,r])]}({groupId:h}),b=d({value:n=g??f,tabValues:y})?n:null;return(0,o.A)(()=>{b&&m(b)},[b]),{selectedValue:u,selectValue:(0,s.useCallback)(e=>{if(!d({value:e,tabValues:y}))throw Error(`Can't select invalid tab value=${e}`);m(e),x(e),j(e)},[x,j,y]),tabValues:y}}},848193(e,n,t){t.d(n,{R:()=>i,x:()=>l});var s=t(830758);let r={},o=s.createContext(r);function i(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:n},e.children)}},24475(e){e.exports=JSON.parse('{"id":"docs/python/goals/check","title":"check","description":"How to use MyPy.","source":"@site/versioned_docs/version-2.17/docs/python/goals/check.mdx","sourceDirName":"docs/python/goals","slug":"/docs/python/goals/check","permalink":"/2.17/docs/python/goals/check","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/python/goals/check.mdx","tags":[],"version":"2.17","sidebarPosition":0,"frontMatter":{"title":"check","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Goals","permalink":"/2.17/docs/python/goals/"},"next":{"title":"fmt","permalink":"/2.17/docs/python/goals/fmt"}}')}}]);