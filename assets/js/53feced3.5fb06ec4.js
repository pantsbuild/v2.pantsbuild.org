"use strict";(self.webpackChunkpantsbuild_org=self.webpackChunkpantsbuild_org||[]).push([["98736"],{920384(e,t,s){s.r(t),s.d(t,{assets:()=>h,contentTitle:()=>o,default:()=>p,frontMatter:()=>c,metadata:()=>n,toc:()=>d});var n=s(102888),l=s(886070),r=s(848193),i=s(685008),a=s(637180);let c={title:"Overview",sidebar_position:0},o,h={},d=[{value:"Initial setup: add <code>shell_library</code> targets",id:"initial-setup-add-shell_library-targets",level:2},{value:"shfmt autoformatter",id:"shfmt-autoformatter",level:2},{value:"Shellcheck linter",id:"shellcheck-linter",level:2},{value:"shUnit2 test runner",id:"shunit2-test-runner",level:2},{value:"Controlling output",id:"controlling-output",level:3},{value:"Force reruns with <code>--force</code>",id:"force-reruns-with---force",level:3},{value:"Setting environment variables",id:"setting-environment-variables",level:3},{value:"Timeouts",id:"timeouts",level:3},{value:"Testing your packaging pipeline",id:"testing-your-packaging-pipeline",level:3}];function u(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.p,{children:"Pants's support for Shellcheck, shfmt, and shUnit2."}),"\n",(0,l.jsx)(t.hr,{}),"\n",(0,l.jsx)(t.p,{children:"Pants integrates with these tools to empower you to follow best practices with your Shell scripts:"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.a,{href:"https://www.shellcheck.net",children:"Shellcheck"}),": lint for common Shell mistakes."]}),"\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.a,{href:"https://github.com/mvdan/sh",children:"shfmt"}),": autoformat Shell code so that you can instead focus on the logic."]}),"\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.a,{href:"https://github.com/kward/shunit2/",children:"shUnit2"}),": write light-weight unit tests for your Shell code."]}),"\n"]}),"\n",(0,l.jsxs)(t.p,{children:["Pants installs these tools deterministically and integrates them into the workflows you already use: ",(0,l.jsx)(t.code,{children:"./pants fmt"}),", ",(0,l.jsx)(t.code,{children:"./pants lint"}),", and ",(0,l.jsx)(t.code,{children:"./pants test"}),"."]}),"\n",(0,l.jsxs)(t.h2,{id:"initial-setup-add-shell_library-targets",children:["Initial setup: add ",(0,l.jsx)(t.code,{children:"shell_library"})," targets"]}),"\n",(0,l.jsxs)(t.p,{children:["Pants uses ",(0,l.jsx)(t.code,{children:"shell_library"})," ",(0,l.jsx)(t.a,{href:"/2.6/docs/using-pants/key-concepts/targets-and-build-files",children:"targets"})," to know which Shell files you want Pants to know about and to add additional metadata. It also uses ",(0,l.jsx)(t.code,{children:"shunit2_tests"})," targets for test support."]}),"\n",(0,l.jsxs)(t.p,{children:["First, activate the Shell backend in your ",(0,l.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'backend_packages = [\n  "pants.backend.shell",\n]\n'})}),"\n",(0,l.jsxs)(t.p,{children:["Then, run ",(0,l.jsx)(t.a,{href:"docs:create-initial-build-files",children:(0,l.jsx)(t.code,{children:"./pants tailor"})})," on a clean branch to autogenerate BUILD files:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:"$ ./pants tailor\nCreated scripts/BUILD:\n  - Added shell_library target scripts\nCreated scripts/subdir/BUILD:\n  - Added shell_library target scripts/subdir\n"})}),"\n",(0,l.jsxs)(t.p,{children:["You can also manually add targets, which is necessary if you have any scripts that don't end in ",(0,l.jsx)(t.code,{children:".sh"}),":"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-python",children:'shell_library(name="scripts", sources=["script_without_an_extension", "*.sh"])\n'})}),"\n",(0,l.jsxs)(t.admonition,{title:"Shell dependency inference",type:"note",children:[(0,l.jsxs)(t.p,{children:["Pants will ",(0,l.jsx)(t.a,{href:"/2.6/docs/learn-about-pants/how-does-pants-2-work#dependency-inference",children:"infer dependencies"})," by looking for imports like ",(0,l.jsx)(t.code,{children:"source script.sh"})," and ",(0,l.jsx)(t.code,{children:". script.sh"}),". You can check that the correct dependencies are inferred by running ",(0,l.jsx)(t.code,{children:"./pants dependencies path/to/script.sh"})," and ",(0,l.jsx)(t.code,{children:"./pants dependencies --transitive path/to/script.sh"}),"."]}),(0,l.jsx)(t.p,{children:"Normally, Pants will not understand dynamic sources, e.g. using variable expansion. However, Pants uses Shellcheck for parsing, so you can use Shellcheck's syntax to give a hint to Pants:"}),(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-shell",children:'another_script="dir/some_script.sh"\n\n# Normally Pants couldn\'t infer this, but we can give a hint like this:\n# shellcheck source=dir/some_script.sh\nsource "${another_script}"\n'})}),(0,l.jsxs)(t.p,{children:["Alternatively, you can explicitly add ",(0,l.jsx)(t.code,{children:"dependencies"})," in the relevant BUILD file."]}),(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-python",children:'shell_library(dependencies=["path/to:shell_library"])\n'})})]}),"\n",(0,l.jsx)(t.h2,{id:"shfmt-autoformatter",children:"shfmt autoformatter"}),"\n",(0,l.jsxs)(t.p,{children:["To activate, add this to your ",(0,l.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = [\n  "pants.backend.shell",\n  "pants.backend.shell.lint.shfmt",\n]\n'})}),"\n",(0,l.jsxs)(t.p,{children:["Make sure that you also have set up ",(0,l.jsx)(t.code,{children:"shell_library"})," and/or ",(0,l.jsx)(t.code,{children:"shunit2_tests"})," targets so that Pants knows to operate on those files."]}),"\n",(0,l.jsxs)(t.p,{children:["Now you can run ",(0,l.jsx)(t.code,{children:"./pants fmt"})," and ",(0,l.jsx)(t.code,{children:"./pants lint"}),":"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:'$ ./pants lint scripts/my_script.sh\n13:05:56.34 [WARN] Completed: lint - shfmt failed (exit code 1).\n--- scripts/my_script.sh.orig\n+++ scripts/my_script.sh\n@@ -9,7 +9,7 @@\n\n set -eo pipefail\n\n-HERE=$(cd "$(dirname "${BASH_SOURCE[0]}")" && \\\n+HERE=$(cd "$(dirname "${BASH_SOURCE[0]}")" &&\n   pwd)\n\n\u{10102} shfmt failed.\n'})}),"\n",(0,l.jsxs)(t.p,{children:["Pants will automatically include any relevant ",(0,l.jsx)(t.code,{children:".editorconfig"})," files in the run. You can also pass command line arguments with ",(0,l.jsx)(t.code,{children:"--shfmt-args='-ci -sr'"})," or permanently set them in ",(0,l.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-toml",children:'[shfmt]\nargs = ["-i 2", "-ci", "-sr"]\n'})}),"\n",(0,l.jsxs)(t.p,{children:["Temporarily disable shfmt with ",(0,l.jsx)(t.code,{children:"--shfmt-skip"}),":"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"./pants --shfmt-skip fmt ::\n"})}),"\n",(0,l.jsxs)(t.admonition,{title:"Benefit of Pants: shfmt runs in parallel with Python formatters",type:"tip",children:[(0,l.jsxs)(t.p,{children:["Normally, Pants runs formatters sequentially so that it can pipe the results of one formatter into the next. However, Pants will run shfmt in parallel to formatters for other languages, ",(0,l.jsx)(t.a,{href:"/2.6/docs/python/overview/linters-and-formatters",children:"like Python"}),", because shfmt does not operate on those languages."]}),(0,l.jsx)(t.p,{children:"You can see this concurrency through Pants's dynamic UI."})]}),"\n",(0,l.jsx)(t.h2,{id:"shellcheck-linter",children:"Shellcheck linter"}),"\n",(0,l.jsxs)(t.p,{children:["To activate, add this to your ",(0,l.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[GLOBAL]\nbackend_packages = [\n  "pants.backend.shell",\n  "pants.backend.shell.lint.shellcheck",\n]\n'})}),"\n",(0,l.jsxs)(t.p,{children:["Make sure that you also have set up ",(0,l.jsx)(t.code,{children:"shell_library"})," and/or ",(0,l.jsx)(t.code,{children:"shunit2_tests"})," targets so that Pants knows to operate on those files."]}),"\n",(0,l.jsxs)(t.p,{children:["Now you can run ",(0,l.jsx)(t.code,{children:"./pants lint"}),":"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:"$ ./pants lint scripts/my_script.sh\n13:09:10.49 [WARN] Completed: lint - Shellcheck failed (exit code 1).\n\nIn scripts/my_script.sh line 12:\nHERE=$(cd $(dirname ${BASH_SOURCE[0]}) && pwd)\n          ^--------------------------^ SC2046: Quote this to prevent word splitting.\n                    ^---------------^ SC2086: Double quote to prevent globbing and word splitting.\n\nDid you mean:\n...\n\n\u{10102} Shellcheck failed.\n"})}),"\n",(0,l.jsxs)(t.p,{children:["Pants will automatically include any relevant ",(0,l.jsx)(t.code,{children:".shellcheckrc"})," and ",(0,l.jsx)(t.code,{children:"shellcheckrc"})," files in the run. You can also pass command line arguments with ",(0,l.jsx)(t.code,{children:"--shellcheck-args='-x -W 3'"})," or permanently set them in ",(0,l.jsx)(t.code,{children:"pants.toml"}),":"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-toml",children:'[shellcheck]\nargs = ["--external-sources", "--wiki-link-count=3"]\n'})}),"\n",(0,l.jsxs)(t.p,{children:["Temporarily disable Shellcheck with ",(0,l.jsx)(t.code,{children:"--shellcheck-skip"}),":"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"./pants --shellcheck-skip lint ::\n"})}),"\n",(0,l.jsx)(t.admonition,{title:"Benefit of Pants: Shellcheck runs in parallel with other linters",type:"tip",children:(0,l.jsxs)(t.p,{children:["Pants will attempt to run all activated linters and formatters at the same time for improved performance, including ",(0,l.jsx)(t.a,{href:"/2.6/docs/python/overview/linters-and-formatters",children:"Python linters"}),". You can see this through Pants's dynamic UI."]})}),"\n",(0,l.jsx)(t.h2,{id:"shunit2-test-runner",children:"shUnit2 test runner"}),"\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.a,{href:"https://github.com/kward/shunit2/",children:"shUnit2"})," allows you to write lightweight unit tests for your Shell code."]}),"\n",(0,l.jsx)(t.p,{children:"To use shunit2 with Pants:"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["Create a test file like ",(0,l.jsx)(t.code,{children:"tests.sh"}),", ",(0,l.jsx)(t.code,{children:"test_foo.sh"}),", or ",(0,l.jsx)(t.code,{children:"foo_test.sh"}),".","\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["Refer to ",(0,l.jsx)(t.a,{href:"https://github.com/kward/shunit2/",children:"https://github.com/kward/shunit2/"})," for how to write shUnit2 tests."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["Create a ",(0,l.jsx)(t.code,{children:"shunit2_tests"})," target in the directory's BUILD file.","\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["You can run ",(0,l.jsx)(t.a,{href:"/2.6/docs/learn-about-pants/getting-started/create-initial-build-files",children:(0,l.jsx)(t.code,{children:"./pants tailor"})})," to automate this step."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["Specify which shell to run your tests with, either by setting a shebang directly in the test file or by setting the field ",(0,l.jsx)(t.code,{children:"shell"})," on the ",(0,l.jsx)(t.code,{children:"shunit2_tests"})," target.","\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["See ",(0,l.jsx)(t.a,{href:"/2.6/reference/targets/shunit2_tests#shell",children:"here"})," for all supported shells."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(i.A,{groupId:"code-examples",children:[(0,l.jsx)(a.A,{value:"scripts/tests.sh",label:"scripts/tests.sh",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-shell",metastring:'tab={"label":"scripts/tests.sh"}',children:"#!/usr/bin/env bash\n\ntestEquality() {\n  assertEquals 1 1\n}\n"})})}),(0,l.jsx)(a.A,{value:"scripts/build",label:"scripts/BUILD",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"scripts/BUILD"}',children:"shunit2_tests()\n"})})})]}),"\n",(0,l.jsx)(t.p,{children:"You can then run your tests like this:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"# Run all tests in the repository.\n./pants test ::\n\n# Run all the tests in this target.\n./pants test scripts:tests\n\n# Run just the tests in this file.\n./pants test scripts/tests.sh\n"})}),"\n",(0,l.jsxs)(t.p,{children:["Pants will download the ",(0,l.jsx)(t.code,{children:"./shunit2"})," script and will add ",(0,l.jsx)(t.code,{children:"source ./shunit2"})," with the correct relpath for you."]}),"\n",(0,l.jsxs)(t.p,{children:["You can import your production code by using ",(0,l.jsx)(t.code,{children:"source"}),". Make sure the code belongs to a ",(0,l.jsx)(t.code,{children:"shell_library"})," target. Pants's ",(0,l.jsx)(t.a,{href:"/2.6/docs/using-pants/key-concepts/targets-and-build-files",children:"dependency inference"})," will add the relevant dependencies, which you can confirm by running ",(0,l.jsx)(t.code,{children:"./pants dependencies scripts/tests.sh"}),". You can also manually add to the ",(0,l.jsx)(t.code,{children:"dependencies"})," field of your ",(0,l.jsx)(t.code,{children:"shunit2_tests"})," target."]}),"\n",(0,l.jsxs)(i.A,{groupId:"code-examples",children:[(0,l.jsx)(a.A,{value:"scripts/tests.sh",label:"scripts/tests.sh",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-shell",metastring:'tab={"label":"scripts/tests.sh"}',children:"#!/usr/bin/bash\n\nsource scripts/lib.sh\n\ntestAdd() {\n    assertEquals $(add_one 4) 5\n}\n"})})}),(0,l.jsx)(a.A,{value:"scripts/lib.sh",label:"scripts/lib.sh",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-shell",metastring:'tab={"label":"scripts/lib.sh"}',children:"add_one() {\n    echo $(($1 + 1))\n}\n"})})}),(0,l.jsx)(a.A,{value:"scripts/build",label:"scripts/BUILD",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-shell",metastring:'tab={"label":"scripts/BUILD"}',children:'shell_library()\nshell_tests(name="tests")\n'})})})]}),"\n",(0,l.jsxs)(t.admonition,{title:"Running your tests with multiple shells",type:"note",children:[(0,l.jsx)(t.p,{children:"Pants allows you to run the same tests against multiple shells, e.g. Bash and Zsh, to ensure your code works with each shell."}),(0,l.jsxs)(t.p,{children:["To test multiple shells, create a distinct ",(0,l.jsx)(t.code,{children:"shunit2_tests"})," target for each shell, like this:"]}),(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-python",children:'shunit2_tests(name="tests_bash", shell="bash")\nshunit2_tests(name="tests_zsh", shell="zsh")\n'})}),(0,l.jsxs)(t.p,{children:["Then, use ",(0,l.jsx)(t.code,{children:"./pants test"}),":"]}),(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"# Run tests with both shells.\n./pants test scripts/tests.sh\n\n# Run tests with only Zsh.\n./pants test scripts/tests.sh:tests_zsh\n"})})]}),"\n",(0,l.jsx)(t.h3,{id:"controlling-output",children:"Controlling output"}),"\n",(0,l.jsxs)(t.p,{children:["By default, Pants only shows output for failed tests. You can change this by setting ",(0,l.jsx)(t.code,{children:"--test-output"})," to one of ",(0,l.jsx)(t.code,{children:"all"}),", ",(0,l.jsx)(t.code,{children:"failed"}),", or ",(0,l.jsx)(t.code,{children:"never"}),", e.g. ",(0,l.jsx)(t.code,{children:"./pants test --output=all ::"}),"."]}),"\n",(0,l.jsxs)(t.p,{children:["You can permanently set the output format in your ",(0,l.jsx)(t.code,{children:"pants.toml"})," like this:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[test]\noutput = "all"\n'})}),"\n",(0,l.jsxs)(t.h3,{id:"force-reruns-with---force",children:["Force reruns with ",(0,l.jsx)(t.code,{children:"--force"})]}),"\n",(0,l.jsxs)(t.p,{children:["To force your tests to run again, rather than reading from the cache, run ",(0,l.jsx)(t.code,{children:"./pants test --force path/to/test.sh"}),"."]}),"\n",(0,l.jsx)(t.h3,{id:"setting-environment-variables",children:"Setting environment variables"}),"\n",(0,l.jsxs)(t.p,{children:["Test runs are ",(0,l.jsx)(t.em,{children:"hermetic"}),", meaning that they are stripped of the parent ",(0,l.jsx)(t.code,{children:"./pants"})," process's environment variables. This is important for reproducibility, and it also increases cache hits."]}),"\n",(0,l.jsxs)(t.p,{children:["To add any arbitrary environment variable back to the process, use the option ",(0,l.jsx)(t.code,{children:"extra_env_vars"})," in the ",(0,l.jsx)(t.code,{children:"[test]"}),' options scope. You can hardcode a value for the option, or leave off a value to "allowlist" it and read from the parent ',(0,l.jsx)(t.code,{children:"./pants"})," process's environment."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[test]\nextra_env_vars = ["VAR1", "VAR2=hardcoded_value"]\n'})}),"\n",(0,l.jsxs)(t.p,{children:["Use ",(0,l.jsx)(t.code,{children:"[bash-setup].executable_search_paths"})," to change the ",(0,l.jsx)(t.code,{children:"$PATH"})," env var used during test runs. You can use the special string ",(0,l.jsx)(t.code,{children:'"<PATH>"'})," to read the value from the parent ",(0,l.jsx)(t.code,{children:"./pants"})," process's environment."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-toml",metastring:'title="pants.toml"',children:'[bash-setup]\nexecutable_search_paths = ["/usr/bin", "<PATH>"]\n'})}),"\n",(0,l.jsx)(t.h3,{id:"timeouts",children:"Timeouts"}),"\n",(0,l.jsx)(t.p,{children:"Pants can cancel tests that take too long, which is useful to prevent tests from hanging indefinitely."}),"\n",(0,l.jsxs)(t.p,{children:["To add a timeout, set the ",(0,l.jsx)(t.code,{children:"timeout"})," field to an integer value of seconds, like this:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-python",metastring:'title="BUILD"',children:'shunit2_tests(name="tests", timeout=120)\n'})}),"\n",(0,l.jsxs)(t.p,{children:["This timeout will apply to each file belonging to the ",(0,l.jsx)(t.code,{children:"shunit2_tests"})," target, meaning that ",(0,l.jsx)(t.code,{children:"test_f1.sh"})," will have a timeout of 120 seconds and ",(0,l.jsx)(t.code,{children:"test_f2.sh"})," will have a timeout of 120 seconds. If you want finer-grained timeouts, create a dedicated ",(0,l.jsx)(t.code,{children:"shunit2_tests"})," target for each file:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-shell",metastring:'title="BUILD"',children:'shunit2_tests(\n    name="test_f1",\n    sources=["test_f1.sh"],\n    timeout=20,\n)\n\nshunit2_tests(\n    name="test_f2",\n    sources=["test_f2.sh"],\n    timeout=35,\n)\n'})}),"\n",(0,l.jsxs)(t.p,{children:["Unlike ",(0,l.jsx)(t.a,{href:"/2.6/docs/python/goals/test#timeouts",children:"with Python"}),", you cannot yet set a default or maximum timeout value, nor temporarily disable all timeouts. Please ",(0,l.jsx)(t.a,{href:"/community/getting-help",children:"let us know"})," if you would like this feature."]}),"\n",(0,l.jsx)(t.h3,{id:"testing-your-packaging-pipeline",children:"Testing your packaging pipeline"}),"\n",(0,l.jsxs)(t.p,{children:["You can include the result of ",(0,l.jsx)(t.code,{children:"./pants package"})," in your test through the ",(0,l.jsx)(t.code,{children:"runtime_package_dependencies field"}),". Pants will run the equivalent of ",(0,l.jsx)(t.code,{children:"./pants package"})," beforehand and copy the built artifact into the test's chroot, allowing you to test things like that the artifact has the correct files present and that it's executable."]}),"\n",(0,l.jsxs)(t.p,{children:["This allows you to test your packaging pipeline by simply running ",(0,l.jsx)(t.code,{children:"./pants test ::"}),", without needing custom integration test scripts."]}),"\n",(0,l.jsxs)(t.p,{children:["To depend on a built package, use the ",(0,l.jsx)(t.code,{children:"runtime_package_dependencies"})," field on the ",(0,l.jsx)(t.code,{children:"shunit2_tests"})," target, which is a list of addresses to targets that can be built with ",(0,l.jsx)(t.code,{children:"./pants package"}),", such as ",(0,l.jsx)(t.a,{href:"/2.6/docs/python/goals/package",children:(0,l.jsx)(t.code,{children:"pex_binary"})}),", ",(0,l.jsx)(t.a,{href:"/2.6/docs/python/integrations/aws-lambda",children:(0,l.jsx)(t.code,{children:"python_awslambda"})}),", and ",(0,l.jsx)(t.a,{href:"/2.6/docs/using-pants/resources-and-archives",children:(0,l.jsx)(t.code,{children:"archive"})})," targets. Pants will build the package before running your test, and insert the file into the test's chroot. It will use the same name it would normally use with ",(0,l.jsx)(t.code,{children:"./pants package"}),", except without the ",(0,l.jsx)(t.code,{children:"dist/"})," prefix."]}),"\n",(0,l.jsx)(t.p,{children:"For example:"}),"\n",(0,l.jsxs)(i.A,{groupId:"code-examples",children:[(0,l.jsx)(a.A,{value:"helloworld/build",label:"helloworld/BUILD",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"helloworld/BUILD"}',children:'python_library()\npex_binary(name="bin", entry_point="say_hello.py")\n\nshunit2_tests(\n    name="tests",\n    runtime_package_dependencies=[":bin"],\n)\n'})})}),(0,l.jsx)(a.A,{value:"helloworld/say_hello.py",label:"helloworld/say_hello.py",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-python",metastring:'tab={"label":"helloworld/say_hello.py"}',children:'print("Hello, test!")\n'})})}),(0,l.jsx)(a.A,{value:"helloworld/tests.sh",label:"helloworld/tests.sh",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-shell",metastring:'tab={"label":"helloworld/tests.sh"}',children:'#!/usr/bin/bash\n\ntestArchiveCreated() {\n  assertTrue "[[ -f helloworld/say_hello.pex ]]"\n}\n'})})})]})]})}function p(e={}){let{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(u,{...e})}):u(e)}},753348(e,t,s){s.d(t,{A:()=>n});let n={tabItem:"tabItem_mHvh"}},618264(e,t,s){s.d(t,{A:()=>n});let n={tabList:"tabList_sFbf",tabItem:"tabItem_UVfV"}},637180(e,t,s){s.d(t,{A:()=>i});var n=s(886070);s(830758);var l=s(313526),r=s(753348);function i({children:e,hidden:t,className:s}){return(0,n.jsx)("div",{role:"tabpanel",className:(0,l.A)(r.A.tabItem,s),hidden:t,children:e})}},685008(e,t,s){s.d(t,{A:()=>m});var n=s(886070),l=s(830758),r=s(313526),i=s(911212),a=s(274875),c=s(106632),o=s(189223),h=s(618264);function d({className:e,block:t,selectedValue:s,selectValue:l,tabValues:i}){let c=[],{blockElementScrollPositionUntilNextRender:o}=(0,a.a_)(),d=e=>{let t=e.currentTarget,n=i[c.indexOf(t)].value;n!==s&&(o(t),l(n))},u=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let s=c.indexOf(e.currentTarget)+1;t=c[s]??c[0];break}case"ArrowLeft":{let s=c.indexOf(e.currentTarget)-1;t=c[s]??c[c.length-1]}}t?.focus()};return(0,n.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},e),children:i.map(({value:e,label:t,attributes:l})=>(0,n.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{c.push(e)},onKeyDown:u,onClick:d,...l,className:(0,r.A)("tabs__item",h.A.tabItem,l?.className,{"tabs__item--active":s===e}),children:t??e},e))})}function u({lazy:e,children:t,selectedValue:s}){let i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){let e=i.find(e=>e.props.value===s);return e?(0,l.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,n.jsx)("div",{className:"margin-top--md",children:i.map((e,t)=>(0,l.cloneElement)(e,{key:t,hidden:e.props.value!==s}))})}function p(e){let t=(0,c.u)(e);return(0,n.jsxs)("div",{className:(0,r.A)(i.G.tabs.container,"tabs-container",h.A.tabList),children:[(0,n.jsx)(d,{...t,...e}),(0,n.jsx)(u,{...t,...e})]})}function m(e){let t=(0,o.A)();return(0,n.jsx)(p,{...e,children:(0,c.v)(e.children)},String(t))}},106632(e,t,s){s.d(t,{u:()=>d,v:()=>o});var n=s(830758),l=s(325557),r=s(363717),i=s(125740),a=s(574229),c=s(270367);function o(e){return n.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,n.isValidElement)(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h({value:e,tabValues:t}){return t.some(t=>t.value===e)}function d(e){let t,{defaultValue:s,queryString:d=!1,groupId:u}=e,p=function(e){let{values:t,children:s}=e;return(0,n.useMemo)(()=>{let e=t??o(s).map(({props:{value:e,label:t,attributes:s,default:n}})=>({value:e,label:t,attributes:s,default:n})),n=(0,a.XI)(e,(e,t)=>e.value===t.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[t,s])}(e),[m,x]=(0,n.useState)(()=>(function({defaultValue:e,tabValues:t}){if(0===t.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:t}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let s=t.find(e=>e.default)??t[0];if(!s)throw Error("Unexpected error: 0 tabValues");return s.value})({defaultValue:s,tabValues:p})),[j,g]=function({queryString:e=!1,groupId:t}){let s=(0,l.W6)(),r=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,i.aZ)(r),(0,n.useCallback)(e=>{if(!r)return;let t=new URLSearchParams(s.location.search);t.set(r,e),s.replace({...s.location,search:t.toString()})},[r,s])]}({queryString:d,groupId:u}),[f,b]=function({groupId:e}){let t=e?`docusaurus.tab.${e}`:null,[s,l]=(0,c.Dv)(t);return[s,(0,n.useCallback)(e=>{t&&l.set(e)},[t,l])]}({groupId:u}),y=h({value:t=j??f,tabValues:p})?t:null;return(0,r.A)(()=>{y&&x(y)},[y]),{selectedValue:m,selectValue:(0,n.useCallback)(e=>{if(!h({value:e,tabValues:p}))throw Error(`Can't select invalid tab value=${e}`);x(e),g(e),b(e)},[g,b,p]),tabValues:p}}},848193(e,t,s){s.d(t,{R:()=>i,x:()=>a});var n=s(830758);let l={},r=n.createContext(l);function i(e){let t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),n.createElement(r.Provider,{value:t},e.children)}},102888(e){e.exports=JSON.parse('{"id":"docs/shell/overview","title":"Overview","description":"Pants\'s support for Shellcheck, shfmt, and shUnit2.","source":"@site/versioned_docs/version-2.6/docs/shell/overview.mdx","sourceDirName":"docs/shell","slug":"/docs/shell/overview","permalink":"/2.6/docs/shell/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/pantsbuild/pants/edit/main/docs/docs/shell/overview.mdx","tags":[],"version":"2.6","sidebarPosition":0,"frontMatter":{"title":"Overview","sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Jupyter","permalink":"/2.6/docs/python/integrations/jupyter"},"next":{"title":"Overview","permalink":"/2.6/docs/writing-plugins/overview"}}')}}]);